

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en-US" > <![endif]-->
<!--[if gt IE 8]><!-->
<html class="no-js" lang="en-US"> <!--<![endif]-->

<head>
  <!-- cookie consent -->
  
    <!-- Combined Onetrust and Rudderstack Implementation Scripts -->
    <!-- Onetrust Initialization -->
    <script type="text/javascript" src="https://cdn.cookielaw.org/consent/92466579-1717-44d3-809d-a05fb02843ed-test/OtAutoBlock.js"></script>
    <script src="https://cdn.cookielaw.org/scripttemplates/otSDKStub.js" data-document-language="true" type="text/javascript" charset="UTF-8" data-domain-script="92466579-1717-44d3-809d-a05fb02843ed-test"></script>
    <link rel="stylesheet" id="db-onetrust-style" href="https://www.databricks.com/wp-content/uploads/db_onetrust.css" media="all" />
    <!-- Setting Rudderstack Write Key -->
    <script>window.rudderstackKey = "2SOR9fvSr5Fi6tN2ihPbVHnX1SZ" </script>
    <!-- Rudderstack Initialization + Onetrust Integration + Rudderstack Custom Events -->
    <script type="text/javascript" src="https://www.databricks.com/sites/default/files/rudderstack/v1/db-rudderstack-events.js"></script>

  <!-- cookie consent -->

  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta http-equiv="X-UA-Compatible" content="IE=9" />
  <meta content="Learn how to create a Databricks workflow that ingests, transforms, analyzes, and visualizes data using Delta Live Tables and Databricks SQL." name="description" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0">
  <meta property="og:image" content="https://www.databricks.com/wp-content/uploads/2020/04/og-databricks.png">
  <meta property="og:image:type" content="image/png">
  <meta property="og:title" content="Use Databricks SQL in a Databricks job">
  <meta property="og:image:width" content="1200">
  <meta property="og:image:height" content="630">
  <meta property="og:type" content="website">
  <meta property="og:url" content="https://docs.databricks.com">
  <meta property="og:description" content="" id="og-description">
  <meta name="twitter:image" content="https://www.databricks.com/wp-content/uploads/2020/04/og-databricks.png">
  <meta name="twitter:site" content="@databricks">
  <meta name="twitter:creator" content="@databricks">
  <meta property="twitter:description" content="">
  
  <title>Use Databricks SQL in a Databricks job &#124; Databricks on AWS</title>
  
  
  <link rel="canonical" href="https://docs.databricks.com/en/workflows/jobs/how-to/use-dbsql-in-workflows.html">
  <!-- Start hreflang tag -->
  <link rel="alternate" hreflang="en" href="https://docs.databricks.com/en/workflows/jobs/how-to/use-dbsql-in-workflows.html" />
<link rel="alternate" hreflang="x-default" href="https://docs.databricks.com/en/workflows/jobs/how-to/use-dbsql-in-workflows.html" />
  <!-- End hreflang tag -->
  
  
  <link rel="shortcut icon" href="../../../_static/favicon.ico" />
  

  

  

  <!-- Google Tag Manager -->
  <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'https://www.googletagmanager.com/gtm.js?id='+i+dl;
j.setAttributeNode(d.createAttribute('data-ot-ignore'));
f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-T85FQ33');</script>
  <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'https://www.googletagmanager.com/gtm.js?id='+i+dl;
j.setAttributeNode(d.createAttribute('data-ot-ignore'));
f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-TWTKQQ');</script>
    
  <!-- End Google Tag Manager -->


  <!-- MaxMind / GEO IP -->
  <script src="//js.maxmind.com/js/apis/geoip2/v2.1/geoip2.js" type="text/javascript"></script>
  <!-- End MaxMind / GEO IP -->

  
  
  <link href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,600&display=swap" rel="stylesheet">
  <link rel="preload" href="../../../_static/fonts/DMSans-Bold.ttf" as="font">
  <link rel="preload" href="../../../_static/fonts/DMSans-Regular.ttf" as="font">
  <link rel="preload" href="../../../_static/fonts/DMMono-Regular.ttf" as="font">
  <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/css/custom.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/css/cloud-provider-selector.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/css/translation-selector.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/css/searchunify/main.css" type="text/css" />

  
  <link rel="index" title="Index" href="../../../genindex.html" />
  <link rel="search" title="Search" href="../../../search.html" />
  <link rel="top" title="Databricks on AWS" href="../../../index.html" /> 
</head>

<body class="wy-body-for-nav" role="document">

  <!-- Google Tag Manager (noscript) -->
  <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-T85FQ33"
height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
  <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-TWTKQQ"
    height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
  <!-- End Google Tag Manager (noscript) -->

  
  <nav class="wy-nav-top header su_header" role="navigation" aria-label="top navigation">
    
<nav class="wy-nav-top header su_header" role="navigation" aria-label="top navigation">
  <div class="container-logo">
    <ul class="mobile-menu-toggle">
        <li class="menu-toggle">
            <i data-toggle="wy-nav-top" class="wy-nav-top-menu-button db-icon db-icon-menu pull-left"></i>
            
            <a href="https://www.databricks.com/" class="wy-nav-top-logo"><img src="../../../_static/small-scale-lockup-full-color-rgb.svg" width="137" height="21"
              alt="Databricks" /></a>   
               
              </li>
    </ul>
    <ul class="su_nav-menu">
      <li class="menu-toggle">
        <i data-toggle="wy-nav-top" class="wy-nav-top-menu-button db-icon db-icon-menu pull-left"></i>
        
          
        
        <a href="https://www.databricks.com/" class="wy-nav-top-logo"><img src="../../../_static/small-scale-lockup-full-color-rgb.svg" width="137" height="21"
            alt="Databricks" /></a></li>
        <!-- 
<li><a href="https://help.databricks.com/s/">Help Center</a></li>
<li class="active"><a href="https://docs.databricks.com/en/">Documentation</a></li>
<li><a href="https://kb.databricks.com/">Knowledge Base</a></li>
 -->
    </ul>
  </div>
  <div class="su_nav-right">
    <ul class="su_link-mobile">
  <!-- Mobile header code can go here -->
</ul>
<ul class="right-try-list">
   
</ul>
  </div>
</nav>
  </nav>

  <div class="su_sub-header">
    <div class="container">
      <div class="su_sub-header-inner">
        <!-- <div class="su_subnav-menu-right">
  <div id="auto" style="width: 100%;">
    <div ng-controller="SearchautoController">
      <div bind-html-compile="autocompleteHtml">
        <form class="su__search-box-1" disabled="disabled">
          <input class="su__search-input" type="search" name="Search box" id="su__search-b" placeholder="Search Documentation" disabled="disabled"/>
          <button class="su__search-button" type="submit" class="button button-success" disabled="disabled">
            <svg width="24" height="24" viewBox="0 0 24 24">
              <path
                d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"
                fill="#333"></path>
            </svg>
          </button>
        </form>
      </div>
    </div>
  </div>
</div> -->
        <div class="search-lng-gap"></div>
        <div style="margin-left: 16px; margin-right: 16px;">
          <!-- <select name="lng selector" id="lng-selector">
    <option value="../../../../en/workflows/jobs/how-to/use-dbsql-in-workflows.html" class="notranslate">English</option>
    <option value="../../../../ja/workflows/jobs/how-to/use-dbsql-in-workflows.html" class="notranslate">日本語</option>
    <option value="../../../../pt/workflows/jobs/how-to/use-dbsql-in-workflows.html" class="notranslate">Português (Brasil)</option>
</select> -->
        </div>
        <div class="cloud-selector-container">
          <!-- <select name="cloud provider selector" id="cloud-provider-selector">
    <option value="aws" selected class="notranslate">
        Amazon Web Services
    </option>
    <option value="azure"  class="notranslate">
        Microsoft Azure
    </option>
    <option value="gcp"  class="notranslate">
        Google Cloud Platform
    </option>
</select> -->
        </div>
      </div>
    </div>
  </div>
  <page class="js-page-container">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side su_nav-side">
<div class="wy-side-scroll">
  <div class="wy-side-nav-search">
    

    

    

    
  </div>

  <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
    
      <a href="../../../index.html" class="main-navigation-home">Databricks on AWS</a>
    

    
      

      
        <p class="caption"><span class="caption-text">Load &amp; manage data</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../rag-temp/index.html">RAG Studio</a></li>
</ul>

      
    
  </div>

  <div role="contentinfo">
    
  <p class="build_info notranslate"data-last-edit="December 23, 2023">
    Updated Jan 11, 2024
  </p>
<script>
  window.addEventListener('DOMContentLoaded',function(){
    var h1=document.querySelector('h1');
    var bi=document.querySelector('[data-last-edit]');
    if(h1 && bi){
      var ver = document.createElement('p');
      ver.className = 'version_info';
      ver.textContent = bi.getAttribute('data-last-edit');
      h1.parentElement.insertBefore(ver, h1.nextElementSibling);
    }
  });
</script>

    <p>
      
        <a id='feedbacklink' href="mailto:doc-feedback@databricks.com?subject=Documentation Feedback">Send us feedback</a>
      
    </p>
  </div>
</div>
</nav>
    
    
<main class="wy-grid-for-nav su_nav-grid">
  <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
    <div class="wy-nav-content su__nav_content">
      <div class="rst-content">
        





<div role="navigation" aria-label="breadcrumbs navigation" class="wy-breadcrumbs-wrapper">
  <ul class="wy-breadcrumbs">
    <li><a href="../../../index.html">Documentation</a> <span class="db-icon db-icon-chevron-right"></span></li>
    
    
      <li>Use Databricks SQL in a Databricks job</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>
</div>
        
        <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
          <div itemprop="articleBody">
            
    
  <div class="section" id="use-databricks-sql-in-a-databricks-job">
<span id="use-dbsql-in-a-databricks-job"></span><h1>Use Databricks SQL in a Databricks job<a class="headerlink" href="#use-databricks-sql-in-a-databricks-job" title="Permalink to this headline"> </a></h1>
<p>You can use the SQL task type in a Databricks job, allowing you to create, schedule, operate, and monitor workflows that include Databricks SQL objects such as queries, dashboards, and alerts. For example, your workflow can ingest data, prepare the data, perform analysis using Databricks SQL queries, and then display the results in a Databricks SQL dashboard.</p>
<p>This article provides an example workflow that creates a Databricks SQL dashboard displaying metrics for GitHub contributions. In this example, you will:</p>
<ul class="simple">
<li><p>Ingest GitHub data using a Python script and the <a class="reference external" href="https://docs.github.com/rest">GitHub REST API</a>.</p></li>
<li><p>Transform the GitHub data using a Delta Live Tables pipeline.</p></li>
<li><p>Trigger Databricks SQL queries performing analysis on the prepared data.</p></li>
<li><p>Display the analysis in a Databricks SQL dashboard.</p></li>
</ul>
<div class="figure align-default">
<img alt="GitHub analysis dashboard" src="../../../_images/github-dashboard.png" />
</div>
<p></p>
<div class="section" id="before-you-begin">
<span id="pre-requisites"></span><h2>Before you begin<a class="headerlink" href="#before-you-begin" title="Permalink to this headline"> </a></h2>
<p>You need the following to complete this walkthrough:</p>
<ul class="simple">
<li><p>A <a class="reference external" href="https://docs.github.com/authentication/keeping-your-account-and-data-secure/creating-a-personal-access-token">GitHub personal access token</a>. This token must have the <strong>repo</strong> permission.</p></li>
<li><p>Databricks SQL and a serverless SQL warehouse or a pro SQL warehouse. See <a class="reference internal" href="../../../compute/sql-warehouse.html#warehouse-types"><span class="std std-ref">What are the available warehouse types and features?</span></a>.</p></li>
<li><p>A Databricks <a class="reference internal" href="../../../security/secrets/secret-scopes.html"><span class="doc">secret scope</span></a>. The secret scope is used to securely store the GitHub token. See <a class="reference internal" href="#add-token-to-secret"><span class="std std-ref">Step 1: Store the GitHub token in a secret</span></a>.</p></li>
</ul>
</div>
<div class="section" id="step-1-store-the-github-token-in-a-secret">
<span id="add-token-to-secret"></span><h2>Step 1: Store the GitHub token in a secret<a class="headerlink" href="#step-1-store-the-github-token-in-a-secret" title="Permalink to this headline"> </a></h2>
<p>Instead of hardcoding credentials such as the GitHub personal access token in a job, Databricks recommends using a secret scope to store and manage secrets securely. The following Databricks CLI commands are an example of creating a secret scope and storing the GitHub token in a secret in that scope:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>databricks<span class="w"> </span>secrets<span class="w"> </span>create-scope<span class="w"> </span>&lt;scope-name&gt;
databricks<span class="w"> </span>secrets<span class="w"> </span>put-secret<span class="w"> </span>&lt;scope-name&gt;<span class="w"> </span>&lt;token-key&gt;<span class="w"> </span>--string-value<span class="w"> </span>&lt;token&gt;
</pre></div>
</div>
<ul class="simple">
<li><p>Replace <code class="docutils literal notranslate"><span class="pre">&lt;scope-name</span></code> with the name of a Databricks secret scope to store the token.</p></li>
<li><p>Replace <code class="docutils literal notranslate"><span class="pre">&lt;token-key&gt;</span></code> with the name of a key to assign to the token.</p></li>
<li><p>Replace <code class="docutils literal notranslate"><span class="pre">&lt;token&gt;</span></code> with the value of the GitHub personal access token.</p></li>
</ul>
</div>
<div class="section" id="step-2-create-a-script-to-fetch-github-data">
<span id="github-script"></span><h2>Step 2: Create a script to fetch GitHub data<a class="headerlink" href="#step-2-create-a-script-to-fetch-github-data" title="Permalink to this headline"> </a></h2>
<p>The following Python script uses the GitHub REST API to fetch data on commits and contributions from a GitHub repo. Input arguments specify the GitHub repo. The records are saved to a location in DBFS specified by another input argument.</p>
<p>This example uses DBFS to store the Python script, but you can also use <a class="reference internal" href="../../../repos/repos-setup.html"><span class="doc">Databricks repos</span></a> to store and manage the script.</p>
<ol class="arabic simple">
<li><p>Save this script to a location on your local disk:</p></li>
</ol>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">requests</span>
<span class="kn">import</span> <span class="nn">sys</span>

<span class="n">api_url</span> <span class="o">=</span> <span class="s2">&quot;https://api.github.com&quot;</span>

<span class="k">def</span> <span class="nf">get_commits</span><span class="p">(</span><span class="n">owner</span><span class="p">,</span> <span class="n">repo</span><span class="p">,</span> <span class="n">token</span><span class="p">,</span> <span class="n">path</span><span class="p">):</span>
  <span class="n">page</span> <span class="o">=</span> <span class="mi">1</span>
  <span class="n">request_url</span> <span class="o">=</span>  <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">api_url</span><span class="si">}</span><span class="s2">/repos/</span><span class="si">{</span><span class="n">owner</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">repo</span><span class="si">}</span><span class="s2">/commits&quot;</span>
  <span class="n">more</span> <span class="o">=</span> <span class="kc">True</span>

  <span class="n">get_response</span><span class="p">(</span><span class="n">request_url</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">path</span><span class="si">}</span><span class="s2">/commits&quot;</span><span class="p">,</span> <span class="n">token</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">get_contributors</span><span class="p">(</span><span class="n">owner</span><span class="p">,</span> <span class="n">repo</span><span class="p">,</span> <span class="n">token</span><span class="p">,</span> <span class="n">path</span><span class="p">):</span>
  <span class="n">page</span> <span class="o">=</span> <span class="mi">1</span>
  <span class="n">request_url</span> <span class="o">=</span>  <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">api_url</span><span class="si">}</span><span class="s2">/repos/</span><span class="si">{</span><span class="n">owner</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">repo</span><span class="si">}</span><span class="s2">/contributors&quot;</span>
  <span class="n">more</span> <span class="o">=</span> <span class="kc">True</span>

  <span class="n">get_response</span><span class="p">(</span><span class="n">request_url</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">path</span><span class="si">}</span><span class="s2">/contributors&quot;</span><span class="p">,</span> <span class="n">token</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">get_response</span><span class="p">(</span><span class="n">request_url</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">token</span><span class="p">):</span>
  <span class="n">page</span> <span class="o">=</span> <span class="mi">1</span>
  <span class="n">more</span> <span class="o">=</span> <span class="kc">True</span>

  <span class="k">while</span> <span class="n">more</span><span class="p">:</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">request_url</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;page&#39;</span><span class="p">:</span> <span class="n">page</span><span class="p">},</span> <span class="n">headers</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;Authorization&#39;</span><span class="p">:</span> <span class="s2">&quot;token &quot;</span> <span class="o">+</span> <span class="n">token</span><span class="p">})</span>
    <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">text</span> <span class="o">!=</span> <span class="s2">&quot;[]&quot;</span><span class="p">:</span>
      <span class="n">write</span><span class="p">(</span><span class="n">path</span> <span class="o">+</span> <span class="s2">&quot;/records-&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">page</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;.json&quot;</span><span class="p">,</span> <span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
      <span class="n">page</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="n">more</span> <span class="o">=</span> <span class="kc">False</span>


<span class="k">def</span> <span class="nf">write</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">contents</span><span class="p">):</span>
  <span class="n">dbutils</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">contents</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
  <span class="n">args</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
  <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">6</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Usage: github-api.py owner repo request output-dir secret-scope secret-key&quot;</span><span class="p">)</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

  <span class="n">owner</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
  <span class="n">repo</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
  <span class="n">request</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
  <span class="n">output_path</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span>
  <span class="n">secret_scope</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span>
  <span class="n">secret_key</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span>

  <span class="n">token</span> <span class="o">=</span> <span class="n">dbutils</span><span class="o">.</span><span class="n">secrets</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">scope</span><span class="o">=</span><span class="n">secret_scope</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="n">secret_key</span><span class="p">)</span>

  <span class="k">if</span> <span class="p">(</span><span class="n">request</span> <span class="o">==</span> <span class="s2">&quot;commits&quot;</span><span class="p">):</span>
    <span class="n">get_commits</span><span class="p">(</span><span class="n">owner</span><span class="p">,</span> <span class="n">repo</span><span class="p">,</span> <span class="n">token</span><span class="p">,</span> <span class="n">output_path</span><span class="p">)</span>
  <span class="k">elif</span> <span class="p">(</span><span class="n">request</span> <span class="o">==</span> <span class="s2">&quot;contributors&quot;</span><span class="p">):</span>
    <span class="n">get_contributors</span><span class="p">(</span><span class="n">owner</span><span class="p">,</span> <span class="n">repo</span><span class="p">,</span> <span class="n">token</span><span class="p">,</span> <span class="n">output_path</span><span class="p">)</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">main</span><span class="p">()</span>
</pre></div>
</div>
<ol class="arabic simple">
<li><p>Upload the script to DBFS:</p>
<ol class="arabic simple">
<li><p>Go to your Databricks landing page and click <img alt="Catalog icon" src="../../../_images/data-icon.png" /> <strong>Catalog</strong> in the sidebar.</p></li>
<li><p>Click <strong>Browse DBFS</strong>.</p></li>
<li><p>In the DBFS file browser, click <strong>Upload</strong>. The <strong>Upload Data to DBFS</strong> dialog appears.</p></li>
<li><p>Enter a path in DBFS to store the script, click <strong>Drop files to upload, or click to browse</strong>, and select the Python script.</p></li>
<li><p>Click <strong>Done</strong>.</p></li>
</ol>
</li>
</ol>
</div>
<div class="section" id="step-3-create-a-delta-live-tables-pipeline-to-process-the-github-data">
<span id="step-3-create-a-dlt-pipeline-to-process-the-github-data"></span><span id="create-pipeline"></span><h2>Step 3: Create a Delta Live Tables pipeline to process the GitHub data<a class="headerlink" href="#step-3-create-a-delta-live-tables-pipeline-to-process-the-github-data" title="Permalink to this headline"> </a></h2>
<p>In this section, you create a Delta Live Tables pipeline to convert the raw GitHub data into tables that can be analyzed by Databricks SQL queries. To create the pipeline, perform the following steps:</p>
<ol class="arabic">
<li><p>In the sidebar, click <img alt="New Icon" src="../../../_images/create-icon.png" /> <strong>New</strong> and select <strong>Notebook</strong> from the menu. The <strong>Create Notebook</strong> dialog appears.</p></li>
<li><p>In <strong>Default Language</strong>, enter a name and select <strong>Python</strong>. You can leave <strong>Cluster</strong> set to the default value. The Delta Live Tables runtime creates a cluster before it runs your pipeline.</p></li>
<li><p>Click <strong>Create</strong>.</p></li>
<li><p>Copy the Python code example and paste it into your new notebook. You can add the example code to a single cell of the notebook or multiple cells.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">dlt</span>
<span class="kn">from</span> <span class="nn">pyspark.sql.functions</span> <span class="kn">import</span> <span class="o">*</span>

<span class="k">def</span> <span class="nf">parse</span><span class="p">(</span><span class="n">df</span><span class="p">):</span>
   <span class="k">return</span> <span class="p">(</span><span class="n">df</span>
     <span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">&quot;author_date&quot;</span><span class="p">,</span> <span class="n">to_timestamp</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;commit.author.date&quot;</span><span class="p">)))</span>
     <span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">&quot;author_email&quot;</span><span class="p">,</span> <span class="n">col</span><span class="p">(</span><span class="s2">&quot;commit.author.email&quot;</span><span class="p">))</span>
     <span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">&quot;author_name&quot;</span><span class="p">,</span> <span class="n">col</span><span class="p">(</span><span class="s2">&quot;commit.author.name&quot;</span><span class="p">))</span>
     <span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">&quot;comment_count&quot;</span><span class="p">,</span> <span class="n">col</span><span class="p">(</span><span class="s2">&quot;commit.comment_count&quot;</span><span class="p">))</span>
     <span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">&quot;committer_date&quot;</span><span class="p">,</span> <span class="n">to_timestamp</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;commit.committer.date&quot;</span><span class="p">)))</span>
     <span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">&quot;committer_email&quot;</span><span class="p">,</span> <span class="n">col</span><span class="p">(</span><span class="s2">&quot;commit.committer.email&quot;</span><span class="p">))</span>
     <span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">&quot;committer_name&quot;</span><span class="p">,</span> <span class="n">col</span><span class="p">(</span><span class="s2">&quot;commit.committer.name&quot;</span><span class="p">))</span>
     <span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">&quot;message&quot;</span><span class="p">,</span> <span class="n">col</span><span class="p">(</span><span class="s2">&quot;commit.message&quot;</span><span class="p">))</span>
     <span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">&quot;sha&quot;</span><span class="p">,</span> <span class="n">col</span><span class="p">(</span><span class="s2">&quot;commit.tree.sha&quot;</span><span class="p">))</span>
     <span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">&quot;tree_url&quot;</span><span class="p">,</span> <span class="n">col</span><span class="p">(</span><span class="s2">&quot;commit.tree.url&quot;</span><span class="p">))</span>
     <span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">&quot;url&quot;</span><span class="p">,</span> <span class="n">col</span><span class="p">(</span><span class="s2">&quot;commit.url&quot;</span><span class="p">))</span>
     <span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">&quot;verification_payload&quot;</span><span class="p">,</span> <span class="n">col</span><span class="p">(</span><span class="s2">&quot;commit.verification.payload&quot;</span><span class="p">))</span>
     <span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">&quot;verification_reason&quot;</span><span class="p">,</span> <span class="n">col</span><span class="p">(</span><span class="s2">&quot;commit.verification.reason&quot;</span><span class="p">))</span>
     <span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">&quot;verification_signature&quot;</span><span class="p">,</span> <span class="n">col</span><span class="p">(</span><span class="s2">&quot;commit.verification.signature&quot;</span><span class="p">))</span>
     <span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">&quot;verification_verified&quot;</span><span class="p">,</span> <span class="n">col</span><span class="p">(</span><span class="s2">&quot;commit.verification.signature&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="s2">&quot;string&quot;</span><span class="p">))</span>
     <span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s2">&quot;commit&quot;</span><span class="p">)</span>
   <span class="p">)</span>

<span class="nd">@dlt</span><span class="o">.</span><span class="n">table</span><span class="p">(</span>
   <span class="n">comment</span><span class="o">=</span><span class="s2">&quot;Raw GitHub commits&quot;</span>
<span class="p">)</span>
<span class="k">def</span> <span class="nf">github_commits_raw</span><span class="p">():</span>
  <span class="n">df</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">read</span><span class="o">.</span><span class="n">json</span><span class="p">(</span><span class="n">spark</span><span class="o">.</span><span class="n">conf</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;commits-path&quot;</span><span class="p">))</span>
  <span class="k">return</span> <span class="n">parse</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;commit&quot;</span><span class="p">))</span>

<span class="nd">@dlt</span><span class="o">.</span><span class="n">table</span><span class="p">(</span>
  <span class="n">comment</span><span class="o">=</span><span class="s2">&quot;Info on the author of a commit&quot;</span>
<span class="p">)</span>
<span class="k">def</span> <span class="nf">commits_by_author</span><span class="p">():</span>
  <span class="k">return</span> <span class="p">(</span>
    <span class="n">dlt</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="s2">&quot;github_commits_raw&quot;</span><span class="p">)</span>
      <span class="o">.</span><span class="n">withColumnRenamed</span><span class="p">(</span><span class="s2">&quot;author_date&quot;</span><span class="p">,</span> <span class="s2">&quot;date&quot;</span><span class="p">)</span>
      <span class="o">.</span><span class="n">withColumnRenamed</span><span class="p">(</span><span class="s2">&quot;author_email&quot;</span><span class="p">,</span> <span class="s2">&quot;email&quot;</span><span class="p">)</span>
      <span class="o">.</span><span class="n">withColumnRenamed</span><span class="p">(</span><span class="s2">&quot;author_name&quot;</span><span class="p">,</span> <span class="s2">&quot;name&quot;</span><span class="p">)</span>
      <span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;sha&quot;</span><span class="p">,</span> <span class="s2">&quot;date&quot;</span><span class="p">,</span> <span class="s2">&quot;email&quot;</span><span class="p">,</span> <span class="s2">&quot;name&quot;</span><span class="p">)</span>
  <span class="p">)</span>

<span class="nd">@dlt</span><span class="o">.</span><span class="n">table</span><span class="p">(</span>
  <span class="n">comment</span><span class="o">=</span><span class="s2">&quot;GitHub repository contributors&quot;</span>
<span class="p">)</span>
<span class="k">def</span> <span class="nf">github_contributors_raw</span><span class="p">():</span>
  <span class="k">return</span><span class="p">(</span>
    <span class="n">spark</span><span class="o">.</span><span class="n">readStream</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">&quot;cloudFiles&quot;</span><span class="p">)</span>
      <span class="o">.</span><span class="n">option</span><span class="p">(</span><span class="s2">&quot;cloudFiles.format&quot;</span><span class="p">,</span> <span class="s2">&quot;json&quot;</span><span class="p">)</span>
      <span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">spark</span><span class="o">.</span><span class="n">conf</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;contribs-path&quot;</span><span class="p">))</span>
  <span class="p">)</span>
</pre></div>
</div>
</li>
<li><p>In the sidebar, click <img alt="Jobs Icon" src="../../../_images/jobs-icon.png" /> <strong>Workflows</strong>, click the <strong>Delta Live Tables</strong> tab, and click <strong>Create Pipeline</strong>.</p></li>
<li><p>Give the pipeline a name, for example, <code class="docutils literal notranslate"><span class="pre">Transform</span> <span class="pre">GitHub</span> <span class="pre">data</span></code>.</p></li>
<li><p>In the <strong>Notebook libraries</strong> field, enter the path to your notebook or click <img alt="File Picker Icon" src="../../../_images/file-picker.png" /> to select the notebook.</p></li>
<li><p>Click <strong>Add configuration</strong>. In the <code class="docutils literal notranslate"><span class="pre">Key</span></code> text box, enter <code class="docutils literal notranslate"><span class="pre">commits-path</span></code>. In the <code class="docutils literal notranslate"><span class="pre">Value</span></code> text box, enter the DBFS path where the GitHub records will be written. This can be any path you choose and is the same path you’ll use when configuring the first Python task when you <a class="reference internal" href="#create-workflow"><span class="std std-ref">create the workflow</span></a>.</p></li>
<li><p>Click <strong>Add configuration</strong> again. In the <code class="docutils literal notranslate"><span class="pre">Key</span></code> text box, enter <code class="docutils literal notranslate"><span class="pre">contribs-path</span></code>. In the <code class="docutils literal notranslate"><span class="pre">Value</span></code> text box, enter the DBFS path where the GitHub records will be written. This can be any path you choose and is the same path you’ll use when configuring the second Python task when you <a class="reference internal" href="#create-workflow"><span class="std std-ref">create the workflow</span></a>.</p></li>
<li><p>In the <strong>Target</strong> field, enter a target database, for example, <code class="docutils literal notranslate"><span class="pre">github_tables</span></code>. Setting a target database publishes the output data to the metastore and is required for the downstream queries analyzing the data produced by the pipeline.</p></li>
<li><p>Click <strong>Save</strong>.</p></li>
</ol>
</div>
<div class="section" id="step-4-create-a-workflow-to-ingest-and-transform-github-data">
<span id="create-workflow"></span><h2>Step 4: Create a workflow to ingest and transform GitHub data<a class="headerlink" href="#step-4-create-a-workflow-to-ingest-and-transform-github-data" title="Permalink to this headline"> </a></h2>
<p>Before analyzing and visualizing the GitHub data with Databricks SQL, you need to ingest and prepare the data. To create a workflow to complete these tasks, perform the following steps:</p>
<div class="section" id="create-a-databricks-job-and-add-the-first-task">
<span id="create-job"></span><h3>Create a Databricks job and add the first task<a class="headerlink" href="#create-a-databricks-job-and-add-the-first-task" title="Permalink to this headline"> </a></h3>
<ol class="arabic">
<li><p>Go to your Databricks landing page and do one of the following:</p>
<ul class="simple">
<li><p>In the sidebar, click <img alt="Jobs Icon" src="../../../_images/jobs-icon.png" /> <strong>Workflows</strong> and click <img alt="Create Job Button" src="../../../_images/create-job.png" />.</p></li>
<li><p>In the sidebar, click <img alt="New Icon" src="../../../_images/create-icon.png" /> <strong>New</strong> and select <strong>Job</strong> from the menu.</p></li>
</ul>
</li>
<li><p>In the task dialog box that appears on the <strong>Tasks</strong> tab, replace <strong>Add a name for your job…</strong> with your job name, for example, <code class="docutils literal notranslate"><span class="pre">GitHub</span> <span class="pre">analysis</span> <span class="pre">workflow</span></code>.</p></li>
<li><p>In <strong>Task name</strong>, enter a name for the task, for example, <code class="docutils literal notranslate"><span class="pre">get_commits</span></code>.</p></li>
<li><p>In <strong>Type</strong>, select <strong>Python script</strong>.</p></li>
<li><p>In <strong>Source</strong>, select <strong>DBFS / S3</strong>.</p></li>
<li><p>In <strong>Path</strong>, enter the path to the script in DBFS.</p></li>
<li><p>In <strong>Parameters</strong>, enter the following arguments for the Python script:</p>
<p><code class="docutils literal notranslate"><span class="pre">[&quot;&lt;owner&gt;&quot;,&quot;&lt;repo&gt;&quot;,&quot;commits&quot;,&quot;&lt;DBFS-output-dir&gt;&quot;,&quot;&lt;scope-name&gt;&quot;,&quot;&lt;github-token-key&gt;&quot;]</span></code></p>
<ul class="simple">
<li><p>Replace <code class="docutils literal notranslate"><span class="pre">&lt;owner&gt;</span></code> with the name of the repository owner. For example, to fetch records from the <code class="docutils literal notranslate"><span class="pre">github.com/databrickslabs/overwatch</span></code> repository, enter <code class="docutils literal notranslate"><span class="pre">databrickslabs</span></code>.</p></li>
<li><p>Replace <code class="docutils literal notranslate"><span class="pre">&lt;repo&gt;</span></code> with the repository name, for example, <code class="docutils literal notranslate"><span class="pre">overwatch</span></code>.</p></li>
<li><p>Replace <code class="docutils literal notranslate"><span class="pre">&lt;DBFS-output-dir&gt;</span></code> with a path in DBFS to store the records fetched from GitHub.</p></li>
<li><p>Replace <code class="docutils literal notranslate"><span class="pre">&lt;scope-name&gt;</span></code> with the name of the secret scope you created to store the GitHub token.</p></li>
<li><p>Replace <code class="docutils literal notranslate"><span class="pre">&lt;github-token-key&gt;</span></code> with the name of the key you assigned to the GitHub token.</p></li>
</ul>
</li>
<li><p>Click <strong>Save task</strong>.</p></li>
</ol>
</div>
<div class="section" id="add-another-task">
<span id="contributors-task"></span><h3>Add another task<a class="headerlink" href="#add-another-task" title="Permalink to this headline"> </a></h3>
<ol class="arabic">
<li><p>Click <img alt="Add Task Button" src="../../../_images/add-task.png" /> below the task you just created.</p></li>
<li><p>In <strong>Task name</strong>, enter a name for the task, for example, <code class="docutils literal notranslate"><span class="pre">get_contributors</span></code>.</p></li>
<li><p>In <strong>Type</strong>, select the <strong>Python script</strong> task type.</p></li>
<li><p>In <strong>Source</strong>, select <strong>DBFS / S3</strong>.</p></li>
<li><p>In <strong>Path</strong>, enter the path to the script in DBFS.</p></li>
<li><p>In <strong>Parameters</strong>, enter the following arguments for the Python script:</p>
<p><code class="docutils literal notranslate"><span class="pre">[&quot;&lt;owner&gt;&quot;,&quot;&lt;repo&gt;&quot;,&quot;contributors&quot;,&quot;&lt;DBFS-output-dir&gt;&quot;,&quot;&lt;scope-name&gt;&quot;,&quot;&lt;github-token-key&gt;&quot;]</span></code></p>
<ul class="simple">
<li><p>Replace <code class="docutils literal notranslate"><span class="pre">&lt;owner&gt;</span></code> with the name of the repository owner. For example, to fetch records from the <code class="docutils literal notranslate"><span class="pre">github.com/databrickslabs/overwatch</span></code> repository, enter <code class="docutils literal notranslate"><span class="pre">databrickslabs</span></code>.</p></li>
<li><p>Replace <code class="docutils literal notranslate"><span class="pre">&lt;repo&gt;</span></code> with the repository name, for example, <code class="docutils literal notranslate"><span class="pre">overwatch</span></code>.</p></li>
<li><p>Replace <code class="docutils literal notranslate"><span class="pre">&lt;DBFS-output-dir&gt;</span></code> with a path in DBFS to store the records fetched from GitHub.</p></li>
<li><p>Replace <code class="docutils literal notranslate"><span class="pre">&lt;scope-name&gt;</span></code> with the name of the secret scope you created to store the GitHub token.</p></li>
<li><p>Replace <code class="docutils literal notranslate"><span class="pre">&lt;github-token-key&gt;</span></code> with the name of the key you assigned to the GitHub token.</p></li>
</ul>
</li>
<li><p>Click <strong>Save task</strong>.</p></li>
</ol>
</div>
<div class="section" id="add-a-task-to-transform-the-data">
<span id="transformation-task"></span><h3>Add a task to transform the data<a class="headerlink" href="#add-a-task-to-transform-the-data" title="Permalink to this headline"> </a></h3>
<ol class="arabic simple">
<li><p>Click <img alt="Add Task Button" src="../../../_images/add-task.png" /> below the task you just created.</p></li>
<li><p>In <strong>Task name</strong>, enter a name for the task, for example, <code class="docutils literal notranslate"><span class="pre">transform_github_data</span></code>.</p></li>
<li><p>In <strong>Type</strong>, select <strong>Delta Live Tables pipeline</strong> and enter a name for the task.</p></li>
<li><p>In <strong>Pipeline</strong>, select the pipeline created in <a class="reference internal" href="#create-pipeline"><span class="std std-ref">Step 3: Create a Delta Live Tables pipeline to process the GitHub data</span></a>.</p></li>
<li><p>Click <strong>Create</strong>.</p></li>
</ol>
</div>
</div>
<div class="section" id="step-5-run-the-data-transformation-workflow">
<span id="run-transformation"></span><h2>Step 5: Run the data transformation workflow<a class="headerlink" href="#step-5-run-the-data-transformation-workflow" title="Permalink to this headline"> </a></h2>
<p>Click <img alt="Run Now Button" src="../../../_images/run-now-button.png" /> to run the workflow. To view <a class="reference internal" href="../monitor-job-runs.html#job-run-details"><span class="std std-ref">details for the run</span></a>, click the link in the <strong>Start time</strong> column for the run in the <a class="reference internal" href="../monitor-job-runs.html#view-job-run-list"><span class="std std-ref">job runs</span></a> view. Click on each task to view details for the task run.</p>
</div>
<div class="section" id="step-6-optional-to-view-the-output-data-after-the-workflow-run-completes-perform-the-following-steps">
<span id="view-transformation-results"></span><h2>Step 6: (Optional) To view the output data after the workflow run completes, perform the following steps:<a class="headerlink" href="#step-6-optional-to-view-the-output-data-after-the-workflow-run-completes-perform-the-following-steps" title="Permalink to this headline"> </a></h2>
<ol class="arabic simple">
<li><p>In the run details view, click on the Delta Live Tables task.</p></li>
<li><p>In the <strong>Task run details</strong> panel, click on the pipeline name under <strong>Pipeline</strong>. The <strong>Pipeline details</strong> page displays.</p></li>
<li><p>Select the <code class="docutils literal notranslate"><span class="pre">commits_by_author</span></code> table in the pipeline DAG.</p></li>
<li><p>Click the table name next to <strong>Metastore</strong> in the <strong>commits_by_author</strong> panel. The Catalog Explorer page opens.</p></li>
</ol>
<p>In Catalog Explorer, you can view the table schema, sample data, and other details for the data. Follow the same steps to view data for the <code class="docutils literal notranslate"><span class="pre">github_contributors_raw</span></code> table.</p>
</div>
<div class="section" id="step-7-remove-the-github-data">
<span id="remove-files"></span><h2>Step 7: Remove the GitHub data<a class="headerlink" href="#step-7-remove-the-github-data" title="Permalink to this headline"> </a></h2>
<p>In a real-world application, you might be continuously ingesting and processing data. Because this example downloads and processes the entire data set, you must remove the already downloaded GitHub data to prevent an error when re-running the workflow. To remove the downloaded data, perform the following steps:</p>
<ol class="arabic">
<li><p>Create a new notebook and enter the following commands in the first cell:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">dbutils</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">rm</span><span class="p">(</span><span class="s2">&quot;&lt;commits-path&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
<span class="n">dbutils</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">rm</span><span class="p">(</span><span class="s2">&quot;&lt;contributors-path&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
<p>Replace <code class="docutils literal notranslate"><span class="pre">&lt;commits-path&gt;</span></code> and <code class="docutils literal notranslate"><span class="pre">&lt;contributors-path&gt;</span></code> with the DBFS paths you configured when creating the Python tasks.</p>
</li>
<li><p>Click <img alt="Run Menu" src="../../../_images/run-menu.png" /> and select <strong>Run Cell</strong>.</p></li>
</ol>
<p>You can also add this notebook as a task in the workflow.</p>
</div>
<div class="section" id="step-8-create-the-databricks-sql-queries">
<span id="step-8-create-the-dbsql-queries"></span><span id="create-queries"></span><h2>Step 8: Create the Databricks SQL queries<a class="headerlink" href="#step-8-create-the-databricks-sql-queries" title="Permalink to this headline"> </a></h2>
<p>After running the workflow and creating the required tables, create queries to analyze the prepared data. To create the example queries and visualizations, perform the following steps:</p>
<div class="section" id="display-the-top-10-contributors-by-month">
<span id="top-10-contributors-query"></span><h3>Display the top 10 contributors by month<a class="headerlink" href="#display-the-top-10-contributors-by-month" title="Permalink to this headline"> </a></h3>
<ol class="arabic">
<li><p>Click the icon below the Databricks logo <img alt="Databricks logo" src="../../../_images/databricks-logo.png" /> in the sidebar and select <strong>SQL</strong>.</p></li>
<li><p>Click <strong>Create a query</strong> to open the Databricks SQL query editor.</p></li>
<li><p>Make sure the catalog is set to <strong>hive_metastore</strong>. Click <strong>default</strong> next to <strong>hive_metastore</strong> and set the database to the <strong>Target</strong> value you set in the Delta Live Tables pipeline.</p></li>
<li><p>In the <strong>New Query</strong> tab, enter the following query:</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">SELECT</span>
<span class="w">  </span><span class="n">date_part</span><span class="p">(</span><span class="s1">&#39;YEAR&#39;</span><span class="p">,</span><span class="w"> </span><span class="nb">date</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="k">year</span><span class="p">,</span>
<span class="w">  </span><span class="n">date_part</span><span class="p">(</span><span class="s1">&#39;MONTH&#39;</span><span class="p">,</span><span class="w"> </span><span class="nb">date</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="k">month</span><span class="p">,</span>
<span class="w">  </span><span class="n">name</span><span class="p">,</span>
<span class="w">  </span><span class="k">count</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="k">FROM</span>
<span class="w">  </span><span class="n">commits_by_author</span>
<span class="k">WHERE</span>
<span class="w">  </span><span class="n">name</span><span class="w"> </span><span class="k">IN</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="k">SELECT</span>
<span class="w">      </span><span class="n">name</span>
<span class="w">    </span><span class="k">FROM</span>
<span class="w">      </span><span class="n">commits_by_author</span>
<span class="w">    </span><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span>
<span class="w">      </span><span class="n">name</span>
<span class="w">    </span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span>
<span class="w">      </span><span class="k">count</span><span class="p">(</span><span class="n">name</span><span class="p">)</span><span class="w"> </span><span class="k">DESC</span>
<span class="w">    </span><span class="k">LIMIT</span><span class="w"> </span><span class="mi">10</span>
<span class="w">  </span><span class="p">)</span>
<span class="w">  </span><span class="k">AND</span>
<span class="w">    </span><span class="n">date_part</span><span class="p">(</span><span class="s1">&#39;YEAR&#39;</span><span class="p">,</span><span class="w"> </span><span class="nb">date</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">2022</span>
<span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span>
<span class="w">  </span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="k">year</span><span class="p">,</span><span class="w"> </span><span class="k">month</span>
<span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span>
<span class="w">  </span><span class="k">year</span><span class="p">,</span><span class="w"> </span><span class="k">month</span><span class="p">,</span><span class="w"> </span><span class="n">name</span>
</pre></div>
</div>
</li>
<li><p>Click the <strong>New query</strong> tab and rename the query, for example, <code class="docutils literal notranslate"><span class="pre">Commits</span> <span class="pre">by</span> <span class="pre">month</span> <span class="pre">top</span> <span class="pre">10</span> <span class="pre">contributors</span></code>.</p></li>
<li><p>By default, the results are displayed as a table. To change how the data is visualized, for example, using a bar chart, in the <strong>Results</strong> panel click <img alt="Jobs Vertical Ellipsis" src="../../../_images/jobs-vertical-ellipsis.png" /> and click <strong>Edit</strong>.</p></li>
<li><p>In <strong>Visualization type</strong>, select <strong>Bar</strong>.</p></li>
<li><p>In <strong>X column</strong>, select <strong>month</strong>.</p></li>
<li><p>In <strong>Y columns</strong>, select <strong>count(1)</strong>.</p></li>
<li><p>In <strong>Group by</strong>, select <strong>name</strong>.</p></li>
<li><p>Click <strong>Save</strong>.</p></li>
</ol>
</div>
<div class="section" id="display-the-top-20-contributors">
<span id="top-20-contributors-query"></span><h3>Display the top 20 contributors<a class="headerlink" href="#display-the-top-20-contributors" title="Permalink to this headline"> </a></h3>
<ol class="arabic">
<li><p>Click <strong>+ &gt; Create new query</strong> and make sure the catalog is set to <strong>hive_metastore</strong>. Click <strong>default</strong> next to <strong>hive_metastore</strong> and set the database to the <strong>Target</strong> value you set in the Delta Live Tables pipeline.</p></li>
<li><p>Enter the following query:</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">SELECT</span>
<span class="w">  </span><span class="n">login</span><span class="p">,</span>
<span class="w">  </span><span class="k">cast</span><span class="p">(</span><span class="n">contributions</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="nb">INTEGER</span><span class="p">)</span>
<span class="k">FROM</span>
<span class="w">  </span><span class="n">github_contributors_raw</span>
<span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span>
<span class="w">  </span><span class="n">contributions</span><span class="w"> </span><span class="k">DESC</span>
<span class="k">LIMIT</span><span class="w"> </span><span class="mi">20</span>
</pre></div>
</div>
</li>
<li><p>Click the <strong>New query</strong> tab and rename the query, for example, <code class="docutils literal notranslate"><span class="pre">Top</span> <span class="pre">20</span> <span class="pre">contributors</span></code>.</p></li>
<li><p>To change the visualization from the default table, in the <strong>Results</strong> panel, click <img alt="Jobs Vertical Ellipsis" src="../../../_images/jobs-vertical-ellipsis.png" /> and click <strong>Edit</strong>.</p></li>
<li><p>In <strong>Visualization type</strong>, select <strong>Bar</strong>.</p></li>
<li><p>In <strong>X column</strong>, select <strong>login</strong>.</p></li>
<li><p>In <strong>Y columns</strong>, select <strong>contributions</strong>.</p></li>
<li><p>Click <strong>Save</strong>.</p></li>
</ol>
</div>
<div class="section" id="display-the-total-commits-by-author">
<span id="total-commits-query"></span><h3>Display the total commits by author<a class="headerlink" href="#display-the-total-commits-by-author" title="Permalink to this headline"> </a></h3>
<ol class="arabic">
<li><p>Click <strong>+ &gt; Create new query</strong> and make sure the catalog is set to <strong>hive_metastore</strong>. Click <strong>default</strong> next to <strong>hive_metastore</strong> and set the database to the <strong>Target</strong> value you set in the Delta Live Tables pipeline.</p></li>
<li><p>Enter the following query:</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">SELECT</span>
<span class="w">  </span><span class="n">name</span><span class="p">,</span>
<span class="w">  </span><span class="k">count</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="n">commits</span>
<span class="k">FROM</span>
<span class="w">  </span><span class="n">commits_by_author</span>
<span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span>
<span class="w">  </span><span class="n">name</span>
<span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span>
<span class="w">  </span><span class="n">commits</span><span class="w"> </span><span class="k">DESC</span>
<span class="k">LIMIT</span><span class="w"> </span><span class="mi">10</span>
</pre></div>
</div>
</li>
<li><p>Click the <strong>New query</strong> tab and rename the query, for example, <code class="docutils literal notranslate"><span class="pre">Total</span> <span class="pre">commits</span> <span class="pre">by</span> <span class="pre">author</span></code>.</p></li>
<li><p>To change the visualization from the default table, in the <strong>Results</strong> panel, click <img alt="Jobs Vertical Ellipsis" src="../../../_images/jobs-vertical-ellipsis.png" /> and click <strong>Edit</strong>.</p></li>
<li><p>In <strong>Visualization type</strong>, select <strong>Bar</strong>.</p></li>
<li><p>In <strong>X column</strong>, select <strong>name</strong>.</p></li>
<li><p>In <strong>Y columns</strong>, select <strong>commits</strong>.</p></li>
<li><p>Click <strong>Save</strong>.</p></li>
</ol>
</div>
</div>
<div class="section" id="step-9-create-a-dashboard">
<span id="create-dashboard"></span><h2>Step 9: Create a dashboard<a class="headerlink" href="#step-9-create-a-dashboard" title="Permalink to this headline"> </a></h2>
<ol class="arabic simple">
<li><p>In the sidebar, click <img alt="Dashboards Icon" src="../../../_images/dashboards-icon.png" /> <strong>Dashboards</strong></p></li>
<li><p>Click <strong>Create dashboard</strong>.</p></li>
<li><p>Enter a name for the dashboard, for example, <code class="docutils literal notranslate"><span class="pre">GitHub</span> <span class="pre">analysis</span></code>.</p></li>
<li><p>For each query and visualization created in <a class="reference internal" href="#create-queries"><span class="std std-ref">Step 8: Create the Databricks SQL queries</span></a>, click <strong>Add &gt; Visualization</strong> and select each visualization.</p></li>
</ol>
<p></p>
</div>
<div class="section" id="step-10-add-the-sql-tasks-to-the-workflow">
<span id="add-sql-tasks"></span><h2>Step 10: Add the SQL tasks to the workflow<a class="headerlink" href="#step-10-add-the-sql-tasks-to-the-workflow" title="Permalink to this headline"> </a></h2>
<p>To add the new query tasks to the workflow you created in <a class="reference internal" href="#create-job"><span class="std std-ref">Create a Databricks job and add the first task</span></a>, for each query you created in <a class="reference internal" href="#create-queries"><span class="std std-ref">Step 8: Create the Databricks SQL queries</span></a>:</p>
<ol class="arabic simple">
<li><p>Click <img alt="Jobs Icon" src="../../../_images/jobs-icon.png" /> <strong>Workflows</strong> in the sidebar.</p></li>
<li><p>In the <strong>Name</strong> column, click the job name.</p></li>
<li><p>Click the <strong>Tasks</strong> tab.</p></li>
<li><p>Click <img alt="Add Task Button" src="../../../_images/add-task.png" /> below the last task.</p></li>
<li><p>Enter a name for the task, in <strong>Type</strong> select <strong>SQL</strong>, and in <strong>SQL task</strong> select <strong>Query</strong>.</p></li>
<li><p>Select the query in <strong>SQL query</strong>.</p></li>
<li><p>In <strong>SQL warehouse</strong>, select a serverless SQL warehouse or a pro SQL warehouse to run the task.</p></li>
<li><p>Click <strong>Create</strong>.</p></li>
</ol>
</div>
<div class="section" id="step-11-add-a-dashboard-task">
<span id="add-dashboard"></span><h2>Step 11: Add a dashboard task<a class="headerlink" href="#step-11-add-a-dashboard-task" title="Permalink to this headline"> </a></h2>
<ol class="arabic simple">
<li><p>Click <img alt="Add Task Button" src="../../../_images/add-task.png" /> below the last task.</p></li>
<li><p>Enter a name for the task, in <strong>Type</strong>, select <strong>SQL</strong>, and in <strong>SQL task</strong> select <strong>Dashboard</strong>.</p></li>
<li><p>Select the dashboard created in <a class="reference internal" href="#create-dashboard"><span class="std std-ref">Step 9: Create a dashboard</span></a>.</p></li>
<li><p>In <strong>SQL warehouse</strong>, select a serverless SQL warehouse or a pro SQL warehouse to run the task.</p></li>
<li><p>Click <strong>Create</strong>.</p></li>
</ol>
</div>
<div class="section" id="step-12-run-the-complete-workflow">
<span id="run-workflow"></span><h2>Step 12: Run the complete workflow<a class="headerlink" href="#step-12-run-the-complete-workflow" title="Permalink to this headline"> </a></h2>
<p>To run the workflow, click <img alt="Run Now Button" src="../../../_images/run-now-button.png" />. To view <a class="reference internal" href="../monitor-job-runs.html#job-run-details"><span class="std std-ref">details for the run</span></a>, click the link in the <strong>Start time</strong> column for the run in the <a class="reference internal" href="../monitor-job-runs.html#view-job-run-list"><span class="std std-ref">job runs</span></a> view.</p>
</div>
<div class="section" id="step-13-view-the-results">
<span id="view-results"></span><h2>Step 13: View the results<a class="headerlink" href="#step-13-view-the-results" title="Permalink to this headline"> </a></h2>
<p>To view the results when the run completes, click the final dashboard task and click the dashboard name under <strong>SQL dashboard</strong> in the right panel.</p>
</div>
</div>


    
          </div>
        </div>
        <div  class="suapp-rating">
  <div id="suPageRateApp">
     <su-app></su-app>
   </div> 
 </div>
<hr> 
<footer>
  <div role="contentinfo">
      <p class="copyright">
          &copy; Databricks 2023. All rights reserved. Apache, Apache Spark, Spark, and the Spark logo are trademarks of the <a href="http://www.apache.org/">Apache Software Foundation</a>.
      </p>
      <p> 
        
          <a id='feedbacklink' href="mailto:doc-feedback@databricks.com?subject=Documentation Feedback">Send us feedback</a>
        
     | <a href="https://databricks.com/privacy-policy">Privacy Policy</a> | <a href="https://databricks.com/terms-of-use">Terms of Use</a></p>

  </div> 

</footer>
      </div>
    </div>
  </section>
</main>

  </page>
  
  <script type="text/javascript">
    var DOCUMENTATION_OPTIONS = {
      URL_ROOT: '../../../',
      VERSION: '1.0',
      COLLAPSE_INDEX: false,
      FILE_SUFFIX: '.html',
      HAS_SOURCE: 'false'
    };
  </script>
  <script type="text/javascript" src="../../../_static/jquery.js"></script>
  <script type="text/javascript" src="../../../_static/underscore.js"></script>
  <script type="text/javascript" src="../../../_static/doctools.js"></script>
  <script type="text/javascript" src="../../../_static/language_data.js"></script>
  

  <script type="text/javascript" src="../../../_static/js/clipboard.min.js"></script>
  <script type="text/javascript" src="../../../_static/js/jquery.waypoints.min.js"></script>

  <!-- Select2 (https://select2.org/) -->
  <link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />
  <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
  <!-- End Select2 -->

  
  
  <script type="text/javascript" src="../../../_static/js/localized.js"></script>
  <script type="text/javascript" src="../../../_static/js/custom.js"></script>
  

  
  
  <script type="text/javascript">
    jQuery(function () {
      SphinxRtdTheme.StickyNav.enable();
    });

  </script>
  
 



  <script>
  window.__searchunifyLoaderConfig = JSON.parse('{"clients": {"en": "02c2e804-27e9-11ee-aefb-0242ac120011", "ja": "6a42c3f2-2820-11ee-aefb-0242ac120011", "pt": "6a86badd-2821-11ee-aefb-0242ac120011"}}')
</script>
<script type="text/javascript" src="../../../_static/js/search-loader.js"></script>
</body>
<script type='text/javascript'>
  window.onload = function () {
    var description = document.querySelector('meta[name="description"]').getAttribute("content");
    let titleText = document.querySelector('h1').textContent;
    document.querySelector('meta[property="og:title"]').setAttribute("content", titleText);
    document.querySelector('meta[property="og:description"]').setAttribute("content", description);
    document.querySelector('meta[property="twitter:description"]').setAttribute("content", description);
  };
</script>

</html>