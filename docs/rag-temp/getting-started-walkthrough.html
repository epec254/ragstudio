

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en-US" > <![endif]-->
<!--[if gt IE 8]><!-->
<html class="no-js" lang="en-US"> <!--<![endif]-->

<head>
  <!-- cookie consent -->
  
    <!-- Combined Onetrust and Rudderstack Implementation Scripts -->
    <!-- Onetrust Initialization -->
    <script type="text/javascript" src="https://cdn.cookielaw.org/consent/92466579-1717-44d3-809d-a05fb02843ed-test/OtAutoBlock.js"></script>
    <script src="https://cdn.cookielaw.org/scripttemplates/otSDKStub.js" data-document-language="true" type="text/javascript" charset="UTF-8" data-domain-script="92466579-1717-44d3-809d-a05fb02843ed-test"></script>
    <link rel="stylesheet" id="db-onetrust-style" href="https://www.databricks.com/wp-content/uploads/db_onetrust.css" media="all" />
    <!-- Setting Rudderstack Write Key -->
    <script>window.rudderstackKey = "2SOR9fvSr5Fi6tN2ihPbVHnX1SZ" </script>
    <!-- Rudderstack Initialization + Onetrust Integration + Rudderstack Custom Events -->
    <script type="text/javascript" src="https://www.databricks.com/sites/default/files/rudderstack/v1/db-rudderstack-events.js"></script>

  <!-- cookie consent -->

  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta http-equiv="X-UA-Compatible" content="IE=9" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0">
  <meta property="og:image" content="https://www.databricks.com/wp-content/uploads/2020/04/og-databricks.png">
  <meta property="og:image:type" content="image/png">
  <meta property="og:title" content="Getting started">
  <meta property="og:image:width" content="1200">
  <meta property="og:image:height" content="630">
  <meta property="og:type" content="website">
  <meta property="og:url" content="https://docs.databricks.com">
  <meta property="og:description" content="" id="og-description">
  <meta name="twitter:image" content="https://www.databricks.com/wp-content/uploads/2020/04/og-databricks.png">
  <meta name="twitter:site" content="@databricks">
  <meta name="twitter:creator" content="@databricks">
  <meta property="twitter:description" content="">
  
  <title>Getting started &#124; Databricks on AWS</title>
  
  
  <link rel="canonical" href="https://docs.databricks.com/en/rag-temp/getting-started-walkthrough.html">
  <!-- Start hreflang tag -->
  <link rel="alternate" hreflang="en" href="https://docs.databricks.com/en/rag-temp/getting-started-walkthrough.html" />
<link rel="alternate" hreflang="x-default" href="https://docs.databricks.com/en/rag-temp/getting-started-walkthrough.html" />
  <!-- End hreflang tag -->
  
  
  <link rel="shortcut icon" href="../_static/favicon.ico" />
  

  

  

  <!-- Google Tag Manager -->
  <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'https://www.googletagmanager.com/gtm.js?id='+i+dl;
j.setAttributeNode(d.createAttribute('data-ot-ignore'));
f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-T85FQ33');</script>
  <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'https://www.googletagmanager.com/gtm.js?id='+i+dl;
j.setAttributeNode(d.createAttribute('data-ot-ignore'));
f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-TWTKQQ');</script>
    
  <!-- End Google Tag Manager -->


  <!-- MaxMind / GEO IP -->
  <script src="//js.maxmind.com/js/apis/geoip2/v2.1/geoip2.js" type="text/javascript"></script>
  <!-- End MaxMind / GEO IP -->

  
  
  <link href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,600&display=swap" rel="stylesheet">
  <link rel="preload" href="../_static/fonts/DMSans-Bold.ttf" as="font">
  <link rel="preload" href="../_static/fonts/DMSans-Regular.ttf" as="font">
  <link rel="preload" href="../_static/fonts/DMMono-Regular.ttf" as="font">
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/css/custom.css" type="text/css" />
  <link rel="stylesheet" href="../_static/css/cloud-provider-selector.css" type="text/css" />
  <link rel="stylesheet" href="../_static/css/translation-selector.css" type="text/css" />
  <link rel="stylesheet" href="../_static/css/searchunify/main.css" type="text/css" />

  
  <link rel="index" title="Index" href="../genindex.html" />
  <link rel="search" title="Search" href="../search.html" />
  <link rel="top" title="Databricks on AWS" href="../index.html" />
  <link rel="up" title="Introduction to RAG Studio" href="index.html" />
  <link rel="next" title="Evaluating your RAG Application with an Evaluation Set" href="getting-started-evaluation.html" />
  <link rel="prev" title="Environments" href="environments.html" /> 
</head>

<body class="wy-body-for-nav" role="document">

  <!-- Google Tag Manager (noscript) -->
  <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-T85FQ33"
height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
  <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-TWTKQQ"
    height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
  <!-- End Google Tag Manager (noscript) -->

  
  <nav class="wy-nav-top header su_header" role="navigation" aria-label="top navigation">
    
<nav class="wy-nav-top header su_header" role="navigation" aria-label="top navigation">
  <div class="container-logo">
    <ul class="mobile-menu-toggle">
        <li class="menu-toggle">
            <i data-toggle="wy-nav-top" class="wy-nav-top-menu-button db-icon db-icon-menu pull-left"></i>
            
            <a href="https://www.databricks.com/" class="wy-nav-top-logo"><img src="../_static/small-scale-lockup-full-color-rgb.svg" width="137" height="21"
              alt="Databricks" /></a>   
               
              </li>
    </ul>
    <ul class="su_nav-menu">
      <li class="menu-toggle">
        <i data-toggle="wy-nav-top" class="wy-nav-top-menu-button db-icon db-icon-menu pull-left"></i>
        
          
        
        <a href="https://www.databricks.com/" class="wy-nav-top-logo"><img src="../_static/small-scale-lockup-full-color-rgb.svg" width="137" height="21"
            alt="Databricks" /></a></li>
        <!-- 
<li><a href="https://help.databricks.com/s/">Help Center</a></li>
<li class="active"><a href="https://docs.databricks.com/en/">Documentation</a></li>
<li><a href="https://kb.databricks.com/">Knowledge Base</a></li>
 -->
    </ul>
  </div>
  <div class="su_nav-right">
    <ul class="su_link-mobile">
  <!-- Mobile header code can go here -->
</ul>
<ul class="right-try-list">
   
</ul>
  </div>
</nav>
  </nav>

  <div class="su_sub-header">
    <div class="container">
      <div class="su_sub-header-inner">
        <!-- <div class="su_subnav-menu-right">
  <div id="auto" style="width: 100%;">
    <div ng-controller="SearchautoController">
      <div bind-html-compile="autocompleteHtml">
        <form class="su__search-box-1" disabled="disabled">
          <input class="su__search-input" type="search" name="Search box" id="su__search-b" placeholder="Search Documentation" disabled="disabled"/>
          <button class="su__search-button" type="submit" class="button button-success" disabled="disabled">
            <svg width="24" height="24" viewBox="0 0 24 24">
              <path
                d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"
                fill="#333"></path>
            </svg>
          </button>
        </form>
      </div>
    </div>
  </div>
</div> -->
        <div class="search-lng-gap"></div>
        <div style="margin-left: 16px; margin-right: 16px;">
          <!-- <select name="lng selector" id="lng-selector">
    <option value="../../en/rag-temp/getting-started-walkthrough.html" class="notranslate">English</option>
    <option value="../../ja/rag-temp/getting-started-walkthrough.html" class="notranslate">日本語</option>
    <option value="../../pt/rag-temp/getting-started-walkthrough.html" class="notranslate">Português (Brasil)</option>
</select> -->
        </div>
        <div class="cloud-selector-container">
          <!-- <select name="cloud provider selector" id="cloud-provider-selector">
    <option value="aws" selected class="notranslate">
        Amazon Web Services
    </option>
    <option value="azure"  class="notranslate">
        Microsoft Azure
    </option>
    <option value="gcp"  class="notranslate">
        Google Cloud Platform
    </option>
</select> -->
        </div>
      </div>
    </div>
  </div>
  <page class="js-page-container">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side su_nav-side">
<div class="wy-side-scroll">
  <div class="wy-side-nav-search">
    

    

    

    
  </div>

  <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
    
      <a href="../index.html" class="main-navigation-home">Databricks on AWS</a>
    

    
      

      
        <p class="caption"><span class="caption-text">Load &amp; manage data</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="index.html">RAG Studio</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="getting-started-1.html">Quick start (1): Deploy a RAG app</a></li>
<li class="toctree-l2"><a class="reference internal" href="getting-started-2.html">Quick start (2): Collecting assessments &amp; viewing metrics</a></li>
<li class="toctree-l2"><a class="reference internal" href="getting-started-3.html">Quick start (3): Creating Evaluation Sets</a></li>
<li class="toctree-l2"><a class="reference internal" href="getting-started-4.html">Quick start (4): Creating Evaluation Sets</a></li>
<li class="toctree-l2"><a class="reference internal" href="getting-started-5.html">Quick start (5): Creating Evaluation Sets</a></li>
<li class="toctree-l2"><a class="reference internal" href="rag_configyml.html">Concepts: Configuration (rag_config.yml)</a></li>
<li class="toctree-l2"><a class="reference internal" href="environments.html">Concepts: Environments</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Tutorial: Creating your first app</a></li>
<li class="toctree-l2"><a class="reference internal" href="getting-started-evaluation.html">Tutorial: Offline Evaluation &amp; Evaluation Sets</a></li>
<li class="toctree-l2"><a class="reference internal" href="metrics.html">Concepts: Metrics</a></li>
<li class="toctree-l2"><a class="reference internal" href="core_concepts.html">Concepts: RAG Abstractions/Entities</a></li>
<li class="toctree-l2"><a class="reference internal" href="protos.html">  Protos (internal only)</a></li>
<li class="toctree-l2"><a class="reference internal" href="env-setup-infra.html">Setup: Infrastructure</a></li>
<li class="toctree-l2"><a class="reference internal" href="env-setup-dev.html">Setup: Dev environment</a></li>
<li class="toctree-l2"><a class="reference internal" href="regions.html">Region availability</a></li>
</ul>
</li>
</ul>

      
    
  </div>

  <div role="contentinfo">
    
  <p class="build_info notranslate"data-last-edit="January 04, 2024">
    Updated Jan 11, 2024
  </p>
<script>
  window.addEventListener('DOMContentLoaded',function(){
    var h1=document.querySelector('h1');
    var bi=document.querySelector('[data-last-edit]');
    if(h1 && bi){
      var ver = document.createElement('p');
      ver.className = 'version_info';
      ver.textContent = bi.getAttribute('data-last-edit');
      h1.parentElement.insertBefore(ver, h1.nextElementSibling);
    }
  });
</script>

    <p>
      
        <a id='feedbacklink' href="mailto:doc-feedback@databricks.com?subject=Documentation Feedback">Send us feedback</a>
      
    </p>
  </div>
</div>
</nav>
    
    
<main class="wy-grid-for-nav su_nav-grid">
  <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
    <div class="wy-nav-content su__nav_content">
      <div class="rst-content">
        





<div role="navigation" aria-label="breadcrumbs navigation" class="wy-breadcrumbs-wrapper">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html">Documentation</a> <span class="db-icon db-icon-chevron-right"></span></li>
    
        <li><a href="index.html">Introduction to RAG Studio</a> <span class="db-icon db-icon-chevron-right"></span></li>
    
    
      <li>Getting started</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>
</div>
        
        <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
          <div itemprop="articleBody">
            
    
  <div class="section" id="getting-started">
<h1>Getting started<a class="headerlink" href="#getting-started" title="Permalink to this headline"> </a></h1>
<p>TODO: add prose about the goals of this seciton</p>
<ul class="simple">
<li><p>we will iteratively build a simple rag application to explain to you the concepts of rag studio and show you how the workflow works.</p></li>
<li><p>we intetionally build the absolute bare minimum at first to show the concepts - then we add in the actual functionality of a rag app</p></li>
<li><p>assumes you understand what rag is - if you don’t <a class="reference external" href="#">link to unstrctured rag overview docs</a>.</p></li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This guide is intended for developers who prefer to use a local IDE, such as Visual Studio Code, to build their RAG Application.  If you prefer to use the Databricks Notebook IDE, please follow <a class="reference external" href="#">insert link to those steps</a>.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This guide assumes you want to use RAG Studio’s development workflow, which is reccomended by Databricks as the simplest path to building high quality RAG apps.  However, RAG Studio is designed modularly so developers that have an existing application and development workflow can still benefit from specific components of RAG Studio, such as the <a class="reference external" href="#">Review UI</a> for collecting user feedback, Request/Feedback logging APIs for capturing Chain traces, or the Evaluation tools for computing Metrics or computing LLM-Judge feedback.  If you prefer this approach, see <a class="reference external" href="#">insert link to guide for just using these tools</a>.</p>
</div>
<div class="section" id="step-1-set-up-the-required-infrastructure">
<h2>Step 1: Set up the required infrastructure<a class="headerlink" href="#step-1-set-up-the-required-infrastructure" title="Permalink to this headline"> </a></h2>
<p>A RAG Studio app must deployed within a Databricks Workspace.  All necessary assets are created within a selected Unity Catalog schema.   <a class="reference external" href="#">insert link for more info on customizing the UC locations per asset type</a></p>
<ol class="arabic">
<li><p>Select a Databricks Workspace with Unity Catalog and Serverless enabled in a supported region.  Note the URL of the Workspace to use in Step 2 e.g., <code class="docutils literal notranslate"><span class="pre">https://workspace-name.cloud.databricks.com</span></code>.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>RAG Studio is currently only supported in <em>LIST OF REGIONS</em></p>
</div>
</li>
<li><p>Do one of the following to select a Unity Catalog schema to use for your RAG Application:</p>
<ol class="loweralpha simple">
<li><p>Create a <a class="reference internal" href="../data-governance/unity-catalog/create-catalogs.html"><span class="doc">new catalog</span></a> and <a class="reference internal" href="../data-governance/unity-catalog/create-schemas.html"><span class="doc">new schema inside the catalog</span></a>.</p></li>
<li><p>Create a <a class="reference internal" href="../data-governance/unity-catalog/create-schemas.html"><span class="doc">new schema inside an existing catalog</span></a>.</p></li>
<li><p>Select an existing Unity Catalog catalog and schema.  You can view existing catalogs and schemas by going to <a class="reference external" href="https://workspace-name.cloud.databricks.com/explore/data">https://workspace-name.cloud.databricks.com/explore/data</a></p></li>
</ol>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>TODO: Insert the required permissions you must have to this catalog/schema.</p>
</div>
</li>
<li><p>Decide a location in your workspace where the RAG Application’s deployed code will reside.  This folder will be automatically created if it does not exist.  If you aren’t sure, we suggest a folder in your Workspace home directory e.g., <code class="docutils literal notranslate"><span class="pre">/Users/your.email&#64;company.com/rag-app-name/</span></code>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>TODO: Insert note if this must be a workspace folder vs. a repo folder.  Also note if we overwrite the existing contents or not.</p>
</div>
</li>
</ol>
</div>
<div class="section" id="step-2-initialize-your-development-environment">
<h2>Step 2: Initialize your development environment<a class="headerlink" href="#step-2-initialize-your-development-environment" title="Permalink to this headline"> </a></h2>
<ol class="arabic">
<li><p>Follow the <a class="reference internal" href="../dev-tools/cli/install.html"><span class="doc">Databricks CLI installation instructions</span></a> to install or upgrade the <a class="reference internal" href="../dev-tools/cli/index.html"><span class="doc">Databricks CLI</span></a> on your development machine.</p></li>
<li><p>Verify you have the correct version of the Databricks CLI installed.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>databricks<span class="w"> </span>--version
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Databricks CLI version 0.205.2 or higher is required.</p>
</div>
</li>
<li><p>Authenticate the Databricks CLI following the steps for using your <a class="reference internal" href="../dev-tools/cli/authentication.html#databricks-personal-access-token-authentication"><span class="std std-ref">personal access token</span></a> or <span class="xref md md-ref">OAuth user-to-machine (U2M) authentication</span>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>You must use the same Workspace that you identified in Step 1.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Contact your Databricks administrator or account represenative if you aren’t sure the correct authentication mechanism to use.</p>
</div>
</li>
</ol>
</div>
<div class="section" id="step-3-clone-the-rag-studio-template">
<h2>Step 3: Clone the RAG Studio template<a class="headerlink" href="#step-3-clone-the-rag-studio-template" title="Permalink to this headline"> </a></h2>
<ol class="arabic">
<li><p>Open the terminal on your development machine and switch to a directory that will hold the application’s code base.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span><span class="w"> </span>/path/to/a/directory/
</pre></div>
</div>
</li>
<li><p>Initialize the sample application using the RAG Studio Bundle template.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>databricks<span class="w"> </span>bundle<span class="w"> </span>init<span class="w"> </span>https://github.com/databricks/rag_studio<span class="w"> </span>--template-dir<span class="w"> </span>templates/blank_rag_app
</pre></div>
</div>
</li>
<li><p>You will see a folder <code class="docutils literal notranslate"><span class="pre">rag-app</span></code> inside <code class="docutils literal notranslate"><span class="pre">/path/to/a/directory/</span></code>.</p></li>
<li><p>TODO: Add a step for setting up the Python environment</p></li>
<li><p>Optionally, create a Git repo and commit this folder of code.  <a class="reference external" href="#">insert link for generic git repo creation instructions</a>.</p></li>
</ol>
</div>
<div class="section" id="learning-moment-understand-the-structure-of-the-rag-studio-app-code-base">
<h2>Learning moment: Understand the structure of the RAG Studio app code base<a class="headerlink" href="#learning-moment-understand-the-structure-of-the-rag-studio-app-code-base" title="Permalink to this headline"> </a></h2>
<p>Before we configure the application, let’s understand the directory structure of the RAG Application.</p>
<p>RAG Studio is based on <a class="reference internal" href="../dev-tools/bundles/index.html"><span class="doc">Databricks Asset Bundles</span></a>, which is Databricks’ tool for streamlining the development of complex data, analytics, and ML projects on the Databricks platform. Bundles make it easy to manage complex projects during active development by providing CI/CD capabilities to your software development workflow in a single concise and declarative YAML syntax.</p>
<p>RAG Studio uses Bundles to simplify your development and deployment workflows and provide you a unified code base that works in both development and production environments – just like you would expect from a typical full-stack software application’s code base.</p>
<div class="highlight-markdown notranslate"><div class="highlight"><pre><span></span>rag-app/
│
├── databricks.yml                &lt;- Main configuration file for the Bundle.
├── rag_studio.yml                &lt;- Main configuration file for RAG Studio.

<span class="gh"># TODO @ Eng: Can we merge the 2 files above into a single YML?</span>

├── resources/
│   │
│   └── env_setup_job.yml         &lt;- RAG Studio provided file for setting up the Workspace to run your application.  Do not modify.
│
└── src/                          &lt;- Store all Source code directory for the application.
    │
    ├── chains/                   &lt;- Chains, which orchestrate responses to user queries.
    │   └── sample-chain/
    │
    ├── data_ingestors/           &lt;- Data Ingestors, which load raw data to Databricks.
    │   └── sample-data-ingestor/
    │
    ├── data_processors/          &lt;- Data Processors, which turn raw data into Vector Databases.
    │   └── sample-data-processor/
    │
    ├── retrievers/               &lt;- Retrievers, which enable Chains to query Vector Databases.
    │   └── sample-retriever/
    │
    |── provided_notebooks/       &lt;- RAG Studio provided Notebooks for running workflows such as evaluation.  Do not modify these notebooks.
    |
    └── setup/                    &lt;- RAG Studio provided code to set up the Workspace.  Do not modify.
</pre></div>
</div>
</div>
<div class="section" id="step-4-configure-the-application-to-use-your-workspace--unity-catalog-schema">
<h2>Step 4: Configure the application to use your Workspace &amp; Unity Catalog schema<a class="headerlink" href="#step-4-configure-the-application-to-use-your-workspace--unity-catalog-schema" title="Permalink to this headline"> </a></h2>
<p>Now that you understand the high level structure of the code base, let’s get started by completing the required configuration.  If you want to learn more about the other configuration options, view the <a class="reference internal" href="rag_configyml.html"><span class="doc">configuration documentation</span></a>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><strong>TODO &#64; eng:</strong> I have intentionally NOT gotten into trying to merge the rag_config.yml with the databricks.yml that comes with the Bundle - consider <code class="docutils literal notranslate"><span class="pre">rag_config.yml</span></code> like a PRD - it is the requirement for the configuration options we provide users, NOT a dictation of HOW we should provide these options in the context of the DAB!!</p>
</div>
<ol class="arabic">
<li><p>Open the <code class="docutils literal notranslate"><span class="pre">rag_config.yml</span></code> in your IDE.</p></li>
<li><p>Modify the <code class="docutils literal notranslate"><span class="pre">global_config</span></code> section to reference the Workspace, Unity Catalog schema, and Workspace folder you configured in <a class="reference internal" href="#step-1-set-up-the-required-infrastructure"><span class="std std-ref">Step 1</span></a>.</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">global_config</span><span class="p">:</span>
<span class="w">    </span><span class="c1">########</span>
<span class="w">    </span><span class="c1"># Required, global configuration</span>
<span class="w">    </span><span class="c1"># These settings are consistent between all Environments</span>
<span class="w">    </span><span class="c1">########</span>

<span class="w">    </span><span class="c1"># User provided name of the application.  Only alphanumeric chars, `_`, or `-`; no spaces.</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">your-app-name-here</span>

<span class="w">    </span><span class="c1"># The workspace where the application is deployed</span>
<span class="w">    </span><span class="nt">workspace_url</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">https://workspace-name.cloud.databricks.com</span>

<span class="w">    </span><span class="c1"># The folder where the deployed code is written</span>
<span class="w">    </span><span class="nt">workspace_folder</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/Users/your.email@company.com/folder-name</span>

<span class="w">    </span><span class="c1"># Unity Catalog location - used for all assets stored within UC.</span>
<span class="w">    </span><span class="c1"># Can be overrridden for specific types of assets below using `artifact_location`, `output_data_location`, or `logs_location`</span>
<span class="w">    </span><span class="nt">unity_catalog</span><span class="p">:</span>
<span class="w">        </span><span class="nt">catalog</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">catalog_name</span>
<span class="w">        </span><span class="nt">schema</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">schema_name</span>
</pre></div>
</div>
</li>
<li><p>Deploy the skeleton application to your Workspace. TODO: talk about what this does - creates the infra, etc, etc.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>databricks<span class="w"> </span>bundle<span class="w"> </span>deploy<span class="w"> </span>-t<span class="w"> </span>dev<span class="w"> </span>setup
</pre></div>
</div>
</li>
</ol>
</div>
<div class="section" id="learning-moment-what-is-an-environment">
<h2>Learning moment: What is an environment?<a class="headerlink" href="#learning-moment-what-is-an-environment" title="Permalink to this headline"> </a></h2>
<p>Environments are RAG Studio’s approach to enabling you to use a single code base for your RAG application, but maintain logical seperation between your development and production environments.  In this tutorial, we will only use the development environment.  Read the <a class="reference internal" href="environments.html"><span class="doc">environments documentation</span></a> to learn more about how to use environments.</p>
</div>
<div class="section" id="learning-moment-what-is-a-chain">
<h2>Learning moment: What is a Chain?<a class="headerlink" href="#learning-moment-what-is-a-chain" title="Permalink to this headline"> </a></h2>
<p>TODO: branch into seperate doc</p>
<p>To use RAG Studio’s development workflow, the bare minimum requirement is to configure a Chain.  A Chain is the “heart” of your application and contains the orchestation and business logic to respond to user queries by querying vector databases and prompting generative AI models to generate responses to those queries.</p>
<p>A typical Chain accepts a user query, performs query processing, queries a <a class="reference external" href="#">Retriever</a>, and then prompts a foundational model with the query and retriever results to generate a response to the user.  However, Chain logic can be arbitrarily complex and often includes additional steps.</p>
<p>RAG Studio is compatible with any MLflow logged model that has the following request/response schema.  The request schema follows the OpenAI <a class="reference internal" href="../machine-learning/foundation-models/api-reference.html#chatmessage"><span class="std std-ref">ChatMessages</span></a> format and the response schema follows the <a class="reference internal" href="../machine-learning/foundation-models/api-reference.html#chat-response"><span class="std std-ref">ChatResponse</span></a>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>TODO: talk about LangChain support, link that section</p>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">request_signature</span> <span class="o">=</span> <span class="p">{</span>
    <span class="c1"># `messages` is an Array of [ChatMessages](/machine-learning/foundation-models/api-reference.md#chatmessage)</span>
    <span class="c1"># To support support multi-turn conversation, your front end application can pass an array of length &gt;1, where the array alternates between role = &quot;user&quot; and role = &quot;assistant&quot;.</span>
    <span class="c1"># The last message in the array must be of role = &quot;user&quot;</span>
    <span class="s2">&quot;messages&quot;</span><span class="p">:</span> <span class="p">[{</span><span class="s2">&quot;role&quot;</span><span class="p">:</span> <span class="s2">&quot;user&quot;</span><span class="p">,</span> <span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="s2">&quot;This is a question to ask?&quot;</span><span class="p">}]</span>
<span class="p">}</span>

<span class="n">response_signature</span> <span class="o">=</span> <span class="p">{</span>
    <span class="c1"># `choices` is an array of ChatCompletionChoice</span>
    <span class="c1"># There can be 1+ choices, but each choice must have a single [ChatMessages](/machine-learning/foundation-models/api-reference.md#chatmessage) with role = &quot;assistant&quot;</span>
    <span class="s2">&quot;choices&quot;</span><span class="p">:</span> <span class="p">[{</span>
        <span class="s2">&quot;index&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
        <span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;role&quot;</span><span class="p">:</span> <span class="s2">&quot;assistant&quot;</span><span class="p">,</span> <span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="s2">&quot;This is the correct answer.&quot;</span><span class="p">},</span>
        <span class="s2">&quot;finish_reason&quot;</span><span class="p">:</span> <span class="s2">&quot;stop&quot;</span>
    <span class="p">}],</span>
    <span class="s2">&quot;object&quot;</span><span class="p">:</span> <span class="s2">&quot;chat.completions&quot;</span>
    <span class="c1"># TODO: add the rest of https://docs.databricks.com/en/machine-learning/foundation-models/api-reference.html#chat-task schema here</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><p><strong>🚧 Roadmap 🚧</strong></p>
 Support for streaming responses is on RAG Studio’s roadmap.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>**TODO &#64; ENG: We should switch the response type to mirror the FMAPI -<a class="reference external" href="https://docs.databricks.com/en/machine-learning/foundation-models/api-reference.html#chatcompletionchoice">https://docs.databricks.com/en/machine-learning/foundation-models/api-reference.html#chatcompletionchoice</a></p>
</div>
<p>When you deploy a Chain with RAG Studio, RAG Studio automatically adds the following properties to the request/response signature of the Chain’s deployed REST API.  The additional request parameters allow RAG Studio’s <a class="reference external" href="#">logging service</a> to track Converastions and user sessions, and optionally request the detailed trace logging if you need to display this in the user facing application.  RAG Studio’s <a class="reference external" href="#">Review UI</a> uses this information to render the feedback UX - we will deep dive into this capability later in the tutorial.  The additional response parameters allow you to capture the request_id if you want to log additional information in your application to later associate with RAG Studio’s logging.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">request_signature</span> <span class="o">=</span> <span class="p">{</span>
  <span class="c1"># &quot;messages&quot; = ...</span>
  <span class="s2">&quot;databricks&quot;</span> <span class="p">:</span> <span class="p">{</span>
    <span class="s2">&quot;return_trace&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>  <span class="c1"># False by default</span>
    <span class="s2">&quot;conversation_id&quot;</span><span class="p">:</span> <span class="s2">&quot;123456&quot;</span><span class="p">,</span> <span class="c1"># Converastion ID is managed the front end application</span>
    <span class="s2">&quot;session_id&quot;</span><span class="p">:</span> <span class="s2">&quot;4568&quot;</span><span class="p">,</span> <span class="c1"># User Session is managed the front end application</span>
  <span class="p">},</span>
<span class="p">}</span>

<span class="n">response_signature</span> <span class="o">=</span> <span class="p">{</span>
  <span class="c1"># &quot;messages&quot; = ...</span>
  <span class="s2">&quot;databricks&quot;</span> <span class="p">:</span> <span class="p">{</span>
    <span class="s2">&quot;request_id&quot;</span><span class="p">:</span> <span class="s2">&quot;XXXXXXXXXX&quot;</span> <span class="c1"># Generated by RAG Studio</span>
    <span class="s2">&quot;trace_steps&quot;</span><span class="p">:</span> <span class="p">[</span> <span class="c1"># Generated only if return_trace is true in the request</span>
      <span class="p">{</span>
          <span class="c1"># Tracing for the corresponding choice.</span>
          <span class="c1"># [insert link with details here]()</span>
      <span class="p">}</span>
    <span class="p">],</span>
  <span class="p">},</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Read the <a class="reference external" href="#">Chain</a> documentation learn more about how a Chain works.</p>
</div>
<div class="section" id="learning-moment-trace-logging">
<h2>Learning moment: Trace Logging<a class="headerlink" href="#learning-moment-trace-logging" title="Permalink to this headline"> </a></h2>
<p>TODO: talk in more depth what trace logging is, the concept of a trace vs. conversation.</p>
</div>
<div class="section" id="step-5-create-a-chain">
<h2>Step 5: Create a Chain<a class="headerlink" href="#step-5-create-a-chain" title="Permalink to this headline"> </a></h2>
<p>We will start by creating the simplest version of a “fake” chain that simulates the typical steps in order to demonstrate the RAG Studio development workflow for building, testing, and deploying chains with <a class="reference external" href="#">Trace Logging</a>.</p>
<p>Later, we will iteratively add functionality to demonstrate the other RAG Studio functionality including config-driven experimentation and feedback collection.</p>
<p>The basic steps you follow are:</p>
<ol class="arabic simple">
<li><p>Add the Chain to the RAG Studio’s configuration</p>
<ul class="simple">
<li><p>This step enables the various downstream functionality mentioned above.</p></li>
</ul>
</li>
<li><p>Write Python code that configures and logs your chain to an MLflow model</p>
<ul class="simple">
<li><p>Your code can be a Notebook or a Python file.</p></li>
</ul>
</li>
<li><p>Test the chain locally to verify it works</p>
<ul class="simple">
<li><p>Optionally, write unit tests to programatically verify the chain’s functionality</p></li>
</ul>
</li>
<li><p>Deploy the chain using the Bundles command line tool</p></li>
<li><p>RAG Studio handles the behind-the-scenes work to deploy the chain to Databricks Model Serving as a CPU endpoint with logging enabled.</p></li>
<li><p>Interact with the Chain through the <a class="reference external" href="#">Review UI</a> web app.</p></li>
</ol>
<p>By following this workflow, you get several benefits:</p>
<ol class="arabic simple">
<li><p>All requests / responses to the Chain are automatically logged during development AND production with automatic linking to the associated converastion &amp; user session</p>
<ul class="simple">
<li><p>Later we will show you how to expand this logging to include logging of the intermediate steps that happen inside the Chain</p></li>
</ul>
</li>
<li><p>Every log is attached to the exact version of the Chain’s code, configuration, and upstream data that was used to generate a response</p></li>
<li><p>Optionally, an LLM-judge asessment can be automatically run for every chain invocation</p></li>
<li><p>The deployed Chain’s REST endpoint includes callbacks for attaching user feedback to a chain invocation</p></li>
<li><p>The Chain is available in the <a class="reference external" href="#">Review UI</a>, RAG Studio’s web-based chat app for allowing your expert stakeholders to interact with the Chain and provide feedback</p></li>
</ol>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>TOOD: How do we allow the user to configure the model serving endpoint settings per environment?</p>
</div>
<p><strong>Now that you understand the workflow, let’s walk through the steps in detail</strong></p>
<ol class="arabic">
<li><p>Update <code class="docutils literal notranslate"><span class="pre">rag_config.yml</span></code> to make RAG Studio aware of your chain.  The minimum configuration required is a chain name and job name, but we suggest providing a description.</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">chains</span><span class="p">:</span>
<span class="w">    </span><span class="c1"># currently, only one chain per application is supported, but this schema allows for adding support for multiple chains in the future</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">example-chain</span><span class="w"> </span><span class="c1"># Required, user specified, must be unique, no spaces</span>
<span class="w">        </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">A simple example chain</span><span class="w">  </span><span class="c1"># Optional, but a best practice.  User specified, any text string</span>
</pre></div>
</div>
</li>
<li><p>Write the chain’s Python code in the <code class="docutils literal notranslate"><span class="pre">src/chains/example-chain/</span></code> folder as <code class="docutils literal notranslate"><span class="pre">chain.py</span></code>.  Databricks suggests using the same folder name as the chain’s name in <code class="docutils literal notranslate"><span class="pre">rag_config.yml</span></code>, but you do not have to.</p>
<p>In this sample Chain, we simply return the user’s message back to them.  Additionally, we have a “fake” retriever step to demonstrate how Trace Logging works - for your actual chain, you would implement an actual retriever - see <a class="reference external" href="#">STEP</a> for those how to do this.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">databricks</span> <span class="kn">import</span> <span class="n">RAGStudio</span>
<span class="kn">import</span> <span class="nn">mlflow</span>

<span class="c1"># Initiatalize RAG Studio for this component</span>
<span class="c1"># Must match the name in the rag_config.yml</span>
<span class="n">this_chain</span> <span class="o">=</span> <span class="n">RAGStudio</span><span class="p">()</span><span class="o">.</span><span class="n">Chain</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;example-chain&quot;</span><span class="p">)</span>


<span class="c1"># Define PythonModel which is compatible to OpenAI-compatible APIs to log with mlflow.pyfunc.log_model</span>
<span class="k">class</span> <span class="nc">SampleChain</span><span class="p">(</span><span class="n">mlflow</span><span class="o">.</span><span class="n">pyfunc</span><span class="o">.</span><span class="n">PythonModel</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">predict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">context</span><span class="p">,</span> <span class="n">model_input</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This method generates prediction for the given input.</span>
<span class="sd">        The input parameters are compatible with `llm/v1/chat`</span>
<span class="sd">        https://mlflow.org/docs/latest/gateway/index.html#chat</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="kn">from</span> <span class="nn">databricks</span> <span class="kn">import</span> <span class="n">RAGStudio</span>

        <span class="n">this_chain</span> <span class="o">=</span> <span class="n">RAGStudio</span><span class="p">()</span><span class="o">.</span><span class="n">Chain</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;example-chain&quot;</span><span class="p">)</span>

        <span class="c1"># The standard parameters for chat routes with type llm/v1/chat can be find at</span>
        <span class="c1"># https://mlflow.org/docs/latest/gateway/index.html#chat</span>
        <span class="c1"># Get the last message</span>
        <span class="n">user_query</span> <span class="o">=</span> <span class="n">model_input</span><span class="p">[</span><span class="s2">&quot;messages&quot;</span><span class="p">][</span><span class="nb">len</span><span class="p">(</span><span class="n">model_input</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">user_query</span><span class="p">[</span><span class="s2">&quot;role&quot;</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&quot;user&quot;</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Last message must be of role = user&quot;</span><span class="p">)</span>

        <span class="n">response</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;This is what you said to me: </span><span class="si">{</span><span class="n">user_query</span><span class="p">[</span><span class="s1">&#39;content&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>

        <span class="c1"># TODO: Insert a trace logging call that logs fake retriever results</span>
        <span class="n">this_chain</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="p">[])</span>

        <span class="c1"># Return in https://docs.databricks.com/en/machine-learning/foundation-models/api-reference.html#chat-response format</span>
        <span class="n">outputs</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;choices&quot;</span><span class="p">:</span> <span class="p">[</span>
                <span class="p">{</span>
                    <span class="s2">&quot;index&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
                    <span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="p">{</span>
                        <span class="s2">&quot;role&quot;</span><span class="p">:</span> <span class="s2">&quot;assistant&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="n">response</span><span class="p">,</span>
                    <span class="p">},</span>
                    <span class="s2">&quot;finish_reason&quot;</span><span class="p">:</span> <span class="s2">&quot;stop&quot;</span><span class="p">,</span>
                <span class="p">}</span>
            <span class="p">],</span>
            <span class="s2">&quot;object&quot;</span><span class="p">:</span> <span class="s2">&quot;chat.completions&quot;</span><span class="p">,</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="n">outputs</span>


<span class="c1"># Test the chain locally by calling the chain through RAG Studio&#39;s wrapper</span>
<span class="c1"># By doing so, every invocation&#39;s request/response is automatically logged in the same logging format used when the chain is deployed</span>
<span class="n">test_input</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;messages&quot;</span><span class="p">:</span> <span class="p">[{</span><span class="s2">&quot;role&quot;</span><span class="p">:</span> <span class="s2">&quot;user&quot;</span><span class="p">,</span> <span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="s2">&quot;This is a question to ask?&quot;</span><span class="p">}]}</span>
<span class="p">(</span><span class="n">responses</span><span class="p">,</span> <span class="n">traces</span><span class="p">)</span> <span class="o">=</span> <span class="n">this_chain</span><span class="o">.</span><span class="n">invoke</span><span class="p">(</span><span class="n">chain</span><span class="o">=</span><span class="n">SampleChain</span><span class="p">(),</span> <span class="nb">input</span><span class="o">=</span><span class="n">test_input</span><span class="p">)</span>


<span class="c1"># Only log the chain if the code is not run locally</span>
<span class="c1"># TODO: This is pseudo-code</span>
<span class="c1"># TODO: how does this automatically pick up the model name from the rag_config.yml + all the things it needs e.g., input / output schemas, etc -- the user should not have to specify this.</span>
<span class="k">if</span> <span class="n">this_chain</span><span class="o">.</span><span class="n">mode</span> <span class="o">==</span> <span class="s2">&quot;deployment&quot;</span><span class="p">:</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">pyfunc</span><span class="o">.</span><span class="n">log_model</span><span class="p">(</span>
        <span class="s2">&quot;model&quot;</span><span class="p">,</span>
        <span class="n">python_model</span><span class="o">=</span><span class="n">SampleChain</span><span class="p">(),</span>
    <span class="p">)</span>
</pre></div>
</div>
</li>
<li><p>Test the code locally.  After you run the Python code, you can see the logs saved locally.  When you deploy the chain, the same logging format is saved to a Delta Table.</p></li>
</ol>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>TOOD: add the format and structure of the local log file.  Add a sample output that would come from this chain.</p>
</div>
<ol class="arabic">
<li><p>Deploy the chain using the Bundles command line tool</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>databricks<span class="w"> </span>bundle<span class="w"> </span>deploy<span class="w"> </span>-t<span class="w"> </span>dev<span class="w"> </span>chain
databricks<span class="w"> </span>bundle<span class="w"> </span>deploy<span class="w"> </span>-t<span class="w"> </span>dev<span class="w"> </span>review_ui
</pre></div>
</div>
</li>
<li><p>Deployment will take N - M minutes.  Once deployment is complete, in the console, you will see output similar to below.  Open the URL in your web browser to open the Review app.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>[placeholder for some steps/status…]
Congrats!
View the Review UI at http://link
(roadmap) View the RAG Studio Developer UI at http://link
</pre></div>
</div>
</li>
<li><p>You can now interact with your RAG app using the Review UI!</p>
<div class="figure align-default">
<img alt="RAG application" src="../_images/review-ui-1.png" />
</div>
</li>
<li><p>Before moving onto the next step, use the Review UI to have converastions and provide feedback using the UI.</p>
<p>TODO: add specific steps e.g., clear the chat a few times, how to add feedback, etc</p>
</li>
</ol>
</div>
<div class="section" id="step-6-view-metrics">
<h2>Step 6. View Metrics<a class="headerlink" href="#step-6-view-metrics" title="Permalink to this headline"> </a></h2>
<p>TODO: Add in a description of what is happening here - e.g., the model as a judge is running automatically and you are seeing metrics based on those assessments in addition to the assesments you provided through the UI.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><p><strong>🚧 Roadmap 🚧</strong></p>
 RAG Studio’s <a class="reference external" href="#">Explorations UI</a> enables you visualize and interact with <a class="reference external" href="#">Metrics</a> in order to identify the subset of queries that are underperforming.  Until this functionality is available, you can interact with the Metrics through Notebook-based visualizations as shown below.</p>
</div>
<ol class="loweralpha simple">
<li><p>Open the RAG App’s Databricks Workspace in your browser.</p>
<ul class="simple">
<li><p>The URL for your workspace can be found in <code class="docutils literal notranslate"><span class="pre">rag_config.yml</span></code> under <code class="docutils literal notranslate"><span class="pre">workspace_url</span></code></p></li>
</ul>
</li>
<li><p>Open the <code class="docutils literal notranslate"><span class="pre">workspace_folder</span></code> and navigate to the <code class="docutils literal notranslate"><span class="pre">/src/provided_notebooks/</span></code> directory.</p></li>
<li><p>Open the <code class="docutils literal notranslate"><span class="pre">Evaluation_Metrics.py</span></code> Notebook</p></li>
<li><p>In this notebook, you can:</p>
<ul class="simple">
<li><p>View graphs for each metric - filtered for “human feedback” or “llm-judge” feedback</p></li>
<li><p>View the underlying data in the <code class="docutils literal notranslate"><span class="pre">online_evaluation_results_table</span></code> table</p></li>
</ul>
</li>
</ol>
</div>
<div class="section" id="step-7-view-trace-logging--assessment-results">
<h2>Step 7. View Trace Logging &amp; Assessment results<a class="headerlink" href="#step-7-view-trace-logging--assessment-results" title="Permalink to this headline"> </a></h2>
<p>TODO: add in more prose describing what these are and how they work conceptually.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><p><strong>🚧 Roadmap 🚧</strong></p>
 RAG Studio’s <a class="reference external" href="#">Investigations UI</a> enables you to visualize the resulting <a class="reference external" href="#">Traces</a> and <a class="reference external" href="#">Assessments</a> in a UI.  Until this functionality is available, you can follow <a class="reference external" href="#">INSERT LINK</a> steps to view the <a class="reference external" href="#">Traces</a> in the <a class="reference external" href="#">Review UI</a> or use the below steps to view the <a class="reference external" href="#">Traces</a> and <a class="reference external" href="#">Assessments</a> as Delta Tables.</p>
</div>
<ol class="loweralpha simple">
<li><p>Follow the first 2 steps above to open the <code class="docutils literal notranslate"><span class="pre">/src/provided_notebooks/</span></code> in your <code class="docutils literal notranslate"><span class="pre">workspace_folder</span></code></p></li>
<li><p>Open the <code class="docutils literal notranslate"><span class="pre">Evaluation_Data.py</span></code> Notebook</p></li>
<li><p>In this notebook, you can:</p>
<ul class="simple">
<li><p>View the underlying data in the <code class="docutils literal notranslate"><span class="pre">request_log_table</span></code> and <code class="docutils literal notranslate"><span class="pre">assessment_log_table</span></code> tables</p></li>
<li><p>Load the <code class="docutils literal notranslate"><span class="pre">request_log_table</span></code> into the Review UI to visualize the RAG app’s answers as a web-based chat app.</p>
<ul>
<li><p>TODO - add this step here - it is documented in <a class="reference internal" href="getting-started-evaluation.html"><span class="doc">getting-started-evaluation.md</span></a> now.</p></li>
</ul>
</li>
</ul>
</li>
</ol>
</div>
<div class="section" id="step-8-add-a-foundational-model">
<h2>Step 8. Add a Foundational Model<a class="headerlink" href="#step-8-add-a-foundational-model" title="Permalink to this headline"> </a></h2>
<p>TODO: flesh this out to be user facing prose.</p>
<ol class="arabic">
<li><p>Update the chain in rag_config.yml</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">chains</span><span class="p">:</span>
<span class="w">    </span><span class="c1"># currently, only one chain per application is supported, but this schema allows for adding support for multiple chains in the future</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">spark-docs-chain</span><span class="w"> </span><span class="c1"># User specified, must be unique, no spaces</span>
<span class="w">    </span><span class="nt">foundational_models</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">llama-2-70b-chat</span><span class="w"> </span><span class="c1"># user specified name to reference this model in the chain &amp; to override per environment.  Must be unique.</span>
<span class="w">        </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v1/llm/chat</span>
<span class="w">        </span><span class="nt">endpoint_name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">databricks-llama-2-70b-chat</span>
<span class="w">        </span><span class="nt">prompt_template</span><span class="p">:</span>
<span class="w">            </span><span class="nt">chat_messages</span><span class="p">:</span>
<span class="w">                </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">role</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;system&quot;</span>
<span class="w">                    </span><span class="nt">content</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;You</span><span class="nv"> </span><span class="s">are</span><span class="nv"> </span><span class="s">a</span><span class="nv"> </span><span class="s">smart</span><span class="nv"> </span><span class="s">assistant</span><span class="nv"> </span><span class="s">made</span><span class="nv"> </span><span class="s">by</span><span class="nv"> </span><span class="s">Databricks</span><span class="nv"> </span><span class="s">Spark&quot;</span>
<span class="w">                </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">role</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;user&quot;</span>
<span class="w">                    </span><span class="nt">content</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Respond</span><span class="nv"> </span><span class="s">to</span><span class="nv"> </span><span class="s">{query}</span><span class="nv"> </span><span class="s">based</span><span class="nv"> </span><span class="s">on</span><span class="nv"> </span><span class="s">{docs}...&quot;</span>
</pre></div>
</div>
</li>
<li><p>Update the chain’s Python code to use this</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">this_chain</span> <span class="o">=</span> <span class="n">RAGStudio</span><span class="p">()</span><span class="o">.</span><span class="n">Chain</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;example-chain&quot;</span><span class="p">)</span>
<span class="c1"># Get access to the embedding model</span>
<span class="n">EmbeddingModel</span> <span class="o">=</span> <span class="n">this_chain</span><span class="o">.</span><span class="n">FoundationalModels</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;llama-2-70b-chat&quot;</span><span class="p">)</span>
<span class="c1"># TBD by engineering</span>
<span class="c1"># EmbeddingModel == [instance of mlflow.deployments | instance of databricks_genai_inference.Embedding | ...params to connect to these APIs... ]</span>
</pre></div>
</div>
</li>
<li><p>test and deploy, etc, etc</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>databricks<span class="w"> </span>bundle<span class="w"> </span>deploy<span class="w"> </span>-t<span class="w"> </span>dev<span class="w"> </span>chain
databricks<span class="w"> </span>bundle<span class="w"> </span>deploy<span class="w"> </span>-t<span class="w"> </span>dev<span class="w"> </span>review_ui
</pre></div>
</div>
</li>
</ol>
</div>
<div class="section" id="step-9-test-a-new-version">
<h2>Step 9. Test a new version<a class="headerlink" href="#step-9-test-a-new-version" title="Permalink to this headline"> </a></h2>
<p>TODO: Talk about what a new version means - its an experiment to try out some setting for quality.</p>
<p>TODO: Link docs for the suggested quality configurations we think you should try</p>
<p>Ways to define a new version</p>
<ul class="simple">
<li><p>you can change the code directly and just deploy it – it is autmatically saved as a new version</p></li>
<li><p>you can change the rag_config.yml and deploy that – saved in the same as #1</p></li>
</ul>
<p>Approaches</p>
<ul class="simple">
<li><p>Talk about how we suggest using configuration settings to do this</p></li>
<li><p>or you could define multiple foundational models and toggle bwteen them</p></li>
</ul>
<p>Talk about</p>
<ul class="simple">
<li><p>How a version maps to mlflow run.</p></li>
<li><p>How to manage versions</p></li>
</ul>
<ol class="arabic">
<li><p>add a configuration setting in the rag_config.yml - these can be any K-V pair.</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="w">    </span><span class="nt">chains</span><span class="p">:</span>
<span class="w">    </span><span class="c1"># currently, only one chain per application is supported, but this schema allows for adding support for multiple chains in the future</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">spark-docs-chain</span><span class="w"> </span><span class="c1"># User specified, must be unique, no space</span>
<span class="w">        </span><span class="nt">configurations</span><span class="p">:</span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">sample_config_setting</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">false</span>
</pre></div>
</div>
</li>
<li><p>accessing this in Python</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">this_chain</span> <span class="o">=</span> <span class="n">RAGStudio</span><span class="p">()</span><span class="o">.</span><span class="n">Chain</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;example-chain&quot;</span><span class="p">)</span>
<span class="n">chunk_overlap</span> <span class="o">=</span> <span class="n">this_chain</span><span class="o">.</span><span class="n">configuration</span><span class="p">[</span><span class="s1">&#39;sample_config_setting&#39;</span><span class="p">]</span>
</pre></div>
</div>
</li>
<li><p>test, deploy, etc</p></li>
</ol>
</div>
<div class="section" id="step-10-deploy-the-application-to-users-for-feedback">
<h2>Step 10. Deploy the application to users for feedback<a class="headerlink" href="#step-10-deploy-the-application-to-users-for-feedback" title="Permalink to this headline"> </a></h2>
<p>TODO: talk about what this means - you share your iterations with users for them to interact with the app</p>
<ol class="arabic simple">
<li><p>Deploy the app to the reviewers environment</p></li>
</ol>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>databricks<span class="w"> </span>bundle<span class="w"> </span>deploy<span class="w"> </span>-t<span class="w"> </span>reviewers
</pre></div>
</div>
<ol class="arabic simple">
<li><p>Add permissions to the app by adjusting the MLflow run for the version</p></li>
<li><p>Share the URL with your users</p></li>
</ol>
</div>
<div class="section" id="step-10-add-a-data-ingestor">
<h2>Step 10. Add a data ingestor<a class="headerlink" href="#step-10-add-a-data-ingestor" title="Permalink to this headline"> </a></h2>
<p>TODO: talk about what this does - load raw docs to a uc volume</p>
<ol class="arabic simple">
<li><p>Add in the rag_config.yml</p></li>
</ol>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">data_ingestors</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">spark-docs-ingestor</span>
<span class="w">        </span><span class="l l-Scalar l-Scalar-Plain">description</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Ingest Spark docs from the website</span>
<span class="w">        </span><span class="l l-Scalar l-Scalar-Plain"># Optional.  The Unity Catalog Volume where the raw docs are stored.  If not specified, will default to `{name}__raw_docs__{env_generated_6digit_id}`</span>
<span class="w">        </span><span class="l l-Scalar l-Scalar-Plain"># destination_uc_volume</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">volume-name</span>
</pre></div>
</div>
<ol class="arabic simple">
<li><p>Add the Python code</p></li>
</ol>
<p>PSUEDO CODE!!</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">databricks</span> <span class="kn">import</span> <span class="n">RAGStudio</span>

<span class="c1"># Initiatalize RAG Studio for this component</span>
<span class="c1"># Must match the name in the rag_config.yml</span>
<span class="n">this_data_ingestor</span> <span class="o">=</span> <span class="n">RAGStudio</span><span class="p">()</span><span class="o">.</span><span class="n">DataIngestor</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;spark-docs-ingestor&quot;</span><span class="p">)</span>

<span class="c1"># Access the Ingestor&#39;s configuration</span>
<span class="n">uc_volume</span> <span class="o">=</span> <span class="n">this_data_ingestor</span><span class="o">.</span><span class="n">destination_uc_volume</span>
<span class="k">assert</span> <span class="n">uc_volume</span> <span class="o">==</span> <span class="s2">&quot;/Volumes/catalog-name/schema-name/volume-name&quot;</span>

<span class="c1"># Connect to the data source and save the files to the UC Volume</span>
<span class="c1"># ........</span>
<span class="c1"># ...insert code here...</span>
<span class="c1"># ........</span>
</pre></div>
</div>
<ol class="arabic simple">
<li><p>Deploy</p></li>
</ol>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>databricks<span class="w"> </span>bundle<span class="w"> </span>deploy<span class="w"> </span>-t<span class="w"> </span>dev<span class="w"> </span>ingestors
</pre></div>
</div>
</div>
<div class="section" id="step-11-add-a-data-processor">
<h2>Step 11. Add a data processor<a class="headerlink" href="#step-11-add-a-data-processor" title="Permalink to this headline"> </a></h2>
<p>TODO: talk about what this does - process docs from the ingestor to parse/chunk/embed them into a vector search index.</p>
<ol class="arabic simple">
<li><p>Add the rag_config.yml</p></li>
</ol>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">data_processors</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">spark-docs-processor</span>
<span class="w">    </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Parse, chunk, embed Spark documentation</span>
<span class="w">    </span><span class="c1"># explicit link to the data ingestors that this processor uses.</span>
<span class="w">    </span><span class="c1"># currently, only one data data ingestor per processor is supported, but this schema allows support for adding multiple in the future</span>
<span class="w">    </span><span class="nt">data_ingestors</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">spark-docs-ingestor</span>
<span class="w">    </span><span class="c1"># Optional.  The Unity Catalog table where the embedded, chunked docs are stored.  If not specified, will default to `{name}__embedded_docs__{env_generated_6digit_id}`</span>
<span class="w">    </span><span class="c1"># destination_table: spark-docs-chunked</span>
<span class="w">    </span><span class="c1"># need to configure &amp; use vector search</span>
<span class="w">    </span><span class="nt">column_names</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">id</span>
<span class="w">          </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">primary_key</span><span class="w"> </span><span class="c1"># one of the reserved names</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">chunk_embedding</span>
<span class="w">          </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">embedding</span><span class="w"> </span><span class="c1"># one of the reserved names</span>
<span class="w">    </span><span class="nt">destination_vector_index</span><span class="p">:</span>
<span class="w">        </span><span class="nt">databricks_vector_search</span><span class="p">:</span>
<span class="w">            </span><span class="c1"># optional, if not set, uses the app&#39;s global or per-environment config for endpoint</span>
<span class="w">            </span><span class="c1"># endpoint_name: vector-search-endpoint-name</span>
<span class="w">            </span><span class="c1"># Optional.  The Unity Catalog table where the embedded, chunked docs are stored.  If not specified, will default to `{name}__embedded_docs_index__{env_generated_6digit_id}`</span>
<span class="w">            </span><span class="c1"># index_name: spark-docs-chunked-index</span>
<span class="w">    </span><span class="nt">embedding_model</span><span class="p">:</span>
<span class="w">        </span><span class="nt">endpoint_name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">databricks-bge-large-en</span>
<span class="w">        </span><span class="nt">indexing_instruction</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;&quot;</span>
<span class="w">        </span><span class="nt">query_instruction</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Represent</span><span class="nv"> </span><span class="s">this</span><span class="nv"> </span><span class="s">sentence</span><span class="nv"> </span><span class="s">for</span><span class="nv"> </span><span class="s">searching</span><span class="nv"> </span><span class="s">relevant</span><span class="nv"> </span><span class="s">passages:&quot;</span>
<span class="w">    </span><span class="c1"># these are key-value pairs that can be specified by the end user</span>
<span class="w">    </span><span class="nt">configurations</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">chunk_size</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">500</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">chunk_overlap</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">50</span>
<span class="w">    </span><span class="c1"># TODO: Do we need a way for the user to specify the compute used to run this pipeline?</span>
</pre></div>
</div>
<ol class="arabic simple">
<li><p>Add the Python code</p></li>
</ol>
<p>This is super rough -not sure the best way to write this - it also doesn’t use the specification for the embedding column name</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>
<span class="kn">from</span> <span class="nn">databricks</span> <span class="kn">import</span> <span class="n">RAGStudio</span>
<span class="kn">import</span> <span class="nn">os</span>

<span class="c1"># Initiatalize RAG Studio for this component</span>
<span class="c1"># Must match the name in the rag_config.yml</span>
<span class="n">this_data_processor</span> <span class="o">=</span> <span class="n">RAGStudio</span><span class="p">()</span><span class="o">.</span><span class="n">DataProcessor</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;spark-docs-processor&quot;</span><span class="p">)</span>

<span class="c1"># Access the Processor&#39;s associated Ingestor&#39;s UC volume via ??</span>
<span class="n">uc_volume</span> <span class="o">=</span> <span class="n">this_data_processor</span><span class="o">.</span><span class="n">DataIngestor</span><span class="p">()</span><span class="o">.</span><span class="n">destination_uc_volume</span>
<span class="k">assert</span> <span class="n">uc_volume</span> <span class="o">==</span> <span class="s2">&quot;/Volumes/catalog-name/schema-name/volume-name&quot;</span>

<span class="c1"># Get configuration settings</span>
<span class="n">chunk_size</span> <span class="o">=</span> <span class="n">this_data_processor</span><span class="o">.</span><span class="n">configuration</span><span class="p">[</span><span class="s1">&#39;chunk_size&#39;</span><span class="p">]</span>
<span class="n">chunk_overlap</span> <span class="o">=</span> <span class="n">this_data_processor</span><span class="o">.</span><span class="n">configuration</span><span class="p">[</span><span class="s1">&#39;chunk_overlap&#39;</span><span class="p">]</span>
<span class="k">assert</span> <span class="n">chunk_size</span> <span class="o">==</span> <span class="mi">500</span>
<span class="k">assert</span> <span class="n">chunk_overlap</span> <span class="o">==</span> <span class="mi">50</span>

<span class="c1"># Get access to the embedding model</span>
<span class="n">EmbeddingModel</span> <span class="o">=</span> <span class="n">this_data_processor</span><span class="o">.</span><span class="n">EmbeddingModel</span><span class="p">()</span>
<span class="c1"># TBD by engineering</span>
<span class="c1"># EmbeddingModel == [instance of mlflow.deployments | instance of databricks_genai_inference.Embedding | ...params to connect to these APIs... ]</span>

<span class="c1"># Get the destination Delta Table</span>
<span class="n">destination_delta_table</span> <span class="o">=</span> <span class="n">this_data_processor</span><span class="o">.</span><span class="n">destination_table</span>
<span class="k">assert</span> <span class="n">destination_delta_table</span> <span class="o">==</span> <span class="s1">&#39;catalog-name.schema-name.spark-docs-chunked&#39;</span>

<span class="c1"># Parse &amp; chunk + save to destination_delta_table</span>

<span class="n">files</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">uc_volume</span><span class="p">)</span>
<span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span>
    <span class="n">chunks</span> <span class="o">=</span> <span class="p">[]</span> <span class="c1"># Make chunks</span>
    <span class="k">for</span> <span class="n">chunk</span> <span class="ow">in</span> <span class="n">chunks</span><span class="p">:</span>
        <span class="n">embedding</span> <span class="o">=</span> <span class="n">EmbeddingModel</span><span class="p">(</span><span class="nb">input</span><span class="o">=</span><span class="n">chunk</span><span class="p">)</span> <span class="c1"># Embed chunks</span>

<span class="c1"># Save all chunks to the `delta table`</span>
<span class="n">embedding_column_name</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
<span class="n">df</span><span class="o">.</span><span class="n">write</span><span class="o">.</span><span class="n">mode</span><span class="p">(</span><span class="s1">&#39;overwrite&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">saveAsTable</span><span class="p">(</span><span class="n">destination_delta_table</span><span class="p">)</span>
<span class="c1"># ........</span>

<span class="c1"># Get the resulting Vector Index</span>
<span class="p">(</span><span class="n">endpoint</span><span class="p">,</span> <span class="n">index_name</span><span class="p">)</span> <span class="o">=</span> <span class="n">this_data_processor</span><span class="o">.</span><span class="n">getVectorIndex</span><span class="p">()</span>

<span class="n">VectorSearchClient</span><span class="p">()</span><span class="o">.</span><span class="n">create_delta_sync_index</span><span class="p">(</span>
    <span class="n">endpoint_name</span><span class="o">=</span><span class="n">endpoint</span><span class="p">,</span>
    <span class="n">index_name</span><span class="o">=</span><span class="n">index_name</span><span class="p">,</span>
    <span class="n">source_table_name</span><span class="o">=</span><span class="n">destination_delta_table</span><span class="p">,</span>
    <span class="n">pipeline_type</span><span class="o">=</span><span class="s2">&quot;CONTINUOUS&quot;</span><span class="p">,</span>
    <span class="n">primary_key</span><span class="o">=</span><span class="s2">&quot;id&quot;</span><span class="p">,</span>
    <span class="n">embedding_dimension</span><span class="o">=</span><span class="n">EmbeddingModel</span><span class="o">.</span><span class="n">dimension</span><span class="p">,</span>
    <span class="n">embedding_vector_column</span><span class="o">=</span><span class="n">embedding_column_name</span>
  <span class="p">)</span>
</pre></div>
</div>
<ol class="arabic simple">
<li><p>Deploy</p></li>
</ol>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>databricks<span class="w"> </span>bundle<span class="w"> </span>deploy<span class="w"> </span>-t<span class="w"> </span>dev<span class="w"> </span>processors
</pre></div>
</div>
</div>
<div class="section" id="step-12-add-a-retriever">
<h2>Step 12. Add a retriever<a class="headerlink" href="#step-12-add-a-retriever" title="Permalink to this headline"> </a></h2>
<p>TODO: Figure out what the schema for the retriever needs to be and specify it.</p>
<ol class="arabic simple">
<li><p>add to the rag_config.yml</p></li>
</ol>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">retrievers</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ann-retriever</span>
<span class="w">    </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Basic ANN retriever</span>
<span class="w">    </span><span class="c1"># explicit link to the data processor that this retriever uses.</span>
<span class="w">    </span><span class="c1"># currently, only one data processor per chain is supported, but this schema allows support for adding multiple in the future</span>
<span class="w">    </span><span class="nt">data_processors</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">spark-docs-processor</span>
<span class="w">    </span><span class="c1"># these are key-value pairs that can be specified by the end user</span>
<span class="w">    </span><span class="nt">configurations</span><span class="p">:</span>
<span class="w">        </span><span class="nt">k</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">5</span>
<span class="w">        </span><span class="nt">use_mmr</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">false</span>
<span class="w">    </span><span class="c1"># Optional.  The Unity Catalog name of the logged MLflow model that the Retriever is saved in.  If not specified, will default to `{name}__retriever__{env_generated_6digit_id}`</span>
<span class="w">    </span><span class="c1"># destination_model_name: spark-docs-retriever</span>
</pre></div>
</div>
<ol class="arabic simple">
<li><p>add the python code</p></li>
</ol>
<p>TODO: write this - it should be similar to Chain - you log this as an MLflow model with a specific schema.</p>
<ol class="arabic simple">
<li><p>Update the chain to use the retriever</p></li>
</ol>
<p>TODO: add sample code</p>
<ol class="arabic simple">
<li><p>Deploy</p></li>
</ol>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>databricks<span class="w"> </span>bundle<span class="w"> </span>deploy<span class="w"> </span>-t<span class="w"> </span>dev<span class="w"> </span>retrievers
databricks<span class="w"> </span>bundle<span class="w"> </span>deploy<span class="w"> </span>-t<span class="w"> </span>dev<span class="w"> </span>chain
databricks<span class="w"> </span>bundle<span class="w"> </span>deploy<span class="w"> </span>-t<span class="w"> </span>dev<span class="w"> </span>review_ui
</pre></div>
</div>
</div>
<div class="section" id="step-13-run-offline-evaluations">
<h2>Step 13. Run offline evaluations<a class="headerlink" href="#step-13-run-offline-evaluations" title="Permalink to this headline"> </a></h2>
<p>See <span class="xref md md-doc">offline evaluations getting started guide</span></p>
<p>TODO: this also talks about configuring metrics.  break that out in a seperate section.</p>
</div>
<div class="section" id="step-14-curate-evaluation-sets-with-user-feedback">
<h2>Step 14. Curate Evaluation Sets with user feedback<a class="headerlink" href="#step-14-curate-evaluation-sets-with-user-feedback" title="Permalink to this headline"> </a></h2>
<p>TODO: Talk about how you use the REview UI to get feedback on traces from users.</p>
<p>This is currently part of <span class="xref md md-doc">offline evaluations getting started guide</span> – break into a seperate doc.</p>
</div>
</div>


    
          </div>
        </div>
        <div  class="suapp-rating">
  <div id="suPageRateApp">
     <su-app></su-app>
   </div> 
 </div>
<hr> 
<footer>
  <div role="contentinfo">
      <p class="copyright">
          &copy; Databricks 2023. All rights reserved. Apache, Apache Spark, Spark, and the Spark logo are trademarks of the <a href="http://www.apache.org/">Apache Software Foundation</a>.
      </p>
      <p> 
        
          <a id='feedbacklink' href="mailto:doc-feedback@databricks.com?subject=Documentation Feedback">Send us feedback</a>
        
     | <a href="https://databricks.com/privacy-policy">Privacy Policy</a> | <a href="https://databricks.com/terms-of-use">Terms of Use</a></p>

  </div> 

</footer>
      </div>
    </div>
  </section>
</main>

  </page>
  
  <script type="text/javascript">
    var DOCUMENTATION_OPTIONS = {
      URL_ROOT: '../',
      VERSION: '1.0',
      COLLAPSE_INDEX: false,
      FILE_SUFFIX: '.html',
      HAS_SOURCE: 'false'
    };
  </script>
  <script type="text/javascript" src="../_static/jquery.js"></script>
  <script type="text/javascript" src="../_static/underscore.js"></script>
  <script type="text/javascript" src="../_static/doctools.js"></script>
  <script type="text/javascript" src="../_static/language_data.js"></script>
  

  <script type="text/javascript" src="../_static/js/clipboard.min.js"></script>
  <script type="text/javascript" src="../_static/js/jquery.waypoints.min.js"></script>

  <!-- Select2 (https://select2.org/) -->
  <link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />
  <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
  <!-- End Select2 -->

  
  
  <script type="text/javascript" src="../_static/js/localized.js"></script>
  <script type="text/javascript" src="../_static/js/custom.js"></script>
  

  
  
  <script type="text/javascript">
    jQuery(function () {
      SphinxRtdTheme.StickyNav.enable();
    });

  </script>
  
 



  <script>
  window.__searchunifyLoaderConfig = JSON.parse('{"clients": {"en": "02c2e804-27e9-11ee-aefb-0242ac120011", "ja": "6a42c3f2-2820-11ee-aefb-0242ac120011", "pt": "6a86badd-2821-11ee-aefb-0242ac120011"}}')
</script>
<script type="text/javascript" src="../_static/js/search-loader.js"></script>
</body>
<script type='text/javascript'>
  window.onload = function () {
    var description = document.querySelector('meta[name="description"]').getAttribute("content");
    let titleText = document.querySelector('h1').textContent;
    document.querySelector('meta[property="og:title"]').setAttribute("content", titleText);
    document.querySelector('meta[property="og:description"]').setAttribute("content", description);
    document.querySelector('meta[property="twitter:description"]').setAttribute("content", description);
  };
</script>

</html>