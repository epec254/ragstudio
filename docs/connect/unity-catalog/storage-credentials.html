

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en-US" > <![endif]-->
<!--[if gt IE 8]><!-->
<html class="no-js" lang="en-US"> <!--<![endif]-->

<head>
  <!-- cookie consent -->
  
    <!-- Combined Onetrust and Rudderstack Implementation Scripts -->
    <!-- Onetrust Initialization -->
    <script type="text/javascript" src="https://cdn.cookielaw.org/consent/92466579-1717-44d3-809d-a05fb02843ed-test/OtAutoBlock.js"></script>
    <script src="https://cdn.cookielaw.org/scripttemplates/otSDKStub.js" data-document-language="true" type="text/javascript" charset="UTF-8" data-domain-script="92466579-1717-44d3-809d-a05fb02843ed-test"></script>
    <link rel="stylesheet" id="db-onetrust-style" href="https://www.databricks.com/wp-content/uploads/db_onetrust.css" media="all" />
    <!-- Setting Rudderstack Write Key -->
    <script>window.rudderstackKey = "2SOR9fvSr5Fi6tN2ihPbVHnX1SZ" </script>
    <!-- Rudderstack Initialization + Onetrust Integration + Rudderstack Custom Events -->
    <script type="text/javascript" src="https://www.databricks.com/sites/default/files/rudderstack/v1/db-rudderstack-events.js"></script>

  <!-- cookie consent -->

  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta http-equiv="X-UA-Compatible" content="IE=9" />
  <meta content="Learn how to create a Unity Catalog storage credential on Databricks." name="description" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0">
  <meta property="og:image" content="https://www.databricks.com/wp-content/uploads/2020/04/og-databricks.png">
  <meta property="og:image:type" content="image/png">
  <meta property="og:title" content="Create a storage credential">
  <meta property="og:image:width" content="1200">
  <meta property="og:image:height" content="630">
  <meta property="og:type" content="website">
  <meta property="og:url" content="https://docs.databricks.com">
  <meta property="og:description" content="" id="og-description">
  <meta name="twitter:image" content="https://www.databricks.com/wp-content/uploads/2020/04/og-databricks.png">
  <meta name="twitter:site" content="@databricks">
  <meta name="twitter:creator" content="@databricks">
  <meta property="twitter:description" content="">
  
  <title>Create a storage credential &#124; Databricks on AWS</title>
  
  
  <link rel="canonical" href="https://docs.databricks.com/en/connect/unity-catalog/storage-credentials.html">
  <!-- Start hreflang tag -->
  <link rel="alternate" hreflang="en" href="https://docs.databricks.com/en/connect/unity-catalog/storage-credentials.html" />
<link rel="alternate" hreflang="x-default" href="https://docs.databricks.com/en/connect/unity-catalog/storage-credentials.html" />
  <!-- End hreflang tag -->
  
  
  <link rel="shortcut icon" href="../../_static/favicon.ico" />
  

  

  

  <!-- Google Tag Manager -->
  <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'https://www.googletagmanager.com/gtm.js?id='+i+dl;
j.setAttributeNode(d.createAttribute('data-ot-ignore'));
f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-T85FQ33');</script>
  <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'https://www.googletagmanager.com/gtm.js?id='+i+dl;
j.setAttributeNode(d.createAttribute('data-ot-ignore'));
f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-TWTKQQ');</script>
    
  <!-- End Google Tag Manager -->


  <!-- MaxMind / GEO IP -->
  <script src="//js.maxmind.com/js/apis/geoip2/v2.1/geoip2.js" type="text/javascript"></script>
  <!-- End MaxMind / GEO IP -->

  
  
  <link href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,600&display=swap" rel="stylesheet">
  <link rel="preload" href="../../_static/fonts/DMSans-Bold.ttf" as="font">
  <link rel="preload" href="../../_static/fonts/DMSans-Regular.ttf" as="font">
  <link rel="preload" href="../../_static/fonts/DMMono-Regular.ttf" as="font">
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/css/custom.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/css/cloud-provider-selector.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/css/translation-selector.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/css/searchunify/main.css" type="text/css" />

  
  <link rel="index" title="Index" href="../../genindex.html" />
  <link rel="search" title="Search" href="../../search.html" />
  <link rel="top" title="Databricks on AWS" href="../../index.html" /> 
</head>

<body class="wy-body-for-nav" role="document">

  <!-- Google Tag Manager (noscript) -->
  <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-T85FQ33"
height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
  <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-TWTKQQ"
    height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
  <!-- End Google Tag Manager (noscript) -->

  
  <nav class="wy-nav-top header su_header" role="navigation" aria-label="top navigation">
    
<nav class="wy-nav-top header su_header" role="navigation" aria-label="top navigation">
  <div class="container-logo">
    <ul class="mobile-menu-toggle">
        <li class="menu-toggle">
            <i data-toggle="wy-nav-top" class="wy-nav-top-menu-button db-icon db-icon-menu pull-left"></i>
            
            <a href="https://www.databricks.com/" class="wy-nav-top-logo"><img src="../../_static/small-scale-lockup-full-color-rgb.svg" width="137" height="21"
              alt="Databricks" /></a>   
               
              </li>
    </ul>
    <ul class="su_nav-menu">
      <li class="menu-toggle">
        <i data-toggle="wy-nav-top" class="wy-nav-top-menu-button db-icon db-icon-menu pull-left"></i>
        
          
        
        <a href="https://www.databricks.com/" class="wy-nav-top-logo"><img src="../../_static/small-scale-lockup-full-color-rgb.svg" width="137" height="21"
            alt="Databricks" /></a></li>
        <!-- 
<li><a href="https://help.databricks.com/s/">Help Center</a></li>
<li class="active"><a href="https://docs.databricks.com/en/">Documentation</a></li>
<li><a href="https://kb.databricks.com/">Knowledge Base</a></li>
 -->
    </ul>
  </div>
  <div class="su_nav-right">
    <ul class="su_link-mobile">
  <!-- Mobile header code can go here -->
</ul>
<ul class="right-try-list">
   
</ul>
  </div>
</nav>
  </nav>

  <div class="su_sub-header">
    <div class="container">
      <div class="su_sub-header-inner">
        <!-- <div class="su_subnav-menu-right">
  <div id="auto" style="width: 100%;">
    <div ng-controller="SearchautoController">
      <div bind-html-compile="autocompleteHtml">
        <form class="su__search-box-1" disabled="disabled">
          <input class="su__search-input" type="search" name="Search box" id="su__search-b" placeholder="Search Documentation" disabled="disabled"/>
          <button class="su__search-button" type="submit" class="button button-success" disabled="disabled">
            <svg width="24" height="24" viewBox="0 0 24 24">
              <path
                d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"
                fill="#333"></path>
            </svg>
          </button>
        </form>
      </div>
    </div>
  </div>
</div> -->
        <div class="search-lng-gap"></div>
        <div style="margin-left: 16px; margin-right: 16px;">
          <!-- <select name="lng selector" id="lng-selector">
    <option value="../../../en/connect/unity-catalog/storage-credentials.html" class="notranslate">English</option>
    <option value="../../../ja/connect/unity-catalog/storage-credentials.html" class="notranslate">日本語</option>
    <option value="../../../pt/connect/unity-catalog/storage-credentials.html" class="notranslate">Português (Brasil)</option>
</select> -->
        </div>
        <div class="cloud-selector-container">
          <!-- <select name="cloud provider selector" id="cloud-provider-selector">
    <option value="aws" selected class="notranslate">
        Amazon Web Services
    </option>
    <option value="azure"  class="notranslate">
        Microsoft Azure
    </option>
    <option value="gcp"  class="notranslate">
        Google Cloud Platform
    </option>
</select> -->
        </div>
      </div>
    </div>
  </div>
  <page class="js-page-container">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side su_nav-side">
<div class="wy-side-scroll">
  <div class="wy-side-nav-search">
    

    

    

    
  </div>

  <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
    
      <a href="../../index.html" class="main-navigation-home">Databricks on AWS</a>
    

    
      

      
        <p class="caption"><span class="caption-text">Load &amp; manage data</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../rag-temp/index.html">RAG Studio</a></li>
</ul>

      
    
  </div>

  <div role="contentinfo">
    
  <p class="build_info notranslate"data-last-edit="December 23, 2023">
    Updated Jan 11, 2024
  </p>
<script>
  window.addEventListener('DOMContentLoaded',function(){
    var h1=document.querySelector('h1');
    var bi=document.querySelector('[data-last-edit]');
    if(h1 && bi){
      var ver = document.createElement('p');
      ver.className = 'version_info';
      ver.textContent = bi.getAttribute('data-last-edit');
      h1.parentElement.insertBefore(ver, h1.nextElementSibling);
    }
  });
</script>

    <p>
      
        <a id='feedbacklink' href="mailto:doc-feedback@databricks.com?subject=Documentation Feedback">Send us feedback</a>
      
    </p>
  </div>
</div>
</nav>
    
    
<main class="wy-grid-for-nav su_nav-grid">
  <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
    <div class="wy-nav-content su__nav_content">
      <div class="rst-content">
        





<div role="navigation" aria-label="breadcrumbs navigation" class="wy-breadcrumbs-wrapper">
  <ul class="wy-breadcrumbs">
    <li><a href="../../index.html">Documentation</a> <span class="db-icon db-icon-chevron-right"></span></li>
    
    
      <li>Create a storage credential</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>
</div>
        
        <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
          <div itemprop="articleBody">
            
    
  <div class="section" id="create-a-storage-credential">
<h1>Create a storage credential<a class="headerlink" href="#create-a-storage-credential" title="Permalink to this headline"> </a></h1>
<p>Storage credentials are used to link permissions defined in your cloud account to managed privileges in Unity Catalog. Storage credentials grant Unity Catalog access to manage data stored in object storage within your cloud account. Databricks recommends that you use cloud storage permissions that have global privileges and restrict access as necessary using Unity Catalog.</p>
<p>To create a storage credential, you must be a Databricks account admin, a metastore admin, or a user with the <code class="docutils literal notranslate"><span class="pre">CREATE</span> <span class="pre">STORAGE</span> <span class="pre">CREDENTIAL</span></code> privilege. You need an IAM role that authorizes access (read, or read and write) to an S3 bucket path. You reference that IAM role when you create the storage credential.</p>
<p>The user who creates the storage credential can delegate ownership to another user or group to manage permissions on it.</p>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>The name of the S3 bucket that you want users to read from and write to cannot use dot notation (for example, <code class="docutils literal notranslate"><span class="pre">incorrect.bucket.name.notation</span></code>). For more bucket naming guidance, see the <a class="reference external" href="https://docs.aws.amazon.com/AmazonS3/latest/userguide/bucketnamingrules.html">AWS bucket naming rules</a>.</p>
</div>
<div class="section" id="step-1-create-an-iam-role">
<span id="create-storage-credentials-1"></span><h2>Step 1: Create an IAM role<a class="headerlink" href="#step-1-create-an-iam-role" title="Permalink to this headline"> </a></h2>
<p>In AWS, create an IAM role that gives access to the S3 bucket that you want your users to access. This IAM role must be defined in the same account as the S3 bucket.</p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>If you have already created an IAM role that provides this access, you can skip this step and go straight to <a class="reference internal" href="#create-storage-credentials-2"><span class="std std-ref">Step 2: Give Databricks the IAM role details</span></a>.</p>
</div>
<ol class="arabic">
<li><p>Create an IAM role that will allow access to the S3 bucket.</p>
<p>Role creation is a two-step process. In this step you create the role, adding a <em>temporary</em> trust relationship policy and a placeholder external ID that you then modify after creating the storage credential in Databricks.</p>
<p>You must modify the trust policy <em>after</em> you create the role because your role must be self-assuming (that is, it must be configured to trust itself). The role must therefore exist before you add the self-assumption statement. For information about self-assuming roles, see this <a class="reference external" href="https://aws.amazon.com/blogs/security/announcing-an-update-to-iam-role-trust-policy-behavior/">Amazon blog article</a>.</p>
<p>To create the policy, you must use a placeholder external ID. An external ID is required in AWS to grant access to your AWS resources to a third party.</p>
<ol class="loweralpha">
<li><p>Create the IAM role with a <strong>Custom Trust Policy</strong>.</p></li>
<li><p>In the <strong>Custom Trust Policy</strong> field, paste the following policy JSON.</p>
<p>This policy establishes a cross-account trust relationship so that Unity Catalog can assume the role to access the data in the bucket on behalf of Databricks users. This is specified by the ARN in the <code class="docutils literal notranslate"><span class="pre">Principal</span></code> section. It is a static value that references a role created by Databricks. Do not modify it.</p>
<p>The policy sets the external ID to <code class="docutils literal notranslate"><span class="pre">0000</span></code> as a placeholder. You update this to the external ID of your storage credential in a later step.</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;Version&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;2012-10-17&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;Statement&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[{</span>
<span class="w">    </span><span class="nt">&quot;Effect&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Allow&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;Principal&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;AWS&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">        </span><span class="s2">&quot;arn:aws:iam::414351767826:role/unity-catalog-prod-UCMasterRole-14S5ZJVKOTYTL&quot;</span>
<span class="w">      </span><span class="p">]</span>
<span class="w">    </span><span class="p">},</span>
<span class="w">    </span><span class="nt">&quot;Action&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;sts:AssumeRole&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;Condition&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;StringEquals&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;sts:ExternalId&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;0000&quot;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">}]</span>
<span class="p">}</span>
</pre></div>
</div>
</li>
<li><p>Skip the permissions policy configuration. You’ll go back to add that in a later step.</p></li>
<li><p>Save the IAM role.</p></li>
</ol>
</li>
<li><p>Create the following IAM policy in the same account as the S3 bucket, replacing the following values:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">&lt;BUCKET&gt;</span></code>: The name of the S3 bucket.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">&lt;KMS-KEY&gt;</span></code>: Optional. If encryption is enabled, provide the name of the KMS key that encrypts the S3 bucket contents. <strong>If encryption is disabled, remove the entire KMS section of the IAM policy.</strong></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">&lt;AWS-ACCOUNT-ID&gt;</span></code>: The Account ID of your AWS account (not your Databricks account).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">&lt;AWS-IAM-ROLE-NAME&gt;</span></code>: The name of the AWS IAM role that you created in the previous step.</p></li>
</ul>
<p>This IAM policy grants read and write access. You can also create a policy that grants read access only. However, this may be unnecessary, because you can mark the storage credential as read-only, and any write access granted by this IAM role will be ignored.</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;Version&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;2012-10-17&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;Statement&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">      </span><span class="p">{</span>
<span class="w">          </span><span class="nt">&quot;Action&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">              </span><span class="s2">&quot;s3:GetObject&quot;</span><span class="p">,</span>
<span class="w">              </span><span class="s2">&quot;s3:PutObject&quot;</span><span class="p">,</span>
<span class="w">              </span><span class="s2">&quot;s3:DeleteObject&quot;</span><span class="p">,</span>
<span class="w">              </span><span class="s2">&quot;s3:ListBucket&quot;</span><span class="p">,</span>
<span class="w">              </span><span class="s2">&quot;s3:GetBucketLocation&quot;</span><span class="p">,</span>
<span class="w">              </span><span class="s2">&quot;s3:GetLifecycleConfiguration&quot;</span><span class="p">,</span>
<span class="w">              </span><span class="s2">&quot;s3:PutLifecycleConfiguration&quot;</span>
<span class="w">          </span><span class="p">],</span>
<span class="w">          </span><span class="nt">&quot;Resource&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">              </span><span class="s2">&quot;arn:aws:s3:::&lt;BUCKET&gt;/*&quot;</span><span class="p">,</span>
<span class="w">              </span><span class="s2">&quot;arn:aws:s3:::&lt;BUCKET&gt;&quot;</span>
<span class="w">          </span><span class="p">],</span>
<span class="w">          </span><span class="nt">&quot;Effect&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Allow&quot;</span>
<span class="w">      </span><span class="p">},</span>
<span class="w">      </span><span class="p">{</span>
<span class="w">          </span><span class="nt">&quot;Action&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">              </span><span class="s2">&quot;kms:Decrypt&quot;</span><span class="p">,</span>
<span class="w">              </span><span class="s2">&quot;kms:Encrypt&quot;</span><span class="p">,</span>
<span class="w">              </span><span class="s2">&quot;kms:GenerateDataKey*&quot;</span>
<span class="w">          </span><span class="p">],</span>
<span class="w">          </span><span class="nt">&quot;Resource&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">              </span><span class="s2">&quot;arn:aws:kms:&lt;KMS-KEY&gt;&quot;</span>
<span class="w">          </span><span class="p">],</span>
<span class="w">          </span><span class="nt">&quot;Effect&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Allow&quot;</span>
<span class="w">      </span><span class="p">},</span>
<span class="w">      </span><span class="p">{</span>
<span class="w">          </span><span class="nt">&quot;Action&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">              </span><span class="s2">&quot;sts:AssumeRole&quot;</span>
<span class="w">          </span><span class="p">],</span>
<span class="w">          </span><span class="nt">&quot;Resource&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">              </span><span class="s2">&quot;arn:aws:iam::&lt;AWS-ACCOUNT-ID&gt;:role/&lt;AWS-IAM-ROLE-NAME&gt;&quot;</span>
<span class="w">          </span><span class="p">],</span>
<span class="w">          </span><span class="nt">&quot;Effect&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Allow&quot;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">    </span><span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If you need a more restrictive IAM policy for Unity Catalog, contact your Databricks account team for assistance.</p>
</div>
</li>
<li><p>Attach the IAM policy to the IAM role.</p>
<p>In the Role’s <strong>Permission</strong> tab, attach the IAM Policy you just created.</p>
</li>
</ol>
</div>
<div class="section" id="step-2-give-databricks-the-iam-role-details">
<span id="create-storage-credentials-2"></span><h2>Step 2: Give Databricks the IAM role details<a class="headerlink" href="#step-2-give-databricks-the-iam-role-details" title="Permalink to this headline"> </a></h2>
<ol class="arabic">
<li><p>In Databricks, log in to a workspace that is linked to the metastore.</p>
<p>You must the <code class="docutils literal notranslate"><span class="pre">CREATE</span> <span class="pre">STORAGE</span> <span class="pre">CREDENTIAL</span></code> privilege. The metastore admin and account admin roles both include this privilege.</p>
</li>
<li><p>Click <img alt="Catalog icon" src="../../_images/data-icon.png" /> <strong>Catalog</strong>.</p></li>
<li><p>Click <strong>+Add &gt; Add a storage credential</strong>.</p></li>
<li><p>Enter a name for the credential, the IAM Role ARN that authorizes Unity Catalog to access the storage location on your cloud tenant, and an optional comment.</p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>If you have already defined an <a class="reference internal" href="../storage/tutorial-s3-instance-profile.html"><span class="doc">instance profile</span></a> in Databricks, you can click <strong>Copy instance profile</strong> to copy over the IAM role ARN for that instance profile. The instance profile’s IAM role must have a cross-account trust relationship that enables Databricks to assume the role in order to access the bucket on behalf of Databricks users. For more information about the IAM role policy and trust relationship requirements, see <a class="reference internal" href="#create-storage-credentials-1"><span class="std std-ref">Step 1: Create an IAM role</span></a>.</p>
</div>
</li>
<li><p>(Optional) If you want users to have read-only access to the external locations that use this storage credential, in <strong>Advanced options</strong> select <strong>Read only</strong>. For more information, see <a class="reference internal" href="manage-storage-credentials.html#read-only"><span class="std std-ref">Mark a storage credential as read-only</span></a>.</p></li>
<li><p>Click <strong>Create</strong>.</p></li>
<li><p>In the <strong>Storage credential created</strong> dialog, copy the <strong>External ID</strong>.</p></li>
<li><p><a class="reference internal" href="external-locations.html"><span class="doc">Create an external location</span></a> that references this storage credential.</p></li>
</ol>
<p>You can also create a storage credential by using <a class="reference internal" href="../../dev-tools/terraform/index.html"><span class="doc">Databricks Terraform provider</span></a> and <a class="reference external" href="https://registry.terraform.io/providers/databricks/databricks/latest/docs/resources/storage_credential">databricks_storage_credential</a>.</p>
</div>
<div class="section" id="step-3-update-the-iam-role-policy">
<h2>Step 3: Update the IAM role policy<a class="headerlink" href="#step-3-update-the-iam-role-policy" title="Permalink to this headline"> </a></h2>
<p>In AWS, modify the trust relationship policy to add your storage credential’s external ID and make it self-assuming.</p>
<ol class="arabic">
<li><p>Return to your saved IAM role and go to the <strong>Trust Relationships</strong> tab.</p></li>
<li><p>Edit the trust relationship policy as follows:</p>
<p>Add the following ARN to the “Allow” statement. Replace <code class="docutils literal notranslate"><span class="pre">&lt;YOUR-AWS-ACCOUNT-ID&gt;</span></code> and <code class="docutils literal notranslate"><span class="pre">&lt;THIS-ROLE-NAME&gt;</span></code> with your actual account ID and IAM role values. To get your Databricks account ID, log in to the Databricks account console, click your username in the upper-right side, and copy the Account ID value on the menu.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="s2">&quot;arn:aws:iam::&lt;YOUR-AWS-ACCOUNT-ID&gt;:role/&lt;THIS-ROLE-NAME&gt;&quot;</span>
</pre></div>
</div>
<p>In the <code class="docutils literal notranslate"><span class="pre">&quot;sts:AssumeRole&quot;</span></code> statement, update the placeholder external ID to your storage credential’s external ID that you copied in the previous step.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="s2">&quot;sts:ExternalId&quot;</span><span class="p">:</span> <span class="s2">&quot;&lt;STORAGE-CREDENTIAL-EXTERNAL-ID&gt;&quot;</span>
</pre></div>
</div>
<p>Your policy should now look like the following, with the replacement text updated to use your storage credential’s external ID, account ID, and IAM role values:</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;Version&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;2012-10-17&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;Statement&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;Effect&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Allow&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;Principal&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;AWS&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">          </span><span class="s2">&quot;arn:aws:iam::414351767826:role/unity-catalog-prod-UCMasterRole-14S5ZJVKOTYTL&quot;</span><span class="p">,</span>
<span class="w">          </span><span class="s2">&quot;arn:aws:iam::&lt;YOUR-AWS-ACCOUNT-ID&gt;:role/&lt;THIS-ROLE-NAME&gt;&quot;</span>
<span class="w">        </span><span class="p">]</span>
<span class="w">      </span><span class="p">},</span>
<span class="w">      </span><span class="nt">&quot;Action&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;sts:AssumeRole&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;Condition&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;StringEquals&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">          </span><span class="nt">&quot;sts:ExternalId&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;&lt;STORAGE-CREDENTIAL-EXTERNAL-ID&gt;&quot;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>
</li>
</ol>
</div>
<div class="section" id="next-steps">
<h2>Next steps<a class="headerlink" href="#next-steps" title="Permalink to this headline"> </a></h2>
<p>You can view, update, delete, and grant other users permission to use storage credentials. See <a class="reference internal" href="manage-storage-credentials.html"><span class="doc">Manage storage credentials</span></a>.</p>
<p>You can define external locations using storage credentials. See <a class="reference internal" href="external-locations.html"><span class="doc">Create an external location</span></a>.</p>
</div>
</div>


    
          </div>
        </div>
        <div  class="suapp-rating">
  <div id="suPageRateApp">
     <su-app></su-app>
   </div> 
 </div>
<hr> 
<footer>
  <div role="contentinfo">
      <p class="copyright">
          &copy; Databricks 2023. All rights reserved. Apache, Apache Spark, Spark, and the Spark logo are trademarks of the <a href="http://www.apache.org/">Apache Software Foundation</a>.
      </p>
      <p> 
        
          <a id='feedbacklink' href="mailto:doc-feedback@databricks.com?subject=Documentation Feedback">Send us feedback</a>
        
     | <a href="https://databricks.com/privacy-policy">Privacy Policy</a> | <a href="https://databricks.com/terms-of-use">Terms of Use</a></p>

  </div> 

</footer>
      </div>
    </div>
  </section>
</main>

  </page>
  
  <script type="text/javascript">
    var DOCUMENTATION_OPTIONS = {
      URL_ROOT: '../../',
      VERSION: '1.0',
      COLLAPSE_INDEX: false,
      FILE_SUFFIX: '.html',
      HAS_SOURCE: 'false'
    };
  </script>
  <script type="text/javascript" src="../../_static/jquery.js"></script>
  <script type="text/javascript" src="../../_static/underscore.js"></script>
  <script type="text/javascript" src="../../_static/doctools.js"></script>
  <script type="text/javascript" src="../../_static/language_data.js"></script>
  

  <script type="text/javascript" src="../../_static/js/clipboard.min.js"></script>
  <script type="text/javascript" src="../../_static/js/jquery.waypoints.min.js"></script>

  <!-- Select2 (https://select2.org/) -->
  <link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />
  <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
  <!-- End Select2 -->

  
  
  <script type="text/javascript" src="../../_static/js/localized.js"></script>
  <script type="text/javascript" src="../../_static/js/custom.js"></script>
  

  
  
  <script type="text/javascript">
    jQuery(function () {
      SphinxRtdTheme.StickyNav.enable();
    });

  </script>
  
 



  <script>
  window.__searchunifyLoaderConfig = JSON.parse('{"clients": {"en": "02c2e804-27e9-11ee-aefb-0242ac120011", "ja": "6a42c3f2-2820-11ee-aefb-0242ac120011", "pt": "6a86badd-2821-11ee-aefb-0242ac120011"}}')
</script>
<script type="text/javascript" src="../../_static/js/search-loader.js"></script>
</body>
<script type='text/javascript'>
  window.onload = function () {
    var description = document.querySelector('meta[name="description"]').getAttribute("content");
    let titleText = document.querySelector('h1').textContent;
    document.querySelector('meta[property="og:title"]').setAttribute("content", titleText);
    document.querySelector('meta[property="og:description"]').setAttribute("content", description);
    document.querySelector('meta[property="twitter:description"]').setAttribute("content", description);
  };
</script>

</html>