

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en-US" > <![endif]-->
<!--[if gt IE 8]><!-->
<html class="no-js" lang="en-US"> <!--<![endif]-->

<head>
  <!-- cookie consent -->
  
    <!-- Combined Onetrust and Rudderstack Implementation Scripts -->
    <!-- Onetrust Initialization -->
    <script type="text/javascript" src="https://cdn.cookielaw.org/consent/92466579-1717-44d3-809d-a05fb02843ed-test/OtAutoBlock.js"></script>
    <script src="https://cdn.cookielaw.org/scripttemplates/otSDKStub.js" data-document-language="true" type="text/javascript" charset="UTF-8" data-domain-script="92466579-1717-44d3-809d-a05fb02843ed-test"></script>
    <link rel="stylesheet" id="db-onetrust-style" href="https://www.databricks.com/wp-content/uploads/db_onetrust.css" media="all" />
    <!-- Setting Rudderstack Write Key -->
    <script>window.rudderstackKey = "2SOR9fvSr5Fi6tN2ihPbVHnX1SZ" </script>
    <!-- Rudderstack Initialization + Onetrust Integration + Rudderstack Custom Events -->
    <script type="text/javascript" src="https://www.databricks.com/sites/default/files/rudderstack/v1/db-rudderstack-events.js"></script>

  <!-- cookie consent -->

  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta http-equiv="X-UA-Compatible" content="IE=9" />
  <meta content="Learn how to set up instance profiles and use them in Databricks to access S3 buckets securely from your Databricks clusters." name="description" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0">
  <meta property="og:image" content="https://www.databricks.com/wp-content/uploads/2020/04/og-databricks.png">
  <meta property="og:image:type" content="image/png">
  <meta property="og:title" content="Tutorial: Configure S3 access with an instance profile">
  <meta property="og:image:width" content="1200">
  <meta property="og:image:height" content="630">
  <meta property="og:type" content="website">
  <meta property="og:url" content="https://docs.databricks.com">
  <meta property="og:description" content="" id="og-description">
  <meta name="twitter:image" content="https://www.databricks.com/wp-content/uploads/2020/04/og-databricks.png">
  <meta name="twitter:site" content="@databricks">
  <meta name="twitter:creator" content="@databricks">
  <meta property="twitter:description" content="">
  
  <title>Tutorial: Configure S3 access with an instance profile &#124; Databricks on AWS</title>
  
  
  <link rel="canonical" href="https://docs.databricks.com/en/connect/storage/tutorial-s3-instance-profile.html">
  <!-- Start hreflang tag -->
  <link rel="alternate" hreflang="en" href="https://docs.databricks.com/en/connect/storage/tutorial-s3-instance-profile.html" />
<link rel="alternate" hreflang="x-default" href="https://docs.databricks.com/en/connect/storage/tutorial-s3-instance-profile.html" />
  <!-- End hreflang tag -->
  
  
  <link rel="shortcut icon" href="../../_static/favicon.ico" />
  

  

  

  <!-- Google Tag Manager -->
  <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'https://www.googletagmanager.com/gtm.js?id='+i+dl;
j.setAttributeNode(d.createAttribute('data-ot-ignore'));
f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-T85FQ33');</script>
  <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'https://www.googletagmanager.com/gtm.js?id='+i+dl;
j.setAttributeNode(d.createAttribute('data-ot-ignore'));
f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-TWTKQQ');</script>
    
  <!-- End Google Tag Manager -->


  <!-- MaxMind / GEO IP -->
  <script src="//js.maxmind.com/js/apis/geoip2/v2.1/geoip2.js" type="text/javascript"></script>
  <!-- End MaxMind / GEO IP -->

  
  
  <link href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,600&display=swap" rel="stylesheet">
  <link rel="preload" href="../../_static/fonts/DMSans-Bold.ttf" as="font">
  <link rel="preload" href="../../_static/fonts/DMSans-Regular.ttf" as="font">
  <link rel="preload" href="../../_static/fonts/DMMono-Regular.ttf" as="font">
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/css/custom.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/css/cloud-provider-selector.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/css/translation-selector.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/css/searchunify/main.css" type="text/css" />

  
  <link rel="index" title="Index" href="../../genindex.html" />
  <link rel="search" title="Search" href="../../search.html" />
  <link rel="top" title="Databricks on AWS" href="../../index.html" /> 
</head>

<body class="wy-body-for-nav" role="document">

  <!-- Google Tag Manager (noscript) -->
  <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-T85FQ33"
height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
  <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-TWTKQQ"
    height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
  <!-- End Google Tag Manager (noscript) -->

  
  <nav class="wy-nav-top header su_header" role="navigation" aria-label="top navigation">
    
<nav class="wy-nav-top header su_header" role="navigation" aria-label="top navigation">
  <div class="container-logo">
    <ul class="mobile-menu-toggle">
        <li class="menu-toggle">
            <i data-toggle="wy-nav-top" class="wy-nav-top-menu-button db-icon db-icon-menu pull-left"></i>
            
            <a href="https://www.databricks.com/" class="wy-nav-top-logo"><img src="../../_static/small-scale-lockup-full-color-rgb.svg" width="137" height="21"
              alt="Databricks" /></a>   
               
              </li>
    </ul>
    <ul class="su_nav-menu">
      <li class="menu-toggle">
        <i data-toggle="wy-nav-top" class="wy-nav-top-menu-button db-icon db-icon-menu pull-left"></i>
        
          
        
        <a href="https://www.databricks.com/" class="wy-nav-top-logo"><img src="../../_static/small-scale-lockup-full-color-rgb.svg" width="137" height="21"
            alt="Databricks" /></a></li>
        <!-- 
<li><a href="https://help.databricks.com/s/">Help Center</a></li>
<li class="active"><a href="https://docs.databricks.com/en/">Documentation</a></li>
<li><a href="https://kb.databricks.com/">Knowledge Base</a></li>
 -->
    </ul>
  </div>
  <div class="su_nav-right">
    <ul class="su_link-mobile">
  <!-- Mobile header code can go here -->
</ul>
<ul class="right-try-list">
   
</ul>
  </div>
</nav>
  </nav>

  <div class="su_sub-header">
    <div class="container">
      <div class="su_sub-header-inner">
        <!-- <div class="su_subnav-menu-right">
  <div id="auto" style="width: 100%;">
    <div ng-controller="SearchautoController">
      <div bind-html-compile="autocompleteHtml">
        <form class="su__search-box-1" disabled="disabled">
          <input class="su__search-input" type="search" name="Search box" id="su__search-b" placeholder="Search Documentation" disabled="disabled"/>
          <button class="su__search-button" type="submit" class="button button-success" disabled="disabled">
            <svg width="24" height="24" viewBox="0 0 24 24">
              <path
                d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"
                fill="#333"></path>
            </svg>
          </button>
        </form>
      </div>
    </div>
  </div>
</div> -->
        <div class="search-lng-gap"></div>
        <div style="margin-left: 16px; margin-right: 16px;">
          <!-- <select name="lng selector" id="lng-selector">
    <option value="../../../en/connect/storage/tutorial-s3-instance-profile.html" class="notranslate">English</option>
    <option value="../../../ja/connect/storage/tutorial-s3-instance-profile.html" class="notranslate">日本語</option>
    <option value="../../../pt/connect/storage/tutorial-s3-instance-profile.html" class="notranslate">Português (Brasil)</option>
</select> -->
        </div>
        <div class="cloud-selector-container">
          <!-- <select name="cloud provider selector" id="cloud-provider-selector">
    <option value="aws" selected class="notranslate">
        Amazon Web Services
    </option>
    <option value="azure"  class="notranslate">
        Microsoft Azure
    </option>
    <option value="gcp"  class="notranslate">
        Google Cloud Platform
    </option>
</select> -->
        </div>
      </div>
    </div>
  </div>
  <page class="js-page-container">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side su_nav-side">
<div class="wy-side-scroll">
  <div class="wy-side-nav-search">
    

    

    

    
  </div>

  <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
    
      <a href="../../index.html" class="main-navigation-home">Databricks on AWS</a>
    

    
      

      
        <p class="caption"><span class="caption-text">Load &amp; manage data</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../rag-temp/index.html">RAG Studio</a></li>
</ul>

      
    
  </div>

  <div role="contentinfo">
    
  <p class="build_info notranslate"data-last-edit="December 23, 2023">
    Updated Jan 11, 2024
  </p>
<script>
  window.addEventListener('DOMContentLoaded',function(){
    var h1=document.querySelector('h1');
    var bi=document.querySelector('[data-last-edit]');
    if(h1 && bi){
      var ver = document.createElement('p');
      ver.className = 'version_info';
      ver.textContent = bi.getAttribute('data-last-edit');
      h1.parentElement.insertBefore(ver, h1.nextElementSibling);
    }
  });
</script>

    <p>
      
        <a id='feedbacklink' href="mailto:doc-feedback@databricks.com?subject=Documentation Feedback">Send us feedback</a>
      
    </p>
  </div>
</div>
</nav>
    
    
<main class="wy-grid-for-nav su_nav-grid">
  <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
    <div class="wy-nav-content su__nav_content">
      <div class="rst-content">
        





<div role="navigation" aria-label="breadcrumbs navigation" class="wy-breadcrumbs-wrapper">
  <ul class="wy-breadcrumbs">
    <li><a href="../../index.html">Documentation</a> <span class="db-icon db-icon-chevron-right"></span></li>
    
    
      <li>Tutorial: Configure S3 access with an instance profile</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>
</div>
        
        <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
          <div itemprop="articleBody">
            
    
  <div class="section" id="tutorial-configure-s3-access-with-an-instance-profile">
<h1>Tutorial: Configure S3 access with an instance profile<a class="headerlink" href="#tutorial-configure-s3-access-with-an-instance-profile" title="Permalink to this headline"> </a></h1>
<p>This tutorial walks you through how to create an instance profile with read, write, update, and delete permissions on a single S3 bucket. You can grant privileges for multiple buckets using a single IAM role and instance profile. It is also possible to use instance profiles to grant only read and list permissions on S3.</p>
<p>Administrators configure IAM roles in AWS, link them to a Databricks workspace, and grant access to privileged users to associate instance profiles with compute. All users that have access to compute resources with an instance profile attached to it gain the privileges granted by the instance profile.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Databricks recommends using Unity Catalog volumes or external locations to connect to S3 instead of instance profiles. Unity Catalog simplifies security and governance of your data by providing a central place to administer and audit data access across multiple workspaces in your account. See <a class="reference internal" href="../unity-catalog/index.html"><span class="doc">Connect to cloud object storage using Unity Catalog</span></a>.</p>
</div>
<div class="section" id="before-you-begin">
<h2>Before you begin<a class="headerlink" href="#before-you-begin" title="Permalink to this headline"> </a></h2>
<p>This tutorial is designed for workspace administrators. You must have sufficient privileges in the AWS account containing your Databricks workspace, and be a Databricks workspace administrator.</p>
<p>This tutorial assumes the following existing permissions and assets:</p>
<ul class="simple">
<li><p>Privileges to edit the IAM role used to deploy the Databricks workspace.</p></li>
<li><p>Privileges to create new IAM roles in AWS.</p></li>
<li><p>Privileges to edit permissions on an S3 bucket.</p></li>
</ul>
</div>
<div class="section" id="step-1-create-an-instance-profile-using-the-aws-console">
<h2>Step 1: Create an instance profile using the AWS console<a class="headerlink" href="#step-1-create-an-instance-profile-using-the-aws-console" title="Permalink to this headline"> </a></h2>
<ol class="arabic">
<li><p>In the AWS console, go to the <strong>IAM</strong> service.</p></li>
<li><p>Click the <strong>Roles</strong> tab in the sidebar.</p></li>
<li><p>Click <strong>Create role</strong>.</p>
<ol class="loweralpha simple">
<li><p>Under <strong>Trusted entity type</strong>, select <strong>AWS service</strong>.</p></li>
<li><p>Under <strong>Use case</strong>, select <strong>EC2</strong>.</p></li>
<li><p>Click <strong>Next</strong>.</p></li>
<li><p>At the bottom of the page, click <strong>Next</strong>.</p></li>
<li><p>In the <strong>Role name</strong> field, type a role name.</p></li>
<li><p>Click <strong>Create role</strong>.</p></li>
</ol>
</li>
<li><p>In the role list, click the role.</p></li>
<li><p>Add an inline policy to the role. This policy grants access to the S3 bucket.</p>
<ol class="loweralpha">
<li><p>In the Permissions tab, click <strong>Add permissions &gt; Create inline policy</strong>.</p></li>
<li><p>Click the <strong>JSON</strong> tab.</p></li>
<li><p>Copy this policy and set <code class="docutils literal notranslate"><span class="pre">&lt;s3-bucket-name&gt;</span></code> to the name of your bucket.</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;Version&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;2012-10-17&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;Statement&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;Effect&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Allow&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;Action&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">        </span><span class="s2">&quot;s3:ListBucket&quot;</span>
<span class="w">      </span><span class="p">],</span>
<span class="w">     </span><span class="nt">&quot;Resource&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">        </span><span class="s2">&quot;arn:aws:s3:::&lt;s3-bucket-name&gt;&quot;</span>
<span class="w">      </span><span class="p">]</span>
<span class="w">    </span><span class="p">},</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;Effect&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Allow&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;Action&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">        </span><span class="s2">&quot;s3:PutObject&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="s2">&quot;s3:GetObject&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="s2">&quot;s3:DeleteObject&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="s2">&quot;s3:PutObjectAcl&quot;</span>
<span class="w">      </span><span class="p">],</span>
<span class="w">      </span><span class="nt">&quot;Resource&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">         </span><span class="s2">&quot;arn:aws:s3:::&lt;s3-bucket-name&gt;/*&quot;</span>
<span class="w">      </span><span class="p">]</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>
</li>
<li><p>Click <strong>Review policy</strong>.</p></li>
<li><p>In the <strong>Name</strong> field, type a policy name.</p></li>
<li><p>Click <strong>Create policy</strong>.</p></li>
</ol>
</li>
<li><p>In the role summary, copy the <strong>Role ARN</strong>.</p>
<div class="figure align-default">
<img alt="Instance profile ARN" src="../../_images/copy-instanceprofile-arn.png" />
</div>
</li>
</ol>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If you intend to enable <a class="reference internal" href="../../dbfs/mounts.html#s3-encryption"><span class="std std-ref">encryption</span></a> for the S3 bucket, you must add the IAM role as a <strong>Key User</strong> for the KMS key provided in the configuration. See <a class="reference internal" href="../../security/keys/kms-s3.html"><span class="doc">Configure encryption for S3 with KMS</span></a>.</p>
</div>
</div>
<div class="section" id="step-2-enable-the-policy-to-work-with-serverless-resources">
<span id="trust-relationship"></span><h2>Step 2: Enable the policy to work with serverless resources<a class="headerlink" href="#step-2-enable-the-policy-to-work-with-serverless-resources" title="Permalink to this headline"> </a></h2>
<p>This step ensures that your instance profile also works for configuring SQL warehouses with instance profiles. See <a class="reference internal" href="../../compute/sql-warehouse/data-access-configuration.html"><span class="doc">Enable data access configuration</span></a>.</p>
<ol class="arabic">
<li><p>In the role list, click your instance profile.</p></li>
<li><p>Select the <strong>Trust Relationships</strong> tab.</p></li>
<li><p>Click <strong>Edit Trust Policy</strong>.</p></li>
<li><p>Within the existing <code class="docutils literal notranslate"><span class="pre">Statement</span></code> array, append the following JSON block to the end of the existing trust policy. Ensure that you don’t overwrite the existing policy.</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="w"> </span><span class="p">{</span>
<span class="w"> </span><span class="nt">&quot;Effect&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Allow&quot;</span><span class="p">,</span>
<span class="w"> </span><span class="nt">&quot;Principal&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">   </span><span class="nt">&quot;AWS&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">     </span><span class="s2">&quot;arn:aws:iam::790110701330:role/serverless-customer-resource-role&quot;</span>
<span class="w">   </span><span class="p">]</span>
<span class="w"> </span><span class="p">},</span>
<span class="w"> </span><span class="nt">&quot;Action&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;sts:AssumeRole&quot;</span><span class="p">,</span>
<span class="w"> </span><span class="nt">&quot;Condition&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">   </span><span class="nt">&quot;StringEquals&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">       </span><span class="nt">&quot;sts:ExternalId&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">         </span><span class="s2">&quot;databricks-serverless-&lt;YOUR-WORKSPACE-ID1&gt;&quot;</span><span class="p">,</span>
<span class="w">         </span><span class="s2">&quot;databricks-serverless-&lt;YOUR-WORKSPACE-ID2&gt;&quot;</span>
<span class="w">       </span><span class="p">]</span>
<span class="w">     </span><span class="p">}</span>
<span class="w">   </span><span class="p">}</span>
<span class="w"> </span><span class="p">}</span>
</pre></div>
</div>
<p>The only thing you need to change in the statement is the workspace IDs. Replace the <code class="docutils literal notranslate"><span class="pre">YOUR_WORKSPACE-ID</span></code>s with one or more Databricks <a class="reference internal" href="../../workspace/workspace-details.html#workspace-url"><span class="std std-ref">workspace IDs</span></a> for the workspaces that will use this role.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>To get your workspace ID, check the URL when you’re using your workspace. For example, in <code class="docutils literal notranslate"><span class="pre">https://&lt;databricks-instance&gt;/?o=6280049833385130</span></code>, the number after <code class="docutils literal notranslate"><span class="pre">o=</span></code> is the workspace ID.</p>
</div>
<p>Do <strong>not</strong> edit the principal of the policy. The <code class="docutils literal notranslate"><span class="pre">Principal.AWS</span></code> field must continue to have the value <code class="docutils literal notranslate"><span class="pre">arn:aws:iam::790110701330:role/serverless-customer-resource-role</span></code>. This references a serverless compute role managed by Databricks.</p>
</li>
<li><p>Click <strong>Review policy</strong>.</p></li>
<li><p>Click <strong>Save changes</strong>.</p></li>
</ol>
</div>
<div class="section" id="step-3-create-the-bucket-policy">
<h2>Step 3: Create the bucket policy<a class="headerlink" href="#step-3-create-the-bucket-policy" title="Permalink to this headline"> </a></h2>
<p>At a minimum, the S3 policy must include the <code class="docutils literal notranslate"><span class="pre">ListBucket</span></code> and <code class="docutils literal notranslate"><span class="pre">GetObject</span></code> actions, which provide read-only access to a bucket. Delta Lake uses <code class="docutils literal notranslate"><span class="pre">DeleteObject</span></code> and <code class="docutils literal notranslate"><span class="pre">PutObject</span></code> permissions during regular operations. The permissions in the example policy below are the recommended defaults for clusters that read and write data.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>S3 buckets have universally unique names and do not require an account ID for universal identification. If you choose to link an S3 bucket to an IAM role and Databricks workspace in a different AWS account, you must specify the account ID when configuring your S3 bucket policy.</p>
</div>
<ol class="arabic">
<li><p>Go to your S3 console. From the <strong>Buckets</strong> list, select the bucket for which you want to create a policy.</p></li>
<li><p>Click <strong>Permissions</strong>.</p></li>
<li><p>Under <strong>Bucket policy</strong>, click <strong>Edit</strong>.</p></li>
<li><p>Paste in a policy. A sample cross-account bucket IAM policy could be the following, replacing <code class="docutils literal notranslate"><span class="pre">&lt;aws-account-id-databricks&gt;</span></code> with the AWS account ID where the Databricks environment is deployed, <code class="docutils literal notranslate"><span class="pre">&lt;iam-role-for-s3-access&gt;</span></code> with the instance profile role, and <code class="docutils literal notranslate"><span class="pre">&lt;s3-bucket-name&gt;</span></code> with the bucket name.</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;Version&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;2012-10-17&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;Statement&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;Sid&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Example permissions&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;Effect&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Allow&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;Principal&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;AWS&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;arn:aws:iam::&lt;aws-account-id-databricks&gt;:role/&lt;iam-role-for-s3-access&gt;&quot;</span>
<span class="w">      </span><span class="p">},</span>
<span class="w">      </span><span class="nt">&quot;Action&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">        </span><span class="s2">&quot;s3:GetBucketLocation&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="s2">&quot;s3:ListBucket&quot;</span>
<span class="w">      </span><span class="p">],</span>
<span class="w">      </span><span class="nt">&quot;Resource&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;arn:aws:s3:::&lt;s3-bucket-name&gt;&quot;</span>
<span class="w">    </span><span class="p">},</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;Effect&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Allow&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;Principal&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;AWS&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;arn:aws:iam::&lt;aws-account-id-databricks&gt;:role/&lt;iam-role-for-s3-access&gt;&quot;</span>
<span class="w">      </span><span class="p">},</span>
<span class="w">      </span><span class="nt">&quot;Action&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">        </span><span class="s2">&quot;s3:PutObject&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="s2">&quot;s3:GetObject&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="s2">&quot;s3:DeleteObject&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="s2">&quot;s3:PutObjectAcl&quot;</span>
<span class="w">      </span><span class="p">],</span>
<span class="w">      </span><span class="nt">&quot;Resource&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;arn:aws:s3:::&lt;s3-bucket-name&gt;/*&quot;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>
</li>
<li><p>Click <strong>Save</strong>.</p></li>
</ol>
</div>
<div class="section" id="step-4-locate-the-iam-role-that-created-the-databricks-deployment">
<span id="deployment-role"></span><h2>Step 4: Locate the IAM role that created the Databricks deployment<a class="headerlink" href="#step-4-locate-the-iam-role-that-created-the-databricks-deployment" title="Permalink to this headline"> </a></h2>
<p>If you don’t know which IAM role created the Databricks deployment, do the following:</p>
<ol class="arabic simple">
<li><p>As an account admin, log in to the <a class="reference external" href="https://accounts.cloud.databricks.com">account console</a>.</p></li>
<li><p>Go to <strong>Workspaces</strong> and click your workspace name.</p></li>
<li><p>In the <strong>Credentials</strong> box, note the role name at the end of the Role ARN.</p></li>
</ol>
<p>For example, in the Role ARN <code class="docutils literal notranslate"><span class="pre">arn:aws:iam::123456789123:role/finance-prod</span></code>, the role name is <code class="docutils literal notranslate"><span class="pre">finance-prod</span></code>.</p>
</div>
<div class="section" id="step-5-add-the-s3-iam-role-to-the-ec2-policy">
<span id="add-s3-role"></span><h2>Step 5: Add the S3 IAM role to the EC2 policy<a class="headerlink" href="#step-5-add-the-s3-iam-role-to-the-ec2-policy" title="Permalink to this headline"> </a></h2>
<ol class="arabic">
<li><p>In the AWS console, go to the <strong>IAM</strong> service.</p></li>
<li><p>Click the <strong>Roles</strong> tab in the sidebar.</p></li>
<li><p>Click the role that created the Databricks deployment.</p></li>
<li><p>On the <strong>Permissions</strong> tab, click the policy.</p></li>
<li><p>Click <strong>Edit Policy</strong>.</p></li>
<li><p>Append the following block to the end of the <code class="docutils literal notranslate"><span class="pre">Statement</span></code> array. Ensure that you don’t overwrite any of the existing policy. Replace <code class="docutils literal notranslate"><span class="pre">&lt;iam-role-for-s3-access&gt;</span></code> with the role you created in <a class="reference internal" href="#"><span class="doc">Tutorial: Configure S3 access with an instance profile</span></a>:</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="w">    </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;Effect&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Allow&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;Action&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;iam:PassRole&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;Resource&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;arn:aws:iam::&lt;aws-account-id-databricks&gt;:role/&lt;iam-role-for-s3-access&gt;&quot;</span>
<span class="w">    </span><span class="p">}</span>
</pre></div>
</div>
</li>
<li><p>Click <strong>Review policy</strong>.</p></li>
<li><p>Click <strong>Save changes</strong>.</p></li>
</ol>
</div>
<div class="section" id="step-6-add-the-instance-profile-to-databricks">
<span id="add-instance-profile"></span><h2>Step 6: Add the instance profile to Databricks<a class="headerlink" href="#step-6-add-the-instance-profile-to-databricks" title="Permalink to this headline"> </a></h2>
<ol class="arabic">
<li><p>As a workspace admin, go to the <a class="reference internal" href="../../administration-guide/index.html#admin-settings"><span class="std std-ref">admin settings page</span></a>.</p></li>
<li><p>Click the <strong>Security</strong> tab.</p></li>
<li><p>Click <strong>Manage</strong> next to <strong>Instance profiles</strong>.</p></li>
<li><p>Click <strong>Add Instance Profile</strong>.</p></li>
<li><p>Paste your instance profile ARN into the <strong>Instance profile ARN</strong> field. If you don’t have the ARN, see <a class="reference internal" href="#"><span class="doc">Tutorial: Configure S3 access with an instance profile</span></a>.</p></li>
<li><p>For <a class="reference internal" href="../../compute/sql-warehouse/serverless.html"><span class="doc">serverless SQL</span></a> to work with your instance profile, you might need to explicitly specify the role ARN associated with your instance profile in the <strong>IAM role ARN</strong> field.</p>
<p>This is only a required step if your instance profile’s associated role name (the text after the last slash in the role ARN) and the instance profile name (the text after the last slash in the instance profile ARN) do not match. To confirm whether this applies to you:</p>
<ol class="loweralpha">
<li><p>In the AWS console, go to the <a class="reference external" href="https://console.aws.amazon.com/iam/home#/roles">IAM service’s Roles tab</a>. It lists the IAM roles in your account.</p></li>
<li><p>Click the role with the name that matches the instance profile name in the Databricks SQL admin settings in the <strong>Data Security</strong> section for the <strong>Instance Profile</strong> field that you found earlier in this section.</p></li>
<li><p>In the summary area, find the <strong>Role ARN</strong> and <strong>Instance Profile ARNs</strong> fields and see if they match.</p>
<div class="figure align-default">
<img alt="Does instance profile name and role arn name match" src="../../_images/serverless-compute-aws-console-instance-profile-names.png" />
</div>
</li>
<li><p>If they do not match, paste the role ARN into the <strong>IAM role ARN</strong> field. If the names match, you do not need to set the <strong>IAM role ARN</strong> field.</p></li>
<li><p>Only if you are setting up <a class="reference internal" href="../../archive/credential-passthrough/iam-passthrough.html"><span class="doc">IAM credential passthrough</span></a>, select the <strong>Meta Instance Profile</strong> property.</p></li>
</ol>
</li>
<li><p>Databricks validates that the instance profile ARN is both syntactically and semantically correct. To validate semantic correctness, Databricks does a dry run by launching a cluster with this instance profile. Any failure in this dry run produces a validation error in the UI. Validation of the instance profile can fail if the instance profile contains the <code class="docutils literal notranslate"><span class="pre">tag-enforcement</span></code> policy, preventing you from adding a legitimate instance profile. If the validation fails and you still want to add the instance profile, select the <strong>Skip Validation</strong> checkbox.</p></li>
<li><p>Click <strong>Add</strong>.</p></li>
</ol>
</div>
<div class="section" id="manage-instance-profiles">
<h2>Manage instance profiles<a class="headerlink" href="#manage-instance-profiles" title="Permalink to this headline"> </a></h2>
<p>Workspace admins can manage manage access to instance profiles and update them. See <a class="reference internal" href="../../administration-guide/workspace-settings/manage-instance-profiles.html"><span class="doc">Manage instance profiles in Databricks</span></a>.</p>
</div>
<div class="section" id="next-steps">
<h2>Next steps<a class="headerlink" href="#next-steps" title="Permalink to this headline"> </a></h2>
<ul class="simple">
<li><p><a class="reference internal" href="../../compute/sql-warehouse/data-access-configuration.html"><span class="doc">Enable data access configuration</span></a></p></li>
</ul>
</div>
</div>


    
          </div>
        </div>
        <div  class="suapp-rating">
  <div id="suPageRateApp">
     <su-app></su-app>
   </div> 
 </div>
<hr> 
<footer>
  <div role="contentinfo">
      <p class="copyright">
          &copy; Databricks 2023. All rights reserved. Apache, Apache Spark, Spark, and the Spark logo are trademarks of the <a href="http://www.apache.org/">Apache Software Foundation</a>.
      </p>
      <p> 
        
          <a id='feedbacklink' href="mailto:doc-feedback@databricks.com?subject=Documentation Feedback">Send us feedback</a>
        
     | <a href="https://databricks.com/privacy-policy">Privacy Policy</a> | <a href="https://databricks.com/terms-of-use">Terms of Use</a></p>

  </div> 

</footer>
      </div>
    </div>
  </section>
</main>

  </page>
  
  <script type="text/javascript">
    var DOCUMENTATION_OPTIONS = {
      URL_ROOT: '../../',
      VERSION: '1.0',
      COLLAPSE_INDEX: false,
      FILE_SUFFIX: '.html',
      HAS_SOURCE: 'false'
    };
  </script>
  <script type="text/javascript" src="../../_static/jquery.js"></script>
  <script type="text/javascript" src="../../_static/underscore.js"></script>
  <script type="text/javascript" src="../../_static/doctools.js"></script>
  <script type="text/javascript" src="../../_static/language_data.js"></script>
  

  <script type="text/javascript" src="../../_static/js/clipboard.min.js"></script>
  <script type="text/javascript" src="../../_static/js/jquery.waypoints.min.js"></script>

  <!-- Select2 (https://select2.org/) -->
  <link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />
  <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
  <!-- End Select2 -->

  
  
  <script type="text/javascript" src="../../_static/js/localized.js"></script>
  <script type="text/javascript" src="../../_static/js/custom.js"></script>
  

  
  
  <script type="text/javascript">
    jQuery(function () {
      SphinxRtdTheme.StickyNav.enable();
    });

  </script>
  
 



  <script>
  window.__searchunifyLoaderConfig = JSON.parse('{"clients": {"en": "02c2e804-27e9-11ee-aefb-0242ac120011", "ja": "6a42c3f2-2820-11ee-aefb-0242ac120011", "pt": "6a86badd-2821-11ee-aefb-0242ac120011"}}')
</script>
<script type="text/javascript" src="../../_static/js/search-loader.js"></script>
</body>
<script type='text/javascript'>
  window.onload = function () {
    var description = document.querySelector('meta[name="description"]').getAttribute("content");
    let titleText = document.querySelector('h1').textContent;
    document.querySelector('meta[property="og:title"]').setAttribute("content", titleText);
    document.querySelector('meta[property="og:description"]').setAttribute("content", description);
    document.querySelector('meta[property="twitter:description"]').setAttribute("content", description);
  };
</script>

</html>