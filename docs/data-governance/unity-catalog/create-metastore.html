

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en-US" > <![endif]-->
<!--[if gt IE 8]><!-->
<html class="no-js" lang="en-US"> <!--<![endif]-->

<head>
  <!-- cookie consent -->
  
    <!-- Combined Onetrust and Rudderstack Implementation Scripts -->
    <!-- Onetrust Initialization -->
    <script type="text/javascript" src="https://cdn.cookielaw.org/consent/92466579-1717-44d3-809d-a05fb02843ed-test/OtAutoBlock.js"></script>
    <script src="https://cdn.cookielaw.org/scripttemplates/otSDKStub.js" data-document-language="true" type="text/javascript" charset="UTF-8" data-domain-script="92466579-1717-44d3-809d-a05fb02843ed-test"></script>
    <link rel="stylesheet" id="db-onetrust-style" href="https://www.databricks.com/wp-content/uploads/db_onetrust.css" media="all" />
    <!-- Setting Rudderstack Write Key -->
    <script>window.rudderstackKey = "2SOR9fvSr5Fi6tN2ihPbVHnX1SZ" </script>
    <!-- Rudderstack Initialization + Onetrust Integration + Rudderstack Custom Events -->
    <script type="text/javascript" src="https://www.databricks.com/sites/default/files/rudderstack/v1/db-rudderstack-events.js"></script>

  <!-- cookie consent -->

  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta http-equiv="X-UA-Compatible" content="IE=9" />
  <meta content="Learn how to create a Unity Catalog metastore for your Databricks account and link it to workspaces." name="description" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0">
  <meta property="og:image" content="https://www.databricks.com/wp-content/uploads/2020/04/og-databricks.png">
  <meta property="og:image:type" content="image/png">
  <meta property="og:title" content="Create a Unity Catalog metastore">
  <meta property="og:image:width" content="1200">
  <meta property="og:image:height" content="630">
  <meta property="og:type" content="website">
  <meta property="og:url" content="https://docs.databricks.com">
  <meta property="og:description" content="" id="og-description">
  <meta name="twitter:image" content="https://www.databricks.com/wp-content/uploads/2020/04/og-databricks.png">
  <meta name="twitter:site" content="@databricks">
  <meta name="twitter:creator" content="@databricks">
  <meta property="twitter:description" content="">
  
  <title>Create a Unity Catalog metastore &#124; Databricks on AWS</title>
  
  
  <link rel="canonical" href="https://docs.databricks.com/en/data-governance/unity-catalog/create-metastore.html">
  <!-- Start hreflang tag -->
  <link rel="alternate" hreflang="en" href="https://docs.databricks.com/en/data-governance/unity-catalog/create-metastore.html" />
<link rel="alternate" hreflang="x-default" href="https://docs.databricks.com/en/data-governance/unity-catalog/create-metastore.html" />
  <!-- End hreflang tag -->
  
  
  <link rel="shortcut icon" href="../../_static/favicon.ico" />
  

  

  

  <!-- Google Tag Manager -->
  <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'https://www.googletagmanager.com/gtm.js?id='+i+dl;
j.setAttributeNode(d.createAttribute('data-ot-ignore'));
f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-T85FQ33');</script>
  <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'https://www.googletagmanager.com/gtm.js?id='+i+dl;
j.setAttributeNode(d.createAttribute('data-ot-ignore'));
f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-TWTKQQ');</script>
    
  <!-- End Google Tag Manager -->


  <!-- MaxMind / GEO IP -->
  <script src="//js.maxmind.com/js/apis/geoip2/v2.1/geoip2.js" type="text/javascript"></script>
  <!-- End MaxMind / GEO IP -->

  
  
  <link href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,600&display=swap" rel="stylesheet">
  <link rel="preload" href="../../_static/fonts/DMSans-Bold.ttf" as="font">
  <link rel="preload" href="../../_static/fonts/DMSans-Regular.ttf" as="font">
  <link rel="preload" href="../../_static/fonts/DMMono-Regular.ttf" as="font">
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/css/custom.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/css/cloud-provider-selector.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/css/translation-selector.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/css/searchunify/main.css" type="text/css" />

  
  <link rel="index" title="Index" href="../../genindex.html" />
  <link rel="search" title="Search" href="../../search.html" />
  <link rel="top" title="Databricks on AWS" href="../../index.html" /> 
</head>

<body class="wy-body-for-nav" role="document">

  <!-- Google Tag Manager (noscript) -->
  <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-T85FQ33"
height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
  <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-TWTKQQ"
    height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
  <!-- End Google Tag Manager (noscript) -->

  
  <nav class="wy-nav-top header su_header" role="navigation" aria-label="top navigation">
    
<nav class="wy-nav-top header su_header" role="navigation" aria-label="top navigation">
  <div class="container-logo">
    <ul class="mobile-menu-toggle">
        <li class="menu-toggle">
            <i data-toggle="wy-nav-top" class="wy-nav-top-menu-button db-icon db-icon-menu pull-left"></i>
            
            <a href="https://www.databricks.com/" class="wy-nav-top-logo"><img src="../../_static/small-scale-lockup-full-color-rgb.svg" width="137" height="21"
              alt="Databricks" /></a>   
               
              </li>
    </ul>
    <ul class="su_nav-menu">
      <li class="menu-toggle">
        <i data-toggle="wy-nav-top" class="wy-nav-top-menu-button db-icon db-icon-menu pull-left"></i>
        
          
        
        <a href="https://www.databricks.com/" class="wy-nav-top-logo"><img src="../../_static/small-scale-lockup-full-color-rgb.svg" width="137" height="21"
            alt="Databricks" /></a></li>
        <!-- 
<li><a href="https://help.databricks.com/s/">Help Center</a></li>
<li class="active"><a href="https://docs.databricks.com/en/">Documentation</a></li>
<li><a href="https://kb.databricks.com/">Knowledge Base</a></li>
 -->
    </ul>
  </div>
  <div class="su_nav-right">
    <ul class="su_link-mobile">
  <!-- Mobile header code can go here -->
</ul>
<ul class="right-try-list">
   
</ul>
  </div>
</nav>
  </nav>

  <div class="su_sub-header">
    <div class="container">
      <div class="su_sub-header-inner">
        <!-- <div class="su_subnav-menu-right">
  <div id="auto" style="width: 100%;">
    <div ng-controller="SearchautoController">
      <div bind-html-compile="autocompleteHtml">
        <form class="su__search-box-1" disabled="disabled">
          <input class="su__search-input" type="search" name="Search box" id="su__search-b" placeholder="Search Documentation" disabled="disabled"/>
          <button class="su__search-button" type="submit" class="button button-success" disabled="disabled">
            <svg width="24" height="24" viewBox="0 0 24 24">
              <path
                d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"
                fill="#333"></path>
            </svg>
          </button>
        </form>
      </div>
    </div>
  </div>
</div> -->
        <div class="search-lng-gap"></div>
        <div style="margin-left: 16px; margin-right: 16px;">
          <!-- <select name="lng selector" id="lng-selector">
    <option value="../../../en/data-governance/unity-catalog/create-metastore.html" class="notranslate">English</option>
    <option value="../../../ja/data-governance/unity-catalog/create-metastore.html" class="notranslate">日本語</option>
    <option value="../../../pt/data-governance/unity-catalog/create-metastore.html" class="notranslate">Português (Brasil)</option>
</select> -->
        </div>
        <div class="cloud-selector-container">
          <!-- <select name="cloud provider selector" id="cloud-provider-selector">
    <option value="aws" selected class="notranslate">
        Amazon Web Services
    </option>
    <option value="azure"  class="notranslate">
        Microsoft Azure
    </option>
    <option value="gcp"  class="notranslate">
        Google Cloud Platform
    </option>
</select> -->
        </div>
      </div>
    </div>
  </div>
  <page class="js-page-container">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side su_nav-side">
<div class="wy-side-scroll">
  <div class="wy-side-nav-search">
    

    

    

    
  </div>

  <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
    
      <a href="../../index.html" class="main-navigation-home">Databricks on AWS</a>
    

    
      

      
        <p class="caption"><span class="caption-text">Load &amp; manage data</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../rag-temp/index.html">RAG Studio</a></li>
</ul>

      
    
  </div>

  <div role="contentinfo">
    
  <p class="build_info notranslate"data-last-edit="December 23, 2023">
    Updated Jan 11, 2024
  </p>
<script>
  window.addEventListener('DOMContentLoaded',function(){
    var h1=document.querySelector('h1');
    var bi=document.querySelector('[data-last-edit]');
    if(h1 && bi){
      var ver = document.createElement('p');
      ver.className = 'version_info';
      ver.textContent = bi.getAttribute('data-last-edit');
      h1.parentElement.insertBefore(ver, h1.nextElementSibling);
    }
  });
</script>

    <p>
      
        <a id='feedbacklink' href="mailto:doc-feedback@databricks.com?subject=Documentation Feedback">Send us feedback</a>
      
    </p>
  </div>
</div>
</nav>
    
    
<main class="wy-grid-for-nav su_nav-grid">
  <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
    <div class="wy-nav-content su__nav_content">
      <div class="rst-content">
        





<div role="navigation" aria-label="breadcrumbs navigation" class="wy-breadcrumbs-wrapper">
  <ul class="wy-breadcrumbs">
    <li><a href="../../index.html">Documentation</a> <span class="db-icon db-icon-chevron-right"></span></li>
    
    
      <li>Create a Unity Catalog metastore</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>
</div>
        
        <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
          <div itemprop="articleBody">
            
    
  <div class="section" id="create-a-unity-catalog-metastore">
<span id="create-a-uc-metastore"></span><h1>Create a Unity Catalog metastore<a class="headerlink" href="#create-a-unity-catalog-metastore" title="Permalink to this headline"> </a></h1>
<p>This article shows how to create a Unity Catalog metastore and link it to workspaces.</p>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>For workspaces that were enabled for Unity Catalog automatically, the instructions in this article are unnecessary. Databricks began to enable new workspaces for Unity Catalog automatically on November 8, 2023, with a rollout proceeding gradually across accounts. You must follow the instructions in this article only if you have a workspace and don’t already have a metastore in your workspace region. To determine whether a metastore already exists in your region, see <a class="reference internal" href="get-started.html#enablement"><span class="std std-ref">Automatic enablement of Unity Catalog</span></a>.</p>
</div>
<p>A metastore is the top-level container for data in Unity Catalog. Unity Catalog metastores register metadata about securable objects (such as tables, volumes, external locations, and shares) and the permissions that govern access to them. Each metastore exposes a three-level namespace (<code class="docutils literal notranslate"><span class="pre">catalog</span></code>.<code class="docutils literal notranslate"><span class="pre">schema</span></code>.<code class="docutils literal notranslate"><span class="pre">table</span></code>) by which data can be organized. You must have one metastore for each region in which your organization operates. To work with Unity Catalog, users must be on a workspace that is attached to a metastore in their region.</p>
<p>To create a metastore, you do the following:</p>
<ol class="arabic">
<li><p>In your AWS account, optionally create a storage location for metastore-level storage of managed tables and volumes.</p>
<p>For information to help you decide whether you need metastore-level storage, see <a class="reference internal" href="get-started.html#metastore-storage"><span class="std std-ref">(Optional) Create metastore-level storage</span></a> and <a class="reference internal" href="best-practices.html#physically-separate"><span class="std std-ref">Data is physically separated in storage</span></a>.</p>
</li>
<li><p>In your AWS account, create an IAM role that gives access to that storage location.</p></li>
<li><p>In Databricks, create the metastore, attaching the storage location, and assign workspaces to the metastore.</p></li>
</ol>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>In addition to the approaches described in this article, you can also create a metastore by using the <a class="reference internal" href="../../dev-tools/terraform/index.html"><span class="doc">Databricks Terraform provider</span></a>, specifically the <a class="reference external" href="https://registry.terraform.io/providers/databricks/databricks/latest/docs/resources/metastore">databricks_metastore</a> resource. To enable Unity Catalog to access the metastore, use <a class="reference external" href="https://registry.terraform.io/providers/databricks/databricks/latest/docs/resources/metastore_data_access">databricks_metastore_data_access</a>. To link workspaces to a metastore, use <a class="reference external" href="https://registry.terraform.io/providers/databricks/databricks/latest/docs/resources/metastore_assignment">databricks_metastore_assignment</a>.</p>
</div>
<div class="section" id="before-you-begin">
<h2>Before you begin<a class="headerlink" href="#before-you-begin" title="Permalink to this headline"> </a></h2>
<p>Before you begin, you should familiarize yourself with the basic Unity Catalog concepts, including metastores and managed storage. See <a class="reference internal" href="index.html"><span class="doc">What is Unity Catalog?</span></a>.</p>
<p>You should also confirm that you meet the following requirements for all setup steps:</p>
<ul class="simple">
<li><p>You must be a Databricks account admin.</p></li>
<li><p>Your Databricks account must be on the <a class="reference external" href="https://databricks.com/product/pricing/platform-addons">Premium plan or above</a>.</p></li>
<li><p>If you want to set up metastore-level root storage, you must have the ability to create S3 buckets, IAM roles, IAM policies, and cross-account trust relationships in your AWS account.</p></li>
</ul>
</div>
<div class="section" id="step-1-optional-create-an-s3-bucket-for-metastore-level-managed-storage-in-aws">
<span id="cloud-tenant-setup-aws"></span><h2>Step 1 (Optional): Create an S3 bucket for metastore-level managed storage in AWS<a class="headerlink" href="#step-1-optional-create-an-s3-bucket-for-metastore-level-managed-storage-in-aws" title="Permalink to this headline"> </a></h2>
<p>In this step, which is optional, you create the S3 bucket required by Unity Catalog to store managed table and volume data at the metastore level. You create the S3 bucket in your own AWS account. To determine whether you need metastore-level storage, see <a class="reference internal" href="get-started.html#metastore-storage"><span class="std std-ref">(Optional) Create metastore-level storage</span></a>.</p>
<ol class="arabic">
<li><p>In AWS, create an S3 bucket.</p>
<p>This S3 bucket will be the metastore-level storage location for managed tables and managed volumes in Unity Catalog. This default storage location can be overridden at the catalog and schema levels. See <a class="reference internal" href="index.html#managed-storage"><span class="std std-ref">Managed storage</span></a></p>
<p>Requirements:</p>
<ul class="simple">
<li><p>If you have more than one metastore, you should use a dedicated S3 bucket for each one.</p></li>
<li><p>Locate the bucket in the same region as the workspaces you want to access the data from.</p></li>
<li><p>The bucket name cannot include dot notation (for example, <code class="docutils literal notranslate"><span class="pre">incorrect.bucket.name.notation</span></code>). For more bucket naming guidance, see the <a class="reference external" href="https://docs.aws.amazon.com/AmazonS3/latest/userguide/bucketnamingrules.html">AWS bucket naming rules</a>.</p></li>
</ul>
</li>
<li><p>Make a note of the S3 bucket path, which starts with <code class="docutils literal notranslate"><span class="pre">s3://</span></code>.</p></li>
<li><p>If you enable KMS encryption on the S3 bucket, make a note of the name of the KMS encryption key.</p></li>
</ol>
</div>
<div class="section" id="step-2-optional-create-an-iam-role-to-access-the-storage-location">
<span id="iam"></span><h2>Step 2 (Optional): Create an IAM role to access the storage location<a class="headerlink" href="#step-2-optional-create-an-iam-role-to-access-the-storage-location" title="Permalink to this headline"> </a></h2>
<p>In this step, which is required only if you completed step 1, you create the IAM role required by Unity Catalog to access the S3 bucket that you created in the previous step.</p>
<p>Role creation is a two-step process. First you simply create the role, adding a <em>temporary</em> trust relationship policy that you then modify in a later step. You must modify the trust policy <em>after</em> you create the role because your role must be self-assuming—that is, it must be configured to trust itself. The role must therefore exist before you add the self-assumption statement. For information about self-assuming roles, see this <a class="reference external" href="https://aws.amazon.com/blogs/security/announcing-an-update-to-iam-role-trust-policy-behavior/">Amazon blog article</a>.</p>
<ol class="arabic">
<li><p>Find your Databricks account ID.</p>
<ol class="loweralpha simple">
<li><p>Log in to the Databricks <a class="reference external" href="https://accounts.cloud.databricks.com">account console</a>.</p></li>
<li><p>Click your username.</p></li>
<li><p>From the menu, copy the <strong>Account ID</strong> value.</p></li>
</ol>
</li>
<li><p>In AWS, create an IAM role with a <strong>Custom Trust Policy</strong>.</p></li>
<li><p>In the <strong>Custom Trust Policy</strong> field, paste the following policy JSON, replacing <code class="docutils literal notranslate"><span class="pre">&lt;DATABRICKS-ACCOUNT-ID&gt;</span></code> with the Databricks account ID you found in step 1 (not your AWS account ID).</p>
<p>This policy establishes a cross-account trust relationship so that Unity Catalog can assume the role to access the data in the bucket on behalf of Databricks users. This is specified by the ARN in the <code class="docutils literal notranslate"><span class="pre">Principal</span></code> section. It is a static value that references a role created by Databricks. Do not modify it.</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;Version&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;2012-10-17&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;Statement&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[{</span>
<span class="w">    </span><span class="nt">&quot;Effect&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Allow&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;Principal&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;AWS&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">        </span><span class="s2">&quot;arn:aws:iam::414351767826:role/unity-catalog-prod-UCMasterRole-14S5ZJVKOTYTL&quot;</span>
<span class="w">      </span><span class="p">]</span>
<span class="w">    </span><span class="p">},</span>
<span class="w">    </span><span class="nt">&quot;Action&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;sts:AssumeRole&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;Condition&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;StringEquals&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;sts:ExternalId&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;&lt;DATABRICKS-ACCOUNT-ID&gt;&quot;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">}]</span>
<span class="p">}</span>
</pre></div>
</div>
</li>
<li><p>Skip the permissions policy configuration. You’ll go back to add that in a later step.</p></li>
<li><p>Save the IAM role.</p></li>
<li><p>Modify the trust relationship policy to make it “self-assuming.”</p>
<ol class="loweralpha">
<li><p>Return to your saved IAM role and go to the <strong>Trust Relationships</strong> tab.</p></li>
<li><p>Edit the trust relationship policy, adding the following ARN to the “Allow” statement.</p>
<p>Replace <code class="docutils literal notranslate"><span class="pre">&lt;YOUR-AWS-ACCOUNT-ID&gt;</span></code> and <code class="docutils literal notranslate"><span class="pre">&lt;THIS-ROLE-NAME&gt;</span></code> with your actual IAM role values.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="s2">&quot;arn:aws:iam::&lt;YOUR-AWS-ACCOUNT-ID&gt;:role/&lt;THIS-ROLE-NAME&gt;&quot;</span>
</pre></div>
</div>
</li>
</ol>
<p>Your policy should now look like this (with replacement text updated to use your Databricks account ID and IAM role values):</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;Version&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;2012-10-17&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;Statement&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;Effect&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Allow&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;Principal&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;AWS&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">          </span><span class="s2">&quot;arn:aws:iam::414351767826:role/unity-catalog-prod-UCMasterRole-14S5ZJVKOTYTL&quot;</span><span class="p">,</span>
<span class="w">          </span><span class="s2">&quot;arn:aws:iam::&lt;YOUR-AWS-ACCOUNT-ID&gt;:role/&lt;THIS-ROLE-NAME&gt;&quot;</span>
<span class="w">         </span><span class="p">]</span>
<span class="w">      </span><span class="p">},</span>
<span class="w">      </span><span class="nt">&quot;Action&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;sts:AssumeRole&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;Condition&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;StringEquals&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">          </span><span class="nt">&quot;sts:ExternalId&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;&lt;DATABRICKS-ACCOUNT-ID&gt;&quot;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>
</li>
<li><p>In AWS, create an IAM policy in the same AWS account as the S3 bucket.</p>
<p>To avoid unexpected issues, you must use the following sample policy, replacing the following values:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">&lt;BUCKET&gt;</span></code>: The name of the S3 bucket you created in the previous step.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">&lt;KMS-KEY&gt;</span></code>: Optional. If encryption is enabled, provide the name of the KMS key that encrypts the S3 bucket contents. <strong>If encryption is disabled, remove the entire KMS section of the IAM policy.</strong></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">&lt;AWS-ACCOUNT-ID&gt;</span></code>: The Account ID of the current AWS account (not your Databricks account).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">&lt;AWS-IAM-ROLE-NAME&gt;</span></code>: The name of the AWS IAM role that you created in the previous step.</p></li>
</ul>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
<span class="w"> </span><span class="nt">&quot;Version&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;2012-10-17&quot;</span><span class="p">,</span>
<span class="w"> </span><span class="nt">&quot;Statement&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">     </span><span class="p">{</span>
<span class="w">         </span><span class="nt">&quot;Action&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">             </span><span class="s2">&quot;s3:GetObject&quot;</span><span class="p">,</span>
<span class="w">             </span><span class="s2">&quot;s3:PutObject&quot;</span><span class="p">,</span>
<span class="w">             </span><span class="s2">&quot;s3:DeleteObject&quot;</span><span class="p">,</span>
<span class="w">             </span><span class="s2">&quot;s3:ListBucket&quot;</span><span class="p">,</span>
<span class="w">             </span><span class="s2">&quot;s3:GetBucketLocation&quot;</span><span class="p">,</span>
<span class="w">             </span><span class="s2">&quot;s3:GetLifecycleConfiguration&quot;</span><span class="p">,</span>
<span class="w">             </span><span class="s2">&quot;s3:PutLifecycleConfiguration&quot;</span>
<span class="w">         </span><span class="p">],</span>
<span class="w">         </span><span class="nt">&quot;Resource&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">             </span><span class="s2">&quot;arn:aws:s3:::&lt;BUCKET&gt;/*&quot;</span><span class="p">,</span>
<span class="w">             </span><span class="s2">&quot;arn:aws:s3:::&lt;BUCKET&gt;&quot;</span>
<span class="w">         </span><span class="p">],</span>
<span class="w">         </span><span class="nt">&quot;Effect&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Allow&quot;</span>
<span class="w">     </span><span class="p">},</span>
<span class="w">     </span><span class="p">{</span>
<span class="w">         </span><span class="nt">&quot;Action&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">             </span><span class="s2">&quot;kms:Decrypt&quot;</span><span class="p">,</span>
<span class="w">             </span><span class="s2">&quot;kms:Encrypt&quot;</span><span class="p">,</span>
<span class="w">             </span><span class="s2">&quot;kms:GenerateDataKey*&quot;</span>
<span class="w">         </span><span class="p">],</span>
<span class="w">         </span><span class="nt">&quot;Resource&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">             </span><span class="s2">&quot;arn:aws:kms:&lt;KMS-KEY&gt;&quot;</span>
<span class="w">         </span><span class="p">],</span>
<span class="w">         </span><span class="nt">&quot;Effect&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Allow&quot;</span>
<span class="w">     </span><span class="p">},</span>
<span class="w">     </span><span class="p">{</span>
<span class="w">         </span><span class="nt">&quot;Action&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">             </span><span class="s2">&quot;sts:AssumeRole&quot;</span>
<span class="w">         </span><span class="p">],</span>
<span class="w">         </span><span class="nt">&quot;Resource&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">             </span><span class="s2">&quot;arn:aws:iam::&lt;AWS-ACCOUNT-ID&gt;:role/&lt;AWS-IAM-ROLE-NAME&gt;&quot;</span>
<span class="w">         </span><span class="p">],</span>
<span class="w">         </span><span class="nt">&quot;Effect&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Allow&quot;</span>
<span class="w">     </span><span class="p">}</span>
<span class="w">   </span><span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If you need a more restrictive IAM policy for Unity Catalog, contact your Databricks representative for assistance.</p>
</div>
</li>
<li><p>Attach the IAM policy to the IAM role.</p>
<p>On the IAM role’s <strong>Permissions</strong> tab, attach the IAM policy that you just created.</p>
</li>
</ol>
</div>
<div class="section" id="step-3-create-the-metastore-and-attach-a-workspace">
<span id="before-you-begin"></span><span id="cloud-metastore"></span><h2>Step 3: Create the metastore and attach a workspace<a class="headerlink" href="#step-3-create-the-metastore-and-attach-a-workspace" title="Permalink to this headline"> </a></h2>
<p>Each Databricks region requires its own Unity Catalog metastore.</p>
<p>You create a metastore for each region in which your organization operates. You can link each of these regional metastores to any number of workspaces in that region. Each linked workspace has the same view of the data in the metastore, and data access control can be managed across workspaces. You can access data in other metastores using <a class="reference internal" href="../../data-sharing/index.html"><span class="doc">Delta Sharing</span></a>.</p>
<p>If you chose to create metastore-level storage, the metastore will use the the S3 bucket and IAM role that you created in the previous steps.</p>
<p>To create a metastore:</p>
<ol class="arabic">
<li><p>Log in to the Databricks <a class="reference external" href="https://accounts.cloud.databricks.com/">account console</a>.</p></li>
<li><p>Click <img alt="Catalog icon" src="../../_images/data-icon.png" /> <strong>Data</strong>.</p></li>
<li><p>Click <strong>Create Metastore</strong>.</p></li>
<li><p>Enter the following:</p>
<ul>
<li><p>A name for the metastore.</p></li>
<li><p>The region where you want to deploy the metastore.</p>
<p>This must be in the same region as the workspaces you want to use to access the data. Make sure that this matches the region of the storage bucket you created earlier.</p>
</li>
<li><p>(Optional) The S3 bucket path (you can omit <code class="docutils literal notranslate"><span class="pre">s3://</span></code>) and IAM role name for the bucket and role you created in <a class="reference internal" href="#cloud-tenant-setup-aws"><span class="std std-ref">Step 1 (Optional): Create an S3 bucket for metastore-level managed storage in AWS</span></a>.</p></li>
</ul>
</li>
<li><p>Click <strong>Create</strong>.</p></li>
<li><p>When prompted, select workspaces to link to the metastore.</p>
<p>For details, see <a class="reference internal" href="enable-workspaces.html"><span class="doc">Enable a workspace for Unity Catalog</span></a>.</p>
</li>
<li><p>Transfer the metastore admin role to a group.</p>
<p>The user who creates a metastore is its owner, also called the metastore admin. The metastore admin can create top-level objects in the metastore such as catalogs and can manage access to tables and other objects. Databricks recommends that you reassign the metastore admin role to a group. See <a class="reference internal" href="manage-privileges/admin-privileges.html#assign-metastore-admin"><span class="std std-ref">Assign a metastore admin</span></a>.</p>
</li>
<li><p>Enable Databricks management of uploads to managed volumes.</p>
<p>Databricks uses cross-origin resource sharing (CORS) to upload data to <a class="reference internal" href="../../connect/unity-catalog/volumes.html"><span class="doc">managed volumes</span></a> in Unity Catalog. See <a class="reference internal" href="storage-cors.html"><span class="doc">Configure Unity Catalog storage account for CORS</span></a>.</p>
</li>
</ol>
</div>
<div class="section" id="next-steps">
<h2>Next steps<a class="headerlink" href="#next-steps" title="Permalink to this headline"> </a></h2>
<ul class="simple">
<li><p><a class="reference internal" href="create-catalogs.html"><span class="doc">Create and manage catalogs</span></a></p></li>
<li><p><a class="reference internal" href="create-schemas.html"><span class="doc">Create and manage schemas (databases)</span></a></p></li>
<li><p><a class="reference internal" href="create-tables.html"><span class="doc">Create tables</span></a></p></li>
<li><p>Learn more about <a class="reference internal" href="index.html"><span class="doc">Unity Catalog</span></a></p></li>
</ul>
</div>
<div class="section" id="add-managed-storage-to-an-existing-metastore">
<span id="add-storage"></span><h2>Add managed storage to an existing metastore<a class="headerlink" href="#add-managed-storage-to-an-existing-metastore" title="Permalink to this headline"> </a></h2>
<p>Metastore-level managed storage is optional, and it is not included for metastores that were created automatically. You might want to add metastore-level storage to your metastore if you prefer a data isolation model that stores data centrally for multiple workspaces. You need metastore-level storage if you want to share notebooks using Delta Sharing or if you are a Databricks partner who uses personal staging locations.</p>
<p>See also <a class="reference internal" href="index.html#managed-storage"><span class="std std-ref">Managed storage</span></a>.</p>
<div class="section" id="requirements">
<h3>Requirements<a class="headerlink" href="#requirements" title="Permalink to this headline"> </a></h3>
<ul class="simple">
<li><p>You must have at least one workspace attached to the Unity Catalog metastore.</p></li>
<li><p>Databricks permissions required:</p>
<ul>
<li><p>To create an external location, you must be a metastore admin or user with the <code class="docutils literal notranslate"><span class="pre">CREATE</span> <span class="pre">EXTERNAL</span> <span class="pre">LOCATION</span></code> and <code class="docutils literal notranslate"><span class="pre">CREATE</span> <span class="pre">STORAGE</span> <span class="pre">CREDENTIAL</span></code> privileges.</p></li>
<li><p>To add the storage location to the metastore definition, you must be an account admin.</p></li>
</ul>
</li>
<li><p>AWS permissions required: the ability to create S3 buckets, IAM roles, IAM policies, and cross-account trust relationships.</p></li>
</ul>
</div>
<div class="section" id="step-1-create-the-storage-location">
<span id="create-storage"></span><h3>Step 1: Create the storage location<a class="headerlink" href="#step-1-create-the-storage-location" title="Permalink to this headline"> </a></h3>
<p>Follow the instructions in <a class="reference internal" href="#cloud-tenant-setup-aws"><span class="std std-ref">Step 1 (Optional): Create an S3 bucket for metastore-level managed storage in AWS</span></a> to create a dedicated S3 bucket in an AWS account in the same region as your metastore.</p>
</div>
<div class="section" id="step-2-create-an-external-location-in-unity-catalog">
<span id="step-1-create-the-storage-location"></span><h3>Step 2: Create an external location in Unity Catalog<a class="headerlink" href="#step-2-create-an-external-location-in-unity-catalog" title="Permalink to this headline"> </a></h3>
<p>In this step, you create an external location in Unity Catalog that represents the bucket that you just created.</p>
<ol class="arabic">
<li><p>Open a workspace that is attached to the metastore.</p></li>
<li><p>Click <img alt="Catalog icon" src="../../_images/data-icon.png" /> <strong>Catalog</strong> to open Catalog Explorer.</p></li>
<li><p>Click the <strong>+ Add</strong> button and select <strong>Add an external location</strong>.</p></li>
<li><p>On the <strong>Create a new external location</strong> dialog, click <strong>AWS Quickstart (Recommended)</strong> and click <strong>Next</strong>.</p>
<p>The AWS Quickstart configures the external location and creates a storage credential for you. If you choose to use the <strong>Manual</strong> option, you must manually create an IAM role that gives access to the S3 bucket and create the storage credential in Databricks yourself.</p>
</li>
<li><p>On the <strong>Create external location with Quickstart</strong> dialog, enter the path to the S3 bucket in the <strong>Bucket Name</strong> field.</p></li>
<li><p>Click <strong>Generate new token</strong> to generate the personal access token that you will use to authenticate between Databricks and your AWS account.</p></li>
<li><p>Copy the token and click <strong>Launch in Quickstart</strong>.</p></li>
<li><p>In the AWS CloudFormation template that launches (labeled <strong>Quick create stack</strong>), paste the token into the <strong>Databricks Account Credentials</strong> field.</p></li>
<li><p>Accept the terms at the bottom of the page (<strong>I acknowledge that AWS CloudFormation might create IAM resources with custom names</strong>).</p></li>
<li><p>Click <strong>Create stack</strong>.</p>
<p>It may take a few minutes for the CloudFormation template to finish creating the external location object in Databricks.</p>
</li>
<li><p>Return to your Databricks workspace and go to the <strong>External locations</strong> pane in <strong>Catalog Explorer</strong>.</p>
<p>In the left pane of Catalog Explorer, scroll down and click <strong>External Data &gt; External Locations</strong>.</p>
</li>
<li><p>Confirm that a new external location has been created.</p>
<p>Automatically-generated external locations use the naming syntax <code class="docutils literal notranslate"><span class="pre">db_s3_external_databricks-S3-ingest-&lt;id&gt;</span></code>.</p>
</li>
<li><p>Grant yourself the <code class="docutils literal notranslate"><span class="pre">CREATE</span> <span class="pre">MANAGED</span> <span class="pre">STORAGE</span></code> privilege on the external location.</p>
<ol class="loweralpha simple">
<li><p>Click the external location name to open the details pane.</p></li>
<li><p>On the <strong>Permissions</strong> tab, click <strong>Grant</strong>.</p></li>
<li><p>On the <strong>Grant on <code class="docutils literal notranslate"><span class="pre">&lt;external</span> <span class="pre">location&gt;</span></code></strong> dialog, select yourself in the <strong>Principals</strong> field and select <code class="docutils literal notranslate"><span class="pre">CREATE</span> <span class="pre">MANAGED</span> <span class="pre">STORAGE</span></code>.</p></li>
<li><p>Click <strong>Grant</strong>.</p></li>
</ol>
</li>
</ol>
</div>
<div class="section" id="step-3-add-the-storage-location-to-the-metastore">
<h3>Step 3: Add the storage location to the metastore<a class="headerlink" href="#step-3-add-the-storage-location-to-the-metastore" title="Permalink to this headline"> </a></h3>
<p>After you have created an external location that represents the metastore storage bucket, you can add it to the metastore.</p>
<ol class="arabic">
<li><p>As an account admin, log in to the <a class="reference external" href="https://accounts.cloud.databricks.com">account console</a>.</p></li>
<li><p>Click <img alt="Catalog icon" src="../../_images/data-icon.png" /> <strong>Data</strong>.</p></li>
<li><p>Click the metastore name.</p></li>
<li><p>Confirm that you are the <strong>Metastore Admin</strong>.</p>
<p>If you are not, click <strong>Edit</strong> and assign yourself as the metastore admin. You can unassign yourself when you are done with this procedure.</p>
</li>
<li><p>On the <strong>Configuration</strong> tab, next to <strong>S3 bucket path</strong>, click <strong>Set</strong>.</p></li>
<li><p>On the <strong>Set metastore root</strong> dialog, enter the S3 bucket path that you used to create the external location, and click <strong>Update</strong>.</p>
<p>You cannot modify this path once you set it.</p>
</li>
</ol>
</div>
</div>
<div class="section" id="delete-a-metastore">
<span id="delete"></span><h2>Delete a metastore<a class="headerlink" href="#delete-a-metastore" title="Permalink to this headline"> </a></h2>
<p>If you are closing your Databricks account or have another reason to delete access to data managed by your Unity Catalog metastore, you can delete the metastore.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>All objects managed by the metastore will become inaccessible using Databricks workspaces. This action cannot be undone.</p>
<p><a class="reference internal" href="create-tables.html#managed-table"><span class="std std-ref">Managed table</span></a> data and metadata will be auto-deleted after 30 days. External table data in your cloud storage is not affected by metastore deletion.</p>
</div>
<p>To delete a metastore:</p>
<ol class="arabic simple">
<li><p>As a metastore admin, log in to the <a class="reference external" href="https://accounts.cloud.databricks.com">account console</a>.</p></li>
<li><p>Click <img alt="Catalog icon" src="../../_images/data-icon.png" /> <strong>Data</strong>.</p></li>
<li><p>Click the metastore name.</p></li>
<li><p>On the <strong>Configuration</strong> tab, click the three-button menu at the far upper right and select <strong>Delete</strong>.</p></li>
<li><p>On the confirmation dialog, enter the name of the metastore and click <strong>Delete</strong>.</p></li>
</ol>
</div>
</div>


    
          </div>
        </div>
        <div  class="suapp-rating">
  <div id="suPageRateApp">
     <su-app></su-app>
   </div> 
 </div>
<hr> 
<footer>
  <div role="contentinfo">
      <p class="copyright">
          &copy; Databricks 2023. All rights reserved. Apache, Apache Spark, Spark, and the Spark logo are trademarks of the <a href="http://www.apache.org/">Apache Software Foundation</a>.
      </p>
      <p> 
        
          <a id='feedbacklink' href="mailto:doc-feedback@databricks.com?subject=Documentation Feedback">Send us feedback</a>
        
     | <a href="https://databricks.com/privacy-policy">Privacy Policy</a> | <a href="https://databricks.com/terms-of-use">Terms of Use</a></p>

  </div> 

</footer>
      </div>
    </div>
  </section>
</main>

  </page>
  
  <script type="text/javascript">
    var DOCUMENTATION_OPTIONS = {
      URL_ROOT: '../../',
      VERSION: '1.0',
      COLLAPSE_INDEX: false,
      FILE_SUFFIX: '.html',
      HAS_SOURCE: 'false'
    };
  </script>
  <script type="text/javascript" src="../../_static/jquery.js"></script>
  <script type="text/javascript" src="../../_static/underscore.js"></script>
  <script type="text/javascript" src="../../_static/doctools.js"></script>
  <script type="text/javascript" src="../../_static/language_data.js"></script>
  

  <script type="text/javascript" src="../../_static/js/clipboard.min.js"></script>
  <script type="text/javascript" src="../../_static/js/jquery.waypoints.min.js"></script>

  <!-- Select2 (https://select2.org/) -->
  <link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />
  <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
  <!-- End Select2 -->

  
  
  <script type="text/javascript" src="../../_static/js/localized.js"></script>
  <script type="text/javascript" src="../../_static/js/custom.js"></script>
  

  
  
  <script type="text/javascript">
    jQuery(function () {
      SphinxRtdTheme.StickyNav.enable();
    });

  </script>
  
 



  <script>
  window.__searchunifyLoaderConfig = JSON.parse('{"clients": {"en": "02c2e804-27e9-11ee-aefb-0242ac120011", "ja": "6a42c3f2-2820-11ee-aefb-0242ac120011", "pt": "6a86badd-2821-11ee-aefb-0242ac120011"}}')
</script>
<script type="text/javascript" src="../../_static/js/search-loader.js"></script>
</body>
<script type='text/javascript'>
  window.onload = function () {
    var description = document.querySelector('meta[name="description"]').getAttribute("content");
    let titleText = document.querySelector('h1').textContent;
    document.querySelector('meta[property="og:title"]').setAttribute("content", titleText);
    document.querySelector('meta[property="og:description"]').setAttribute("content", description);
    document.querySelector('meta[property="twitter:description"]').setAttribute("content", description);
  };
</script>

</html>