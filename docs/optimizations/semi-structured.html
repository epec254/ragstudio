

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en-US" > <![endif]-->
<!--[if gt IE 8]><!-->
<html class="no-js" lang="en-US"> <!--<![endif]-->

<head>
  <!-- cookie consent -->
  
    <!-- Combined Onetrust and Rudderstack Implementation Scripts -->
    <!-- Onetrust Initialization -->
    <script type="text/javascript" src="https://cdn.cookielaw.org/consent/92466579-1717-44d3-809d-a05fb02843ed-test/OtAutoBlock.js"></script>
    <script src="https://cdn.cookielaw.org/scripttemplates/otSDKStub.js" data-document-language="true" type="text/javascript" charset="UTF-8" data-domain-script="92466579-1717-44d3-809d-a05fb02843ed-test"></script>
    <link rel="stylesheet" id="db-onetrust-style" href="https://www.databricks.com/wp-content/uploads/db_onetrust.css" media="all" />
    <!-- Setting Rudderstack Write Key -->
    <script>window.rudderstackKey = "2SOR9fvSr5Fi6tN2ihPbVHnX1SZ" </script>
    <!-- Rudderstack Initialization + Onetrust Integration + Rudderstack Custom Events -->
    <script type="text/javascript" src="https://www.databricks.com/sites/default/files/rudderstack/v1/db-rudderstack-events.js"></script>

  <!-- cookie consent -->

  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta http-equiv="X-UA-Compatible" content="IE=9" />
  <meta content="Learn how to easily query semi-structured data with Databricks." name="description" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0">
  <meta property="og:image" content="https://www.databricks.com/wp-content/uploads/2020/04/og-databricks.png">
  <meta property="og:image:type" content="image/png">
  <meta property="og:title" content="Query semi-structured data in Databricks">
  <meta property="og:image:width" content="1200">
  <meta property="og:image:height" content="630">
  <meta property="og:type" content="website">
  <meta property="og:url" content="https://docs.databricks.com">
  <meta property="og:description" content="" id="og-description">
  <meta name="twitter:image" content="https://www.databricks.com/wp-content/uploads/2020/04/og-databricks.png">
  <meta name="twitter:site" content="@databricks">
  <meta name="twitter:creator" content="@databricks">
  <meta property="twitter:description" content="">
  
  <title>Query semi-structured data in Databricks &#124; Databricks on AWS</title>
  
  
  <link rel="canonical" href="https://docs.databricks.com/en/optimizations/semi-structured.html">
  <!-- Start hreflang tag -->
  <link rel="alternate" hreflang="en" href="https://docs.databricks.com/en/optimizations/semi-structured.html" />
<link rel="alternate" hreflang="x-default" href="https://docs.databricks.com/en/optimizations/semi-structured.html" />
  <!-- End hreflang tag -->
  
  
  <link rel="shortcut icon" href="../_static/favicon.ico" />
  

  

  

  <!-- Google Tag Manager -->
  <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'https://www.googletagmanager.com/gtm.js?id='+i+dl;
j.setAttributeNode(d.createAttribute('data-ot-ignore'));
f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-T85FQ33');</script>
  <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'https://www.googletagmanager.com/gtm.js?id='+i+dl;
j.setAttributeNode(d.createAttribute('data-ot-ignore'));
f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-TWTKQQ');</script>
    
  <!-- End Google Tag Manager -->


  <!-- MaxMind / GEO IP -->
  <script src="//js.maxmind.com/js/apis/geoip2/v2.1/geoip2.js" type="text/javascript"></script>
  <!-- End MaxMind / GEO IP -->

  
  
  <link href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,600&display=swap" rel="stylesheet">
  <link rel="preload" href="../_static/fonts/DMSans-Bold.ttf" as="font">
  <link rel="preload" href="../_static/fonts/DMSans-Regular.ttf" as="font">
  <link rel="preload" href="../_static/fonts/DMMono-Regular.ttf" as="font">
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/css/custom.css" type="text/css" />
  <link rel="stylesheet" href="../_static/css/cloud-provider-selector.css" type="text/css" />
  <link rel="stylesheet" href="../_static/css/translation-selector.css" type="text/css" />
  <link rel="stylesheet" href="../_static/css/searchunify/main.css" type="text/css" />

  
  <link rel="index" title="Index" href="../genindex.html" />
  <link rel="search" title="Search" href="../search.html" />
  <link rel="top" title="Databricks on AWS" href="../index.html" /> 
</head>

<body class="wy-body-for-nav" role="document">

  <!-- Google Tag Manager (noscript) -->
  <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-T85FQ33"
height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
  <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-TWTKQQ"
    height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
  <!-- End Google Tag Manager (noscript) -->

  
  <nav class="wy-nav-top header su_header" role="navigation" aria-label="top navigation">
    
<nav class="wy-nav-top header su_header" role="navigation" aria-label="top navigation">
  <div class="container-logo">
    <ul class="mobile-menu-toggle">
        <li class="menu-toggle">
            <i data-toggle="wy-nav-top" class="wy-nav-top-menu-button db-icon db-icon-menu pull-left"></i>
            
            <a href="https://www.databricks.com/" class="wy-nav-top-logo"><img src="../_static/small-scale-lockup-full-color-rgb.svg" width="137" height="21"
              alt="Databricks" /></a>   
               
              </li>
    </ul>
    <ul class="su_nav-menu">
      <li class="menu-toggle">
        <i data-toggle="wy-nav-top" class="wy-nav-top-menu-button db-icon db-icon-menu pull-left"></i>
        
          
        
        <a href="https://www.databricks.com/" class="wy-nav-top-logo"><img src="../_static/small-scale-lockup-full-color-rgb.svg" width="137" height="21"
            alt="Databricks" /></a></li>
        <!-- 
<li><a href="https://help.databricks.com/s/">Help Center</a></li>
<li class="active"><a href="https://docs.databricks.com/en/">Documentation</a></li>
<li><a href="https://kb.databricks.com/">Knowledge Base</a></li>
 -->
    </ul>
  </div>
  <div class="su_nav-right">
    <ul class="su_link-mobile">
  <!-- Mobile header code can go here -->
</ul>
<ul class="right-try-list">
   
</ul>
  </div>
</nav>
  </nav>

  <div class="su_sub-header">
    <div class="container">
      <div class="su_sub-header-inner">
        <!-- <div class="su_subnav-menu-right">
  <div id="auto" style="width: 100%;">
    <div ng-controller="SearchautoController">
      <div bind-html-compile="autocompleteHtml">
        <form class="su__search-box-1" disabled="disabled">
          <input class="su__search-input" type="search" name="Search box" id="su__search-b" placeholder="Search Documentation" disabled="disabled"/>
          <button class="su__search-button" type="submit" class="button button-success" disabled="disabled">
            <svg width="24" height="24" viewBox="0 0 24 24">
              <path
                d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"
                fill="#333"></path>
            </svg>
          </button>
        </form>
      </div>
    </div>
  </div>
</div> -->
        <div class="search-lng-gap"></div>
        <div style="margin-left: 16px; margin-right: 16px;">
          <!-- <select name="lng selector" id="lng-selector">
    <option value="../../en/optimizations/semi-structured.html" class="notranslate">English</option>
    <option value="../../ja/optimizations/semi-structured.html" class="notranslate">日本語</option>
    <option value="../../pt/optimizations/semi-structured.html" class="notranslate">Português (Brasil)</option>
</select> -->
        </div>
        <div class="cloud-selector-container">
          <!-- <select name="cloud provider selector" id="cloud-provider-selector">
    <option value="aws" selected class="notranslate">
        Amazon Web Services
    </option>
    <option value="azure"  class="notranslate">
        Microsoft Azure
    </option>
    <option value="gcp"  class="notranslate">
        Google Cloud Platform
    </option>
</select> -->
        </div>
      </div>
    </div>
  </div>
  <page class="js-page-container">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side su_nav-side">
<div class="wy-side-scroll">
  <div class="wy-side-nav-search">
    

    

    

    
  </div>

  <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
    
      <a href="../index.html" class="main-navigation-home">Databricks on AWS</a>
    

    
      

      
        <p class="caption"><span class="caption-text">Load &amp; manage data</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../rag-temp/index.html">RAG Studio</a></li>
</ul>

      
    
  </div>

  <div role="contentinfo">
    
  <p class="build_info notranslate"data-last-edit="December 23, 2023">
    Updated Jan 11, 2024
  </p>
<script>
  window.addEventListener('DOMContentLoaded',function(){
    var h1=document.querySelector('h1');
    var bi=document.querySelector('[data-last-edit]');
    if(h1 && bi){
      var ver = document.createElement('p');
      ver.className = 'version_info';
      ver.textContent = bi.getAttribute('data-last-edit');
      h1.parentElement.insertBefore(ver, h1.nextElementSibling);
    }
  });
</script>

    <p>
      
        <a id='feedbacklink' href="mailto:doc-feedback@databricks.com?subject=Documentation Feedback">Send us feedback</a>
      
    </p>
  </div>
</div>
</nav>
    
    
<main class="wy-grid-for-nav su_nav-grid">
  <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
    <div class="wy-nav-content su__nav_content">
      <div class="rst-content">
        





<div role="navigation" aria-label="breadcrumbs navigation" class="wy-breadcrumbs-wrapper">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html">Documentation</a> <span class="db-icon db-icon-chevron-right"></span></li>
    
    
      <li>Query semi-structured data in Databricks</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>
</div>
        
        <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
          <div itemprop="articleBody">
            
    
  <div class="section" id="query-semi-structured-data-in-databricks">
<h1>Query semi-structured data in Databricks<a class="headerlink" href="#query-semi-structured-data-in-databricks" title="Permalink to this headline"> </a></h1>
<p>This article describes the Databricks SQL operators you can use to query and transform semi-structured data stored as JSON.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This feature lets you read semi-structured data without flattening the files. However, for optimal read query performance Databricks recommends that you extract nested columns with the correct data types.</p>
</div>
<p>You extract a column from fields containing JSON strings using the syntax <code class="docutils literal notranslate"><span class="pre">&lt;column-name&gt;:&lt;extraction-path&gt;</span></code>, where <code class="docutils literal notranslate"><span class="pre">&lt;column-name&gt;</span></code> is the string column name and <code class="docutils literal notranslate"><span class="pre">&lt;extraction-path&gt;</span></code> is the path to the field to extract. The returned results are strings.</p>
<div class="section" id="create-a-table-with-highly-nested-data">
<h2>Create a table with highly nested data<a class="headerlink" href="#create-a-table-with-highly-nested-data" title="Permalink to this headline"> </a></h2>
<p>Run the following query to create a table with highly nested data. The examples in this article all reference this table.</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">store_data</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="k">SELECT</span>
<span class="s1">&#39;{</span>
<span class="s1">   &quot;store&quot;:{</span>
<span class="s1">      &quot;fruit&quot;: [</span>
<span class="s1">        {&quot;weight&quot;:8,&quot;type&quot;:&quot;apple&quot;},</span>
<span class="s1">        {&quot;weight&quot;:9,&quot;type&quot;:&quot;pear&quot;}</span>
<span class="s1">      ],</span>
<span class="s1">      &quot;basket&quot;:[</span>
<span class="s1">        [1,2,{&quot;b&quot;:&quot;y&quot;,&quot;a&quot;:&quot;x&quot;}],</span>
<span class="s1">        [3,4],</span>
<span class="s1">        [5,6]</span>
<span class="s1">      ],</span>
<span class="s1">      &quot;book&quot;:[</span>
<span class="s1">        {</span>
<span class="s1">          &quot;author&quot;:&quot;Nigel Rees&quot;,</span>
<span class="s1">          &quot;title&quot;:&quot;Sayings of the Century&quot;,</span>
<span class="s1">          &quot;category&quot;:&quot;reference&quot;,</span>
<span class="s1">          &quot;price&quot;:8.95</span>
<span class="s1">        },</span>
<span class="s1">        {</span>
<span class="s1">          &quot;author&quot;:&quot;Herman Melville&quot;,</span>
<span class="s1">          &quot;title&quot;:&quot;Moby Dick&quot;,</span>
<span class="s1">          &quot;category&quot;:&quot;fiction&quot;,</span>
<span class="s1">          &quot;price&quot;:8.99,</span>
<span class="s1">          &quot;isbn&quot;:&quot;0-553-21311-3&quot;</span>
<span class="s1">        },</span>
<span class="s1">        {</span>
<span class="s1">          &quot;author&quot;:&quot;J. R. R. Tolkien&quot;,</span>
<span class="s1">          &quot;title&quot;:&quot;The Lord of the Rings&quot;,</span>
<span class="s1">          &quot;category&quot;:&quot;fiction&quot;,</span>
<span class="s1">          &quot;reader&quot;:[</span>
<span class="s1">            {&quot;age&quot;:25,&quot;name&quot;:&quot;bob&quot;},</span>
<span class="s1">            {&quot;age&quot;:26,&quot;name&quot;:&quot;jack&quot;}</span>
<span class="s1">          ],</span>
<span class="s1">          &quot;price&quot;:22.99,</span>
<span class="s1">          &quot;isbn&quot;:&quot;0-395-19395-8&quot;</span>
<span class="s1">        }</span>
<span class="s1">      ],</span>
<span class="s1">      &quot;bicycle&quot;:{</span>
<span class="s1">        &quot;price&quot;:19.95,</span>
<span class="s1">        &quot;color&quot;:&quot;red&quot;</span>
<span class="s1">      }</span>
<span class="s1">    },</span>
<span class="s1">    &quot;owner&quot;:&quot;amy&quot;,</span>
<span class="s1">    &quot;zip code&quot;:&quot;94025&quot;,</span>
<span class="s1">    &quot;fb:testid&quot;:&quot;1234&quot;</span>
<span class="s1"> }&#39;</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">raw</span>
</pre></div>
</div>
</div>
<div class="section" id="extract-a-top-level-column">
<h2>Extract a top-level column<a class="headerlink" href="#extract-a-top-level-column" title="Permalink to this headline"> </a></h2>
<p>To extract a column, specify the name of the JSON field in your extraction path.</p>
<p>You can provide column names within brackets. Columns referenced inside brackets are
matched case <em>sensitively</em>. The column name is also referenced case insensitively.</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">SELECT</span><span class="w"> </span><span class="n">raw</span><span class="p">:</span><span class="k">owner</span><span class="p">,</span><span class="w"> </span><span class="n">RAW</span><span class="p">:</span><span class="k">owner</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">store_data</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">+-------+-------+</span>
<span class="o">|</span> <span class="n">owner</span> <span class="o">|</span> <span class="n">owner</span> <span class="o">|</span>
<span class="o">+-------+-------+</span>
<span class="o">|</span> <span class="n">amy</span>   <span class="o">|</span> <span class="n">amy</span>   <span class="o">|</span>
<span class="o">+-------+-------+</span>
</pre></div>
</div>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="c1">-- References are case sensitive when you use brackets</span>
<span class="k">SELECT</span><span class="w"> </span><span class="n">raw</span><span class="p">:</span><span class="k">OWNER</span><span class="w"> </span><span class="n">case_insensitive</span><span class="p">,</span><span class="w"> </span><span class="n">raw</span><span class="p">:[</span><span class="s1">&#39;OWNER&#39;</span><span class="p">]</span><span class="w"> </span><span class="n">case_sensitive</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">store_data</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">+------------------+----------------+</span>
<span class="o">|</span> <span class="n">case_insensitive</span> <span class="o">|</span> <span class="n">case_sensitive</span> <span class="o">|</span>
<span class="o">+------------------+----------------+</span>
<span class="o">|</span> <span class="n">amy</span>              <span class="o">|</span> <span class="n">null</span>           <span class="o">|</span>
<span class="o">+------------------+----------------+</span>
</pre></div>
</div>
<p>Use backticks to escape spaces and special characters. The field names are matched case <em>insensitively</em>.</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="c1">-- Use backticks to escape special characters. References are case insensitive when you use backticks.</span>
<span class="c1">-- Use brackets to make them case sensitive.</span>
<span class="k">SELECT</span><span class="w"> </span><span class="n">raw</span><span class="p">:</span><span class="o">`</span><span class="n">zip</span><span class="w"> </span><span class="n">code</span><span class="o">`</span><span class="p">,</span><span class="w"> </span><span class="n">raw</span><span class="p">:</span><span class="o">`</span><span class="n">Zip</span><span class="w"> </span><span class="n">Code</span><span class="o">`</span><span class="p">,</span><span class="w"> </span><span class="n">raw</span><span class="p">:[</span><span class="s1">&#39;fb:testid&#39;</span><span class="p">]</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">store_data</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">+----------+----------+-----------+</span>
<span class="o">|</span> <span class="nb">zip</span> <span class="n">code</span> <span class="o">|</span> <span class="n">Zip</span> <span class="n">Code</span> <span class="o">|</span> <span class="n">fb</span><span class="p">:</span><span class="n">testid</span> <span class="o">|</span>
<span class="o">+----------+----------+-----------+</span>
<span class="o">|</span> <span class="mi">94025</span>    <span class="o">|</span> <span class="mi">94025</span>    <span class="o">|</span> <span class="mi">1234</span>      <span class="o">|</span>
<span class="o">+----------+----------+-----------+</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If a JSON record contains multiple columns that can match your extraction path due to case insensitive matching, you will receive an error asking you to use brackets. If you have matches of columns across rows, you will not receive any errors. The following will throw an error: <code class="docutils literal notranslate"><span class="pre">{&quot;foo&quot;:&quot;bar&quot;,</span> <span class="pre">&quot;Foo&quot;:&quot;bar&quot;}</span></code>, and the following won’t throw an error:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="s2">&quot;foo&quot;</span><span class="p">:</span><span class="s2">&quot;bar&quot;</span><span class="p">}</span>
<span class="p">{</span><span class="s2">&quot;Foo&quot;</span><span class="p">:</span><span class="s2">&quot;bar&quot;</span><span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="extract-nested-fields">
<h2>Extract nested fields<a class="headerlink" href="#extract-nested-fields" title="Permalink to this headline"> </a></h2>
<p>You specify nested fields through dot notation or using brackets. When you use brackets, columns are matched case sensitively.</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="c1">-- Use dot notation</span>
<span class="k">SELECT</span><span class="w"> </span><span class="n">raw</span><span class="p">:</span><span class="n">store</span><span class="p">.</span><span class="n">bicycle</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">store_data</span>
<span class="c1">-- the column returned is a string</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">+------------------+</span>
<span class="o">|</span> <span class="n">bicycle</span>          <span class="o">|</span>
<span class="o">+------------------+</span>
<span class="o">|</span> <span class="p">{</span>                <span class="o">|</span>
<span class="o">|</span>   <span class="s2">&quot;price&quot;</span><span class="p">:</span><span class="mf">19.95</span><span class="p">,</span> <span class="o">|</span>
<span class="o">|</span>   <span class="s2">&quot;color&quot;</span><span class="p">:</span><span class="s2">&quot;red&quot;</span>  <span class="o">|</span>
<span class="o">|</span> <span class="p">}</span>                <span class="o">|</span>
<span class="o">+------------------+</span>
</pre></div>
</div>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="c1">-- Use brackets</span>
<span class="k">SELECT</span><span class="w"> </span><span class="n">raw</span><span class="p">:</span><span class="n">store</span><span class="p">[</span><span class="s1">&#39;bicycle&#39;</span><span class="p">],</span><span class="w"> </span><span class="n">raw</span><span class="p">:</span><span class="n">store</span><span class="p">[</span><span class="s1">&#39;BICYCLE&#39;</span><span class="p">]</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">store_data</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">+------------------+---------+</span>
<span class="o">|</span> <span class="n">bicycle</span>          <span class="o">|</span> <span class="n">BICYCLE</span> <span class="o">|</span>
<span class="o">+------------------+---------+</span>
<span class="o">|</span> <span class="p">{</span>                <span class="o">|</span> <span class="n">null</span>    <span class="o">|</span>
<span class="o">|</span>   <span class="s2">&quot;price&quot;</span><span class="p">:</span><span class="mf">19.95</span><span class="p">,</span> <span class="o">|</span>         <span class="o">|</span>
<span class="o">|</span>   <span class="s2">&quot;color&quot;</span><span class="p">:</span><span class="s2">&quot;red&quot;</span>  <span class="o">|</span>         <span class="o">|</span>
<span class="o">|</span> <span class="p">}</span>                <span class="o">|</span>         <span class="o">|</span>
<span class="o">+------------------+---------+</span>
</pre></div>
</div>
</div>
<div class="section" id="extract-values-from-arrays">
<h2>Extract values from arrays<a class="headerlink" href="#extract-values-from-arrays" title="Permalink to this headline"> </a></h2>
<p>You index elements in arrays with brackets. Indices are 0-based. You can use an asterisk (<code class="docutils literal notranslate"><span class="pre">*</span></code>) followed by dot or bracket notation to extract subfields from all elements in an array.</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="c1">-- Index elements</span>
<span class="k">SELECT</span><span class="w"> </span><span class="n">raw</span><span class="p">:</span><span class="n">store</span><span class="p">.</span><span class="n">fruit</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="w"> </span><span class="n">raw</span><span class="p">:</span><span class="n">store</span><span class="p">.</span><span class="n">fruit</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">store_data</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">+------------------+-----------------+</span>
<span class="o">|</span> <span class="n">fruit</span>            <span class="o">|</span> <span class="n">fruit</span>           <span class="o">|</span>
<span class="o">+------------------+-----------------+</span>
<span class="o">|</span> <span class="p">{</span>                <span class="o">|</span> <span class="p">{</span>               <span class="o">|</span>
<span class="o">|</span>   <span class="s2">&quot;weight&quot;</span><span class="p">:</span><span class="mi">8</span><span class="p">,</span>    <span class="o">|</span>   <span class="s2">&quot;weight&quot;</span><span class="p">:</span><span class="mi">9</span><span class="p">,</span>   <span class="o">|</span>
<span class="o">|</span>   <span class="s2">&quot;type&quot;</span><span class="p">:</span><span class="s2">&quot;apple&quot;</span> <span class="o">|</span>   <span class="s2">&quot;type&quot;</span><span class="p">:</span><span class="s2">&quot;pear&quot;</span> <span class="o">|</span>
<span class="o">|</span> <span class="p">}</span>                <span class="o">|</span> <span class="p">}</span>               <span class="o">|</span>
<span class="o">+------------------+-----------------+</span>
</pre></div>
</div>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="c1">-- Extract subfields from arrays</span>
<span class="k">SELECT</span><span class="w"> </span><span class="n">raw</span><span class="p">:</span><span class="n">store</span><span class="p">.</span><span class="n">book</span><span class="p">[</span><span class="o">*</span><span class="p">].</span><span class="n">isbn</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">store_data</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">+--------------------+</span>
<span class="o">|</span> <span class="n">isbn</span>               <span class="o">|</span>
<span class="o">+--------------------+</span>
<span class="o">|</span> <span class="p">[</span>                  <span class="o">|</span>
<span class="o">|</span>   <span class="n">null</span><span class="p">,</span>            <span class="o">|</span>
<span class="o">|</span>   <span class="s2">&quot;0-553-21311-3&quot;</span><span class="p">,</span> <span class="o">|</span>
<span class="o">|</span>   <span class="s2">&quot;0-395-19395-8&quot;</span>  <span class="o">|</span>
<span class="o">|</span> <span class="p">]</span>                  <span class="o">|</span>
<span class="o">+--------------------+</span>
</pre></div>
</div>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="c1">-- Access arrays within arrays or structs within arrays</span>
<span class="k">SELECT</span>
<span class="w">    </span><span class="n">raw</span><span class="p">:</span><span class="n">store</span><span class="p">.</span><span class="n">basket</span><span class="p">[</span><span class="o">*</span><span class="p">],</span>
<span class="w">    </span><span class="n">raw</span><span class="p">:</span><span class="n">store</span><span class="p">.</span><span class="n">basket</span><span class="p">[</span><span class="o">*</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="n">first_of_baskets</span><span class="p">,</span>
<span class="w">    </span><span class="n">raw</span><span class="p">:</span><span class="n">store</span><span class="p">.</span><span class="n">basket</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="o">*</span><span class="p">]</span><span class="w"> </span><span class="n">first_basket</span><span class="p">,</span>
<span class="w">    </span><span class="n">raw</span><span class="p">:</span><span class="n">store</span><span class="p">.</span><span class="n">basket</span><span class="p">[</span><span class="o">*</span><span class="p">][</span><span class="o">*</span><span class="p">]</span><span class="w"> </span><span class="n">all_elements_flattened</span><span class="p">,</span>
<span class="w">    </span><span class="n">raw</span><span class="p">:</span><span class="n">store</span><span class="p">.</span><span class="n">basket</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">2</span><span class="p">].</span><span class="n">b</span><span class="w"> </span><span class="n">subfield</span>
<span class="k">FROM</span><span class="w"> </span><span class="n">store_data</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">+----------------------------+------------------+---------------------+---------------------------------+----------+</span>
<span class="o">|</span> <span class="n">basket</span>                     <span class="o">|</span> <span class="n">first_of_baskets</span> <span class="o">|</span> <span class="n">first_basket</span>        <span class="o">|</span> <span class="n">all_elements_flattened</span>          <span class="o">|</span> <span class="n">subfield</span> <span class="o">|</span>
<span class="o">+----------------------------+------------------+---------------------+---------------------------------+----------+</span>
<span class="o">|</span> <span class="p">[</span>                          <span class="o">|</span> <span class="p">[</span>                <span class="o">|</span> <span class="p">[</span>                   <span class="o">|</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,{</span><span class="s2">&quot;b&quot;</span><span class="p">:</span><span class="s2">&quot;y&quot;</span><span class="p">,</span><span class="s2">&quot;a&quot;</span><span class="p">:</span><span class="s2">&quot;x&quot;</span><span class="p">},</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">]</span> <span class="o">|</span> <span class="n">y</span>        <span class="o">|</span>
<span class="o">|</span>   <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,{</span><span class="s2">&quot;b&quot;</span><span class="p">:</span><span class="s2">&quot;y&quot;</span><span class="p">,</span><span class="s2">&quot;a&quot;</span><span class="p">:</span><span class="s2">&quot;x&quot;</span><span class="p">}],</span> <span class="o">|</span>   <span class="mi">1</span><span class="p">,</span>             <span class="o">|</span>   <span class="mi">1</span><span class="p">,</span>                <span class="o">|</span>                                 <span class="o">|</span>          <span class="o">|</span>
<span class="o">|</span>   <span class="p">[</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">],</span>                   <span class="o">|</span>   <span class="mi">3</span><span class="p">,</span>             <span class="o">|</span>   <span class="mi">2</span><span class="p">,</span>                <span class="o">|</span>                                 <span class="o">|</span>          <span class="o">|</span>
<span class="o">|</span>   <span class="p">[</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">]</span>                    <span class="o">|</span>   <span class="mi">5</span>              <span class="o">|</span>   <span class="p">{</span><span class="s2">&quot;b&quot;</span><span class="p">:</span><span class="s2">&quot;y&quot;</span><span class="p">,</span><span class="s2">&quot;a&quot;</span><span class="p">:</span><span class="s2">&quot;x&quot;</span><span class="p">}</span> <span class="o">|</span>                                 <span class="o">|</span>          <span class="o">|</span>
<span class="o">|</span> <span class="p">]</span>                          <span class="o">|</span> <span class="p">]</span>                <span class="o">|</span> <span class="p">]</span>                   <span class="o">|</span>                                 <span class="o">|</span>          <span class="o">|</span>
<span class="o">+----------------------------+------------------+---------------------+---------------------------------+----------+</span>
</pre></div>
</div>
</div>
<div class="section" id="cast-values">
<h2>Cast values<a class="headerlink" href="#cast-values" title="Permalink to this headline"> </a></h2>
<p>You can use <code class="docutils literal notranslate"><span class="pre">::</span></code> to cast values to basic data types. Use the <a class="reference internal" href="../sql/language-manual/sql-ref-functions-builtin.html#json-functions"><span class="std std-ref">from_json</span></a> method to cast nested results into more complex data types, such as arrays or structs.</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="c1">-- price is returned as a double, not a string</span>
<span class="k">SELECT</span><span class="w"> </span><span class="n">raw</span><span class="p">:</span><span class="n">store</span><span class="p">.</span><span class="n">bicycle</span><span class="p">.</span><span class="n">price</span><span class="p">::</span><span class="n">double</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">store_data</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">+------------------+</span>
<span class="o">|</span> <span class="n">price</span>            <span class="o">|</span>
<span class="o">+------------------+</span>
<span class="o">|</span> <span class="mf">19.95</span>            <span class="o">|</span>
<span class="o">+------------------+</span>
</pre></div>
</div>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="c1">-- use from_json to cast into more complex types</span>
<span class="k">SELECT</span><span class="w"> </span><span class="n">from_json</span><span class="p">(</span><span class="n">raw</span><span class="p">:</span><span class="n">store</span><span class="p">.</span><span class="n">bicycle</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;price double, color string&#39;</span><span class="p">)</span><span class="w"> </span><span class="n">bicycle</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">store_data</span>
<span class="c1">-- the column returned is a struct containing the columns price and color</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">+------------------+</span>
<span class="o">|</span> <span class="n">bicycle</span>          <span class="o">|</span>
<span class="o">+------------------+</span>
<span class="o">|</span> <span class="p">{</span>                <span class="o">|</span>
<span class="o">|</span>   <span class="s2">&quot;price&quot;</span><span class="p">:</span><span class="mf">19.95</span><span class="p">,</span> <span class="o">|</span>
<span class="o">|</span>   <span class="s2">&quot;color&quot;</span><span class="p">:</span><span class="s2">&quot;red&quot;</span>  <span class="o">|</span>
<span class="o">|</span> <span class="p">}</span>                <span class="o">|</span>
<span class="o">+------------------+</span>
</pre></div>
</div>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">SELECT</span><span class="w"> </span><span class="n">from_json</span><span class="p">(</span><span class="n">raw</span><span class="p">:</span><span class="n">store</span><span class="p">.</span><span class="n">basket</span><span class="p">[</span><span class="o">*</span><span class="p">],</span><span class="w"> </span><span class="s1">&#39;array&lt;array&lt;string&gt;&gt;&#39;</span><span class="p">)</span><span class="w"> </span><span class="n">baskets</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">store_data</span>
<span class="c1">-- the column returned is an array of string arrays</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">+------------------------------------------+</span>
<span class="o">|</span> <span class="n">basket</span>                                   <span class="o">|</span>
<span class="o">+------------------------------------------+</span>
<span class="o">|</span> <span class="p">[</span>                                        <span class="o">|</span>
<span class="o">|</span>   <span class="p">[</span><span class="s2">&quot;1&quot;</span><span class="p">,</span><span class="s2">&quot;2&quot;</span><span class="p">,</span><span class="s2">&quot;{</span><span class="se">\&quot;</span><span class="s2">b</span><span class="se">\&quot;</span><span class="s2">:</span><span class="se">\&quot;</span><span class="s2">y</span><span class="se">\&quot;</span><span class="s2">,</span><span class="se">\&quot;</span><span class="s2">a</span><span class="se">\&quot;</span><span class="s2">:</span><span class="se">\&quot;</span><span class="s2">x</span><span class="se">\&quot;</span><span class="s2">}]&quot;</span><span class="p">,</span> <span class="o">|</span>
<span class="o">|</span>   <span class="p">[</span><span class="s2">&quot;3&quot;</span><span class="p">,</span><span class="s2">&quot;4&quot;</span><span class="p">],</span>                             <span class="o">|</span>
<span class="o">|</span>   <span class="p">[</span><span class="s2">&quot;5&quot;</span><span class="p">,</span><span class="s2">&quot;6&quot;</span><span class="p">]</span>                              <span class="o">|</span>
<span class="o">|</span> <span class="p">]</span>                                        <span class="o">|</span>
<span class="o">+------------------------------------------+</span>
</pre></div>
</div>
</div>
<div class="section" id="null-behavior">
<h2>NULL behavior<a class="headerlink" href="#null-behavior" title="Permalink to this headline"> </a></h2>
<p>When a JSON field exists with a <code class="docutils literal notranslate"><span class="pre">null</span></code> value, you will receive a SQL <code class="docutils literal notranslate"><span class="pre">null</span></code> value for that column, not a <code class="docutils literal notranslate"><span class="pre">null</span></code> text value.</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">select</span><span class="w"> </span><span class="s1">&#39;{&quot;key&quot;:null}&#39;</span><span class="p">:</span><span class="k">key</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="k">null</span><span class="w"> </span><span class="n">sql_null</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;{&quot;key&quot;:null}&#39;</span><span class="p">:</span><span class="k">key</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s1">&#39;null&#39;</span><span class="w"> </span><span class="n">text_null</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">+-------------+-----------+</span>
<span class="o">|</span> <span class="n">sql_null</span>    <span class="o">|</span> <span class="n">text_null</span> <span class="o">|</span>
<span class="o">+-------------+-----------+</span>
<span class="o">|</span> <span class="n">true</span>        <span class="o">|</span> <span class="n">null</span>      <span class="o">|</span>
<span class="o">+-------------+-----------+</span>
</pre></div>
</div>
</div>
<div class="section" id="transform-nested-data-using-spark-sql-operators">
<h2>Transform nested data using Spark SQL operators<a class="headerlink" href="#transform-nested-data-using-spark-sql-operators" title="Permalink to this headline"> </a></h2>
<p>Apache Spark has a number of built-in functions for working with complex and nested data. The following notebook contains examples.</p>
<p>Additionally, <a class="reference internal" href="higher-order-lambda-functions.html"><span class="doc">higher order functions</span></a> provide many additional options when built-in Spark operators aren’t available for transforming data the way you want.</p>
<div class="embedded-notebook-section section" id="complex-nested-data-notebook">
<span id="complex-nested-structured"></span><h3>Complex nested data notebook<a class="headerlink" href="#complex-nested-data-notebook" title="Permalink to this headline"> </a></h3>
<div class="embedded-notebook">
    <p class="notebook-import-help">
        <a href="/_extras/notebooks/source/complex-nested-structured.html"            target="_blank">Open notebook in new tab</a>
        <button class="embedded-notebook-copy-to-clipboard"                copy-path-to-clipboard-on-click="/_extras/notebooks/source/complex-nested-structured.html">            <img src="/_static/clippy.svg"                alt="Copy to clipboard">            Copy link for import        </button>    <div class="embedded-notebook-container">        <div class="loading-spinner"></div>        <iframe data-src="/_extras/notebooks/source/complex-nested-structured.html"            id="a5701c5d13c1e989b62263a85dff93aebe9a789c696928a281cc0117fd4b8e65" height="1000px" width="100%"            style="overflow-y:hidden;" scrolling="no"></iframe>    </div></div></div>
</div>
</div>


    
          </div>
        </div>
        <div  class="suapp-rating">
  <div id="suPageRateApp">
     <su-app></su-app>
   </div> 
 </div>
<hr> 
<footer>
  <div role="contentinfo">
      <p class="copyright">
          &copy; Databricks 2023. All rights reserved. Apache, Apache Spark, Spark, and the Spark logo are trademarks of the <a href="http://www.apache.org/">Apache Software Foundation</a>.
      </p>
      <p> 
        
          <a id='feedbacklink' href="mailto:doc-feedback@databricks.com?subject=Documentation Feedback">Send us feedback</a>
        
     | <a href="https://databricks.com/privacy-policy">Privacy Policy</a> | <a href="https://databricks.com/terms-of-use">Terms of Use</a></p>

  </div> 

</footer>
      </div>
    </div>
  </section>
</main>

  </page>
  
  <script type="text/javascript">
    var DOCUMENTATION_OPTIONS = {
      URL_ROOT: '../',
      VERSION: '1.0',
      COLLAPSE_INDEX: false,
      FILE_SUFFIX: '.html',
      HAS_SOURCE: 'false'
    };
  </script>
  <script type="text/javascript" src="../_static/jquery.js"></script>
  <script type="text/javascript" src="../_static/underscore.js"></script>
  <script type="text/javascript" src="../_static/doctools.js"></script>
  <script type="text/javascript" src="../_static/language_data.js"></script>
  

  <script type="text/javascript" src="../_static/js/clipboard.min.js"></script>
  <script type="text/javascript" src="../_static/js/jquery.waypoints.min.js"></script>

  <!-- Select2 (https://select2.org/) -->
  <link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />
  <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
  <!-- End Select2 -->

  
  
  <script type="text/javascript" src="../_static/js/localized.js"></script>
  <script type="text/javascript" src="../_static/js/custom.js"></script>
  

  
  
  <script type="text/javascript">
    jQuery(function () {
      SphinxRtdTheme.StickyNav.enable();
    });

  </script>
  
 



  <script>
  window.__searchunifyLoaderConfig = JSON.parse('{"clients": {"en": "02c2e804-27e9-11ee-aefb-0242ac120011", "ja": "6a42c3f2-2820-11ee-aefb-0242ac120011", "pt": "6a86badd-2821-11ee-aefb-0242ac120011"}}')
</script>
<script type="text/javascript" src="../_static/js/search-loader.js"></script>
</body>
<script type='text/javascript'>
  window.onload = function () {
    var description = document.querySelector('meta[name="description"]').getAttribute("content");
    let titleText = document.querySelector('h1').textContent;
    document.querySelector('meta[property="og:title"]').setAttribute("content", titleText);
    document.querySelector('meta[property="og:description"]').setAttribute("content", description);
    document.querySelector('meta[property="twitter:description"]').setAttribute("content", description);
  };
</script>

</html>