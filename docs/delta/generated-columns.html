

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en-US" > <![endif]-->
<!--[if gt IE 8]><!-->
<html class="no-js" lang="en-US"> <!--<![endif]-->

<head>
  <!-- cookie consent -->
  
    <!-- Combined Onetrust and Rudderstack Implementation Scripts -->
    <!-- Onetrust Initialization -->
    <script type="text/javascript" src="https://cdn.cookielaw.org/consent/92466579-1717-44d3-809d-a05fb02843ed-test/OtAutoBlock.js"></script>
    <script src="https://cdn.cookielaw.org/scripttemplates/otSDKStub.js" data-document-language="true" type="text/javascript" charset="UTF-8" data-domain-script="92466579-1717-44d3-809d-a05fb02843ed-test"></script>
    <link rel="stylesheet" id="db-onetrust-style" href="https://www.databricks.com/wp-content/uploads/db_onetrust.css" media="all" />
    <!-- Setting Rudderstack Write Key -->
    <script>window.rudderstackKey = "2SOR9fvSr5Fi6tN2ihPbVHnX1SZ" </script>
    <!-- Rudderstack Initialization + Onetrust Integration + Rudderstack Custom Events -->
    <script type="text/javascript" src="https://www.databricks.com/sites/default/files/rudderstack/v1/db-rudderstack-events.js"></script>

  <!-- cookie consent -->

  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta http-equiv="X-UA-Compatible" content="IE=9" />
  <meta content="Automatically generate column values using user-specified functions in Delta Lake on Databricks." name="description" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0">
  <meta property="og:image" content="https://www.databricks.com/wp-content/uploads/2020/04/og-databricks.png">
  <meta property="og:image:type" content="image/png">
  <meta property="og:title" content="Use Delta Lake generated columns">
  <meta property="og:image:width" content="1200">
  <meta property="og:image:height" content="630">
  <meta property="og:type" content="website">
  <meta property="og:url" content="https://docs.databricks.com">
  <meta property="og:description" content="" id="og-description">
  <meta name="twitter:image" content="https://www.databricks.com/wp-content/uploads/2020/04/og-databricks.png">
  <meta name="twitter:site" content="@databricks">
  <meta name="twitter:creator" content="@databricks">
  <meta property="twitter:description" content="">
  
  <title>Use Delta Lake generated columns &#124; Databricks on AWS</title>
  
  
  <link rel="canonical" href="https://docs.databricks.com/en/delta/generated-columns.html">
  <!-- Start hreflang tag -->
  <link rel="alternate" hreflang="en" href="https://docs.databricks.com/en/delta/generated-columns.html" />
<link rel="alternate" hreflang="x-default" href="https://docs.databricks.com/en/delta/generated-columns.html" />
  <!-- End hreflang tag -->
  
  
  <link rel="shortcut icon" href="../_static/favicon.ico" />
  

  

  

  <!-- Google Tag Manager -->
  <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'https://www.googletagmanager.com/gtm.js?id='+i+dl;
j.setAttributeNode(d.createAttribute('data-ot-ignore'));
f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-T85FQ33');</script>
  <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'https://www.googletagmanager.com/gtm.js?id='+i+dl;
j.setAttributeNode(d.createAttribute('data-ot-ignore'));
f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-TWTKQQ');</script>
    
  <!-- End Google Tag Manager -->


  <!-- MaxMind / GEO IP -->
  <script src="//js.maxmind.com/js/apis/geoip2/v2.1/geoip2.js" type="text/javascript"></script>
  <!-- End MaxMind / GEO IP -->

  
  
  <link href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,600&display=swap" rel="stylesheet">
  <link rel="preload" href="../_static/fonts/DMSans-Bold.ttf" as="font">
  <link rel="preload" href="../_static/fonts/DMSans-Regular.ttf" as="font">
  <link rel="preload" href="../_static/fonts/DMMono-Regular.ttf" as="font">
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/css/custom.css" type="text/css" />
  <link rel="stylesheet" href="../_static/css/cloud-provider-selector.css" type="text/css" />
  <link rel="stylesheet" href="../_static/css/translation-selector.css" type="text/css" />
  <link rel="stylesheet" href="../_static/css/searchunify/main.css" type="text/css" />

  
  <link rel="index" title="Index" href="../genindex.html" />
  <link rel="search" title="Search" href="../search.html" />
  <link rel="top" title="Databricks on AWS" href="../index.html" /> 
</head>

<body class="wy-body-for-nav" role="document">

  <!-- Google Tag Manager (noscript) -->
  <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-T85FQ33"
height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
  <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-TWTKQQ"
    height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
  <!-- End Google Tag Manager (noscript) -->

  
  <nav class="wy-nav-top header su_header" role="navigation" aria-label="top navigation">
    
<nav class="wy-nav-top header su_header" role="navigation" aria-label="top navigation">
  <div class="container-logo">
    <ul class="mobile-menu-toggle">
        <li class="menu-toggle">
            <i data-toggle="wy-nav-top" class="wy-nav-top-menu-button db-icon db-icon-menu pull-left"></i>
            
            <a href="https://www.databricks.com/" class="wy-nav-top-logo"><img src="../_static/small-scale-lockup-full-color-rgb.svg" width="137" height="21"
              alt="Databricks" /></a>   
               
              </li>
    </ul>
    <ul class="su_nav-menu">
      <li class="menu-toggle">
        <i data-toggle="wy-nav-top" class="wy-nav-top-menu-button db-icon db-icon-menu pull-left"></i>
        
          
        
        <a href="https://www.databricks.com/" class="wy-nav-top-logo"><img src="../_static/small-scale-lockup-full-color-rgb.svg" width="137" height="21"
            alt="Databricks" /></a></li>
        <!-- 
<li><a href="https://help.databricks.com/s/">Help Center</a></li>
<li class="active"><a href="https://docs.databricks.com/en/">Documentation</a></li>
<li><a href="https://kb.databricks.com/">Knowledge Base</a></li>
 -->
    </ul>
  </div>
  <div class="su_nav-right">
    <ul class="su_link-mobile">
  <!-- Mobile header code can go here -->
</ul>
<ul class="right-try-list">
   
</ul>
  </div>
</nav>
  </nav>

  <div class="su_sub-header">
    <div class="container">
      <div class="su_sub-header-inner">
        <!-- <div class="su_subnav-menu-right">
  <div id="auto" style="width: 100%;">
    <div ng-controller="SearchautoController">
      <div bind-html-compile="autocompleteHtml">
        <form class="su__search-box-1" disabled="disabled">
          <input class="su__search-input" type="search" name="Search box" id="su__search-b" placeholder="Search Documentation" disabled="disabled"/>
          <button class="su__search-button" type="submit" class="button button-success" disabled="disabled">
            <svg width="24" height="24" viewBox="0 0 24 24">
              <path
                d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"
                fill="#333"></path>
            </svg>
          </button>
        </form>
      </div>
    </div>
  </div>
</div> -->
        <div class="search-lng-gap"></div>
        <div style="margin-left: 16px; margin-right: 16px;">
          <!-- <select name="lng selector" id="lng-selector">
    <option value="../../en/delta/generated-columns.html" class="notranslate">English</option>
    <option value="../../ja/delta/generated-columns.html" class="notranslate">日本語</option>
    <option value="../../pt/delta/generated-columns.html" class="notranslate">Português (Brasil)</option>
</select> -->
        </div>
        <div class="cloud-selector-container">
          <!-- <select name="cloud provider selector" id="cloud-provider-selector">
    <option value="aws" selected class="notranslate">
        Amazon Web Services
    </option>
    <option value="azure"  class="notranslate">
        Microsoft Azure
    </option>
    <option value="gcp"  class="notranslate">
        Google Cloud Platform
    </option>
</select> -->
        </div>
      </div>
    </div>
  </div>
  <page class="js-page-container">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side su_nav-side">
<div class="wy-side-scroll">
  <div class="wy-side-nav-search">
    

    

    

    
  </div>

  <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
    
      <a href="../index.html" class="main-navigation-home">Databricks on AWS</a>
    

    
      

      
        <p class="caption"><span class="caption-text">Load &amp; manage data</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../rag-temp/index.html">RAG Studio</a></li>
</ul>

      
    
  </div>

  <div role="contentinfo">
    
  <p class="build_info notranslate"data-last-edit="December 23, 2023">
    Updated Jan 11, 2024
  </p>
<script>
  window.addEventListener('DOMContentLoaded',function(){
    var h1=document.querySelector('h1');
    var bi=document.querySelector('[data-last-edit]');
    if(h1 && bi){
      var ver = document.createElement('p');
      ver.className = 'version_info';
      ver.textContent = bi.getAttribute('data-last-edit');
      h1.parentElement.insertBefore(ver, h1.nextElementSibling);
    }
  });
</script>

    <p>
      
        <a id='feedbacklink' href="mailto:doc-feedback@databricks.com?subject=Documentation Feedback">Send us feedback</a>
      
    </p>
  </div>
</div>
</nav>
    
    
<main class="wy-grid-for-nav su_nav-grid">
  <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
    <div class="wy-nav-content su__nav_content">
      <div class="rst-content">
        





<div role="navigation" aria-label="breadcrumbs navigation" class="wy-breadcrumbs-wrapper">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html">Documentation</a> <span class="db-icon db-icon-chevron-right"></span></li>
    
    
      <li>Use Delta Lake generated columns</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>
</div>
        
        <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
          <div itemprop="articleBody">
            
    
  <div class="section" id="use-delta-lake-generated-columns">
<span id="use-delta-generated-columns"></span><h1>Use Delta Lake generated columns<a class="headerlink" href="#use-delta-lake-generated-columns" title="Permalink to this headline"> </a></h1>
<div class="preview admonition">
<p class="admonition-title">Preview</p>
<p>This feature is in <a class="reference internal" href="../release-notes/release-types.html"><span class="doc">Public Preview</span></a>.</p>
</div>
<p>Delta Lake supports generated columns which are a special type of column whose values are automatically generated based on a user-specified function over other columns in the Delta table. When you write to a table with generated columns and you do not explicitly provide values for them, Delta Lake automatically computes the values. For example, you can automatically generate a date column (for partitioning the table by date) from the timestamp column; any writes into the table need only specify the data for the timestamp column. However, if you explicitly provide values for them, the values must satisfy the <a class="reference internal" href="../tables/constraints.html"><span class="doc">constraint</span></a> <code class="docutils literal notranslate"><span class="pre">(&lt;value&gt;</span> <span class="pre">&lt;=&gt;</span> <span class="pre">&lt;generation</span> <span class="pre">expression&gt;)</span> <span class="pre">IS</span> <span class="pre">TRUE</span></code> or the write will fail with an error.</p>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>Tables created with generated columns have a higher table writer protocol version than the default. See <a class="reference internal" href="feature-compatibility.html"><span class="doc">How does Databricks manage Delta Lake feature compatibility?</span></a> to understand table protocol versioning and what it means to have a higher version of a table protocol version.</p>
</div>
<div class="section" id="learn-how-to-use-generated-columns">
<h2>Learn how to use generated columns<a class="headerlink" href="#learn-how-to-use-generated-columns" title="Permalink to this headline"> </a></h2>
<p>The following example shows how to create a table with generated columns:</p>
<div class="js-code-language-tabs js-code-language-tabs--literal compound">
<div class="compound-first highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="k">default</span><span class="p">.</span><span class="n">people10m</span><span class="w"> </span><span class="p">(</span>
<span class="w">  </span><span class="n">id</span><span class="w"> </span><span class="nb">INT</span><span class="p">,</span>
<span class="w">  </span><span class="n">firstName</span><span class="w"> </span><span class="n">STRING</span><span class="p">,</span>
<span class="w">  </span><span class="n">middleName</span><span class="w"> </span><span class="n">STRING</span><span class="p">,</span>
<span class="w">  </span><span class="n">lastName</span><span class="w"> </span><span class="n">STRING</span><span class="p">,</span>
<span class="w">  </span><span class="n">gender</span><span class="w"> </span><span class="n">STRING</span><span class="p">,</span>
<span class="w">  </span><span class="n">birthDate</span><span class="w"> </span><span class="k">TIMESTAMP</span><span class="p">,</span>
<span class="w">  </span><span class="n">dateOfBirth</span><span class="w"> </span><span class="nb">DATE</span><span class="w"> </span><span class="k">GENERATED</span><span class="w"> </span><span class="n">ALWAYS</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="p">(</span><span class="k">CAST</span><span class="p">(</span><span class="n">birthDate</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="nb">DATE</span><span class="p">)),</span>
<span class="w">  </span><span class="n">ssn</span><span class="w"> </span><span class="n">STRING</span><span class="p">,</span>
<span class="w">  </span><span class="n">salary</span><span class="w"> </span><span class="nb">INT</span>
<span class="p">)</span>
</pre></div>
</div>
<div class="compound-middle highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">DeltaTable</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">spark</span><span class="p">)</span> \
  <span class="o">.</span><span class="n">tableName</span><span class="p">(</span><span class="s2">&quot;default.people10m&quot;</span><span class="p">)</span> \
  <span class="o">.</span><span class="n">addColumn</span><span class="p">(</span><span class="s2">&quot;id&quot;</span><span class="p">,</span> <span class="s2">&quot;INT&quot;</span><span class="p">)</span> \
  <span class="o">.</span><span class="n">addColumn</span><span class="p">(</span><span class="s2">&quot;firstName&quot;</span><span class="p">,</span> <span class="s2">&quot;STRING&quot;</span><span class="p">)</span> \
  <span class="o">.</span><span class="n">addColumn</span><span class="p">(</span><span class="s2">&quot;middleName&quot;</span><span class="p">,</span> <span class="s2">&quot;STRING&quot;</span><span class="p">)</span> \
  <span class="o">.</span><span class="n">addColumn</span><span class="p">(</span><span class="s2">&quot;lastName&quot;</span><span class="p">,</span> <span class="s2">&quot;STRING&quot;</span><span class="p">,</span> <span class="n">comment</span> <span class="o">=</span> <span class="s2">&quot;surname&quot;</span><span class="p">)</span> \
  <span class="o">.</span><span class="n">addColumn</span><span class="p">(</span><span class="s2">&quot;gender&quot;</span><span class="p">,</span> <span class="s2">&quot;STRING&quot;</span><span class="p">)</span> \
  <span class="o">.</span><span class="n">addColumn</span><span class="p">(</span><span class="s2">&quot;birthDate&quot;</span><span class="p">,</span> <span class="s2">&quot;TIMESTAMP&quot;</span><span class="p">)</span> \
  <span class="o">.</span><span class="n">addColumn</span><span class="p">(</span><span class="s2">&quot;dateOfBirth&quot;</span><span class="p">,</span> <span class="n">DateType</span><span class="p">(),</span> <span class="n">generatedAlwaysAs</span><span class="o">=</span><span class="s2">&quot;CAST(birthDate AS DATE)&quot;</span><span class="p">)</span> \
  <span class="o">.</span><span class="n">addColumn</span><span class="p">(</span><span class="s2">&quot;ssn&quot;</span><span class="p">,</span> <span class="s2">&quot;STRING&quot;</span><span class="p">)</span> \
  <span class="o">.</span><span class="n">addColumn</span><span class="p">(</span><span class="s2">&quot;salary&quot;</span><span class="p">,</span> <span class="s2">&quot;INT&quot;</span><span class="p">)</span> \
  <span class="o">.</span><span class="n">execute</span><span class="p">()</span>
</pre></div>
</div>
<div class="compound-last highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="nc">DeltaTable</span><span class="p">.</span><span class="n">create</span><span class="p">(</span><span class="n">spark</span><span class="p">)</span>
<span class="w">  </span><span class="p">.</span><span class="n">tableName</span><span class="p">(</span><span class="s">&quot;default.people10m&quot;</span><span class="p">)</span>
<span class="w">  </span><span class="p">.</span><span class="n">addColumn</span><span class="p">(</span><span class="s">&quot;id&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;INT&quot;</span><span class="p">)</span>
<span class="w">  </span><span class="p">.</span><span class="n">addColumn</span><span class="p">(</span><span class="s">&quot;firstName&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;STRING&quot;</span><span class="p">)</span>
<span class="w">  </span><span class="p">.</span><span class="n">addColumn</span><span class="p">(</span><span class="s">&quot;middleName&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;STRING&quot;</span><span class="p">)</span>
<span class="w">  </span><span class="p">.</span><span class="n">addColumn</span><span class="p">(</span>
<span class="w">    </span><span class="nc">DeltaTable</span><span class="p">.</span><span class="n">columnBuilder</span><span class="p">(</span><span class="s">&quot;lastName&quot;</span><span class="p">)</span>
<span class="w">      </span><span class="p">.</span><span class="n">dataType</span><span class="p">(</span><span class="s">&quot;STRING&quot;</span><span class="p">)</span>
<span class="w">      </span><span class="p">.</span><span class="n">comment</span><span class="p">(</span><span class="s">&quot;surname&quot;</span><span class="p">)</span>
<span class="w">      </span><span class="p">.</span><span class="n">build</span><span class="p">())</span>
<span class="w">  </span><span class="p">.</span><span class="n">addColumn</span><span class="p">(</span><span class="s">&quot;lastName&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;STRING&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">comment</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;surname&quot;</span><span class="p">)</span>
<span class="w">  </span><span class="p">.</span><span class="n">addColumn</span><span class="p">(</span><span class="s">&quot;gender&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;STRING&quot;</span><span class="p">)</span>
<span class="w">  </span><span class="p">.</span><span class="n">addColumn</span><span class="p">(</span><span class="s">&quot;birthDate&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;TIMESTAMP&quot;</span><span class="p">)</span>
<span class="w">  </span><span class="p">.</span><span class="n">addColumn</span><span class="p">(</span>
<span class="w">    </span><span class="nc">DeltaTable</span><span class="p">.</span><span class="n">columnBuilder</span><span class="p">(</span><span class="s">&quot;dateOfBirth&quot;</span><span class="p">)</span>
<span class="w">     </span><span class="p">.</span><span class="n">dataType</span><span class="p">(</span><span class="nc">DateType</span><span class="p">)</span>
<span class="w">     </span><span class="p">.</span><span class="n">generatedAlwaysAs</span><span class="p">(</span><span class="s">&quot;CAST(dateOfBirth AS DATE)&quot;</span><span class="p">)</span>
<span class="w">     </span><span class="p">.</span><span class="n">build</span><span class="p">())</span>
<span class="w">  </span><span class="p">.</span><span class="n">addColumn</span><span class="p">(</span><span class="s">&quot;ssn&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;STRING&quot;</span><span class="p">)</span>
<span class="w">  </span><span class="p">.</span><span class="n">addColumn</span><span class="p">(</span><span class="s">&quot;salary&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;INT&quot;</span><span class="p">)</span>
<span class="w">  </span><span class="p">.</span><span class="n">execute</span><span class="p">()</span>
</pre></div>
</div>
</div>
<p>Generated columns are stored as if they were normal columns. That is, they occupy storage.</p>
<p>The following restrictions apply to generated columns:</p>
<ul class="simple">
<li><p>A generation expression can use any SQL functions in Spark that always return the same result when given the same argument values, except the following types of functions:</p>
<ul>
<li><p>User-defined functions.</p></li>
<li><p>Aggregate functions.</p></li>
<li><p>Window functions.</p></li>
<li><p>Functions returning multiple rows.</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">MERGE</span></code> operations support generated columns when you set <code class="docutils literal notranslate"><span class="pre">spark.databricks.delta.schema.autoMerge.enabled</span></code> to true.</p></li>
</ul>
<p>Delta Lake can generate partition filters for a query whenever a partition column is defined by one of the following expressions:</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Photon in required in Databricks Runtime 10.4 LTS and below. Photon is not required in Databricks Runtime 11.0 and above.</p>
</div>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">CAST(col</span> <span class="pre">AS</span> <span class="pre">DATE)</span></code> and the type of <code class="docutils literal notranslate"><span class="pre">col</span></code> is <code class="docutils literal notranslate"><span class="pre">TIMESTAMP</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">YEAR(col)</span></code> and the type of <code class="docutils literal notranslate"><span class="pre">col</span></code> is <code class="docutils literal notranslate"><span class="pre">TIMESTAMP</span></code>.</p></li>
<li><p>Two partition columns defined by <code class="docutils literal notranslate"><span class="pre">YEAR(col),</span> <span class="pre">MONTH(col)</span></code> and the type of <code class="docutils literal notranslate"><span class="pre">col</span></code> is <code class="docutils literal notranslate"><span class="pre">TIMESTAMP</span></code>.</p></li>
<li><p>Three partition columns defined by <code class="docutils literal notranslate"><span class="pre">YEAR(col),</span> <span class="pre">MONTH(col),</span> <span class="pre">DAY(col)</span></code> and the type of <code class="docutils literal notranslate"><span class="pre">col</span></code> is <code class="docutils literal notranslate"><span class="pre">TIMESTAMP</span></code>.</p></li>
<li><p>Four partition columns defined by <code class="docutils literal notranslate"><span class="pre">YEAR(col),</span> <span class="pre">MONTH(col),</span> <span class="pre">DAY(col),</span> <span class="pre">HOUR(col)</span></code> and the type of <code class="docutils literal notranslate"><span class="pre">col</span></code> is <code class="docutils literal notranslate"><span class="pre">TIMESTAMP</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">SUBSTRING(col,</span> <span class="pre">pos,</span> <span class="pre">len)</span></code> and the type of <code class="docutils literal notranslate"><span class="pre">col</span></code> is <code class="docutils literal notranslate"><span class="pre">STRING</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">DATE_FORMAT(col,</span> <span class="pre">format)</span></code> and the type of <code class="docutils literal notranslate"><span class="pre">col</span></code> is <code class="docutils literal notranslate"><span class="pre">TIMESTAMP</span></code>.</p>
<ul>
<li><p>You can only use date formats with the following patterns: <code class="docutils literal notranslate"><span class="pre">yyyy-MM</span></code> and <code class="docutils literal notranslate"><span class="pre">yyyy-MM-dd-HH</span></code>.</p></li>
<li><p>In Databricks Runtime 10.4 LTS and above, you can also use the following pattern: <code class="docutils literal notranslate"><span class="pre">yyyy-MM-dd</span></code>.</p></li>
</ul>
</li>
</ul>
<p>If a partition column is defined by one of the preceding expressions, and a query filters data using the underlying base column of a generation expression, Delta Lake looks at the relationship between the base column and the generated column, and populates partition filters based on the generated partition column if possible. For example, given the following table:</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">events</span><span class="p">(</span>
<span class="n">eventId</span><span class="w"> </span><span class="nb">BIGINT</span><span class="p">,</span>
<span class="k">data</span><span class="w"> </span><span class="n">STRING</span><span class="p">,</span>
<span class="n">eventType</span><span class="w"> </span><span class="n">STRING</span><span class="p">,</span>
<span class="n">eventTime</span><span class="w"> </span><span class="k">TIMESTAMP</span><span class="p">,</span>
<span class="n">eventDate</span><span class="w"> </span><span class="nb">date</span><span class="w"> </span><span class="k">GENERATED</span><span class="w"> </span><span class="n">ALWAYS</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="p">(</span><span class="k">CAST</span><span class="p">(</span><span class="n">eventTime</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="nb">DATE</span><span class="p">))</span>
<span class="p">)</span>
<span class="n">PARTITIONED</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="p">(</span><span class="n">eventType</span><span class="p">,</span><span class="w"> </span><span class="n">eventDate</span><span class="p">)</span>
</pre></div>
</div>
<p>If you then run the following query:</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">events</span>
<span class="k">WHERE</span><span class="w"> </span><span class="n">eventTime</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="ss">&quot;2020-10-01 00:00:00&quot;</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="ss">&quot;2020-10-01 12:00:00&quot;</span>
</pre></div>
</div>
<p>Delta Lake automatically generates a partition filter so that the preceding query only reads the data in partition <code class="docutils literal notranslate"><span class="pre">date=2020-10-01</span></code> even if a partition filter is not specified.</p>
<p>As another example, given the following table:</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">events</span><span class="p">(</span>
<span class="n">eventId</span><span class="w"> </span><span class="nb">BIGINT</span><span class="p">,</span>
<span class="k">data</span><span class="w"> </span><span class="n">STRING</span><span class="p">,</span>
<span class="n">eventType</span><span class="w"> </span><span class="n">STRING</span><span class="p">,</span>
<span class="n">eventTime</span><span class="w"> </span><span class="k">TIMESTAMP</span><span class="p">,</span>
<span class="k">year</span><span class="w"> </span><span class="nb">INT</span><span class="w"> </span><span class="k">GENERATED</span><span class="w"> </span><span class="n">ALWAYS</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="p">(</span><span class="k">YEAR</span><span class="p">(</span><span class="n">eventTime</span><span class="p">)),</span>
<span class="k">month</span><span class="w"> </span><span class="nb">INT</span><span class="w"> </span><span class="k">GENERATED</span><span class="w"> </span><span class="n">ALWAYS</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="p">(</span><span class="k">MONTH</span><span class="p">(</span><span class="n">eventTime</span><span class="p">)),</span>
<span class="k">day</span><span class="w"> </span><span class="nb">INT</span><span class="w"> </span><span class="k">GENERATED</span><span class="w"> </span><span class="n">ALWAYS</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="p">(</span><span class="k">DAY</span><span class="p">(</span><span class="n">eventTime</span><span class="p">))</span>
<span class="p">)</span>
<span class="n">PARTITIONED</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="p">(</span><span class="n">eventType</span><span class="p">,</span><span class="w"> </span><span class="k">year</span><span class="p">,</span><span class="w"> </span><span class="k">month</span><span class="p">,</span><span class="w"> </span><span class="k">day</span><span class="p">)</span>
</pre></div>
</div>
<p>If you then run the following query:</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">events</span>
<span class="k">WHERE</span><span class="w"> </span><span class="n">eventTime</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="ss">&quot;2020-10-01 00:00:00&quot;</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="ss">&quot;2020-10-01 12:00:00&quot;</span>
</pre></div>
</div>
<p>Delta Lake automatically generates a partition filter so that the preceding query only reads the data in partition <code class="docutils literal notranslate"><span class="pre">year=2020/month=10/day=01</span></code> even if a partition filter is not specified.</p>
<p>You can use an <a class="reference internal" href="../sql/language-manual/sql-ref-syntax-qry-explain.html"><span class="doc">EXPLAIN</span></a> clause and check the provided plan to see whether Delta Lake automatically generates any partition filters.</p>
</div>
<div class="section" id="use-identity-columns-in-delta-lake">
<span id="use-identity-columns-in-delta"></span><span id="identity"></span><h2>Use identity columns in Delta Lake<a class="headerlink" href="#use-identity-columns-in-delta-lake" title="Permalink to this headline"> </a></h2>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>Declaring an identity column on a Delta table disables concurrent transactions. Only use identity columns in use cases where concurrent writes to the target table are not required.</p>
</div>
<p>Delta Lake identity columns are a type of generated column that assign unique values for each record inserted to a table. You can optionally specify a starting value and a step size, which can include both positive and negative values. Identity columns only support the <code class="docutils literal notranslate"><span class="pre">BIGINT</span></code> type, and operations fail if the assigned value exceeds the range supported by <code class="docutils literal notranslate"><span class="pre">BIGINT</span></code>.</p>
<p>Values assigned by identity columns are unique and increment in the direction of the specified step, and in multiples of the specified step size, but are not guaranteed to be contiguous.</p>
<p>Users can optionally specify values for identity columns during insert operations, but this can be disabled by using the <code class="docutils literal notranslate"><span class="pre">ALWAYS</span></code> keyword during identity column declaration.</p>
<p>Tables cannot be partitioned by an identity column, and you cannot perform update operations on identity columns.</p>
<p>You cannot add identity columns to an existing table. To create a table with identity columns, see <a class="reference internal" href="../sql/language-manual/sql-ref-syntax-ddl-create-table-using.html"><span class="doc">CREATE TABLE [USING]</span></a>.</p>
<p>To learn about syncing identity column values with data, see <a class="reference internal" href="../sql/language-manual/sql-ref-syntax-ddl-alter-table.html"><span class="doc">ALTER TABLE</span></a>.</p>
</div>
</div>


    
          </div>
        </div>
        <div  class="suapp-rating">
  <div id="suPageRateApp">
     <su-app></su-app>
   </div> 
 </div>
<hr> 
<footer>
  <div role="contentinfo">
      <p class="copyright">
          &copy; Databricks 2023. All rights reserved. Apache, Apache Spark, Spark, and the Spark logo are trademarks of the <a href="http://www.apache.org/">Apache Software Foundation</a>.
      </p>
      <p> 
        
          <a id='feedbacklink' href="mailto:doc-feedback@databricks.com?subject=Documentation Feedback">Send us feedback</a>
        
     | <a href="https://databricks.com/privacy-policy">Privacy Policy</a> | <a href="https://databricks.com/terms-of-use">Terms of Use</a></p>

  </div> 

</footer>
      </div>
    </div>
  </section>
</main>

  </page>
  
  <script type="text/javascript">
    var DOCUMENTATION_OPTIONS = {
      URL_ROOT: '../',
      VERSION: '1.0',
      COLLAPSE_INDEX: false,
      FILE_SUFFIX: '.html',
      HAS_SOURCE: 'false'
    };
  </script>
  <script type="text/javascript" src="../_static/jquery.js"></script>
  <script type="text/javascript" src="../_static/underscore.js"></script>
  <script type="text/javascript" src="../_static/doctools.js"></script>
  <script type="text/javascript" src="../_static/language_data.js"></script>
  

  <script type="text/javascript" src="../_static/js/clipboard.min.js"></script>
  <script type="text/javascript" src="../_static/js/jquery.waypoints.min.js"></script>

  <!-- Select2 (https://select2.org/) -->
  <link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />
  <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
  <!-- End Select2 -->

  
  
  <script type="text/javascript" src="../_static/js/localized.js"></script>
  <script type="text/javascript" src="../_static/js/custom.js"></script>
  

  
  
  <script type="text/javascript">
    jQuery(function () {
      SphinxRtdTheme.StickyNav.enable();
    });

  </script>
  
 



  <script>
  window.__searchunifyLoaderConfig = JSON.parse('{"clients": {"en": "02c2e804-27e9-11ee-aefb-0242ac120011", "ja": "6a42c3f2-2820-11ee-aefb-0242ac120011", "pt": "6a86badd-2821-11ee-aefb-0242ac120011"}}')
</script>
<script type="text/javascript" src="../_static/js/search-loader.js"></script>
</body>
<script type='text/javascript'>
  window.onload = function () {
    var description = document.querySelector('meta[name="description"]').getAttribute("content");
    let titleText = document.querySelector('h1').textContent;
    document.querySelector('meta[property="og:title"]').setAttribute("content", titleText);
    document.querySelector('meta[property="og:description"]').setAttribute("content", description);
    document.querySelector('meta[property="twitter:description"]').setAttribute("content", description);
  };
</script>

</html>