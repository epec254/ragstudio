

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en-US" > <![endif]-->
<!--[if gt IE 8]><!-->
<html class="no-js" lang="en-US"> <!--<![endif]-->

<head>
  <!-- cookie consent -->
  
    <!-- Combined Onetrust and Rudderstack Implementation Scripts -->
    <!-- Onetrust Initialization -->
    <script type="text/javascript" src="https://cdn.cookielaw.org/consent/92466579-1717-44d3-809d-a05fb02843ed-test/OtAutoBlock.js"></script>
    <script src="https://cdn.cookielaw.org/scripttemplates/otSDKStub.js" data-document-language="true" type="text/javascript" charset="UTF-8" data-domain-script="92466579-1717-44d3-809d-a05fb02843ed-test"></script>
    <link rel="stylesheet" id="db-onetrust-style" href="https://www.databricks.com/wp-content/uploads/db_onetrust.css" media="all" />
    <!-- Setting Rudderstack Write Key -->
    <script>window.rudderstackKey = "2SOR9fvSr5Fi6tN2ihPbVHnX1SZ" </script>
    <!-- Rudderstack Initialization + Onetrust Integration + Rudderstack Custom Events -->
    <script type="text/javascript" src="https://www.databricks.com/sites/default/files/rudderstack/v1/db-rudderstack-events.js"></script>

  <!-- cookie consent -->

  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta http-equiv="X-UA-Compatible" content="IE=9" />
  <meta content="Learn how Delta Lake liquid clustering works to simplify data layout decisions and accelerate data access." name="description" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0">
  <meta property="og:image" content="https://www.databricks.com/wp-content/uploads/2020/04/og-databricks.png">
  <meta property="og:image:type" content="image/png">
  <meta property="og:title" content="Use liquid clustering for Delta tables">
  <meta property="og:image:width" content="1200">
  <meta property="og:image:height" content="630">
  <meta property="og:type" content="website">
  <meta property="og:url" content="https://docs.databricks.com">
  <meta property="og:description" content="" id="og-description">
  <meta name="twitter:image" content="https://www.databricks.com/wp-content/uploads/2020/04/og-databricks.png">
  <meta name="twitter:site" content="@databricks">
  <meta name="twitter:creator" content="@databricks">
  <meta property="twitter:description" content="">
  
  <title>Use liquid clustering for Delta tables &#124; Databricks on AWS</title>
  
  
  <link rel="canonical" href="https://docs.databricks.com/en/delta/clustering.html">
  <!-- Start hreflang tag -->
  <link rel="alternate" hreflang="en" href="https://docs.databricks.com/en/delta/clustering.html" />
<link rel="alternate" hreflang="x-default" href="https://docs.databricks.com/en/delta/clustering.html" />
  <!-- End hreflang tag -->
  
  
  <link rel="shortcut icon" href="../_static/favicon.ico" />
  

  

  

  <!-- Google Tag Manager -->
  <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'https://www.googletagmanager.com/gtm.js?id='+i+dl;
j.setAttributeNode(d.createAttribute('data-ot-ignore'));
f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-T85FQ33');</script>
  <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'https://www.googletagmanager.com/gtm.js?id='+i+dl;
j.setAttributeNode(d.createAttribute('data-ot-ignore'));
f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-TWTKQQ');</script>
    
  <!-- End Google Tag Manager -->


  <!-- MaxMind / GEO IP -->
  <script src="//js.maxmind.com/js/apis/geoip2/v2.1/geoip2.js" type="text/javascript"></script>
  <!-- End MaxMind / GEO IP -->

  
  
  <link href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,600&display=swap" rel="stylesheet">
  <link rel="preload" href="../_static/fonts/DMSans-Bold.ttf" as="font">
  <link rel="preload" href="../_static/fonts/DMSans-Regular.ttf" as="font">
  <link rel="preload" href="../_static/fonts/DMMono-Regular.ttf" as="font">
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/css/custom.css" type="text/css" />
  <link rel="stylesheet" href="../_static/css/cloud-provider-selector.css" type="text/css" />
  <link rel="stylesheet" href="../_static/css/translation-selector.css" type="text/css" />
  <link rel="stylesheet" href="../_static/css/searchunify/main.css" type="text/css" />

  
  <link rel="index" title="Index" href="../genindex.html" />
  <link rel="search" title="Search" href="../search.html" />
  <link rel="top" title="Databricks on AWS" href="../index.html" /> 
</head>

<body class="wy-body-for-nav" role="document">

  <!-- Google Tag Manager (noscript) -->
  <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-T85FQ33"
height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
  <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-TWTKQQ"
    height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
  <!-- End Google Tag Manager (noscript) -->

  
  <nav class="wy-nav-top header su_header" role="navigation" aria-label="top navigation">
    
<nav class="wy-nav-top header su_header" role="navigation" aria-label="top navigation">
  <div class="container-logo">
    <ul class="mobile-menu-toggle">
        <li class="menu-toggle">
            <i data-toggle="wy-nav-top" class="wy-nav-top-menu-button db-icon db-icon-menu pull-left"></i>
            
            <a href="https://www.databricks.com/" class="wy-nav-top-logo"><img src="../_static/small-scale-lockup-full-color-rgb.svg" width="137" height="21"
              alt="Databricks" /></a>   
               
              </li>
    </ul>
    <ul class="su_nav-menu">
      <li class="menu-toggle">
        <i data-toggle="wy-nav-top" class="wy-nav-top-menu-button db-icon db-icon-menu pull-left"></i>
        
          
        
        <a href="https://www.databricks.com/" class="wy-nav-top-logo"><img src="../_static/small-scale-lockup-full-color-rgb.svg" width="137" height="21"
            alt="Databricks" /></a></li>
        <!-- 
<li><a href="https://help.databricks.com/s/">Help Center</a></li>
<li class="active"><a href="https://docs.databricks.com/en/">Documentation</a></li>
<li><a href="https://kb.databricks.com/">Knowledge Base</a></li>
 -->
    </ul>
  </div>
  <div class="su_nav-right">
    <ul class="su_link-mobile">
  <!-- Mobile header code can go here -->
</ul>
<ul class="right-try-list">
   
</ul>
  </div>
</nav>
  </nav>

  <div class="su_sub-header">
    <div class="container">
      <div class="su_sub-header-inner">
        <!-- <div class="su_subnav-menu-right">
  <div id="auto" style="width: 100%;">
    <div ng-controller="SearchautoController">
      <div bind-html-compile="autocompleteHtml">
        <form class="su__search-box-1" disabled="disabled">
          <input class="su__search-input" type="search" name="Search box" id="su__search-b" placeholder="Search Documentation" disabled="disabled"/>
          <button class="su__search-button" type="submit" class="button button-success" disabled="disabled">
            <svg width="24" height="24" viewBox="0 0 24 24">
              <path
                d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"
                fill="#333"></path>
            </svg>
          </button>
        </form>
      </div>
    </div>
  </div>
</div> -->
        <div class="search-lng-gap"></div>
        <div style="margin-left: 16px; margin-right: 16px;">
          <!-- <select name="lng selector" id="lng-selector">
    <option value="../../en/delta/clustering.html" class="notranslate">English</option>
    <option value="../../ja/delta/clustering.html" class="notranslate">日本語</option>
    <option value="../../pt/delta/clustering.html" class="notranslate">Português (Brasil)</option>
</select> -->
        </div>
        <div class="cloud-selector-container">
          <!-- <select name="cloud provider selector" id="cloud-provider-selector">
    <option value="aws" selected class="notranslate">
        Amazon Web Services
    </option>
    <option value="azure"  class="notranslate">
        Microsoft Azure
    </option>
    <option value="gcp"  class="notranslate">
        Google Cloud Platform
    </option>
</select> -->
        </div>
      </div>
    </div>
  </div>
  <page class="js-page-container">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side su_nav-side">
<div class="wy-side-scroll">
  <div class="wy-side-nav-search">
    

    

    

    
  </div>

  <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
    
      <a href="../index.html" class="main-navigation-home">Databricks on AWS</a>
    

    
      

      
        <p class="caption"><span class="caption-text">Load &amp; manage data</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../rag-temp/index.html">RAG Studio</a></li>
</ul>

      
    
  </div>

  <div role="contentinfo">
    
  <p class="build_info notranslate"data-last-edit="December 23, 2023">
    Updated Jan 11, 2024
  </p>
<script>
  window.addEventListener('DOMContentLoaded',function(){
    var h1=document.querySelector('h1');
    var bi=document.querySelector('[data-last-edit]');
    if(h1 && bi){
      var ver = document.createElement('p');
      ver.className = 'version_info';
      ver.textContent = bi.getAttribute('data-last-edit');
      h1.parentElement.insertBefore(ver, h1.nextElementSibling);
    }
  });
</script>

    <p>
      
        <a id='feedbacklink' href="mailto:doc-feedback@databricks.com?subject=Documentation Feedback">Send us feedback</a>
      
    </p>
  </div>
</div>
</nav>
    
    
<main class="wy-grid-for-nav su_nav-grid">
  <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
    <div class="wy-nav-content su__nav_content">
      <div class="rst-content">
        





<div role="navigation" aria-label="breadcrumbs navigation" class="wy-breadcrumbs-wrapper">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html">Documentation</a> <span class="db-icon db-icon-chevron-right"></span></li>
    
    
      <li>Use liquid clustering for Delta tables</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>
</div>
        
        <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
          <div itemprop="articleBody">
            
    
  <div class="section" id="use-liquid-clustering-for-delta-tables">
<h1>Use liquid clustering for Delta tables<a class="headerlink" href="#use-liquid-clustering-for-delta-tables" title="Permalink to this headline"> </a></h1>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>Delta Lake liquid clustering is available in Public Preview in Databricks Runtime 13.3 and above. Some support for liquid clustering exists in Databricks Runtime 12.1 and above. See <a class="reference internal" href="#compatibility"><span class="std std-ref">Compatibility for tables with liquid clustering</span></a>.</p>
</div>
<p>Delta Lake liquid clustering replaces table partitioning and <code class="docutils literal notranslate"><span class="pre">ZORDER</span></code> to simplify data layout decisions and optimize query performance. Liquid clustering provides flexibility to redefine clustering keys without rewriting existing data, allowing data layout to evolve alongside analytic needs over time.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Databricks Runtime 13.3 LTS and above is required to create, write, or <code class="docutils literal notranslate"><span class="pre">OPTIMIZE</span></code> Delta tables with liquid clustering enabled.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Tables with liquid clustering enabled support row-level concurrency in Databricks Runtime 13.3 LTS and above. Row-level concurrency is generally available in Databricks Runtime 14.2 and above for all tables with deletion vectors enabled. See <a class="reference internal" href="../optimizations/isolation-level.html"><span class="doc">Isolation levels and write conflicts on Databricks</span></a>.</p>
</div>
<div class="section" id="what-is-liquid-clustering-used-for">
<h2>What is liquid clustering used for?<a class="headerlink" href="#what-is-liquid-clustering-used-for" title="Permalink to this headline"> </a></h2>
<p>Databricks recommends liquid clustering for all new Delta tables. The following are examples of scenarios that benefit from clustering:</p>
<ul class="simple">
<li><p>Tables often filtered by high cardinality columns.</p></li>
<li><p>Tables with significant skew in data distribution.</p></li>
<li><p>Tables that grow quickly and require maintenance and tuning effort.</p></li>
<li><p>Tables with concurrent write requirements.</p></li>
<li><p>Tables with access patterns that change over time.</p></li>
<li><p>Tables where a typical partition key could leave the table with too many or too few partitions.</p></li>
</ul>
</div>
<div class="section" id="enable-liquid-clustering">
<h2>Enable liquid clustering<a class="headerlink" href="#enable-liquid-clustering" title="Permalink to this headline"> </a></h2>
<p>You must enable Delta Lake liquid clustering when first creating a table. Clustering is not compatible with partitioning or <code class="docutils literal notranslate"><span class="pre">ZORDER</span></code>, and requires that the Databricks client manages all layout and optimization operations for data in your table. Once enabled, run <code class="docutils literal notranslate"><span class="pre">OPTIMIZE</span></code> jobs as normal to incrementally cluster data. See <a class="reference internal" href="#optimize"><span class="std std-ref">How to trigger clustering</span></a>.</p>
<p>To enable liquid clustering, add the <code class="docutils literal notranslate"><span class="pre">CLUSTER</span> <span class="pre">BY</span></code> phrase to a table creation statement, as in the examples below:</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="c1">-- Create an empty table</span>
<span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">table1</span><span class="p">(</span><span class="n">col0</span><span class="w"> </span><span class="nb">int</span><span class="p">,</span><span class="w"> </span><span class="n">col1</span><span class="w"> </span><span class="n">string</span><span class="p">)</span><span class="w"> </span><span class="k">USING</span><span class="w"> </span><span class="n">DELTA</span><span class="w"> </span><span class="k">CLUSTER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="p">(</span><span class="n">col0</span><span class="p">);</span>

<span class="c1">-- Using a CTAS statement</span>
<span class="k">CREATE</span><span class="w"> </span><span class="k">EXTERNAL</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">table2</span><span class="w"> </span><span class="k">CLUSTER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="p">(</span><span class="n">col0</span><span class="p">)</span><span class="w">  </span><span class="c1">-- specify clustering after table name, not in subquery</span>
<span class="k">LOCATION</span><span class="w"> </span><span class="err">‘</span><span class="n">table_location</span><span class="err">’</span>
<span class="k">AS</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">table1</span><span class="p">;</span>

<span class="c1">-- Using a LIKE statement to copy configurations</span>
<span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">table3</span><span class="w"> </span><span class="k">LIKE</span><span class="w"> </span><span class="n">table1</span><span class="p">;</span>
</pre></div>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Tables created with liquid clustering enabled have numerous Delta table features enabled at creation and use Delta writer version 7 and reader version 3. Table protocol versions cannot be downgraded, and tables with clustering enabled are not readable by Delta Lake clients that do not support all enabled Delta reader protocol table features. See <a class="reference internal" href="feature-compatibility.html"><span class="doc">How does Databricks manage Delta Lake feature compatibility?</span></a>.</p>
</div>
</div>
<div class="section" id="choose-clustering-keys">
<h2>Choose clustering keys<a class="headerlink" href="#choose-clustering-keys" title="Permalink to this headline"> </a></h2>
<p>Databricks recommends choosing clustering keys based on commonly used query filters. Clustering keys can be defined in any order. If two columns are correlated, you only need to add one of them as a clustering key.</p>
<p>If you’re converting an existing table, consider the following recommendations:</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 48%" />
<col style="width: 52%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Current data optimization technique</p></th>
<th class="head"><p>Recommendation for clustering keys</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p> Hive-style partitioning</p></td>
<td><p> Use partition columns as clustering keys.</p></td>
</tr>
<tr class="row-odd"><td><p> Z-order indexing</p></td>
<td><p> Use the <code class="docutils literal notranslate"><span class="pre">ZORDER</span> <span class="pre">BY</span></code> columns as clustering keys.</p></td>
</tr>
<tr class="row-even"><td><p> Hive-style partitioning and Z-order</p></td>
<td><p> Use both partition columns and <code class="docutils literal notranslate"><span class="pre">ZORDER</span> <span class="pre">BY</span></code> columns as clustering keys.</p></td>
</tr>
<tr class="row-odd"><td><p> Generated columns to reduce cardinality (for example, date for a timestamp)</p></td>
<td><p> Use the original column as a clustering key, and don’t create a generated column.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="write-data-to-a-clustered-table">
<h2>Write data to a clustered table<a class="headerlink" href="#write-data-to-a-clustered-table" title="Permalink to this headline"> </a></h2>
<p>You must use a Delta writer client that supports all Delta write protocol table features used by liquid clustering. On Databricks, you must use Databricks Runtime 13.3 LTS and above.</p>
<p>Most operations do not automatically cluster data on write. Operations that cluster on write include the following:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">INSERT</span> <span class="pre">INTO</span></code> operations</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">CTAS</span></code> statements</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">COPY</span> <span class="pre">INTO</span></code> from Parquet format</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">spark.write.format(&quot;delta&quot;).mode(&quot;append&quot;)</span></code></p></li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Clustering on write is a best effort application, and is not applied in the following situations:</p>
<ul class="simple">
<li><p>If a write operation exceeds 512GB of data.</p></li>
<li><p>If the <code class="docutils literal notranslate"><span class="pre">SELECT</span></code> subquery contains a transformation, filter, or join.</p></li>
<li><p>If projected columns are not the same as the source table.</p></li>
</ul>
<p>Because not all operations apply liquid clustering, Databricks recommends frequently running <code class="docutils literal notranslate"><span class="pre">OPTIMIZE</span></code> to ensure that all data is efficiently clustered.</p>
</div>
</div>
<div class="section" id="how-to-trigger-clustering">
<span id="optimize"></span><h2>How to trigger clustering<a class="headerlink" href="#how-to-trigger-clustering" title="Permalink to this headline"> </a></h2>
<p>To trigger clustering, you must use Databricks Runtime 13.3 LTS or above. Use the <code class="docutils literal notranslate"><span class="pre">OPTIMIZE</span></code> command on your table, as in the following example:</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="n">OPTIMIZE</span><span class="w"> </span><span class="k">table_name</span><span class="p">;</span>
</pre></div>
</div>
<p>Liquid clustering is incremental, meaning that data is only rewritten as necessary to accommodate data that needs to be clustered. Data files with clustering keys that do not match data to be clustered are not rewritten.</p>
<p>For best performance, Databricks recommends scheduling regular <code class="docutils literal notranslate"><span class="pre">OPTIMIZE</span></code> jobs to cluster data. For tables experiencing many updates or inserts, Databricks recommends scheduling an <code class="docutils literal notranslate"><span class="pre">OPTIMIZE</span></code> job every one or two hours. Because liquid clustering is incremental, most <code class="docutils literal notranslate"><span class="pre">OPTIMIZE</span></code> jobs for clustered tables run quickly.</p>
<p></p>
</div>
<div class="section" id="read-data-from-a-clustered-table">
<h2>Read data from a clustered table<a class="headerlink" href="#read-data-from-a-clustered-table" title="Permalink to this headline"> </a></h2>
<p>You can read data in a clustered table using any Delta Lake client that supports reading deletion vectors. For best query results, include clustering keys in your query filters, as in the following example:</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="k">table_name</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">cluster_key_column_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">&quot;some_value&quot;</span><span class="p">;</span>
</pre></div>
</div>
</div>
<div class="section" id="change-clustering-keys">
<h2>Change clustering keys<a class="headerlink" href="#change-clustering-keys" title="Permalink to this headline"> </a></h2>
<p>You can change clustering keys for a table at any time by running an <code class="docutils literal notranslate"><span class="pre">ALTER</span> <span class="pre">TABLE</span></code> command, as in the following example:</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">ALTER</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="k">table_name</span><span class="w"> </span><span class="k">CLUSTER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="p">(</span><span class="n">new_column1</span><span class="p">,</span><span class="w"> </span><span class="n">new_column2</span><span class="p">);</span>
</pre></div>
</div>
<p>When you change clustering keys, subsequent <code class="docutils literal notranslate"><span class="pre">OPTIMIZE</span></code> and write operations use the new clustering approach, but existing data is not rewritten.</p>
<p>You can also turn off clustering by setting the keys to <code class="docutils literal notranslate"><span class="pre">NONE</span></code>, as in the following example:</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">ALTER</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="k">table_name</span><span class="w"> </span><span class="k">CLUSTER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="k">NONE</span><span class="p">;</span>
</pre></div>
</div>
<p>Setting cluster keys to <code class="docutils literal notranslate"><span class="pre">NONE</span></code> does not rewrite data that has already been clustered, but prevents future <code class="docutils literal notranslate"><span class="pre">OPTIMIZE</span></code> operations from using clustering keys.</p>
</div>
<div class="section" id="see-how-table-is-clustered">
<h2>See how table is clustered<a class="headerlink" href="#see-how-table-is-clustered" title="Permalink to this headline"> </a></h2>
<p>You can use <code class="docutils literal notranslate"><span class="pre">DESCRIBE</span></code> commands to see the clustering keys for a table, as in the following examples:</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">DESCRIBE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="k">table_name</span><span class="p">;</span>

<span class="k">DESCRIBE</span><span class="w"> </span><span class="n">DETAIL</span><span class="w"> </span><span class="k">table_name</span><span class="p">;</span>
</pre></div>
</div>
</div>
<div class="section" id="compatibility-for-tables-with-liquid-clustering">
<span id="compatibility"></span><h2>Compatibility for tables with liquid clustering<a class="headerlink" href="#compatibility-for-tables-with-liquid-clustering" title="Permalink to this headline"> </a></h2>
<p>Databricks recommends using Databricks Runtime 13.3 LTS or above for all workloads that read or write from tables with liquid clustering enabled.</p>
<p>Some support for creating and writing tables with liquid clustering exists in Databricks Runtime 13.2. Because Databricks Runtime 13.3 LTS introduces critical bug fixes and major feature improvements, Databricks does not recommend using Databricks Runtime 13.2 to create or write tables with liquid clustering.</p>
<p>Tables created with liquid clustering in Databricks Runtime 14.1 and above use v2 checkpoints by default. You can read and write tables with v2 checkpoints in Databricks Runtime 13.3 LTS and above.</p>
<p>You can disable v2 checkpoints and downgrade table protocols to read tables with liquid clustering in Databricks Runtime 12.1 and above. See <a class="reference internal" href="drop-feature.html"><span class="doc">Drop Delta table features</span></a>.</p>
</div>
<div class="section" id="limitations">
<h2>Limitations<a class="headerlink" href="#limitations" title="Permalink to this headline"> </a></h2>
<p>The following limitations exist:</p>
<ul class="simple">
<li><p>You can only specify columns with statistics collected for clustering keys. By default, the first 32 columns in a Delta table have statistics collected.</p></li>
<li><p>You can specify up to 4 columns as clustering keys.</p></li>
<li><p>Structured Streaming workloads do not support clustering-on-write.</p></li>
</ul>
</div>
</div>


    
          </div>
        </div>
        <div  class="suapp-rating">
  <div id="suPageRateApp">
     <su-app></su-app>
   </div> 
 </div>
<hr> 
<footer>
  <div role="contentinfo">
      <p class="copyright">
          &copy; Databricks 2023. All rights reserved. Apache, Apache Spark, Spark, and the Spark logo are trademarks of the <a href="http://www.apache.org/">Apache Software Foundation</a>.
      </p>
      <p> 
        
          <a id='feedbacklink' href="mailto:doc-feedback@databricks.com?subject=Documentation Feedback">Send us feedback</a>
        
     | <a href="https://databricks.com/privacy-policy">Privacy Policy</a> | <a href="https://databricks.com/terms-of-use">Terms of Use</a></p>

  </div> 

</footer>
      </div>
    </div>
  </section>
</main>

  </page>
  
  <script type="text/javascript">
    var DOCUMENTATION_OPTIONS = {
      URL_ROOT: '../',
      VERSION: '1.0',
      COLLAPSE_INDEX: false,
      FILE_SUFFIX: '.html',
      HAS_SOURCE: 'false'
    };
  </script>
  <script type="text/javascript" src="../_static/jquery.js"></script>
  <script type="text/javascript" src="../_static/underscore.js"></script>
  <script type="text/javascript" src="../_static/doctools.js"></script>
  <script type="text/javascript" src="../_static/language_data.js"></script>
  

  <script type="text/javascript" src="../_static/js/clipboard.min.js"></script>
  <script type="text/javascript" src="../_static/js/jquery.waypoints.min.js"></script>

  <!-- Select2 (https://select2.org/) -->
  <link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />
  <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
  <!-- End Select2 -->

  
  
  <script type="text/javascript" src="../_static/js/localized.js"></script>
  <script type="text/javascript" src="../_static/js/custom.js"></script>
  

  
  
  <script type="text/javascript">
    jQuery(function () {
      SphinxRtdTheme.StickyNav.enable();
    });

  </script>
  
 



  <script>
  window.__searchunifyLoaderConfig = JSON.parse('{"clients": {"en": "02c2e804-27e9-11ee-aefb-0242ac120011", "ja": "6a42c3f2-2820-11ee-aefb-0242ac120011", "pt": "6a86badd-2821-11ee-aefb-0242ac120011"}}')
</script>
<script type="text/javascript" src="../_static/js/search-loader.js"></script>
</body>
<script type='text/javascript'>
  window.onload = function () {
    var description = document.querySelector('meta[name="description"]').getAttribute("content");
    let titleText = document.querySelector('h1').textContent;
    document.querySelector('meta[property="og:title"]').setAttribute("content", titleText);
    document.querySelector('meta[property="og:description"]').setAttribute("content", description);
    document.querySelector('meta[property="twitter:description"]').setAttribute("content", description);
  };
</script>

</html>