

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en-US" > <![endif]-->
<!--[if gt IE 8]><!-->
<html class="no-js" lang="en-US"> <!--<![endif]-->

<head>
  <!-- cookie consent -->
  
    <!-- Combined Onetrust and Rudderstack Implementation Scripts -->
    <!-- Onetrust Initialization -->
    <script type="text/javascript" src="https://cdn.cookielaw.org/consent/92466579-1717-44d3-809d-a05fb02843ed-test/OtAutoBlock.js"></script>
    <script src="https://cdn.cookielaw.org/scripttemplates/otSDKStub.js" data-document-language="true" type="text/javascript" charset="UTF-8" data-domain-script="92466579-1717-44d3-809d-a05fb02843ed-test"></script>
    <link rel="stylesheet" id="db-onetrust-style" href="https://www.databricks.com/wp-content/uploads/db_onetrust.css" media="all" />
    <!-- Setting Rudderstack Write Key -->
    <script>window.rudderstackKey = "2SOR9fvSr5Fi6tN2ihPbVHnX1SZ" </script>
    <!-- Rudderstack Initialization + Onetrust Integration + Rudderstack Custom Events -->
    <script type="text/javascript" src="https://www.databricks.com/sites/default/files/rudderstack/v1/db-rudderstack-events.js"></script>

  <!-- cookie consent -->

  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta http-equiv="X-UA-Compatible" content="IE=9" />
  <meta content="Learn about retrieval augmented generation (RAG) on Databricks to achieve greater large language model (LLM) accuracy with your own data." name="description" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0">
  <meta property="og:image" content="https://www.databricks.com/wp-content/uploads/2020/04/og-databricks.png">
  <meta property="og:image:type" content="image/png">
  <meta property="og:title" content="Retrieval Augmented Generation (RAG) on Databricks">
  <meta property="og:image:width" content="1200">
  <meta property="og:image:height" content="630">
  <meta property="og:type" content="website">
  <meta property="og:url" content="https://docs.databricks.com">
  <meta property="og:description" content="" id="og-description">
  <meta name="twitter:image" content="https://www.databricks.com/wp-content/uploads/2020/04/og-databricks.png">
  <meta name="twitter:site" content="@databricks">
  <meta name="twitter:creator" content="@databricks">
  <meta property="twitter:description" content="">
  
  <title>Retrieval Augmented Generation (RAG) on Databricks &#124; Databricks on AWS</title>
  
  
  <link rel="canonical" href="https://docs.databricks.com/en/generative-ai/retrieval-augmented-generation.html">
  <!-- Start hreflang tag -->
  <link rel="alternate" hreflang="en" href="https://docs.databricks.com/en/generative-ai/retrieval-augmented-generation.html" />
<link rel="alternate" hreflang="x-default" href="https://docs.databricks.com/en/generative-ai/retrieval-augmented-generation.html" />
  <!-- End hreflang tag -->
  
  
  <link rel="shortcut icon" href="../_static/favicon.ico" />
  

  

  

  <!-- Google Tag Manager -->
  <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'https://www.googletagmanager.com/gtm.js?id='+i+dl;
j.setAttributeNode(d.createAttribute('data-ot-ignore'));
f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-T85FQ33');</script>
  <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'https://www.googletagmanager.com/gtm.js?id='+i+dl;
j.setAttributeNode(d.createAttribute('data-ot-ignore'));
f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-TWTKQQ');</script>
    
  <!-- End Google Tag Manager -->


  <!-- MaxMind / GEO IP -->
  <script src="//js.maxmind.com/js/apis/geoip2/v2.1/geoip2.js" type="text/javascript"></script>
  <!-- End MaxMind / GEO IP -->

  
  
  <link href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,600&display=swap" rel="stylesheet">
  <link rel="preload" href="../_static/fonts/DMSans-Bold.ttf" as="font">
  <link rel="preload" href="../_static/fonts/DMSans-Regular.ttf" as="font">
  <link rel="preload" href="../_static/fonts/DMMono-Regular.ttf" as="font">
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/css/custom.css" type="text/css" />
  <link rel="stylesheet" href="../_static/css/cloud-provider-selector.css" type="text/css" />
  <link rel="stylesheet" href="../_static/css/translation-selector.css" type="text/css" />
  <link rel="stylesheet" href="../_static/css/searchunify/main.css" type="text/css" />

  
  <link rel="index" title="Index" href="../genindex.html" />
  <link rel="search" title="Search" href="../search.html" />
  <link rel="top" title="Databricks on AWS" href="../index.html" /> 
</head>

<body class="wy-body-for-nav" role="document">

  <!-- Google Tag Manager (noscript) -->
  <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-T85FQ33"
height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
  <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-TWTKQQ"
    height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
  <!-- End Google Tag Manager (noscript) -->

  
  <nav class="wy-nav-top header su_header" role="navigation" aria-label="top navigation">
    
<nav class="wy-nav-top header su_header" role="navigation" aria-label="top navigation">
  <div class="container-logo">
    <ul class="mobile-menu-toggle">
        <li class="menu-toggle">
            <i data-toggle="wy-nav-top" class="wy-nav-top-menu-button db-icon db-icon-menu pull-left"></i>
            
            <a href="https://www.databricks.com/" class="wy-nav-top-logo"><img src="../_static/small-scale-lockup-full-color-rgb.svg" width="137" height="21"
              alt="Databricks" /></a>   
               
              </li>
    </ul>
    <ul class="su_nav-menu">
      <li class="menu-toggle">
        <i data-toggle="wy-nav-top" class="wy-nav-top-menu-button db-icon db-icon-menu pull-left"></i>
        
          
        
        <a href="https://www.databricks.com/" class="wy-nav-top-logo"><img src="../_static/small-scale-lockup-full-color-rgb.svg" width="137" height="21"
            alt="Databricks" /></a></li>
        <!-- 
<li><a href="https://help.databricks.com/s/">Help Center</a></li>
<li class="active"><a href="https://docs.databricks.com/en/">Documentation</a></li>
<li><a href="https://kb.databricks.com/">Knowledge Base</a></li>
 -->
    </ul>
  </div>
  <div class="su_nav-right">
    <ul class="su_link-mobile">
  <!-- Mobile header code can go here -->
</ul>
<ul class="right-try-list">
   
</ul>
  </div>
</nav>
  </nav>

  <div class="su_sub-header">
    <div class="container">
      <div class="su_sub-header-inner">
        <!-- <div class="su_subnav-menu-right">
  <div id="auto" style="width: 100%;">
    <div ng-controller="SearchautoController">
      <div bind-html-compile="autocompleteHtml">
        <form class="su__search-box-1" disabled="disabled">
          <input class="su__search-input" type="search" name="Search box" id="su__search-b" placeholder="Search Documentation" disabled="disabled"/>
          <button class="su__search-button" type="submit" class="button button-success" disabled="disabled">
            <svg width="24" height="24" viewBox="0 0 24 24">
              <path
                d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"
                fill="#333"></path>
            </svg>
          </button>
        </form>
      </div>
    </div>
  </div>
</div> -->
        <div class="search-lng-gap"></div>
        <div style="margin-left: 16px; margin-right: 16px;">
          <!-- <select name="lng selector" id="lng-selector">
    <option value="../../en/generative-ai/retrieval-augmented-generation.html" class="notranslate">English</option>
    <option value="../../ja/generative-ai/retrieval-augmented-generation.html" class="notranslate">日本語</option>
    <option value="../../pt/generative-ai/retrieval-augmented-generation.html" class="notranslate">Português (Brasil)</option>
</select> -->
        </div>
        <div class="cloud-selector-container">
          <!-- <select name="cloud provider selector" id="cloud-provider-selector">
    <option value="aws" selected class="notranslate">
        Amazon Web Services
    </option>
    <option value="azure"  class="notranslate">
        Microsoft Azure
    </option>
    <option value="gcp"  class="notranslate">
        Google Cloud Platform
    </option>
</select> -->
        </div>
      </div>
    </div>
  </div>
  <page class="js-page-container">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side su_nav-side">
<div class="wy-side-scroll">
  <div class="wy-side-nav-search">
    

    

    

    
  </div>

  <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
    
      <a href="../index.html" class="main-navigation-home">Databricks on AWS</a>
    

    
      

      
        <p class="caption"><span class="caption-text">Load &amp; manage data</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../rag-temp/index.html">RAG Studio</a></li>
</ul>

      
    
  </div>

  <div role="contentinfo">
    
  <p class="build_info notranslate"data-last-edit="December 23, 2023">
    Updated Jan 11, 2024
  </p>
<script>
  window.addEventListener('DOMContentLoaded',function(){
    var h1=document.querySelector('h1');
    var bi=document.querySelector('[data-last-edit]');
    if(h1 && bi){
      var ver = document.createElement('p');
      ver.className = 'version_info';
      ver.textContent = bi.getAttribute('data-last-edit');
      h1.parentElement.insertBefore(ver, h1.nextElementSibling);
    }
  });
</script>

    <p>
      
        <a id='feedbacklink' href="mailto:doc-feedback@databricks.com?subject=Documentation Feedback">Send us feedback</a>
      
    </p>
  </div>
</div>
</nav>
    
    
<main class="wy-grid-for-nav su_nav-grid">
  <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
    <div class="wy-nav-content su__nav_content">
      <div class="rst-content">
        





<div role="navigation" aria-label="breadcrumbs navigation" class="wy-breadcrumbs-wrapper">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html">Documentation</a> <span class="db-icon db-icon-chevron-right"></span></li>
    
    
      <li>Retrieval Augmented Generation (RAG) on Databricks</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>
</div>
        
        <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
          <div itemprop="articleBody">
            
    
  <div class="section" id="retrieval-augmented-generation-rag-on-databricks">
<h1>Retrieval Augmented Generation (RAG) on Databricks<a class="headerlink" href="#retrieval-augmented-generation-rag-on-databricks" title="Permalink to this headline"> </a></h1>
<p>This article provides an overview of retrieval augmented generation (RAG) and describes RAG application support in Databricks.</p>
<div class="section" id="what-is-retrieval-augmented-generation">
<h2>What is Retrieval Augmented Generation?<a class="headerlink" href="#what-is-retrieval-augmented-generation" title="Permalink to this headline"> </a></h2>
<p>RAG is a <a class="reference external" href="/generative-ai/generative-ai">generative AI design pattern</a> that involves combining a large language model (LLM) with external knowledge retrieval. RAG is required to connect real-time data to your generative AI applications. Doing so improves the accuracy and quality of the application, by providing your data as context to the LLM at inference time.</p>
<p>The Databricks platform provides an integrated set of tools that supports the following RAG scenarios.</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 11%" />
<col style="width: 68%" />
<col style="width: 21%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Type of RAG</p></th>
<th class="head"><p>Description</p></th>
<th class="head"><p>Example use case</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p> Unstructured data</p></td>
<td><p> Use of documents - PDFs, wikis, website contents, Google or Microsoft Office documents, and so on.</p></td>
<td><p>  Chatbot over product documentation</p></td>
</tr>
<tr class="row-odd"><td><p> Structured data</p></td>
<td><p> Use of tabular data - Delta Tables, data from existing application APIs.</p></td>
<td><p> Chatbot to check order status</p></td>
</tr>
<tr class="row-even"><td><p> Tools &amp; function calling</p></td>
<td><p> Call third party or internal APIs to perform specific tasks or update statuses.  For example, performing calculations or triggering a business workflow.</p></td>
<td><p> Chatbot to place an order</p></td>
</tr>
<tr class="row-odd"><td><p> Agents</p></td>
<td><p> Dynamically decide how to respond to a user’s query by using an LLM to choose a sequence of actions.</p></td>
<td><p> Chatbot that replaces a customer service agent</p></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="rag-application-architecture">
<h2>RAG application architecture<a class="headerlink" href="#rag-application-architecture" title="Permalink to this headline"> </a></h2>
<p>The following illustrates the components that make up a RAG application.</p>
<div class="figure align-default">
<img alt="RAG application architecture all up" src="../_images/rag-app-architecture-all-up.png" />
</div>
<p>RAG applications require a pipeline and a chain component to perform the following:</p>
<ul class="simple">
<li><p><strong>Indexing</strong> A pipeline that ingests data from a source and indexes it. This data can be structured or unstructured.</p></li>
<li><p><strong>Retrieval and generation</strong> This is the actual RAG chain. It takes the user query and retrieves similar data from the index, then passes the data, along with the query, to the LLM model.</p></li>
</ul>
<p>The below diagram demonstrates these core components:</p>
<div class="figure align-default">
<img alt="RAG application architecture for just the indexing pipeline and retrieval and generation, the RAG chain, pieces of RAG. The top section shows the RAG chain consuming the query and the subsequent steps of query processing, query expansion, retrieval and re-ranking, prompt engineering, initial response generation and post-processing, all before generating a response to the query. The bottom portion shows the RAG chain connected to separate data pipelines for 1. unstructured data, which includes data parsing, chunking and embedding and storing that data in a vector search database or index. Unstructured data pipelines require interaction with embedding and foundational models to feed into the RAG chain and 2. structured data pipelines, which includes consuming already embedded data chunks and performing ETL tasks and feature engineering before serving this data to the RAG chain" src="../_images/rag-app-architecture.png" />
</div>
</div>
<div class="section" id="unstructured-data-rag-example">
<h2>Unstructured data RAG example<a class="headerlink" href="#unstructured-data-rag-example" title="Permalink to this headline"> </a></h2>
<p>The following sections describe the details of the indexing pipeline and RAG chain in the context of an unstructured data RAG example.</p>
<div class="section" id="indexing-pipeline-in-a-rag-app">
<h3>Indexing pipeline in a RAG app<a class="headerlink" href="#indexing-pipeline-in-a-rag-app" title="Permalink to this headline"> </a></h3>
<p>The following steps describe the indexing pipeline:</p>
<ol class="arabic simple">
<li><p>Ingest data from your proprietary data source.</p></li>
<li><p>Split the data into chunks that can fit into the context window of the foundational LLM. This step also includes parsing the data and extracting metadata. This data is commonly referred to as a knowledge base that the foundational LLM is trained on.</p></li>
<li><p>Use an embedding model to create vector embeddings for the data chunks.</p></li>
<li><p>Store the embeddings and metadata in a vector database to make them accessible for querying by the RAG chain.</p></li>
</ol>
</div>
<div class="section" id="retrieval-using-the-rag-chain">
<h3>Retrieval using the RAG chain<a class="headerlink" href="#retrieval-using-the-rag-chain" title="Permalink to this headline"> </a></h3>
<p>After the index is prepared, the RAG chain of the application can be served to respond to questions. The following steps and diagram describe how the RAG application responds to an incoming request.</p>
<ol class="arabic simple">
<li><p>Embed the request using the same embedding model that was used to embed the data in the knowledge base.</p></li>
<li><p>Query the vector database to do a similarity search between the embedded request and the embedded data chunks in the vector database.</p></li>
<li><p>Retrieve the data chunks that are most relevant to the request.</p></li>
<li><p>Feed the relevant data chunks and the request to a customized LLM. The data chunks provide context that helps the LLM generate an appropriate response. Often, the LLM has a template for how to format the response.</p></li>
<li><p>Generate a response.</p></li>
</ol>
<p>The following diagram illustrates this process:</p>
<div class="figure align-default">
<img alt="RAG workflow after a request" src="../_images/rag-workflow.png" />
</div>
</div>
</div>
<div class="section" id="develop-rag-applications-with-databricks">
<h2>Develop RAG applications with Databricks<a class="headerlink" href="#develop-rag-applications-with-databricks" title="Permalink to this headline"> </a></h2>
<p>Databricks provides the following capabilities to help you develop RAG applications.</p>
<ul class="simple">
<li><p><a class="reference internal" href="../data-governance/unity-catalog/index.html"><span class="doc">Unity Catalog</span></a> for governance, discovery, versioning, and access control for data, features, models, and functions.</p></li>
<li><p><a class="reference internal" href="../notebooks/index.html"><span class="doc">Notebooks</span></a> and <a class="reference internal" href="../workflows/index.html"><span class="doc">workflows</span></a> for data pipeline creation and orchestration.</p></li>
<li><p><a class="reference internal" href="../introduction/delta-comparison.html"><span class="doc">Delta tables</span></a> for storing structured data and unstructured data chunks and embeddings.</p></li>
<li><p><a class="reference internal" href="vector-search.html"><span class="doc">Vector search</span></a> provides a queryable vector database that stores embedding vectors and can be configured to automatically sync to your knowledge base.</p></li>
<li><p><a class="reference internal" href="../machine-learning/model-serving/index.html"><span class="doc">Databricks model serving</span></a> for deploying LLMs and hosting your RAG chain. You can configure a dedicated model serving endpoint specifically for accessing state-of-the-art open LLMs with <a class="reference internal" href="../machine-learning/foundation-models/index.html"><span class="doc">Foundation Model APIs</span></a> or third-party models with <a class="reference internal" href="external-models/index.html"><span class="doc">External models</span></a>.</p></li>
<li><p><a class="reference internal" href="../mlflow/tracking.html"><span class="doc">MLflow</span></a> for RAG chain development tracking and <a class="reference internal" href="../mlflow/llm-evaluate.html"><span class="doc">LLM evaluation</span></a>.</p></li>
<li><p><a class="reference internal" href="../machine-learning/feature-store/feature-function-serving.html"><span class="doc">Feature engineering and serving</span></a>. This typically applies for structured data RAG scenarios.</p></li>
<li><p><a class="reference internal" href="../machine-learning/feature-store/online-tables.html"><span class="doc">Online Tables</span></a>. You can serve online tables as a low-latency API to include the data in RAG applications.</p></li>
<li><p><a class="reference internal" href="../lakehouse-monitoring/index.html"><span class="doc">Lakehouse Monitoring</span></a> for data monitoring and tracking model prediction quality and drift using <a class="reference internal" href="../machine-learning/model-serving/inference-tables.html"><span class="doc">automatic payload logging with inference tables</span></a>.</p></li>
<li><p><a class="reference internal" href="../machine-learning/foundation-models/supported-models.html#playground"><span class="std std-ref">AI Playground</span></a>. A chat-based UI to test and compare LLMs.</p></li>
</ul>
</div>
<div class="section" id="rag-architecture-with-databricks">
<h2>RAG architecture with Databricks<a class="headerlink" href="#rag-architecture-with-databricks" title="Permalink to this headline"> </a></h2>
<p>The following architecture diagrams demonstrate where each Databricks feature fits in the RAG workflow. For an example, see the <a class="reference external" href="https://www.databricks.com/resources/demos/tutorials/data-science-and-ai/lakehouse-ai-deploy-your-llm-chatbot">Deploy Your LLM Chatbot With Retrieval Augmented Generation (RAG) demo</a>.</p>
<div class="section" id="process-unstructured-data-and-databricks-managed-embeddings">
<h3>Process unstructured data and Databricks-managed embeddings<a class="headerlink" href="#process-unstructured-data-and-databricks-managed-embeddings" title="Permalink to this headline"> </a></h3>
<p>For processing unstructured data and Databricks-managed embeddings, the following diagram steps and diagram show:</p>
<ol class="arabic simple">
<li><p>Data ingestion from your proprietary data source. You can store this data in a Delta Table or Unity Catalog Volume.</p></li>
<li><p>The data is then split into chunks that can fit into the context window of the foundational LLM. This step also includes parsing the data and extracting metadata. You can use Databricks Workflows, Databricks notebooks and Delta Live Tables to perform these tasks. This data is commonly referred to as a knowledge base that the foundational LLM is trained on.</p></li>
<li><p>The parsed and chunked data is then consumed by an embedding model to create vector embeddings. In this scenario, Databricks computes the embeddings for you as part of the Vector Search functionality which uses Model Serving to provide an embedding model.</p></li>
<li><p>After Vector Search computes embeddings, Databricks stores them in a Delta table.</p></li>
<li><p>Also as part of Vector Search, the embeddings and metadata are indexed and stored in a vector database to make them accessible for querying by the RAG chain. Vector Search automatically computes embeddings for new data that is added to the source data table and updates the vector search index.</p></li>
</ol>
<div class="figure align-default">
<img alt="RAG indexing pipeline processing unstructured data and Databricks managed embeddings. This diagram shows the RAG application architecture for just the indexing pipeline. " src="../_images/rag-unstructured-data-managed.png" />
</div>
</div>
<div class="section" id="process-unstructured-data-and-customer-managed-embeddings">
<h3>Process unstructured data and customer-managed embeddings<a class="headerlink" href="#process-unstructured-data-and-customer-managed-embeddings" title="Permalink to this headline"> </a></h3>
<p>For processing unstructured data and customer-managed embeddings, the following steps and diagram show:</p>
<ol class="arabic simple">
<li><p>Data ingestion from your proprietary data source. You can store this data in a Delta table or Unity Catalog Volume.</p></li>
<li><p>You can then split the data into chunks that can fit into the context window of the foundational LLM. This step also includes parsing the data and extracting metadata. You can use Databricks Workflows, Databricks Notebooks and Delta Live Tables to perform these tasks. This data is commonly referred to as a knowledge base that the foundational LLM is trained on.</p></li>
<li><p>Next, the parsed and chunked data can be consumed by an embedding model to create vector embeddings. In this scenario, you compute the embeddings yourself and can use Model Serving to serve an embedding model.</p></li>
<li><p>After you compute embeddings, you can store them in a Delta table, that can be synced with Vector Search.</p></li>
<li><p>As part of Vector Search, the embeddings and metadata are indexed and stored in a vector database to make them accessible for querying by the RAG chain. Vector Search automatically syncs new embeddings that are added to your Delta table and updates the vector search index.</p></li>
</ol>
<div class="figure align-default">
<img alt="RAG with Databricks unstructured data and self managed embeddings" src="../_images/rag-unstructured-data-self-managed.png" />
</div>
</div>
<div class="section" id="process-structured-data">
<h3>Process structured data<a class="headerlink" href="#process-structured-data" title="Permalink to this headline"> </a></h3>
<p>For processing structured data, the following steps and diagram show:</p>
<ol class="arabic simple">
<li><p>Data ingestion from your proprietary data source. You can store this data in a Delta table or Unity Catalog Volume.</p></li>
<li><p>For feature engineering you can use Databricks notebooks, Databricks workflows, and Delta Live Tables.</p></li>
<li><p>Create a feature table. A feature table is a Delta table in Unity Catalog that has a primary key.</p></li>
<li><p>Create an online table and host it on a feature serving endpoint. The endpoint automatically stays synced with the feature table.</p></li>
</ol>
<p>For an example notebook illustrating the use of online tables and feature serving for RAG applications, see the <a class="reference internal" href="../machine-learning/feature-store/online-tables.html#notebook-examples"><span class="std std-ref">Databricks online tables and feature serving endpoints for RAG example notebook</span></a>.</p>
<div class="figure align-default">
<img alt="RAG with Databricks structured data" src="../_images/rag-structured-data.png" />
</div>
</div>
<div class="section" id="rag-chain">
<h3>RAG chain<a class="headerlink" href="#rag-chain" title="Permalink to this headline"> </a></h3>
<p>After the index is prepared, the RAG chain of the application can be served to respond to questions. The following steps and diagram describe how the RAG chain operates in response to an incoming question.</p>
<ol class="arabic simple">
<li><p>The incoming question gets embedded using the same embedding model that was used to embed the data in the knowledge base. Model Serving is used to serve the embedding model.</p></li>
<li><p>After the question is embedded, you can use Vector Search to do a similarity search between the embedded question and the embedded data chunks in the vector database.</p></li>
<li><p>After Vector Search retrieves the data chunks that are most relevant to the request, those data chunks along with relevant features from Feature Serving and the embedded question are consumed in a customized LLM for post processing before it a response is generated.</p></li>
<li><p>The data chunks and features provide context that help the LLM generate an appropriate response. Often, the LLM has a template for how to format the response. Once again, Model Serving is used to serve the LLM. You can also use Unity Catalog and Lakehouse Monitoring to store logs and monitor the chain workflow, respectively.</p></li>
<li><p>Generate a response.</p></li>
</ol>
<div class="figure align-default">
<img alt="Running the chain" src="../_images/rag-chain.png" />
</div>
</div>
</div>
<div class="section" id="region-availability">
<span id="unstructured-data-rag-example"></span><h2>Region availability<a class="headerlink" href="#region-availability" title="Permalink to this headline"> </a></h2>
<p>The features that support RAG application development on Databricks are available in the <a class="reference internal" href="../resources/supported-regions.html"><span class="doc">same regions as model serving</span></a>.</p>
<p>If you plan on using Foundation Model APIs as part of your RAG application development, you are limited to the <a class="reference internal" href="../machine-learning/foundation-models/index.html#required"><span class="std std-ref">supported regions for Foundation Model APIs</span></a>.</p>
</div>
</div>


    
          </div>
        </div>
        <div  class="suapp-rating">
  <div id="suPageRateApp">
     <su-app></su-app>
   </div> 
 </div>
<hr> 
<footer>
  <div role="contentinfo">
      <p class="copyright">
          &copy; Databricks 2023. All rights reserved. Apache, Apache Spark, Spark, and the Spark logo are trademarks of the <a href="http://www.apache.org/">Apache Software Foundation</a>.
      </p>
      <p> 
        
          <a id='feedbacklink' href="mailto:doc-feedback@databricks.com?subject=Documentation Feedback">Send us feedback</a>
        
     | <a href="https://databricks.com/privacy-policy">Privacy Policy</a> | <a href="https://databricks.com/terms-of-use">Terms of Use</a></p>

  </div> 

</footer>
      </div>
    </div>
  </section>
</main>

  </page>
  
  <script type="text/javascript">
    var DOCUMENTATION_OPTIONS = {
      URL_ROOT: '../',
      VERSION: '1.0',
      COLLAPSE_INDEX: false,
      FILE_SUFFIX: '.html',
      HAS_SOURCE: 'false'
    };
  </script>
  <script type="text/javascript" src="../_static/jquery.js"></script>
  <script type="text/javascript" src="../_static/underscore.js"></script>
  <script type="text/javascript" src="../_static/doctools.js"></script>
  <script type="text/javascript" src="../_static/language_data.js"></script>
  

  <script type="text/javascript" src="../_static/js/clipboard.min.js"></script>
  <script type="text/javascript" src="../_static/js/jquery.waypoints.min.js"></script>

  <!-- Select2 (https://select2.org/) -->
  <link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />
  <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
  <!-- End Select2 -->

  
  
  <script type="text/javascript" src="../_static/js/localized.js"></script>
  <script type="text/javascript" src="../_static/js/custom.js"></script>
  

  
  
  <script type="text/javascript">
    jQuery(function () {
      SphinxRtdTheme.StickyNav.enable();
    });

  </script>
  
 



  <script>
  window.__searchunifyLoaderConfig = JSON.parse('{"clients": {"en": "02c2e804-27e9-11ee-aefb-0242ac120011", "ja": "6a42c3f2-2820-11ee-aefb-0242ac120011", "pt": "6a86badd-2821-11ee-aefb-0242ac120011"}}')
</script>
<script type="text/javascript" src="../_static/js/search-loader.js"></script>
</body>
<script type='text/javascript'>
  window.onload = function () {
    var description = document.querySelector('meta[name="description"]').getAttribute("content");
    let titleText = document.querySelector('h1').textContent;
    document.querySelector('meta[property="og:title"]').setAttribute("content", titleText);
    document.querySelector('meta[property="og:description"]').setAttribute("content", description);
    document.querySelector('meta[property="twitter:description"]').setAttribute("content", description);
  };
</script>

</html>