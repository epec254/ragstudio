

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en-US" > <![endif]-->
<!--[if gt IE 8]><!-->
<html class="no-js" lang="en-US"> <!--<![endif]-->

<head>
  <!-- cookie consent -->
  
    <!-- Combined Onetrust and Rudderstack Implementation Scripts -->
    <!-- Onetrust Initialization -->
    <script type="text/javascript" src="https://cdn.cookielaw.org/consent/92466579-1717-44d3-809d-a05fb02843ed-test/OtAutoBlock.js"></script>
    <script src="https://cdn.cookielaw.org/scripttemplates/otSDKStub.js" data-document-language="true" type="text/javascript" charset="UTF-8" data-domain-script="92466579-1717-44d3-809d-a05fb02843ed-test"></script>
    <link rel="stylesheet" id="db-onetrust-style" href="https://www.databricks.com/wp-content/uploads/db_onetrust.css" media="all" />
    <!-- Setting Rudderstack Write Key -->
    <script>window.rudderstackKey = "2SOR9fvSr5Fi6tN2ihPbVHnX1SZ" </script>
    <!-- Rudderstack Initialization + Onetrust Integration + Rudderstack Custom Events -->
    <script type="text/javascript" src="https://www.databricks.com/sites/default/files/rudderstack/v1/db-rudderstack-events.js"></script>

  <!-- cookie consent -->

  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta http-equiv="X-UA-Compatible" content="IE=9" />
  <meta content="Learn about legacy visualizations in Databricks." name="description" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0">
  <meta property="og:image" content="https://www.databricks.com/wp-content/uploads/2020/04/og-databricks.png">
  <meta property="og:image:type" content="image/png">
  <meta property="og:title" content="Legacy visualizations">
  <meta property="og:image:width" content="1200">
  <meta property="og:image:height" content="630">
  <meta property="og:type" content="website">
  <meta property="og:url" content="https://docs.databricks.com">
  <meta property="og:description" content="" id="og-description">
  <meta name="twitter:image" content="https://www.databricks.com/wp-content/uploads/2020/04/og-databricks.png">
  <meta name="twitter:site" content="@databricks">
  <meta name="twitter:creator" content="@databricks">
  <meta property="twitter:description" content="">
  
  <title>Legacy visualizations &#124; Databricks on AWS</title>
  
  
  <link rel="canonical" href="https://docs.databricks.com/en/visualizations/legacy-visualizations.html">
  <!-- Start hreflang tag -->
  <link rel="alternate" hreflang="en" href="https://docs.databricks.com/en/visualizations/legacy-visualizations.html" />
<link rel="alternate" hreflang="x-default" href="https://docs.databricks.com/en/visualizations/legacy-visualizations.html" />
  <!-- End hreflang tag -->
  
  
  <link rel="shortcut icon" href="../_static/favicon.ico" />
  

  

  

  <!-- Google Tag Manager -->
  <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'https://www.googletagmanager.com/gtm.js?id='+i+dl;
j.setAttributeNode(d.createAttribute('data-ot-ignore'));
f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-T85FQ33');</script>
  <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'https://www.googletagmanager.com/gtm.js?id='+i+dl;
j.setAttributeNode(d.createAttribute('data-ot-ignore'));
f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-TWTKQQ');</script>
    
  <!-- End Google Tag Manager -->


  <!-- MaxMind / GEO IP -->
  <script src="//js.maxmind.com/js/apis/geoip2/v2.1/geoip2.js" type="text/javascript"></script>
  <!-- End MaxMind / GEO IP -->

  
  
  <link href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,600&display=swap" rel="stylesheet">
  <link rel="preload" href="../_static/fonts/DMSans-Bold.ttf" as="font">
  <link rel="preload" href="../_static/fonts/DMSans-Regular.ttf" as="font">
  <link rel="preload" href="../_static/fonts/DMMono-Regular.ttf" as="font">
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/css/custom.css" type="text/css" />
  <link rel="stylesheet" href="../_static/css/cloud-provider-selector.css" type="text/css" />
  <link rel="stylesheet" href="../_static/css/translation-selector.css" type="text/css" />
  <link rel="stylesheet" href="../_static/css/searchunify/main.css" type="text/css" />

  
  <link rel="index" title="Index" href="../genindex.html" />
  <link rel="search" title="Search" href="../search.html" />
  <link rel="top" title="Databricks on AWS" href="../index.html" /> 
</head>

<body class="wy-body-for-nav" role="document">

  <!-- Google Tag Manager (noscript) -->
  <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-T85FQ33"
height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
  <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-TWTKQQ"
    height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
  <!-- End Google Tag Manager (noscript) -->

  
  <nav class="wy-nav-top header su_header" role="navigation" aria-label="top navigation">
    
<nav class="wy-nav-top header su_header" role="navigation" aria-label="top navigation">
  <div class="container-logo">
    <ul class="mobile-menu-toggle">
        <li class="menu-toggle">
            <i data-toggle="wy-nav-top" class="wy-nav-top-menu-button db-icon db-icon-menu pull-left"></i>
            
            <a href="https://www.databricks.com/" class="wy-nav-top-logo"><img src="../_static/small-scale-lockup-full-color-rgb.svg" width="137" height="21"
              alt="Databricks" /></a>   
               
              </li>
    </ul>
    <ul class="su_nav-menu">
      <li class="menu-toggle">
        <i data-toggle="wy-nav-top" class="wy-nav-top-menu-button db-icon db-icon-menu pull-left"></i>
        
          
        
        <a href="https://www.databricks.com/" class="wy-nav-top-logo"><img src="../_static/small-scale-lockup-full-color-rgb.svg" width="137" height="21"
            alt="Databricks" /></a></li>
        <!-- 
<li><a href="https://help.databricks.com/s/">Help Center</a></li>
<li class="active"><a href="https://docs.databricks.com/en/">Documentation</a></li>
<li><a href="https://kb.databricks.com/">Knowledge Base</a></li>
 -->
    </ul>
  </div>
  <div class="su_nav-right">
    <ul class="su_link-mobile">
  <!-- Mobile header code can go here -->
</ul>
<ul class="right-try-list">
   
</ul>
  </div>
</nav>
  </nav>

  <div class="su_sub-header">
    <div class="container">
      <div class="su_sub-header-inner">
        <!-- <div class="su_subnav-menu-right">
  <div id="auto" style="width: 100%;">
    <div ng-controller="SearchautoController">
      <div bind-html-compile="autocompleteHtml">
        <form class="su__search-box-1" disabled="disabled">
          <input class="su__search-input" type="search" name="Search box" id="su__search-b" placeholder="Search Documentation" disabled="disabled"/>
          <button class="su__search-button" type="submit" class="button button-success" disabled="disabled">
            <svg width="24" height="24" viewBox="0 0 24 24">
              <path
                d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"
                fill="#333"></path>
            </svg>
          </button>
        </form>
      </div>
    </div>
  </div>
</div> -->
        <div class="search-lng-gap"></div>
        <div style="margin-left: 16px; margin-right: 16px;">
          <!-- <select name="lng selector" id="lng-selector">
    <option value="../../en/visualizations/legacy-visualizations.html" class="notranslate">English</option>
    <option value="../../ja/visualizations/legacy-visualizations.html" class="notranslate">日本語</option>
    <option value="../../pt/visualizations/legacy-visualizations.html" class="notranslate">Português (Brasil)</option>
</select> -->
        </div>
        <div class="cloud-selector-container">
          <!-- <select name="cloud provider selector" id="cloud-provider-selector">
    <option value="aws" selected class="notranslate">
        Amazon Web Services
    </option>
    <option value="azure"  class="notranslate">
        Microsoft Azure
    </option>
    <option value="gcp"  class="notranslate">
        Google Cloud Platform
    </option>
</select> -->
        </div>
      </div>
    </div>
  </div>
  <page class="js-page-container">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side su_nav-side">
<div class="wy-side-scroll">
  <div class="wy-side-nav-search">
    

    

    

    
  </div>

  <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
    
      <a href="../index.html" class="main-navigation-home">Databricks on AWS</a>
    

    
      

      
        <p class="caption"><span class="caption-text">Load &amp; manage data</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../rag-temp/index.html">RAG Studio</a></li>
</ul>

      
    
  </div>

  <div role="contentinfo">
    
  <p class="build_info notranslate"data-last-edit="December 23, 2023">
    Updated Jan 11, 2024
  </p>
<script>
  window.addEventListener('DOMContentLoaded',function(){
    var h1=document.querySelector('h1');
    var bi=document.querySelector('[data-last-edit]');
    if(h1 && bi){
      var ver = document.createElement('p');
      ver.className = 'version_info';
      ver.textContent = bi.getAttribute('data-last-edit');
      h1.parentElement.insertBefore(ver, h1.nextElementSibling);
    }
  });
</script>

    <p>
      
        <a id='feedbacklink' href="mailto:doc-feedback@databricks.com?subject=Documentation Feedback">Send us feedback</a>
      
    </p>
  </div>
</div>
</nav>
    
    
<main class="wy-grid-for-nav su_nav-grid">
  <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
    <div class="wy-nav-content su__nav_content">
      <div class="rst-content">
        





<div role="navigation" aria-label="breadcrumbs navigation" class="wy-breadcrumbs-wrapper">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html">Documentation</a> <span class="db-icon db-icon-chevron-right"></span></li>
    
    
      <li>Legacy visualizations</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>
</div>
        
        <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
          <div itemprop="articleBody">
            
    
  <div class="section" id="legacy-visualizations">
<h1>Legacy visualizations<a class="headerlink" href="#legacy-visualizations" title="Permalink to this headline"> </a></h1>
<p>This article describes legacy Databricks visualizations. See <a class="reference internal" href="index.html"><span class="doc">Visualizations in Databricks notebooks</span></a> for current visualization support.</p>
<p>Databricks also natively supports visualization libraries in Python and R and lets you install and use third-party libraries.</p>
<div class="section" id="create-a-legacy-visualization">
<span id="plot-types"></span><h2>Create a legacy visualization<a class="headerlink" href="#create-a-legacy-visualization" title="Permalink to this headline"> </a></h2>
<p>To create a legacy visualization from a results cell, click <strong>+</strong> and select <strong>Legacy Visualization</strong>.</p>
<p>Legacy visualizations support a rich set of plot types:</p>
<div class="figure align-default">
<img alt="Chart types" src="../_images/display-charts.png" />
</div>
<div class="section" id="choose-and-configure-a-legacy-chart-type">
<h3>Choose and configure a legacy chart type<a class="headerlink" href="#choose-and-configure-a-legacy-chart-type" title="Permalink to this headline"> </a></h3>
<p>To choose a bar chart, click the bar chart icon <img alt="Chart Button" src="../_images/chart-button.png" />:</p>
<div class="figure align-default">
<img alt="Bar chart icon" src="../_images/diamonds-bar-chart.png" />
</div>
<p>To choose another plot type, click <img alt="Button Down" src="../_images/button-down.png" /> to the right of the bar chart <img alt="Chart Button" src="../_images/chart-button.png" /> and choose the plot type.</p>
</div>
<div class="section" id="legacy-chart-toolbar">
<h3>Legacy chart toolbar<a class="headerlink" href="#legacy-chart-toolbar" title="Permalink to this headline"> </a></h3>
<p>Both line and bar charts have a built-in toolbar that support a rich set of client-side interactions.</p>
<div class="figure align-default">
<img alt="Chart toolbar" src="../_images/chart-toolbar.png" />
</div>
<p>To configure a chart, click <strong>Plot Options…</strong>.</p>
<div class="figure align-default">
<img alt="Plot options" src="../_images/plot-options.png" />
</div>
<p>The line chart has a few custom chart options: setting a Y-axis range, showing and hiding points, and displaying the Y-axis with a log scale.</p>
<p>For information about legacy chart types, see:</p>
<div class="toctree-wrapper compound">
<ul>
<li class="toctree-l1"><a class="reference internal" href="legacy-charts.html">Migrate legacy line charts</a></li>
</ul>
</div>
</div>
<div class="section" id="color-consistency-across-charts">
<h3>Color consistency across charts<a class="headerlink" href="#color-consistency-across-charts" title="Permalink to this headline"> </a></h3>
<p>Databricks supports two kinds of color consistency across legacy charts: series set and global.</p>
<p><em>Series set</em> color consistency assigns the same color to the same value if you have series with the
same values but in different orders (for example, A = <code class="docutils literal notranslate"><span class="pre">[&quot;Apple&quot;,</span> <span class="pre">&quot;Orange&quot;,</span> <span class="pre">&quot;Banana&quot;]</span></code> and B =
<code class="docutils literal notranslate"><span class="pre">[&quot;Orange&quot;,</span> <span class="pre">&quot;Banana&quot;,</span> <span class="pre">&quot;Apple&quot;]</span></code>). The values are sorted before plotting, so both legends are sorted
the same way (<code class="docutils literal notranslate"><span class="pre">[&quot;Apple&quot;,</span> <span class="pre">&quot;Banana&quot;,</span> <span class="pre">&quot;Orange&quot;]</span></code>), and the same values are given the same colors. However,
if you have a series C = <code class="docutils literal notranslate"><span class="pre">[&quot;Orange&quot;,</span> <span class="pre">&quot;Banana&quot;]</span></code>, it would not be color consistent with set
A because the set isn’t the same. The sorting algorithm would assign the first color to “Banana” in
set C but the second color to “Banana” in set A. If you want these series to be color consistent,
you can specify that charts should have global color consistency.</p>
<p>In <em>global</em> color consistency, each value is always mapped to the same color no matter what values
the series have. To enable this for each chart, select the <strong>Global color consistency</strong> checkbox.</p>
<div class="figure align-default">
<img alt="Global color consistency" src="../_images/series-colors.gif" />
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>To achieve this consistency, Databricks hashes directly from values to colors. To avoid
collisions (where two values go to the exact same color), the hash is to a large set of colors,
which has the side effect that nice-looking or easily distinguishable colors cannot be guaranteed;
with many colors there are bound to be some that are very similar looking.</p>
</div>
</div>
</div>
<div class="section" id="machine-learning-visualizations">
<span id="display-ml-models"></span><h2>Machine learning visualizations<a class="headerlink" href="#machine-learning-visualizations" title="Permalink to this headline"> </a></h2>
<p>In addition to the standard chart types, legacy visualizations support the following machine learning training parameters and results:</p>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><p><a class="reference internal" href="#residuals" id="id2">Residuals</a></p></li>
<li><p><a class="reference internal" href="#roc-curves" id="id3">ROC curves</a></p></li>
<li><p><a class="reference internal" href="#decision-trees" id="id4">Decision trees</a></p></li>
</ul>
</div>
<div class="section" id="residuals">
<h3><a class="toc-backref" href="#id2">Residuals</a><a class="headerlink" href="#residuals" title="Permalink to this headline"> </a></h3>
<p></p>
<p>For linear and logistic regressions, you can render a <a class="reference external" href="https://en.wikipedia.org/wiki/Errors_and_residuals">fitted versus residuals</a> plot. To obtain this plot, supply the model and DataFrame.</p>
<p>The following example runs a linear regression on city population to house sale price data and then displays the residuals versus the fitted data.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Load data</span>
<span class="n">pop_df</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">read</span><span class="o">.</span><span class="n">csv</span><span class="p">(</span><span class="s2">&quot;/databricks-datasets/samples/population-vs-price/data_geo.csv&quot;</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="s2">&quot;true&quot;</span><span class="p">,</span> <span class="n">inferSchema</span><span class="o">=</span><span class="s2">&quot;true&quot;</span><span class="p">)</span>

<span class="c1"># Drop rows with missing values and rename the feature and label columns, replacing spaces with _</span>
<span class="kn">from</span> <span class="nn">pyspark.sql.functions</span> <span class="kn">import</span> <span class="n">col</span>
<span class="n">pop_df</span> <span class="o">=</span> <span class="n">pop_df</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span> <span class="c1"># drop rows with missing values</span>
<span class="n">exprs</span> <span class="o">=</span> <span class="p">[</span><span class="n">col</span><span class="p">(</span><span class="n">column</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="n">column</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="s1">&#39;_&#39;</span><span class="p">))</span> <span class="k">for</span> <span class="n">column</span> <span class="ow">in</span> <span class="n">pop_df</span><span class="o">.</span><span class="n">columns</span><span class="p">]</span>

<span class="c1"># Register a UDF to convert the feature (2014_Population_estimate) column vector to a VectorUDT type and apply it to the column.</span>
<span class="kn">from</span> <span class="nn">pyspark.ml.linalg</span> <span class="kn">import</span> <span class="n">Vectors</span><span class="p">,</span> <span class="n">VectorUDT</span>

<span class="n">spark</span><span class="o">.</span><span class="n">udf</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="s2">&quot;oneElementVec&quot;</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">d</span><span class="p">:</span> <span class="n">Vectors</span><span class="o">.</span><span class="n">dense</span><span class="p">([</span><span class="n">d</span><span class="p">]),</span> <span class="n">returnType</span><span class="o">=</span><span class="n">VectorUDT</span><span class="p">())</span>
<span class="n">tdata</span> <span class="o">=</span> <span class="n">pop_df</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="o">*</span><span class="n">exprs</span><span class="p">)</span><span class="o">.</span><span class="n">selectExpr</span><span class="p">(</span><span class="s2">&quot;oneElementVec(2014_Population_estimate) as features&quot;</span><span class="p">,</span> <span class="s2">&quot;2015_median_sales_price as label&quot;</span><span class="p">)</span>

<span class="c1"># Run a linear regression</span>
<span class="kn">from</span> <span class="nn">pyspark.ml.regression</span> <span class="kn">import</span> <span class="n">LinearRegression</span>

<span class="n">lr</span> <span class="o">=</span> <span class="n">LinearRegression</span><span class="p">()</span>
<span class="n">modelA</span> <span class="o">=</span> <span class="n">lr</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">tdata</span><span class="p">,</span> <span class="p">{</span><span class="n">lr</span><span class="o">.</span><span class="n">regParam</span><span class="p">:</span><span class="mf">0.0</span><span class="p">})</span>

<span class="c1"># Plot residuals versus fitted data</span>
<span class="n">display</span><span class="p">(</span><span class="n">modelA</span><span class="p">,</span> <span class="n">tdata</span><span class="p">)</span>
</pre></div>
</div>
<div class="figure align-default">
<img alt="Display residuals" src="../_images/residuals.png" />
</div>
</div>
<div class="section" id="roc-curves">
<h3><a class="toc-backref" href="#id3">ROC curves</a><a class="headerlink" href="#roc-curves" title="Permalink to this headline"> </a></h3>
<p></p>
<p>For logistic regressions, you can render an <a class="reference external" href="https://en.wikipedia.org/wiki/Receiver_operating_characteristic">ROC</a> curve. To obtain this plot, supply the model, the prepped data that is input to the <code class="docutils literal notranslate"><span class="pre">fit</span></code> method, and the parameter <code class="docutils literal notranslate"><span class="pre">&quot;ROC&quot;</span></code>.</p>
<p>The following example develops a classifier that predicts if an individual earns &lt;=50K or &gt;50k a year from various attributes of the individual. The Adult dataset derives from census data, and consists of information about 48842 individuals and their annual income.</p>
<p>The example code in this section uses one-hot encoding.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>
<span class="c1"># This code uses one-hot encoding to convert all categorical variables into binary vectors.</span>

<span class="n">schema</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;`age` DOUBLE,</span>
<span class="s2">`workclass` STRING,</span>
<span class="s2">`fnlwgt` DOUBLE,</span>
<span class="s2">`education` STRING,</span>
<span class="s2">`education_num` DOUBLE,</span>
<span class="s2">`marital_status` STRING,</span>
<span class="s2">`occupation` STRING,</span>
<span class="s2">`relationship` STRING,</span>
<span class="s2">`race` STRING,</span>
<span class="s2">`sex` STRING,</span>
<span class="s2">`capital_gain` DOUBLE,</span>
<span class="s2">`capital_loss` DOUBLE,</span>
<span class="s2">`hours_per_week` DOUBLE,</span>
<span class="s2">`native_country` STRING,</span>
<span class="s2">`income` STRING&quot;&quot;&quot;</span>

<span class="n">dataset</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">read</span><span class="o">.</span><span class="n">csv</span><span class="p">(</span><span class="s2">&quot;/databricks-datasets/adult/adult.data&quot;</span><span class="p">,</span> <span class="n">schema</span><span class="o">=</span><span class="n">schema</span><span class="p">)</span>

<span class="kn">from</span> <span class="nn">pyspark.ml</span> <span class="kn">import</span> <span class="n">Pipeline</span>
<span class="kn">from</span> <span class="nn">pyspark.ml.feature</span> <span class="kn">import</span> <span class="n">OneHotEncoder</span><span class="p">,</span> <span class="n">StringIndexer</span><span class="p">,</span> <span class="n">VectorAssembler</span>

<span class="n">categoricalColumns</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;workclass&quot;</span><span class="p">,</span> <span class="s2">&quot;education&quot;</span><span class="p">,</span> <span class="s2">&quot;marital_status&quot;</span><span class="p">,</span> <span class="s2">&quot;occupation&quot;</span><span class="p">,</span> <span class="s2">&quot;relationship&quot;</span><span class="p">,</span> <span class="s2">&quot;race&quot;</span><span class="p">,</span> <span class="s2">&quot;sex&quot;</span><span class="p">,</span> <span class="s2">&quot;native_country&quot;</span><span class="p">]</span>

<span class="n">stages</span> <span class="o">=</span> <span class="p">[]</span> <span class="c1"># stages in the Pipeline</span>
<span class="k">for</span> <span class="n">categoricalCol</span> <span class="ow">in</span> <span class="n">categoricalColumns</span><span class="p">:</span>
    <span class="c1"># Category indexing with StringIndexer</span>
    <span class="n">stringIndexer</span> <span class="o">=</span> <span class="n">StringIndexer</span><span class="p">(</span><span class="n">inputCol</span><span class="o">=</span><span class="n">categoricalCol</span><span class="p">,</span> <span class="n">outputCol</span><span class="o">=</span><span class="n">categoricalCol</span> <span class="o">+</span> <span class="s2">&quot;Index&quot;</span><span class="p">)</span>
    <span class="c1"># Use OneHotEncoder to convert categorical variables into binary SparseVectors</span>
    <span class="n">encoder</span> <span class="o">=</span> <span class="n">OneHotEncoder</span><span class="p">(</span><span class="n">inputCols</span><span class="o">=</span><span class="p">[</span><span class="n">stringIndexer</span><span class="o">.</span><span class="n">getOutputCol</span><span class="p">()],</span> <span class="n">outputCols</span><span class="o">=</span><span class="p">[</span><span class="n">categoricalCol</span> <span class="o">+</span> <span class="s2">&quot;classVec&quot;</span><span class="p">])</span>
    <span class="c1"># Add stages.  These are not run here, but will run all at once later on.</span>
    <span class="n">stages</span> <span class="o">+=</span> <span class="p">[</span><span class="n">stringIndexer</span><span class="p">,</span> <span class="n">encoder</span><span class="p">]</span>

<span class="c1"># Convert label into label indices using the StringIndexer</span>
<span class="n">label_stringIdx</span> <span class="o">=</span> <span class="n">StringIndexer</span><span class="p">(</span><span class="n">inputCol</span><span class="o">=</span><span class="s2">&quot;income&quot;</span><span class="p">,</span> <span class="n">outputCol</span><span class="o">=</span><span class="s2">&quot;label&quot;</span><span class="p">)</span>
<span class="n">stages</span> <span class="o">+=</span> <span class="p">[</span><span class="n">label_stringIdx</span><span class="p">]</span>

<span class="c1"># Transform all features into a vector using VectorAssembler</span>
<span class="n">numericCols</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;age&quot;</span><span class="p">,</span> <span class="s2">&quot;fnlwgt&quot;</span><span class="p">,</span> <span class="s2">&quot;education_num&quot;</span><span class="p">,</span> <span class="s2">&quot;capital_gain&quot;</span><span class="p">,</span> <span class="s2">&quot;capital_loss&quot;</span><span class="p">,</span> <span class="s2">&quot;hours_per_week&quot;</span><span class="p">]</span>
<span class="n">assemblerInputs</span> <span class="o">=</span> <span class="p">[</span><span class="n">c</span> <span class="o">+</span> <span class="s2">&quot;classVec&quot;</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">categoricalColumns</span><span class="p">]</span> <span class="o">+</span> <span class="n">numericCols</span>
<span class="n">assembler</span> <span class="o">=</span> <span class="n">VectorAssembler</span><span class="p">(</span><span class="n">inputCols</span><span class="o">=</span><span class="n">assemblerInputs</span><span class="p">,</span> <span class="n">outputCol</span><span class="o">=</span><span class="s2">&quot;features&quot;</span><span class="p">)</span>
<span class="n">stages</span> <span class="o">+=</span> <span class="p">[</span><span class="n">assembler</span><span class="p">]</span>

<span class="c1"># Run the stages as a Pipeline. This puts the data through all of the feature transformations in a single call.</span>

<span class="n">partialPipeline</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">()</span><span class="o">.</span><span class="n">setStages</span><span class="p">(</span><span class="n">stages</span><span class="p">)</span>
<span class="n">pipelineModel</span> <span class="o">=</span> <span class="n">partialPipeline</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">dataset</span><span class="p">)</span>
<span class="n">preppedDataDF</span> <span class="o">=</span> <span class="n">pipelineModel</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">dataset</span><span class="p">)</span>

<span class="c1"># Fit logistic regression model</span>

<span class="kn">from</span> <span class="nn">pyspark.ml.classification</span> <span class="kn">import</span> <span class="n">LogisticRegression</span>
<span class="n">lrModel</span> <span class="o">=</span> <span class="n">LogisticRegression</span><span class="p">()</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">preppedDataDF</span><span class="p">)</span>

<span class="c1"># ROC for data</span>
<span class="n">display</span><span class="p">(</span><span class="n">lrModel</span><span class="p">,</span> <span class="n">preppedDataDF</span><span class="p">,</span> <span class="s2">&quot;ROC&quot;</span><span class="p">)</span>
</pre></div>
</div>
<div class="figure align-default">
<img alt="Display ROC" src="../_images/roc.png" />
</div>
<p>To display the residuals, omit the <code class="docutils literal notranslate"><span class="pre">&quot;ROC&quot;</span></code> parameter:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">display</span><span class="p">(</span><span class="n">lrModel</span><span class="p">,</span> <span class="n">preppedDataDF</span><span class="p">)</span>
</pre></div>
</div>
<div class="figure align-default">
<img alt="Display logistic regression residuals" src="../_images/log-reg-residuals.png" />
</div>
</div>
<div class="section" id="decision-trees">
<h3><a class="toc-backref" href="#id4">Decision trees</a><a class="headerlink" href="#decision-trees" title="Permalink to this headline"> </a></h3>
<p>Legacy visualizations support rendering a decision tree.</p>
<p>To obtain this visualization, supply the decision tree model.</p>
<p>The following examples train a tree to recognize digits (0 - 9) from the MNIST dataset of images of handwritten digits and then displays the tree.</p>
<div class="js-code-language-tabs js-code-language-tabs--literal compound">
<div class="compound-first highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">trainingDF</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">read</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">&quot;libsvm&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s2">&quot;/databricks-datasets/mnist-digits/data-001/mnist-digits-train.txt&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">cache</span><span class="p">()</span>
<span class="n">testDF</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">read</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">&quot;libsvm&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s2">&quot;/databricks-datasets/mnist-digits/data-001/mnist-digits-test.txt&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">cache</span><span class="p">()</span>

<span class="kn">from</span> <span class="nn">pyspark.ml.classification</span> <span class="kn">import</span> <span class="n">DecisionTreeClassifier</span>
<span class="kn">from</span> <span class="nn">pyspark.ml.feature</span> <span class="kn">import</span> <span class="n">StringIndexer</span>
<span class="kn">from</span> <span class="nn">pyspark.ml</span> <span class="kn">import</span> <span class="n">Pipeline</span>

<span class="n">indexer</span> <span class="o">=</span> <span class="n">StringIndexer</span><span class="p">()</span><span class="o">.</span><span class="n">setInputCol</span><span class="p">(</span><span class="s2">&quot;label&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">setOutputCol</span><span class="p">(</span><span class="s2">&quot;indexedLabel&quot;</span><span class="p">)</span>

<span class="n">dtc</span> <span class="o">=</span> <span class="n">DecisionTreeClassifier</span><span class="p">()</span><span class="o">.</span><span class="n">setLabelCol</span><span class="p">(</span><span class="s2">&quot;indexedLabel&quot;</span><span class="p">)</span>

<span class="c1"># Chain indexer + dtc together into a single ML Pipeline.</span>
<span class="n">pipeline</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">()</span><span class="o">.</span><span class="n">setStages</span><span class="p">([</span><span class="n">indexer</span><span class="p">,</span> <span class="n">dtc</span><span class="p">])</span>

<span class="n">model</span> <span class="o">=</span> <span class="n">pipeline</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">trainingDF</span><span class="p">)</span>
<span class="n">display</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">stages</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
</pre></div>
</div>
<div class="compound-last highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="kd">val</span><span class="w"> </span><span class="n">trainingDF</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">spark</span><span class="p">.</span><span class="n">read</span><span class="p">.</span><span class="n">format</span><span class="p">(</span><span class="s">&quot;libsvm&quot;</span><span class="p">).</span><span class="n">load</span><span class="p">(</span><span class="s">&quot;/databricks-datasets/mnist-digits/data-001/mnist-digits-train.txt&quot;</span><span class="p">).</span><span class="n">cache</span>
<span class="kd">val</span><span class="w"> </span><span class="n">testDF</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">spark</span><span class="p">.</span><span class="n">read</span><span class="p">.</span><span class="n">format</span><span class="p">(</span><span class="s">&quot;libsvm&quot;</span><span class="p">).</span><span class="n">load</span><span class="p">(</span><span class="s">&quot;/databricks-datasets/mnist-digits/data-001/mnist-digits-test.txt&quot;</span><span class="p">).</span><span class="n">cache</span>

<span class="k">import</span><span class="w"> </span><span class="nn">org</span><span class="p">.</span><span class="nn">apache</span><span class="p">.</span><span class="nn">spark</span><span class="p">.</span><span class="nn">ml</span><span class="p">.</span><span class="nn">classification</span><span class="p">.{</span><span class="nc">DecisionTreeClassifier</span><span class="p">,</span><span class="w"> </span><span class="nc">DecisionTreeClassificationModel</span><span class="p">}</span>
<span class="k">import</span><span class="w"> </span><span class="nn">org</span><span class="p">.</span><span class="nn">apache</span><span class="p">.</span><span class="nn">spark</span><span class="p">.</span><span class="nn">ml</span><span class="p">.</span><span class="nn">feature</span><span class="p">.</span><span class="nc">StringIndexer</span>
<span class="k">import</span><span class="w"> </span><span class="nn">org</span><span class="p">.</span><span class="nn">apache</span><span class="p">.</span><span class="nn">spark</span><span class="p">.</span><span class="nn">ml</span><span class="p">.</span><span class="nc">Pipeline</span>

<span class="kd">val</span><span class="w"> </span><span class="n">indexer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="nc">StringIndexer</span><span class="p">().</span><span class="n">setInputCol</span><span class="p">(</span><span class="s">&quot;label&quot;</span><span class="p">).</span><span class="n">setOutputCol</span><span class="p">(</span><span class="s">&quot;indexedLabel&quot;</span><span class="p">)</span>
<span class="kd">val</span><span class="w"> </span><span class="n">dtc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="nc">DecisionTreeClassifier</span><span class="p">().</span><span class="n">setLabelCol</span><span class="p">(</span><span class="s">&quot;indexedLabel&quot;</span><span class="p">)</span>
<span class="kd">val</span><span class="w"> </span><span class="n">pipeline</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="nc">Pipeline</span><span class="p">().</span><span class="n">setStages</span><span class="p">(</span><span class="nc">Array</span><span class="p">(</span><span class="n">indexer</span><span class="p">,</span><span class="w"> </span><span class="n">dtc</span><span class="p">))</span>

<span class="kd">val</span><span class="w"> </span><span class="n">model</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pipeline</span><span class="p">.</span><span class="n">fit</span><span class="p">(</span><span class="n">trainingDF</span><span class="p">)</span>
<span class="kd">val</span><span class="w"> </span><span class="n">tree</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">model</span><span class="p">.</span><span class="n">stages</span><span class="p">.</span><span class="n">last</span><span class="p">.</span><span class="k">asInstanceOf</span><span class="p">[</span><span class="nc">DecisionTreeClassificationModel</span><span class="p">]</span>

<span class="n">display</span><span class="p">(</span><span class="n">tree</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="figure align-default">
<img alt="Display decision tree" src="../_images/decision-tree.png" />
</div>
</div>
</div>
<div class="section" id="structured-streaming-dataframes">
<span id="ss-display"></span><h2>Structured Streaming DataFrames<a class="headerlink" href="#structured-streaming-dataframes" title="Permalink to this headline"> </a></h2>
<p></p>
<p>To visualize the result of a streaming query in real time you can <code class="docutils literal notranslate"><span class="pre">display</span></code> a Structured Streaming DataFrame in Scala and Python.</p>
<div class="js-code-language-tabs js-code-language-tabs--literal compound">
<div class="compound-first highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">streaming_df</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">readStream</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">&quot;rate&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">load</span><span class="p">()</span>
<span class="n">display</span><span class="p">(</span><span class="n">streaming_df</span><span class="o">.</span><span class="n">groupBy</span><span class="p">()</span><span class="o">.</span><span class="n">count</span><span class="p">())</span>
</pre></div>
</div>
<div class="compound-last highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="kd">val</span><span class="w"> </span><span class="n">streaming_df</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">spark</span><span class="p">.</span><span class="n">readStream</span><span class="p">.</span><span class="n">format</span><span class="p">(</span><span class="s">&quot;rate&quot;</span><span class="p">).</span><span class="n">load</span><span class="p">()</span>
<span class="n">display</span><span class="p">(</span><span class="n">streaming_df</span><span class="p">.</span><span class="n">groupBy</span><span class="p">().</span><span class="n">count</span><span class="p">())</span>
</pre></div>
</div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">display</span></code> supports the following optional parameters:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">streamName</span></code>: the streaming query name.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">trigger</span></code> (Scala) and <code class="docutils literal notranslate"><span class="pre">processingTime</span></code> (Python): defines how often the streaming query is run. If not specified, the system checks for availability of new data as soon as the previous processing has completed. To reduce the cost in production, Databricks recommends that  you <em>always</em> set a trigger interval. With Databricks Runtime 8.0 and above, the default trigger interval is 500 ms.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">checkpointLocation</span></code>: the location where the system writes all the checkpoint information. If it is not specified, the system automatically generates a temporary checkpoint location on DBFS. In order for your stream to continue processing data from where it left off, you must provide a checkpoint location. Databricks recommends that in production you <em>always</em> specify the <code class="docutils literal notranslate"><span class="pre">checkpointLocation</span></code> option.</p></li>
</ul>
<div class="js-code-language-tabs js-code-language-tabs--literal compound">
<div class="compound-first highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">streaming_df</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">readStream</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">&quot;rate&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">load</span><span class="p">()</span>
<span class="n">display</span><span class="p">(</span><span class="n">streaming_df</span><span class="o">.</span><span class="n">groupBy</span><span class="p">()</span><span class="o">.</span><span class="n">count</span><span class="p">(),</span> <span class="n">processingTime</span> <span class="o">=</span> <span class="s2">&quot;5 seconds&quot;</span><span class="p">,</span> <span class="n">checkpointLocation</span> <span class="o">=</span> <span class="s2">&quot;dbfs:/&lt;checkpoint-path&gt;&quot;</span><span class="p">)</span>
</pre></div>
</div>
<div class="compound-last highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="k">import</span><span class="w"> </span><span class="nn">org</span><span class="p">.</span><span class="nn">apache</span><span class="p">.</span><span class="nn">spark</span><span class="p">.</span><span class="nn">sql</span><span class="p">.</span><span class="nn">streaming</span><span class="p">.</span><span class="nc">Trigger</span>

<span class="kd">val</span><span class="w"> </span><span class="n">streaming_df</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">spark</span><span class="p">.</span><span class="n">readStream</span><span class="p">.</span><span class="n">format</span><span class="p">(</span><span class="s">&quot;rate&quot;</span><span class="p">).</span><span class="n">load</span><span class="p">()</span>
<span class="n">display</span><span class="p">(</span><span class="n">streaming_df</span><span class="p">.</span><span class="n">groupBy</span><span class="p">().</span><span class="n">count</span><span class="p">(),</span><span class="w"> </span><span class="n">trigger</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">Trigger</span><span class="p">.</span><span class="nc">ProcessingTime</span><span class="p">(</span><span class="s">&quot;5 seconds&quot;</span><span class="p">),</span><span class="w"> </span><span class="n">checkpointLocation</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;dbfs:/&lt;checkpoint-path&gt;&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>For more information about these parameters, see <a class="reference external" href="http://spark.apache.org/docs/latest/structured-streaming-programming-guide.html#starting-streaming-queries">Starting Streaming Queries</a>.</p>
</div>
<div class="section" id="displayhtml-function">
<span id="display-html-function"></span><h2><code class="docutils literal notranslate"><span class="pre">displayHTML</span></code> function<a class="headerlink" href="#displayhtml-function" title="Permalink to this headline"> </a></h2>
<p>Databricks programming language notebooks (Python, R, and Scala) support HTML graphics using the <code class="docutils literal notranslate"><span class="pre">displayHTML</span></code> function;
you can pass the function any HTML, CSS, or JavaScript code. This function supports interactive graphics using JavaScript libraries such as D3.</p>
<p>For examples of using <code class="docutils literal notranslate"><span class="pre">displayHTML</span></code>, see:</p>
<div class="toctree-wrapper compound">
<ul>
<li class="toctree-l1"><a class="reference internal" href="html-d3-and-svg.html">HTML, D3, and SVG in notebooks</a></li>
</ul>
</div>
<ul class="simple">
<li><p><a class="reference internal" href="../dbfs/filestore.html#static-images"><span class="std std-ref">Embed static images in notebooks</span></a></p></li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The <code class="docutils literal notranslate"><span class="pre">displayHTML</span></code> iframe is served from the domain <code class="docutils literal notranslate"><span class="pre">databricksusercontent.com</span></code>, and the iframe sandbox includes the <code class="docutils literal notranslate"><span class="pre">allow-same-origin</span></code> attribute. <code class="docutils literal notranslate"><span class="pre">databricksusercontent.com</span></code> must be accessible from your browser. If it is currently blocked by your corporate network, it must added to an allow list.</p>
</div>
</div>
<div class="section" id="images">
<span id="display-image-type"></span><h2>Images<a class="headerlink" href="#images" title="Permalink to this headline"> </a></h2>
<p>Columns containing image data types are rendered as rich HTML. Databricks attempts to render image thumbnails for <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code> columns matching the Spark <a class="reference external" href="https://api-docs.databricks.com/scala/spark/latest/org/apache/spark/ml/image/ImageSchema$.html">ImageSchema</a>.
Thumbnail rendering works for any images successfully read in through the <code class="docutils literal notranslate"><span class="pre">spark.read.format('image')</span></code> function. For image values generated through other means, Databricks supports the rendering of 1, 3, or 4 channel images (where each channel consists of a single byte), with the following constraints:</p>
<ul class="simple">
<li><p><strong>One-channel images</strong>: <code class="docutils literal notranslate"><span class="pre">mode</span></code> field must be equal to 0. <code class="docutils literal notranslate"><span class="pre">height</span></code>, <code class="docutils literal notranslate"><span class="pre">width</span></code>, and <code class="docutils literal notranslate"><span class="pre">nChannels</span></code>
fields must accurately describe the binary image data in the <code class="docutils literal notranslate"><span class="pre">data</span></code> field.</p></li>
<li><p><strong>Three-channel images</strong>: <code class="docutils literal notranslate"><span class="pre">mode</span></code> field must be equal to 16. <code class="docutils literal notranslate"><span class="pre">height</span></code>, <code class="docutils literal notranslate"><span class="pre">width</span></code>, and <code class="docutils literal notranslate"><span class="pre">nChannels</span></code>
fields must accurately describe the binary image data in the <code class="docutils literal notranslate"><span class="pre">data</span></code> field. The <code class="docutils literal notranslate"><span class="pre">data</span></code> field
must contain pixel data in three-byte chunks, with the channel ordering <code class="docutils literal notranslate"><span class="pre">(blue,</span> <span class="pre">green,</span> <span class="pre">red)</span></code> for
each pixel.</p></li>
<li><p><strong>Four-channel images</strong>: <code class="docutils literal notranslate"><span class="pre">mode</span></code> field must be equal to 24. <code class="docutils literal notranslate"><span class="pre">height</span></code>, <code class="docutils literal notranslate"><span class="pre">width</span></code>, and <code class="docutils literal notranslate"><span class="pre">nChannels</span></code>
fields must accurately describe the binary image data in the <code class="docutils literal notranslate"><span class="pre">data</span></code> field. The <code class="docutils literal notranslate"><span class="pre">data</span></code> field
must contain pixel data in four-byte chunks, with the channel ordering <code class="docutils literal notranslate"><span class="pre">(blue,</span> <span class="pre">green,</span> <span class="pre">red,</span> <span class="pre">alpha)</span></code>
for each pixel.</p></li>
</ul>
<div class="section" id="example">
<h3>Example<a class="headerlink" href="#example" title="Permalink to this headline"> </a></h3>
<p>Suppose you have a folder containing some images:</p>
<div class="figure align-default">
<img alt="Folder of image data" src="../_images/sample-image-data.png" />
</div>
<p>If you read the images into a DataFrame and then display the DataFrame, Databricks renders thumbnails of the images:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">image_df</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">read</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">&quot;image&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">sample_img_dir</span><span class="p">)</span>
<span class="n">display</span><span class="p">(</span><span class="n">image_df</span><span class="p">)</span>
</pre></div>
</div>
<div class="figure align-default">
<img alt="Display image DataFrame" src="../_images/image-data.png" />
</div>
</div>
</div>
<div class="section" id="visualizations-in-python">
<h2>Visualizations in Python<a class="headerlink" href="#visualizations-in-python" title="Permalink to this headline"> </a></h2>
<div class="contents local topic" id="in-this-section">
<p class="topic-title first">In this section:</p>
<ul class="simple">
<li><p><a class="reference internal" href="#seaborn" id="id5">Seaborn</a></p></li>
<li><p><a class="reference internal" href="#other-python-libraries" id="id6">Other Python libraries</a></p></li>
</ul>
</div>
<div class="section" id="seaborn">
<h3><a class="toc-backref" href="#id5">Seaborn</a><a class="headerlink" href="#seaborn" title="Permalink to this headline"> </a></h3>
<p>You can also use other Python libraries to generate plots. The Databricks Runtime includes the <a class="reference external" href="https://seaborn.pydata.org/">seaborn</a> visualization library. To create a seaborn plot, import the library, create a plot, and pass the plot to the <code class="docutils literal notranslate"><span class="pre">display</span></code> function.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>
<span class="n">sns</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">style</span><span class="o">=</span><span class="s2">&quot;white&quot;</span><span class="p">)</span>

<span class="n">df</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">load_dataset</span><span class="p">(</span><span class="s2">&quot;iris&quot;</span><span class="p">)</span>
<span class="n">g</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">PairGrid</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">diag_sharey</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">g</span><span class="o">.</span><span class="n">map_lower</span><span class="p">(</span><span class="n">sns</span><span class="o">.</span><span class="n">kdeplot</span><span class="p">)</span>
<span class="n">g</span><span class="o">.</span><span class="n">map_diag</span><span class="p">(</span><span class="n">sns</span><span class="o">.</span><span class="n">kdeplot</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>

<span class="n">g</span><span class="o">.</span><span class="n">map_upper</span><span class="p">(</span><span class="n">sns</span><span class="o">.</span><span class="n">regplot</span><span class="p">)</span>

<span class="n">display</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">fig</span><span class="p">)</span>
</pre></div>
</div>
<div class="figure align-default">
<img alt="Seaborn plot" src="../_images/seaborn-iris.png" />
</div>
</div>
<div class="section" id="other-python-libraries">
<h3><a class="toc-backref" href="#id6">Other Python libraries</a><a class="headerlink" href="#other-python-libraries" title="Permalink to this headline"> </a></h3>
<div class="toctree-wrapper compound">
<ul>
<li class="toctree-l1"><a class="reference internal" href="bokeh.html">Bokeh</a></li>
<li class="toctree-l1"><a class="reference internal" href="matplotlib.html">Matplotlib</a></li>
<li class="toctree-l1"><a class="reference internal" href="plotly.html">Plotly</a></li>
</ul>
</div>
</div>
</div>
<div class="section" id="visualizations-in-r">
<h2>Visualizations in R<a class="headerlink" href="#visualizations-in-r" title="Permalink to this headline"> </a></h2>
<p>To plot data in R, use the <code class="docutils literal notranslate"><span class="pre">display</span></code> function as follows:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">library</span><span class="p">(</span><span class="n">SparkR</span><span class="p">)</span>
<span class="n">diamonds_df</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">read.df</span><span class="p">(</span><span class="s">&quot;/databricks-datasets/Rdatasets/data-001/csv/ggplot2/diamonds.csv&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">source</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;csv&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">header</span><span class="o">=</span><span class="s">&quot;true&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">inferSchema</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;true&quot;</span><span class="p">)</span>

<span class="nf">display</span><span class="p">(</span><span class="nf">arrange</span><span class="p">(</span><span class="nf">agg</span><span class="p">(</span><span class="nf">groupBy</span><span class="p">(</span><span class="n">diamonds_df</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;color&quot;</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;price&quot;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;avg&quot;</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;color&quot;</span><span class="p">))</span>
</pre></div>
</div>
<p>You can use the default R <a class="reference external" href="https://www.rdocumentation.org/packages/graphics/versions/3.6.2/topics/plot">plot</a> function.</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">fit</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">lm</span><span class="p">(</span><span class="n">Petal.Length</span><span class="w"> </span><span class="o">~</span><span class="n">.</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">iris</span><span class="p">)</span>
<span class="nf">layout</span><span class="p">(</span><span class="nf">matrix</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="m">2</span><span class="p">,</span><span class="m">3</span><span class="p">,</span><span class="m">4</span><span class="p">),</span><span class="m">2</span><span class="p">,</span><span class="m">2</span><span class="p">))</span><span class="w"> </span><span class="c1"># optional 4 graphs/page</span>
<span class="nf">plot</span><span class="p">(</span><span class="n">fit</span><span class="p">)</span>
</pre></div>
</div>
<div class="figure align-default">
<img alt="R default plot" src="../_images/r-iris.png" />
</div>
<p>You can also use any R visualization package. The R notebook captures the resulting plot as a <code class="docutils literal notranslate"><span class="pre">.png</span></code> and displays it inline.</p>
<div class="contents local topic" id="id1">
<p class="topic-title first">In this section:</p>
<ul class="simple">
<li><p><a class="reference internal" href="#lattice" id="id7">Lattice</a></p></li>
<li><p><a class="reference internal" href="#dandefa" id="id8">DandEFA</a></p></li>
<li><p><a class="reference internal" href="#plotly" id="id9">Plotly</a></p></li>
<li><p><a class="reference internal" href="#other-r-libraries" id="id10">Other R libraries</a></p></li>
</ul>
</div>
<div class="section" id="lattice">
<h3><a class="toc-backref" href="#id7">Lattice</a><a class="headerlink" href="#lattice" title="Permalink to this headline"> </a></h3>
<p>The <a class="reference external" href="https://www.statmethods.net/advgraphs/trellis.html">Lattice</a> package supports trellis graphs—graphs that display a variable or the relationship between variables, conditioned on one or more other variables.</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">library</span><span class="p">(</span><span class="n">lattice</span><span class="p">)</span>
<span class="nf">xyplot</span><span class="p">(</span><span class="n">price</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">carat</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">cut</span><span class="p">,</span><span class="w"> </span><span class="n">diamonds</span><span class="p">,</span><span class="w"> </span><span class="n">scales</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">list</span><span class="p">(</span><span class="n">log</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">),</span><span class="w"> </span><span class="n">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;p&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;g&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;smooth&quot;</span><span class="p">),</span><span class="w"> </span><span class="n">ylab</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Log price&quot;</span><span class="p">)</span>
</pre></div>
</div>
<div class="figure align-default">
<img alt="R Lattice plot" src="../_images/r-lattice.png" />
</div>
</div>
<div class="section" id="dandefa">
<h3><a class="toc-backref" href="#id8">DandEFA</a><a class="headerlink" href="#dandefa" title="Permalink to this headline"> </a></h3>
<p>The <a class="reference external" href="https://www.rdocumentation.org/packages/DandEFA/versions/1.6">DandEFA</a> package supports dandelion plots.</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">install.packages</span><span class="p">(</span><span class="s">&quot;DandEFA&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">repos</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;https://cran.us.r-project.org&quot;</span><span class="p">)</span>
<span class="nf">library</span><span class="p">(</span><span class="n">DandEFA</span><span class="p">)</span>
<span class="nf">data</span><span class="p">(</span><span class="n">timss2011</span><span class="p">)</span>
<span class="n">timss2011</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">na.omit</span><span class="p">(</span><span class="n">timss2011</span><span class="p">)</span>
<span class="n">dandpal</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">rev</span><span class="p">(</span><span class="nf">rainbow</span><span class="p">(</span><span class="m">100</span><span class="p">,</span><span class="w"> </span><span class="n">start</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="n">end</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.2</span><span class="p">))</span>
<span class="n">facl</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">factload</span><span class="p">(</span><span class="n">timss2011</span><span class="p">,</span><span class="n">nfac</span><span class="o">=</span><span class="m">5</span><span class="p">,</span><span class="n">method</span><span class="o">=</span><span class="s">&quot;prax&quot;</span><span class="p">,</span><span class="n">cormeth</span><span class="o">=</span><span class="s">&quot;spearman&quot;</span><span class="p">)</span>
<span class="nf">dandelion</span><span class="p">(</span><span class="n">facl</span><span class="p">,</span><span class="n">bound</span><span class="o">=</span><span class="m">0</span><span class="p">,</span><span class="n">mcex</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="m">1.2</span><span class="p">),</span><span class="n">palet</span><span class="o">=</span><span class="n">dandpal</span><span class="p">)</span>
<span class="n">facl</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">factload</span><span class="p">(</span><span class="n">timss2011</span><span class="p">,</span><span class="n">nfac</span><span class="o">=</span><span class="m">8</span><span class="p">,</span><span class="n">method</span><span class="o">=</span><span class="s">&quot;mle&quot;</span><span class="p">,</span><span class="n">cormeth</span><span class="o">=</span><span class="s">&quot;pearson&quot;</span><span class="p">)</span>
<span class="nf">dandelion</span><span class="p">(</span><span class="n">facl</span><span class="p">,</span><span class="n">bound</span><span class="o">=</span><span class="m">0</span><span class="p">,</span><span class="n">mcex</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="m">1.2</span><span class="p">),</span><span class="n">palet</span><span class="o">=</span><span class="n">dandpal</span><span class="p">)</span>
</pre></div>
</div>
<div class="figure align-default">
<img alt="R DandEFA plot" src="../_images/r-daefa.png" />
</div>
</div>
<div class="section" id="plotly">
<h3><a class="toc-backref" href="#id9">Plotly</a><a class="headerlink" href="#plotly" title="Permalink to this headline"> </a></h3>
<p>The <a class="reference external" href="https://plotly.com/r/">Plotly</a> R package relies on <a class="reference external" href="https://www.htmlwidgets.org/">htmlwidgets for R</a>.
For installation instructions and a notebook, see <a class="reference internal" href="htmlwidgets.html"><span class="doc">htmlwidgets</span></a>.</p>
</div>
<div class="section" id="other-r-libraries">
<h3><a class="toc-backref" href="#id10">Other R libraries</a><a class="headerlink" href="#other-r-libraries" title="Permalink to this headline"> </a></h3>
<div class="toctree-wrapper compound">
<ul>
<li class="toctree-l1"><a class="reference internal" href="ggplot2.html">ggplot2</a></li>
<li class="toctree-l1"><a class="reference internal" href="htmlwidgets.html">htmlwidgets</a></li>
</ul>
</div>
</div>
</div>
<div class="section" id="visualizations-in-scala">
<h2>Visualizations in Scala<a class="headerlink" href="#visualizations-in-scala" title="Permalink to this headline"> </a></h2>
<p>To plot data in Scala, use the <code class="docutils literal notranslate"><span class="pre">display</span></code> function as follows:</p>
<div class="highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="kd">val</span><span class="w"> </span><span class="n">diamonds_df</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">spark</span><span class="p">.</span><span class="n">read</span><span class="p">.</span><span class="n">format</span><span class="p">(</span><span class="s">&quot;csv&quot;</span><span class="p">).</span><span class="n">option</span><span class="p">(</span><span class="s">&quot;header&quot;</span><span class="p">,</span><span class="s">&quot;true&quot;</span><span class="p">).</span><span class="n">option</span><span class="p">(</span><span class="s">&quot;inferSchema&quot;</span><span class="p">,</span><span class="s">&quot;true&quot;</span><span class="p">).</span><span class="n">load</span><span class="p">(</span><span class="s">&quot;/databricks-datasets/Rdatasets/data-001/csv/ggplot2/diamonds.csv&quot;</span><span class="p">)</span>

<span class="n">display</span><span class="p">(</span><span class="n">diamonds_df</span><span class="p">.</span><span class="n">groupBy</span><span class="p">(</span><span class="s">&quot;color&quot;</span><span class="p">).</span><span class="n">avg</span><span class="p">(</span><span class="s">&quot;price&quot;</span><span class="p">).</span><span class="n">orderBy</span><span class="p">(</span><span class="s">&quot;color&quot;</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="section" id="deep-dive-notebooks-for-python-and-scala">
<h2>Deep dive notebooks for Python and Scala<a class="headerlink" href="#deep-dive-notebooks-for-python-and-scala" title="Permalink to this headline"> </a></h2>
<p></p>
<p>For a deep dive into Python visualizations, see the notebook:</p>
<div class="toctree-wrapper compound">
<ul>
<li class="toctree-l1"><a class="reference internal" href="charts-and-graphs-python.html">Visualization deep dive in Python</a></li>
</ul>
</div>
<p>For a deep dive into Scala visualizations, see the notebook:</p>
<div class="toctree-wrapper compound">
<ul>
<li class="toctree-l1"><a class="reference internal" href="charts-and-graphs-scala.html">Visualization deep dive in Scala</a></li>
</ul>
</div>
</div>
</div>


    
          </div>
        </div>
        <div  class="suapp-rating">
  <div id="suPageRateApp">
     <su-app></su-app>
   </div> 
 </div>
<hr> 
<footer>
  <div role="contentinfo">
      <p class="copyright">
          &copy; Databricks 2023. All rights reserved. Apache, Apache Spark, Spark, and the Spark logo are trademarks of the <a href="http://www.apache.org/">Apache Software Foundation</a>.
      </p>
      <p> 
        
          <a id='feedbacklink' href="mailto:doc-feedback@databricks.com?subject=Documentation Feedback">Send us feedback</a>
        
     | <a href="https://databricks.com/privacy-policy">Privacy Policy</a> | <a href="https://databricks.com/terms-of-use">Terms of Use</a></p>

  </div> 

</footer>
      </div>
    </div>
  </section>
</main>

  </page>
  
  <script type="text/javascript">
    var DOCUMENTATION_OPTIONS = {
      URL_ROOT: '../',
      VERSION: '1.0',
      COLLAPSE_INDEX: false,
      FILE_SUFFIX: '.html',
      HAS_SOURCE: 'false'
    };
  </script>
  <script type="text/javascript" src="../_static/jquery.js"></script>
  <script type="text/javascript" src="../_static/underscore.js"></script>
  <script type="text/javascript" src="../_static/doctools.js"></script>
  <script type="text/javascript" src="../_static/language_data.js"></script>
  

  <script type="text/javascript" src="../_static/js/clipboard.min.js"></script>
  <script type="text/javascript" src="../_static/js/jquery.waypoints.min.js"></script>

  <!-- Select2 (https://select2.org/) -->
  <link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />
  <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
  <!-- End Select2 -->

  
  
  <script type="text/javascript" src="../_static/js/localized.js"></script>
  <script type="text/javascript" src="../_static/js/custom.js"></script>
  

  
  
  <script type="text/javascript">
    jQuery(function () {
      SphinxRtdTheme.StickyNav.enable();
    });

  </script>
  
 



  <script>
  window.__searchunifyLoaderConfig = JSON.parse('{"clients": {"en": "02c2e804-27e9-11ee-aefb-0242ac120011", "ja": "6a42c3f2-2820-11ee-aefb-0242ac120011", "pt": "6a86badd-2821-11ee-aefb-0242ac120011"}}')
</script>
<script type="text/javascript" src="../_static/js/search-loader.js"></script>
</body>
<script type='text/javascript'>
  window.onload = function () {
    var description = document.querySelector('meta[name="description"]').getAttribute("content");
    let titleText = document.querySelector('h1').textContent;
    document.querySelector('meta[property="og:title"]').setAttribute("content", titleText);
    document.querySelector('meta[property="og:description"]').setAttribute("content", description);
    document.querySelector('meta[property="twitter:description"]').setAttribute("content", description);
  };
</script>

</html>