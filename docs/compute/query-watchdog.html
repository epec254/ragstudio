

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en-US" > <![endif]-->
<!--[if gt IE 8]><!-->
<html class="no-js" lang="en-US"> <!--<![endif]-->

<head>
  <!-- cookie consent -->
  
    <!-- Combined Onetrust and Rudderstack Implementation Scripts -->
    <!-- Onetrust Initialization -->
    <script type="text/javascript" src="https://cdn.cookielaw.org/consent/92466579-1717-44d3-809d-a05fb02843ed-test/OtAutoBlock.js"></script>
    <script src="https://cdn.cookielaw.org/scripttemplates/otSDKStub.js" data-document-language="true" type="text/javascript" charset="UTF-8" data-domain-script="92466579-1717-44d3-809d-a05fb02843ed-test"></script>
    <link rel="stylesheet" id="db-onetrust-style" href="https://www.databricks.com/wp-content/uploads/db_onetrust.css" media="all" />
    <!-- Setting Rudderstack Write Key -->
    <script>window.rudderstackKey = "2SOR9fvSr5Fi6tN2ihPbVHnX1SZ" </script>
    <!-- Rudderstack Initialization + Onetrust Integration + Rudderstack Custom Events -->
    <script type="text/javascript" src="https://www.databricks.com/sites/default/files/rudderstack/v1/db-rudderstack-events.js"></script>

  <!-- cookie consent -->

  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta http-equiv="X-UA-Compatible" content="IE=9" />
  <meta content="Learn how to use Query Watchdog to throttle large queries in Databricks." name="description" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0">
  <meta property="og:image" content="https://www.databricks.com/wp-content/uploads/2020/04/og-databricks.png">
  <meta property="og:image:type" content="image/png">
  <meta property="og:title" content="Handling large queries in interactive workflows">
  <meta property="og:image:width" content="1200">
  <meta property="og:image:height" content="630">
  <meta property="og:type" content="website">
  <meta property="og:url" content="https://docs.databricks.com">
  <meta property="og:description" content="" id="og-description">
  <meta name="twitter:image" content="https://www.databricks.com/wp-content/uploads/2020/04/og-databricks.png">
  <meta name="twitter:site" content="@databricks">
  <meta name="twitter:creator" content="@databricks">
  <meta property="twitter:description" content="">
  
  <title>Handling large queries in interactive workflows &#124; Databricks on AWS</title>
  
  
  <link rel="canonical" href="https://docs.databricks.com/en/compute/query-watchdog.html">
  <!-- Start hreflang tag -->
  <link rel="alternate" hreflang="en" href="https://docs.databricks.com/en/compute/query-watchdog.html" />
<link rel="alternate" hreflang="x-default" href="https://docs.databricks.com/en/compute/query-watchdog.html" />
  <!-- End hreflang tag -->
  
  
  <link rel="shortcut icon" href="../_static/favicon.ico" />
  

  

  

  <!-- Google Tag Manager -->
  <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'https://www.googletagmanager.com/gtm.js?id='+i+dl;
j.setAttributeNode(d.createAttribute('data-ot-ignore'));
f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-T85FQ33');</script>
  <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'https://www.googletagmanager.com/gtm.js?id='+i+dl;
j.setAttributeNode(d.createAttribute('data-ot-ignore'));
f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-TWTKQQ');</script>
    
  <!-- End Google Tag Manager -->


  <!-- MaxMind / GEO IP -->
  <script src="//js.maxmind.com/js/apis/geoip2/v2.1/geoip2.js" type="text/javascript"></script>
  <!-- End MaxMind / GEO IP -->

  
  
  <link href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,600&display=swap" rel="stylesheet">
  <link rel="preload" href="../_static/fonts/DMSans-Bold.ttf" as="font">
  <link rel="preload" href="../_static/fonts/DMSans-Regular.ttf" as="font">
  <link rel="preload" href="../_static/fonts/DMMono-Regular.ttf" as="font">
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/css/custom.css" type="text/css" />
  <link rel="stylesheet" href="../_static/css/cloud-provider-selector.css" type="text/css" />
  <link rel="stylesheet" href="../_static/css/translation-selector.css" type="text/css" />
  <link rel="stylesheet" href="../_static/css/searchunify/main.css" type="text/css" />

  
  <link rel="index" title="Index" href="../genindex.html" />
  <link rel="search" title="Search" href="../search.html" />
  <link rel="top" title="Databricks on AWS" href="../index.html" /> 
</head>

<body class="wy-body-for-nav" role="document">

  <!-- Google Tag Manager (noscript) -->
  <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-T85FQ33"
height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
  <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-TWTKQQ"
    height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
  <!-- End Google Tag Manager (noscript) -->

  
  <nav class="wy-nav-top header su_header" role="navigation" aria-label="top navigation">
    
<nav class="wy-nav-top header su_header" role="navigation" aria-label="top navigation">
  <div class="container-logo">
    <ul class="mobile-menu-toggle">
        <li class="menu-toggle">
            <i data-toggle="wy-nav-top" class="wy-nav-top-menu-button db-icon db-icon-menu pull-left"></i>
            
            <a href="https://www.databricks.com/" class="wy-nav-top-logo"><img src="../_static/small-scale-lockup-full-color-rgb.svg" width="137" height="21"
              alt="Databricks" /></a>   
               
              </li>
    </ul>
    <ul class="su_nav-menu">
      <li class="menu-toggle">
        <i data-toggle="wy-nav-top" class="wy-nav-top-menu-button db-icon db-icon-menu pull-left"></i>
        
          
        
        <a href="https://www.databricks.com/" class="wy-nav-top-logo"><img src="../_static/small-scale-lockup-full-color-rgb.svg" width="137" height="21"
            alt="Databricks" /></a></li>
        <!-- 
<li><a href="https://help.databricks.com/s/">Help Center</a></li>
<li class="active"><a href="https://docs.databricks.com/en/">Documentation</a></li>
<li><a href="https://kb.databricks.com/">Knowledge Base</a></li>
 -->
    </ul>
  </div>
  <div class="su_nav-right">
    <ul class="su_link-mobile">
  <!-- Mobile header code can go here -->
</ul>
<ul class="right-try-list">
   
</ul>
  </div>
</nav>
  </nav>

  <div class="su_sub-header">
    <div class="container">
      <div class="su_sub-header-inner">
        <!-- <div class="su_subnav-menu-right">
  <div id="auto" style="width: 100%;">
    <div ng-controller="SearchautoController">
      <div bind-html-compile="autocompleteHtml">
        <form class="su__search-box-1" disabled="disabled">
          <input class="su__search-input" type="search" name="Search box" id="su__search-b" placeholder="Search Documentation" disabled="disabled"/>
          <button class="su__search-button" type="submit" class="button button-success" disabled="disabled">
            <svg width="24" height="24" viewBox="0 0 24 24">
              <path
                d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"
                fill="#333"></path>
            </svg>
          </button>
        </form>
      </div>
    </div>
  </div>
</div> -->
        <div class="search-lng-gap"></div>
        <div style="margin-left: 16px; margin-right: 16px;">
          <!-- <select name="lng selector" id="lng-selector">
    <option value="../../en/compute/query-watchdog.html" class="notranslate">English</option>
    <option value="../../ja/compute/query-watchdog.html" class="notranslate">日本語</option>
    <option value="../../pt/compute/query-watchdog.html" class="notranslate">Português (Brasil)</option>
</select> -->
        </div>
        <div class="cloud-selector-container">
          <!-- <select name="cloud provider selector" id="cloud-provider-selector">
    <option value="aws" selected class="notranslate">
        Amazon Web Services
    </option>
    <option value="azure"  class="notranslate">
        Microsoft Azure
    </option>
    <option value="gcp"  class="notranslate">
        Google Cloud Platform
    </option>
</select> -->
        </div>
      </div>
    </div>
  </div>
  <page class="js-page-container">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side su_nav-side">
<div class="wy-side-scroll">
  <div class="wy-side-nav-search">
    

    

    

    
  </div>

  <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
    
      <a href="../index.html" class="main-navigation-home">Databricks on AWS</a>
    

    
      

      
        <p class="caption"><span class="caption-text">Load &amp; manage data</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../rag-temp/index.html">RAG Studio</a></li>
</ul>

      
    
  </div>

  <div role="contentinfo">
    
  <p class="build_info notranslate"data-last-edit="December 23, 2023">
    Updated Jan 11, 2024
  </p>
<script>
  window.addEventListener('DOMContentLoaded',function(){
    var h1=document.querySelector('h1');
    var bi=document.querySelector('[data-last-edit]');
    if(h1 && bi){
      var ver = document.createElement('p');
      ver.className = 'version_info';
      ver.textContent = bi.getAttribute('data-last-edit');
      h1.parentElement.insertBefore(ver, h1.nextElementSibling);
    }
  });
</script>

    <p>
      
        <a id='feedbacklink' href="mailto:doc-feedback@databricks.com?subject=Documentation Feedback">Send us feedback</a>
      
    </p>
  </div>
</div>
</nav>
    
    
<main class="wy-grid-for-nav su_nav-grid">
  <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
    <div class="wy-nav-content su__nav_content">
      <div class="rst-content">
        





<div role="navigation" aria-label="breadcrumbs navigation" class="wy-breadcrumbs-wrapper">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html">Documentation</a> <span class="db-icon db-icon-chevron-right"></span></li>
    
    
      <li>Handling large queries in interactive workflows</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>
</div>
        
        <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
          <div itemprop="articleBody">
            
    
  <div class="section" id="handling-large-queries-in-interactive-workflows">
<h1>Handling large queries in interactive workflows<a class="headerlink" href="#handling-large-queries-in-interactive-workflows" title="Permalink to this headline"> </a></h1>
<p>A challenge with interactive data workflows is handling large queries. This includes queries that generate too many output rows, fetch many external partitions, or compute on extremely large data sets. These queries can be extremely slow, saturate cluster resources, and make it difficult for others to share the same cluster.</p>
<p>Query Watchdog is a process that prevents queries from monopolizing cluster resources by examining the most common causes of large queries and terminating queries that pass a threshold. This article describes how to enable and configure Query Watchdog.</p>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>Query Watchdog is enabled for all all-purpose clusters created using the UI.</p>
</div>
<div class="section" id="example-of-a-disruptive-query">
<h2>Example of a disruptive query<a class="headerlink" href="#example-of-a-disruptive-query" title="Permalink to this headline"> </a></h2>
<p>An analyst is performing some ad hoc queries in a just-in-time data warehouse. The analyst uses a shared autoscaling cluster that makes it easy for multiple users to use a single cluster at the same time. Suppose there are two tables that each have a million rows.</p>
<div class="highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="k">import</span><span class="w"> </span><span class="nn">org</span><span class="p">.</span><span class="nn">apache</span><span class="p">.</span><span class="nn">spark</span><span class="p">.</span><span class="nn">sql</span><span class="p">.</span><span class="nn">functions</span><span class="p">.</span><span class="n">_</span>
<span class="n">spark</span><span class="p">.</span><span class="n">conf</span><span class="p">.</span><span class="n">set</span><span class="p">(</span><span class="s">&quot;spark.sql.shuffle.partitions&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">10</span><span class="p">)</span>

<span class="n">spark</span><span class="p">.</span><span class="n">range</span><span class="p">(</span><span class="mi">1000000</span><span class="p">)</span>
<span class="w">  </span><span class="p">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s">&quot;join_key&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">lit</span><span class="p">(</span><span class="s">&quot; &quot;</span><span class="p">))</span>
<span class="w">  </span><span class="p">.</span><span class="n">createOrReplaceTempView</span><span class="p">(</span><span class="s">&quot;table_x&quot;</span><span class="p">)</span>
<span class="n">spark</span><span class="p">.</span><span class="n">range</span><span class="p">(</span><span class="mi">1000000</span><span class="p">)</span>
<span class="w">  </span><span class="p">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s">&quot;join_key&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">lit</span><span class="p">(</span><span class="s">&quot; &quot;</span><span class="p">))</span>
<span class="w">  </span><span class="p">.</span><span class="n">createOrReplaceTempView</span><span class="p">(</span><span class="s">&quot;table_y&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>These table sizes are manageable in Apache Spark. However, they each include a <code class="docutils literal notranslate"><span class="pre">join_key</span></code> column with an empty string in every row. This can happen if the data is not perfectly clean or if there is significant data skew where some keys are more prevalent than others. These empty join keys are far more prevalent than any other value.</p>
<p>In the following code, the analyst is joining these two tables on their keys, which produces output of <em>one trillion results</em>, and all of these are produced on a single executor (the executor that gets the <code class="docutils literal notranslate"><span class="pre">&quot;</span> <span class="pre">&quot;</span></code> key):</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">SELECT</span>
<span class="w">  </span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="k">count</span><span class="p">(</span><span class="n">id</span><span class="p">)</span>
<span class="k">FROM</span>
<span class="w">  </span><span class="p">(</span><span class="k">SELECT</span>
<span class="w">    </span><span class="n">x</span><span class="p">.</span><span class="n">id</span>
<span class="w">  </span><span class="k">FROM</span>
<span class="w">    </span><span class="n">table_x</span><span class="w"> </span><span class="n">x</span>
<span class="w">  </span><span class="k">JOIN</span>
<span class="w">    </span><span class="n">table_y</span><span class="w"> </span><span class="n">y</span>
<span class="w">  </span><span class="k">on</span><span class="w"> </span><span class="n">x</span><span class="p">.</span><span class="n">join_key</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">y</span><span class="p">.</span><span class="n">join_key</span><span class="p">)</span>
<span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">id</span>
</pre></div>
</div>
<p>This query appears to be running. But without knowing about the data, the analyst sees that there’s “only” a single task left over the course of executing the job. The query never finishes, leaving the analyst frustrated and confused about why it did not work.</p>
<p>In this case there is only one problematic join key. Other times there may be many more.</p>
</div>
<div class="section" id="enable-and-configure-query-watchdog">
<h2>Enable and configure Query Watchdog<a class="headerlink" href="#enable-and-configure-query-watchdog" title="Permalink to this headline"> </a></h2>
<p>To enable and configure Query Watchdog, the following steps are required.</p>
<ul class="simple">
<li><p>Enable Watchdog with <code class="docutils literal notranslate"><span class="pre">spark.databricks.queryWatchdog.enabled</span></code>.</p></li>
<li><p>Configure the task runtime with <code class="docutils literal notranslate"><span class="pre">spark.databricks.queryWatchdog.minTimeSecs</span></code>.</p></li>
<li><p>Display output with <code class="docutils literal notranslate"><span class="pre">spark.databricks.queryWatchdog.minOutputRows</span></code>.</p></li>
<li><p>Configure the output ratio with <code class="docutils literal notranslate"><span class="pre">spark.databricks.queryWatchdog.outputRatioThreshold</span></code>.</p></li>
</ul>
<p>To a prevent a query from creating too many output rows for the number of input rows, you can enable Query Watchdog and configure the maximum number of output rows as a multiple of the number of input rows.  In this example we use a ratio of 1000 (the default).</p>
<div class="highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="n">spark</span><span class="p">.</span><span class="n">conf</span><span class="p">.</span><span class="n">set</span><span class="p">(</span><span class="s">&quot;spark.databricks.queryWatchdog.enabled&quot;</span><span class="p">,</span><span class="w"> </span><span class="kc">true</span><span class="p">)</span>
<span class="n">spark</span><span class="p">.</span><span class="n">conf</span><span class="p">.</span><span class="n">set</span><span class="p">(</span><span class="s">&quot;spark.databricks.queryWatchdog.outputRatioThreshold&quot;</span><span class="p">,</span><span class="w"> </span><span class="il">1000L</span><span class="p">)</span>
</pre></div>
</div>
<p>The latter configuration declares that any given task should never produce more than 1000 times the number of input rows.</p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>The output ratio is completely customizable. We recommend starting lower and seeing what threshold works well for you and your team. A range of 1,000 to 10,000 is a good starting point.</p>
</div>
<p>Not only does Query Watchdog prevent users from monopolizing cluster resources for jobs that will never complete, it also saves time by fast-failing a query that would have never completed. For example, the following query will fail after several minutes because it exceeds the ratio.</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">SELECT</span>
<span class="w">  </span><span class="n">z</span><span class="p">.</span><span class="n">id</span>
<span class="w">  </span><span class="n">join_key</span><span class="p">,</span>
<span class="w">  </span><span class="k">sum</span><span class="p">(</span><span class="n">z</span><span class="p">.</span><span class="n">id</span><span class="p">),</span>
<span class="w">  </span><span class="k">count</span><span class="p">(</span><span class="n">z</span><span class="p">.</span><span class="n">id</span><span class="p">)</span>
<span class="k">FROM</span>
<span class="w">  </span><span class="p">(</span><span class="k">SELECT</span>
<span class="w">    </span><span class="n">x</span><span class="p">.</span><span class="n">id</span><span class="p">,</span>
<span class="w">    </span><span class="n">y</span><span class="p">.</span><span class="n">join_key</span>
<span class="w">  </span><span class="k">FROM</span>
<span class="w">    </span><span class="n">table_x</span><span class="w"> </span><span class="n">x</span>
<span class="w">  </span><span class="k">JOIN</span>
<span class="w">    </span><span class="n">table_y</span><span class="w"> </span><span class="n">y</span>
<span class="w">  </span><span class="k">on</span><span class="w"> </span><span class="n">x</span><span class="p">.</span><span class="n">join_key</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">y</span><span class="p">.</span><span class="n">join_key</span><span class="p">)</span><span class="w"> </span><span class="n">z</span>
<span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">join_key</span><span class="p">,</span><span class="w"> </span><span class="n">z</span><span class="p">.</span><span class="n">id</span>
</pre></div>
</div>
<p>Here’s what you would see:</p>
<div class="figure align-default">
<img alt="Query watchdog" src="../_images/query-watchdog-example.png" />
</div>
<p>It’s usually enough to enable Query Watchdog and set the output/input threshold ratio, but you also have the option to set two additional properties: <code class="docutils literal notranslate"><span class="pre">spark.databricks.queryWatchdog.minTimeSecs</span></code> and <code class="docutils literal notranslate"><span class="pre">spark.databricks.queryWatchdog.minOutputRows</span></code>. These properties specify the minimum time a given task in a query must run before cancelling it and the minimum number of output rows for a task in that query.</p>
<p>For example, you can set <code class="docutils literal notranslate"><span class="pre">minTimeSecs</span></code> to a higher value if you want to give it a chance to produce a large number of rows per task. Likewise, you can set <code class="docutils literal notranslate"><span class="pre">spark.databricks.queryWatchdog.minOutputRows</span></code> to ten million if you want to stop a query only after a task in that query has produced ten million rows. Anything less and the query succeeds, even if the output/input ratio was exceeded.</p>
<div class="highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="n">spark</span><span class="p">.</span><span class="n">conf</span><span class="p">.</span><span class="n">set</span><span class="p">(</span><span class="s">&quot;spark.databricks.queryWatchdog.minTimeSecs&quot;</span><span class="p">,</span><span class="w"> </span><span class="il">10L</span><span class="p">)</span>
<span class="n">spark</span><span class="p">.</span><span class="n">conf</span><span class="p">.</span><span class="n">set</span><span class="p">(</span><span class="s">&quot;spark.databricks.queryWatchdog.minOutputRows&quot;</span><span class="p">,</span><span class="w"> </span><span class="il">100000L</span><span class="p">)</span>
</pre></div>
</div>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>If you configure Query Watchdog in a notebook, the configuration does not persist across cluster restarts. If you want to configure Query Watchdog for all users of a cluster, we recommend that you use a <a class="reference internal" href="configure.html#spark-configuration"><span class="std std-ref">cluster configuration</span></a>.</p>
</div>
</div>
<div class="section" id="detect-query-on-extremely-large-dataset">
<h2>Detect query on extremely large dataset<a class="headerlink" href="#detect-query-on-extremely-large-dataset" title="Permalink to this headline"> </a></h2>
<p>Another typical large query may scan a large amount of data from big tables/datasets. The scan operation may last for a long time and saturate cluster resources (even reading metadata of a big Hive table can take a significant amount of time). You can set <code class="docutils literal notranslate"><span class="pre">maxHivePartitions</span></code> to prevent fetching too many partitions from a big Hive table. Similarly, you can also set <code class="docutils literal notranslate"><span class="pre">maxQueryTasks</span></code> to limit queries on an extremely large dataset.</p>
<div class="highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="n">spark</span><span class="p">.</span><span class="n">conf</span><span class="p">.</span><span class="n">set</span><span class="p">(</span><span class="s">&quot;spark.databricks.queryWatchdog.maxHivePartitions&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">20000</span><span class="p">)</span>
<span class="n">spark</span><span class="p">.</span><span class="n">conf</span><span class="p">.</span><span class="n">set</span><span class="p">(</span><span class="s">&quot;spark.databricks.queryWatchdog.maxQueryTasks&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">20000</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="when-should-you-enable-query-watchdog">
<h2>When should you enable Query Watchdog?<a class="headerlink" href="#when-should-you-enable-query-watchdog" title="Permalink to this headline"> </a></h2>
<p>Query Watchdog should be enabled for ad hoc analytics clusters where SQL analysts and data scientists are sharing a given cluster and an administrator needs to make sure that queries “play nicely” with one another.</p>
</div>
<div class="section" id="when-should-you-disable-query-watchdog">
<h2>When should you disable Query Watchdog?<a class="headerlink" href="#when-should-you-disable-query-watchdog" title="Permalink to this headline"> </a></h2>
<p>In general we do not advise eagerly cancelling queries used in an ETL scenario because there typically isn’t a human in the loop to correct the error. We recommend that you disable Query Watchdog for all but ad hoc analytics clusters.</p>
</div>
</div>


    
          </div>
        </div>
        <div  class="suapp-rating">
  <div id="suPageRateApp">
     <su-app></su-app>
   </div> 
 </div>
<hr> 
<footer>
  <div role="contentinfo">
      <p class="copyright">
          &copy; Databricks 2023. All rights reserved. Apache, Apache Spark, Spark, and the Spark logo are trademarks of the <a href="http://www.apache.org/">Apache Software Foundation</a>.
      </p>
      <p> 
        
          <a id='feedbacklink' href="mailto:doc-feedback@databricks.com?subject=Documentation Feedback">Send us feedback</a>
        
     | <a href="https://databricks.com/privacy-policy">Privacy Policy</a> | <a href="https://databricks.com/terms-of-use">Terms of Use</a></p>

  </div> 

</footer>
      </div>
    </div>
  </section>
</main>

  </page>
  
  <script type="text/javascript">
    var DOCUMENTATION_OPTIONS = {
      URL_ROOT: '../',
      VERSION: '1.0',
      COLLAPSE_INDEX: false,
      FILE_SUFFIX: '.html',
      HAS_SOURCE: 'false'
    };
  </script>
  <script type="text/javascript" src="../_static/jquery.js"></script>
  <script type="text/javascript" src="../_static/underscore.js"></script>
  <script type="text/javascript" src="../_static/doctools.js"></script>
  <script type="text/javascript" src="../_static/language_data.js"></script>
  

  <script type="text/javascript" src="../_static/js/clipboard.min.js"></script>
  <script type="text/javascript" src="../_static/js/jquery.waypoints.min.js"></script>

  <!-- Select2 (https://select2.org/) -->
  <link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />
  <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
  <!-- End Select2 -->

  
  
  <script type="text/javascript" src="../_static/js/localized.js"></script>
  <script type="text/javascript" src="../_static/js/custom.js"></script>
  

  
  
  <script type="text/javascript">
    jQuery(function () {
      SphinxRtdTheme.StickyNav.enable();
    });

  </script>
  
 



  <script>
  window.__searchunifyLoaderConfig = JSON.parse('{"clients": {"en": "02c2e804-27e9-11ee-aefb-0242ac120011", "ja": "6a42c3f2-2820-11ee-aefb-0242ac120011", "pt": "6a86badd-2821-11ee-aefb-0242ac120011"}}')
</script>
<script type="text/javascript" src="../_static/js/search-loader.js"></script>
</body>
<script type='text/javascript'>
  window.onload = function () {
    var description = document.querySelector('meta[name="description"]').getAttribute("content");
    let titleText = document.querySelector('h1').textContent;
    document.querySelector('meta[property="og:title"]').setAttribute("content", titleText);
    document.querySelector('meta[property="og:description"]').setAttribute("content", description);
    document.querySelector('meta[property="twitter:description"]').setAttribute("content", description);
  };
</script>

</html>