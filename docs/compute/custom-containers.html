

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en-US" > <![endif]-->
<!--[if gt IE 8]><!-->
<html class="no-js" lang="en-US"> <!--<![endif]-->

<head>
  <!-- cookie consent -->
  
    <!-- Combined Onetrust and Rudderstack Implementation Scripts -->
    <!-- Onetrust Initialization -->
    <script type="text/javascript" src="https://cdn.cookielaw.org/consent/92466579-1717-44d3-809d-a05fb02843ed-test/OtAutoBlock.js"></script>
    <script src="https://cdn.cookielaw.org/scripttemplates/otSDKStub.js" data-document-language="true" type="text/javascript" charset="UTF-8" data-domain-script="92466579-1717-44d3-809d-a05fb02843ed-test"></script>
    <link rel="stylesheet" id="db-onetrust-style" href="https://www.databricks.com/wp-content/uploads/db_onetrust.css" media="all" />
    <!-- Setting Rudderstack Write Key -->
    <script>window.rudderstackKey = "2SOR9fvSr5Fi6tN2ihPbVHnX1SZ" </script>
    <!-- Rudderstack Initialization + Onetrust Integration + Rudderstack Custom Events -->
    <script type="text/javascript" src="https://www.databricks.com/sites/default/files/rudderstack/v1/db-rudderstack-events.js"></script>

  <!-- cookie consent -->

  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta http-equiv="X-UA-Compatible" content="IE=9" />
  <meta content="Learn how to customize Databricks compute using Docker images, for full control of library customization, environment lockdown, and CI/CD integration." name="description" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0">
  <meta property="og:image" content="https://www.databricks.com/wp-content/uploads/2020/04/og-databricks.png">
  <meta property="og:image:type" content="image/png">
  <meta property="og:title" content="Customize containers with Databricks Container Service">
  <meta property="og:image:width" content="1200">
  <meta property="og:image:height" content="630">
  <meta property="og:type" content="website">
  <meta property="og:url" content="https://docs.databricks.com">
  <meta property="og:description" content="" id="og-description">
  <meta name="twitter:image" content="https://www.databricks.com/wp-content/uploads/2020/04/og-databricks.png">
  <meta name="twitter:site" content="@databricks">
  <meta name="twitter:creator" content="@databricks">
  <meta property="twitter:description" content="">
  
  <title>Customize containers with Databricks Container Service &#124; Databricks on AWS</title>
  
  
  <link rel="canonical" href="https://docs.databricks.com/en/compute/custom-containers.html">
  <!-- Start hreflang tag -->
  <link rel="alternate" hreflang="en" href="https://docs.databricks.com/en/compute/custom-containers.html" />
<link rel="alternate" hreflang="x-default" href="https://docs.databricks.com/en/compute/custom-containers.html" />
  <!-- End hreflang tag -->
  
  
  <link rel="shortcut icon" href="../_static/favicon.ico" />
  

  

  

  <!-- Google Tag Manager -->
  <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'https://www.googletagmanager.com/gtm.js?id='+i+dl;
j.setAttributeNode(d.createAttribute('data-ot-ignore'));
f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-T85FQ33');</script>
  <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'https://www.googletagmanager.com/gtm.js?id='+i+dl;
j.setAttributeNode(d.createAttribute('data-ot-ignore'));
f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-TWTKQQ');</script>
    
  <!-- End Google Tag Manager -->


  <!-- MaxMind / GEO IP -->
  <script src="//js.maxmind.com/js/apis/geoip2/v2.1/geoip2.js" type="text/javascript"></script>
  <!-- End MaxMind / GEO IP -->

  
  
  <link href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,600&display=swap" rel="stylesheet">
  <link rel="preload" href="../_static/fonts/DMSans-Bold.ttf" as="font">
  <link rel="preload" href="../_static/fonts/DMSans-Regular.ttf" as="font">
  <link rel="preload" href="../_static/fonts/DMMono-Regular.ttf" as="font">
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/css/custom.css" type="text/css" />
  <link rel="stylesheet" href="../_static/css/cloud-provider-selector.css" type="text/css" />
  <link rel="stylesheet" href="../_static/css/translation-selector.css" type="text/css" />
  <link rel="stylesheet" href="../_static/css/searchunify/main.css" type="text/css" />

  
  <link rel="index" title="Index" href="../genindex.html" />
  <link rel="search" title="Search" href="../search.html" />
  <link rel="top" title="Databricks on AWS" href="../index.html" /> 
</head>

<body class="wy-body-for-nav" role="document">

  <!-- Google Tag Manager (noscript) -->
  <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-T85FQ33"
height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
  <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-TWTKQQ"
    height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
  <!-- End Google Tag Manager (noscript) -->

  
  <nav class="wy-nav-top header su_header" role="navigation" aria-label="top navigation">
    
<nav class="wy-nav-top header su_header" role="navigation" aria-label="top navigation">
  <div class="container-logo">
    <ul class="mobile-menu-toggle">
        <li class="menu-toggle">
            <i data-toggle="wy-nav-top" class="wy-nav-top-menu-button db-icon db-icon-menu pull-left"></i>
            
            <a href="https://www.databricks.com/" class="wy-nav-top-logo"><img src="../_static/small-scale-lockup-full-color-rgb.svg" width="137" height="21"
              alt="Databricks" /></a>   
               
              </li>
    </ul>
    <ul class="su_nav-menu">
      <li class="menu-toggle">
        <i data-toggle="wy-nav-top" class="wy-nav-top-menu-button db-icon db-icon-menu pull-left"></i>
        
          
        
        <a href="https://www.databricks.com/" class="wy-nav-top-logo"><img src="../_static/small-scale-lockup-full-color-rgb.svg" width="137" height="21"
            alt="Databricks" /></a></li>
        <!-- 
<li><a href="https://help.databricks.com/s/">Help Center</a></li>
<li class="active"><a href="https://docs.databricks.com/en/">Documentation</a></li>
<li><a href="https://kb.databricks.com/">Knowledge Base</a></li>
 -->
    </ul>
  </div>
  <div class="su_nav-right">
    <ul class="su_link-mobile">
  <!-- Mobile header code can go here -->
</ul>
<ul class="right-try-list">
   
</ul>
  </div>
</nav>
  </nav>

  <div class="su_sub-header">
    <div class="container">
      <div class="su_sub-header-inner">
        <!-- <div class="su_subnav-menu-right">
  <div id="auto" style="width: 100%;">
    <div ng-controller="SearchautoController">
      <div bind-html-compile="autocompleteHtml">
        <form class="su__search-box-1" disabled="disabled">
          <input class="su__search-input" type="search" name="Search box" id="su__search-b" placeholder="Search Documentation" disabled="disabled"/>
          <button class="su__search-button" type="submit" class="button button-success" disabled="disabled">
            <svg width="24" height="24" viewBox="0 0 24 24">
              <path
                d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"
                fill="#333"></path>
            </svg>
          </button>
        </form>
      </div>
    </div>
  </div>
</div> -->
        <div class="search-lng-gap"></div>
        <div style="margin-left: 16px; margin-right: 16px;">
          <!-- <select name="lng selector" id="lng-selector">
    <option value="../../en/compute/custom-containers.html" class="notranslate">English</option>
    <option value="../../ja/compute/custom-containers.html" class="notranslate">日本語</option>
    <option value="../../pt/compute/custom-containers.html" class="notranslate">Português (Brasil)</option>
</select> -->
        </div>
        <div class="cloud-selector-container">
          <!-- <select name="cloud provider selector" id="cloud-provider-selector">
    <option value="aws" selected class="notranslate">
        Amazon Web Services
    </option>
    <option value="azure"  class="notranslate">
        Microsoft Azure
    </option>
    <option value="gcp"  class="notranslate">
        Google Cloud Platform
    </option>
</select> -->
        </div>
      </div>
    </div>
  </div>
  <page class="js-page-container">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side su_nav-side">
<div class="wy-side-scroll">
  <div class="wy-side-nav-search">
    

    

    

    
  </div>

  <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
    
      <a href="../index.html" class="main-navigation-home">Databricks on AWS</a>
    

    
      

      
        <p class="caption"><span class="caption-text">Load &amp; manage data</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../rag-temp/index.html">RAG Studio</a></li>
</ul>

      
    
  </div>

  <div role="contentinfo">
    
  <p class="build_info notranslate"data-last-edit="December 23, 2023">
    Updated Jan 11, 2024
  </p>
<script>
  window.addEventListener('DOMContentLoaded',function(){
    var h1=document.querySelector('h1');
    var bi=document.querySelector('[data-last-edit]');
    if(h1 && bi){
      var ver = document.createElement('p');
      ver.className = 'version_info';
      ver.textContent = bi.getAttribute('data-last-edit');
      h1.parentElement.insertBefore(ver, h1.nextElementSibling);
    }
  });
</script>

    <p>
      
        <a id='feedbacklink' href="mailto:doc-feedback@databricks.com?subject=Documentation Feedback">Send us feedback</a>
      
    </p>
  </div>
</div>
</nav>
    
    
<main class="wy-grid-for-nav su_nav-grid">
  <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
    <div class="wy-nav-content su__nav_content">
      <div class="rst-content">
        





<div role="navigation" aria-label="breadcrumbs navigation" class="wy-breadcrumbs-wrapper">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html">Documentation</a> <span class="db-icon db-icon-chevron-right"></span></li>
    
    
      <li>Customize containers with Databricks Container Service</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>
</div>
        
        <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
          <div itemprop="articleBody">
            
    
  <div class="section" id="customize-containers-with-databricks-container-service">
<h1>Customize containers with Databricks Container Service<a class="headerlink" href="#customize-containers-with-databricks-container-service" title="Permalink to this headline"> </a></h1>
<p>Databricks Container Services lets you specify a Docker image when you create compute. Some example use cases include:</p>
<ul class="simple">
<li><p>Library customization: you have full control over the system libraries you want installed.</p></li>
<li><p>Golden container environment: your Docker image is a locked down environment that will never change.</p></li>
<li><p>Docker CI/CD integration: you can integrate Databricks with your Docker CI/CD pipelines.</p></li>
</ul>
<p>You can also use Docker images to create custom deep learning environments on compute with GPU devices. For additional information about using GPU clusters with Databricks Container Services, see <a class="reference internal" href="gpu.html#databricks-container-services-on-gpu"><span class="std std-ref">Databricks Container Services on GPU clusters</span></a>.</p>
<p>For tasks to be executed each time the container starts, use an <a class="reference internal" href="#containers-init-script"><span class="std std-ref">init script</span></a>.</p>
<div class="section" id="requirements">
<h2>Requirements<a class="headerlink" href="#requirements" title="Permalink to this headline"> </a></h2>
<ul class="simple">
<li><p>Your Databricks workspace must have Databricks Container Services <a class="reference internal" href="#enable"><span class="std std-ref">enabled</span></a>.</p></li>
<li><p>Your machine must be running a recent Docker daemon (one that is tested and works with Client/Server Version 18.03.0-ce) and the <code class="docutils literal notranslate"><span class="pre">docker</span></code> command must be available on your <code class="docutils literal notranslate"><span class="pre">PATH</span></code>.</p></li>
</ul>
</div>
<div class="section" id="limitations">
<h2>Limitations<a class="headerlink" href="#limitations" title="Permalink to this headline"> </a></h2>
<ul class="simple">
<li><p>Databricks Container Services is not supported on compute using shared access mode.</p></li>
<li><p>Databricks Runtime for Machine Learning does not support Databricks Container Services.</p></li>
<li><p>To access Volumes on Databricks Container Services, add the following configuration to the compute’s <strong>Spark config</strong> field: <code class="docutils literal notranslate"><span class="pre">spark.databricks.unityCatalog.volumes.enabled</span> <span class="pre">true</span></code>.</p></li>
</ul>
</div>
<div class="section" id="step-1-build-your-base">
<h2>Step 1: Build your base<a class="headerlink" href="#step-1-build-your-base" title="Permalink to this headline"> </a></h2>
<p>Databricks recommends that you build your Docker base from a base that Databricks has built and tested. It is also possible to build your Docker base from scratch. This section describes the two options.</p>
<div class="section" id="option-1-use-a-base-built-by-databricks">
<h3>Option 1. Use a base built by Databricks<a class="headerlink" href="#option-1-use-a-base-built-by-databricks" title="Permalink to this headline"> </a></h3>
<p>This example uses the <code class="docutils literal notranslate"><span class="pre">9.x</span></code> tag for an image that will target a compute with runtime version Databricks Runtime 9.0 and above:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>FROM<span class="w"> </span>databricksruntime/standard:9.x
...
</pre></div>
</div>
<p>To specify additional Python libraries, such as the latest version of pandas and urllib, use the container-specific version of <code class="docutils literal notranslate"><span class="pre">pip</span></code>. For the <code class="docutils literal notranslate"><span class="pre">databricksruntime/standard:9.x</span></code> container, include the following:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>RUN<span class="w"> </span>/databricks/python3/bin/pip<span class="w"> </span>install<span class="w"> </span>pandas
RUN<span class="w"> </span>/databricks/python3/bin/pip<span class="w"> </span>install<span class="w"> </span>urllib3
</pre></div>
</div>
<p>For the <code class="docutils literal notranslate"><span class="pre">databricksruntime/standard:8.x</span></code> container or lower, include the following:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>RUN<span class="w"> </span>/databricks/conda/envs/dcs-minimal/bin/pip<span class="w"> </span>install<span class="w"> </span>pandas
RUN<span class="w"> </span>/databricks/conda/envs/dcs-minimal/bin/pip<span class="w"> </span>install<span class="w"> </span>urllib3
</pre></div>
</div>
<p>Base images are hosted on Docker Hub at <a class="reference external" href="https://hub.docker.com/u/databricksruntime">https://hub.docker.com/u/databricksruntime</a>. The Dockerfiles used to generate these bases are at <a class="reference external" href="https://github.com/databricks/containers">https://github.com/databricks/containers</a>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Docker Hub hosted images with Tags with “-LTS” suffix will be patched. All other images are examples and are not patched regularly.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The base images <code class="docutils literal notranslate"><span class="pre">databricksruntime/standard</span></code> and <code class="docutils literal notranslate"><span class="pre">databricksruntime/minimal</span></code> are not to be confused with the unrelated <code class="docutils literal notranslate"><span class="pre">databricks-standard</span></code> and <code class="docutils literal notranslate"><span class="pre">databricks-minimal</span></code> environments included in the no longer available Databricks Runtime with Conda (Beta).</p>
</div>
</div>
<div class="section" id="option-2-build-your-own-docker-base">
<h3>Option 2. Build your own Docker base<a class="headerlink" href="#option-2-build-your-own-docker-base" title="Permalink to this headline"> </a></h3>
<p>You can also build your Docker base from scratch. The Docker image must meet these requirements:</p>
<ul class="simple">
<li><p>JDK 8u191 as Java on the system <code class="docutils literal notranslate"><span class="pre">PATH</span></code></p></li>
<li><p>bash</p></li>
<li><p>iproute2 (<a class="reference external" href="https://packages.ubuntu.com/search?keywords=iproute2">ubuntu iproute</a>)</p></li>
<li><p>coreutils (<a class="reference external" href="https://packages.ubuntu.com/search?keywords=coreutils">ubuntu coreutils</a>)</p></li>
<li><p>procps (<a class="reference external" href="https://packages.ubuntu.com/search?keywords=procps">ubuntu procps</a>)</p></li>
<li><p>sudo (<a class="reference external" href="https://packages.ubuntu.com/search?keywords=sudo">ubuntu sudo</a>)</p></li>
<li><p>Ubuntu Linux</p></li>
</ul>
<p>To build your own image from scratch, you must create the virtual environment. You must also include packages that are built into Databricks compute, such as Python and R. To get started, you can use the appropriate base image:</p>
<ul class="simple">
<li><p>For R:  <code class="docutils literal notranslate"><span class="pre">databricksruntime/rbase</span></code></p></li>
<li><p>For Python: <code class="docutils literal notranslate"><span class="pre">databricksruntime/python</span></code></p></li>
<li><p>For the minimal image built by Databricks: <code class="docutils literal notranslate"><span class="pre">databricksruntime/minimal</span></code></p></li>
</ul>
<p>You can also refer to the example <a class="reference external" href="https://hub.docker.com/u/databricksruntime">Dockerfiles in GitHub</a>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Databricks recommends using Ubuntu Linux; however, it is possible to use Alpine Linux. To use Alpine Linux, you must include these files:</p>
<ul class="simple">
<li><p><a class="reference external" href="https://pkgs.alpinelinux.org/package/v3.3/main/x86/coreutils">alpine coreutils</a></p></li>
<li><p><a class="reference external" href="https://pkgs.alpinelinux.org/package/v3.3/main/x86/procps">alpine procps</a></p></li>
<li><p><a class="reference external" href="https://pkgs.alpinelinux.org/package/v3.3/main/x86/sudo">alpine sudo</a></p></li>
</ul>
<p>In addition, you must set up Python, as shown in this <a class="reference external" href="https://github.com/databricks/containers/blob/master/experimental/alpine/minimal/Dockerfile">example Dockerfile</a>.</p>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Test your custom container image thoroughly on a Databricks compute. Your container may work on a local or build machine, but when your container is launched on Databricks the compute launch may fail, certain features may become disabled, or your container may stop working, even silently. In worst-case scenarios, it could corrupt your data or accidentally expose your data to external parties.</p>
</div>
<p>As a reminder, your use of Databricks Container Services is subject to the <a class="reference external" href="https://databricks.com/product-specific-terms">Service Specific Terms</a>.</p>
</div>
</div>
<div class="section" id="step-2-push-your-base-image">
<h2>Step 2: Push your base image<a class="headerlink" href="#step-2-push-your-base-image" title="Permalink to this headline"> </a></h2>
<p>Push your custom base image to a Docker registry. This process is supported with the following registries:</p>
<ul class="simple">
<li><p><a class="reference external" href="https://hub.docker.com/">Docker Hub</a> with no auth or basic auth.</p></li>
<li><p><a class="reference external" href="https://aws.amazon.com/ecr/">Amazon Elastic Container Registry (Amazon ECR)</a> with IAM (with the exception of Commercial Cloud Services (C2S)).</p></li>
<li><p><a class="reference external" href="https://learn.microsoft.com/azure/container-registry/">Azure Container Registry</a> with basic auth.</p></li>
</ul>
<p>Other Docker registries that support no auth or basic auth are also expected to work.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If you use Docker Hub for your Docker registry, be sure to check that rate limits accommodate the amount of compute that you expect to launch in a six-hour period. These rate limits  are different for anonymous users, authenticated users without a paid subscription, and paid subscriptions. See <a class="reference external" href="https://docs.docker.com/docker-hub/download-rate-limit/">the Docker documentation</a> for details. If this limit is exceeded, you will get a “429 Too Many Requests” response.</p>
</div>
</div>
<div class="section" id="step-3-launch-your-compute">
<h2>Step 3: Launch your compute<a class="headerlink" href="#step-3-launch-your-compute" title="Permalink to this headline"> </a></h2>
<p>You can launch your compute using the UI or the API.</p>
<div class="section" id="launch-your-compute-using-the-ui">
<h3>Launch your compute using the UI<a class="headerlink" href="#launch-your-compute-using-the-ui" title="Permalink to this headline"> </a></h3>
<ol class="arabic">
<li><p>On the <a class="reference internal" href="configure.html"><span class="doc">Create compute page</span></a>, specify a Databricks Runtime Version that supports Databricks Container Services.</p></li>
<li><p>Under <strong>Advanced options</strong>, select the <strong>Docker</strong> tab.</p></li>
<li><p>Select <strong>Use your own Docker container</strong>.</p></li>
<li><p>In the <strong>Docker Image URL</strong> field, enter your custom Docker image.</p>
<p>Docker image URL examples:</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Registry</p></th>
<th class="head"><p>Tag format</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Docker Hub</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">&lt;organization&gt;/&lt;repository&gt;:&lt;tag&gt;</span></code> (for example: <code class="docutils literal notranslate"><span class="pre">databricksruntime/standard:latest</span></code>)</p></td>
</tr>
<tr class="row-odd"><td><p>Amazon ECR</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">&lt;aws-account-id&gt;.dkr.ecr.&lt;region&gt;.amazonaws.com/&lt;repository&gt;:&lt;tag&gt;</span></code></p></td>
</tr>
<tr class="row-even"><td><p>Azure Container Registry</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">&lt;your-registry-name&gt;.azurecr.io/&lt;repository-name&gt;:&lt;tag&gt;</span></code></p></td>
</tr>
</tbody>
</table>
</li>
<li><p>Select the authentication type.</p></li>
</ol>
</div>
<div class="section" id="launch-your-compute-using-the-api">
<h3>Launch your compute using the API<a class="headerlink" href="#launch-your-compute-using-the-api" title="Permalink to this headline"> </a></h3>
<ol class="arabic">
<li><p><a class="reference external" href="https://docs.databricks.com/api/workspace/tokenmanagement">Generate an API token</a>.</p></li>
<li><p>Use the <a class="reference external" href="https://docs.databricks.com/api/workspace/clusters">Clusters API</a> to launch a compute with your custom Docker base.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>curl<span class="w"> </span>-X<span class="w"> </span>POST<span class="w"> </span>-H<span class="w"> </span><span class="s2">&quot;Authorization: Bearer &lt;token&gt;&quot;</span><span class="w"> </span>https://&lt;databricks-instance&gt;/api/2.0/clusters/create<span class="w"> </span>-d<span class="w"> </span><span class="s1">&#39;{</span>
<span class="s1">  &quot;cluster_name&quot;: &quot;&lt;cluster-name&gt;&quot;,</span>
<span class="s1">  &quot;num_workers&quot;: 0,</span>
<span class="s1">  &quot;node_type_id&quot;: &quot;i3.xlarge&quot;,</span>
<span class="s1">  &quot;docker_image&quot;: {</span>
<span class="s1">    &quot;url&quot;: &quot;databricksruntime/standard:latest&quot;,</span>
<span class="s1">    &quot;basic_auth&quot;: {</span>
<span class="s1">      &quot;username&quot;: &quot;&lt;docker-registry-username&gt;&quot;,</span>
<span class="s1">      &quot;password&quot;: &quot;&lt;docker-registry-password&gt;&quot;</span>
<span class="s1">    }</span>
<span class="s1">  },</span>
<span class="s1">  &quot;spark_version&quot;: &quot;7.3.x-scala2.12&quot;,</span>
<span class="s1">  &quot;aws_attributes&quot;: {</span>
<span class="s1">    &quot;availability&quot;: &quot;ON_DEMAND&quot;,</span>
<span class="s1">    &quot;instance_profile_arn&quot;: &quot;arn:aws:iam::&lt;aws-account-number&gt;:instance-profile/&lt;iam-role-name&gt;&quot;</span>
<span class="s1">  }</span>
<span class="s1">}&#39;</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">basic_auth</span></code> requirements depend on your Docker image type:</p>
<ul>
<li><p>For public Docker images, <em>do not</em> include the <code class="docutils literal notranslate"><span class="pre">basic_auth</span></code> field.</p></li>
<li><p>For private Docker images, you must include the <code class="docutils literal notranslate"><span class="pre">basic_auth</span></code> field, using a service principal ID and password as the username and password.</p></li>
<li><p>For Azure Container Registry, you must set the <code class="docutils literal notranslate"><span class="pre">basic_auth</span></code> field to the ID and password for a service principal. See <a class="reference external" href="https://learn.microsoft.com/azure/container-registry/container-registry-auth-service-principal">Azure Container Registry service principal authentication documentation</a> for information about creating the service principal.</p></li>
<li><p>For Amazon ECR images, do not include the <code class="docutils literal notranslate"><span class="pre">basic_auth</span></code> field. You must launch your compute with an <a class="reference external" href="https://docs.databricks.com/api/workspace/clusters">instance profile</a> that includes permissions to pull Docker images from the Docker repository where the image resides. To do this, follow <a class="reference internal" href="../connect/storage/tutorial-s3-instance-profile.html"><span class="doc">steps 3 and 4 of the process for setting up secure access to S3 buckets using instance profiles</span></a>.</p>
<p>Here is an example of an IAM role with permission to pull any image. The repository is specified by <code class="docutils literal notranslate"><span class="pre">&lt;arn-of-repository&gt;</span></code>.</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="w"> </span><span class="p">{</span>
<span class="w">   </span><span class="nt">&quot;Version&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;2012-10-17&quot;</span><span class="p">,</span>
<span class="w">   </span><span class="nt">&quot;Statement&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">     </span><span class="p">{</span>
<span class="w">       </span><span class="nt">&quot;Effect&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Allow&quot;</span><span class="p">,</span>
<span class="w">       </span><span class="nt">&quot;Action&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">           </span><span class="s2">&quot;ecr:GetAuthorizationToken&quot;</span>
<span class="w">       </span><span class="p">],</span>
<span class="w">     </span><span class="nt">&quot;Resource&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;*&quot;</span>
<span class="w">   </span><span class="p">},</span>
<span class="w">   </span><span class="p">{</span>
<span class="w">     </span><span class="nt">&quot;Effect&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Allow&quot;</span><span class="p">,</span>
<span class="w">     </span><span class="nt">&quot;Action&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">         </span><span class="s2">&quot;ecr:BatchCheckLayerAvailability&quot;</span><span class="p">,</span>
<span class="w">         </span><span class="s2">&quot;ecr:GetDownloadUrlForLayer&quot;</span><span class="p">,</span>
<span class="w">         </span><span class="s2">&quot;ecr:GetrepositoryPolicy&quot;</span><span class="p">,</span>
<span class="w">         </span><span class="s2">&quot;ecr:DescribeRepositories&quot;</span><span class="p">,</span>
<span class="w">         </span><span class="s2">&quot;ecr:ListImages&quot;</span><span class="p">,</span>
<span class="w">         </span><span class="s2">&quot;ecr:DescribeImages&quot;</span><span class="p">,</span>
<span class="w">         </span><span class="s2">&quot;ecr:BatchGetImage&quot;</span>
<span class="w">       </span><span class="p">],</span>
<span class="w">       </span><span class="nt">&quot;Resource&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="s2">&quot;&lt;arn-of-repository&gt;&quot;</span><span class="w"> </span><span class="p">]</span>
<span class="w">     </span><span class="p">}</span>
<span class="w">   </span><span class="p">]</span>
<span class="w"> </span><span class="p">}</span>
</pre></div>
</div>
<p>If the Amazon ECR image resides in a different AWS account than the Databricks compute, use an <a class="reference external" href="https://docs.aws.amazon.com/AmazonECR/latest/userguide/repository-policies.html">ECR repository policy</a> in addition to the compute instance profile to grant the compute access. Here is an example of an ECR repository policy. The IAM role assumed by the compute’s instance profile is specified by <code class="docutils literal notranslate"><span class="pre">&lt;arn-of-IAM-role&gt;</span></code>.</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;Version&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;2012-10-17&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;Statement&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[{</span>
<span class="w">    </span><span class="nt">&quot;Sid&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;AllowCrossAccountPush&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;Effect&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Allow&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;Principal&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;AWS&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;&lt;arn-of-IAM-role&gt;&quot;</span>
<span class="w">    </span><span class="p">},</span>
<span class="w">    </span><span class="nt">&quot;Action&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">      </span><span class="s2">&quot;ecr:BatchCheckLayerAvailability&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="s2">&quot;ecr:BatchGetImage&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="s2">&quot;ecr:DescribeImages&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="s2">&quot;ecr:DescribeRepositories&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="s2">&quot;ecr:GetDownloadUrlForLayer&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="s2">&quot;ecr:GetrepositoryPolicy&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="s2">&quot;ecr:ListImages&quot;</span>
<span class="w">    </span><span class="p">]</span>
<span class="w">  </span><span class="p">}]</span>
<span class="p">}</span>
</pre></div>
</div>
</li>
</ul>
</li>
</ol>
</div>
</div>
<div class="section" id="use-an-init-script">
<span id="containers-init-script"></span><h2>Use an init script<a class="headerlink" href="#use-an-init-script" title="Permalink to this headline"> </a></h2>
<p>Databricks Container Services enable customers to include init scripts in the Docker container. In most cases, you should avoid init scripts and instead make customizations through Docker directly (using the Dockerfile). However, certain tasks must be executed when the container starts, instead of when the container is built. Use an init script for these tasks.</p>
<p>For example, suppose you want to run a security daemon inside a custom container. Install and build the daemon in the Docker image through your image building pipeline. Then, add an init script that starts the daemon. In this example, the init script would include a line like <code class="docutils literal notranslate"><span class="pre">systemctl</span> <span class="pre">start</span> <span class="pre">my-daemon</span></code>.</p>
<p>In the API, you can specify init scripts as part of the compute spec as follows. For more information, see the <a class="reference external" href="https://docs.databricks.com/api/workspace/clusters">Clusters API</a>.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="s2">&quot;init_scripts&quot;</span>:<span class="w"> </span><span class="o">[</span>
<span class="w">    </span><span class="o">{</span>
<span class="w">        </span><span class="s2">&quot;file&quot;</span>:<span class="w"> </span><span class="o">{</span>
<span class="w">            </span><span class="s2">&quot;destination&quot;</span>:<span class="w"> </span><span class="s2">&quot;file:/my/local/file.sh&quot;</span>
<span class="w">        </span><span class="o">}</span>
<span class="w">    </span><span class="o">}</span>
<span class="o">]</span>
</pre></div>
</div>
<p>For Databricks Container Services images, you can also store init scripts in cloud storage.</p>
<p>The following steps take place when you launch a compute that uses Databricks Container Services:</p>
<ol class="arabic simple">
<li><p>VMs are acquired from the cloud provider.</p></li>
<li><p>The custom Docker image is downloaded from your repo.</p></li>
<li><p>Databricks creates a Docker container from the image.</p></li>
<li><p>Databricks Runtime code is copied into the Docker container.</p></li>
<li><p>The init scripts are executed. See <a class="reference internal" href="../init-scripts/index.html"><span class="doc">What are init scripts?</span></a>.</p></li>
</ol>
<p>Databricks ignores the Docker <code class="docutils literal notranslate"><span class="pre">CMD</span></code> and <code class="docutils literal notranslate"><span class="pre">ENTRYPOINT</span></code> primitives.</p>
</div>
<div class="section" id="enable-container-services">
<span id="enable"></span><h2>Enable Container Services<a class="headerlink" href="#enable-container-services" title="Permalink to this headline"> </a></h2>
<p>To use custom containers on your compute, a workspace admin must enable Databricks Container Services.</p>
<p>Workspace admins can enable Databricks Container Service using the <a class="reference external" href="https://docs.databricks.com/api/workspace/workspaceconf/setstatus">Workspace configuration API</a>. In a JSON request body, specify <code class="docutils literal notranslate"><span class="pre">enableDcs</span></code> to <code class="docutils literal notranslate"><span class="pre">true</span></code>, as in the following example:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>curl<span class="w"> </span>-X<span class="w"> </span>PATCH<span class="w"> </span>-n<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>https://&lt;databricks-instance&gt;/api/2.0/workspace-conf<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-d<span class="w"> </span><span class="s1">&#39;{</span>
<span class="s1">    &quot;enableDcs&quot;: &quot;true&quot;</span>
<span class="s1">    }&#39;</span>
</pre></div>
</div>
</div>
</div>


    
          </div>
        </div>
        <div  class="suapp-rating">
  <div id="suPageRateApp">
     <su-app></su-app>
   </div> 
 </div>
<hr> 
<footer>
  <div role="contentinfo">
      <p class="copyright">
          &copy; Databricks 2023. All rights reserved. Apache, Apache Spark, Spark, and the Spark logo are trademarks of the <a href="http://www.apache.org/">Apache Software Foundation</a>.
      </p>
      <p> 
        
          <a id='feedbacklink' href="mailto:doc-feedback@databricks.com?subject=Documentation Feedback">Send us feedback</a>
        
     | <a href="https://databricks.com/privacy-policy">Privacy Policy</a> | <a href="https://databricks.com/terms-of-use">Terms of Use</a></p>

  </div> 

</footer>
      </div>
    </div>
  </section>
</main>

  </page>
  
  <script type="text/javascript">
    var DOCUMENTATION_OPTIONS = {
      URL_ROOT: '../',
      VERSION: '1.0',
      COLLAPSE_INDEX: false,
      FILE_SUFFIX: '.html',
      HAS_SOURCE: 'false'
    };
  </script>
  <script type="text/javascript" src="../_static/jquery.js"></script>
  <script type="text/javascript" src="../_static/underscore.js"></script>
  <script type="text/javascript" src="../_static/doctools.js"></script>
  <script type="text/javascript" src="../_static/language_data.js"></script>
  

  <script type="text/javascript" src="../_static/js/clipboard.min.js"></script>
  <script type="text/javascript" src="../_static/js/jquery.waypoints.min.js"></script>

  <!-- Select2 (https://select2.org/) -->
  <link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />
  <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
  <!-- End Select2 -->

  
  
  <script type="text/javascript" src="../_static/js/localized.js"></script>
  <script type="text/javascript" src="../_static/js/custom.js"></script>
  

  
  
  <script type="text/javascript">
    jQuery(function () {
      SphinxRtdTheme.StickyNav.enable();
    });

  </script>
  
 



  <script>
  window.__searchunifyLoaderConfig = JSON.parse('{"clients": {"en": "02c2e804-27e9-11ee-aefb-0242ac120011", "ja": "6a42c3f2-2820-11ee-aefb-0242ac120011", "pt": "6a86badd-2821-11ee-aefb-0242ac120011"}}')
</script>
<script type="text/javascript" src="../_static/js/search-loader.js"></script>
</body>
<script type='text/javascript'>
  window.onload = function () {
    var description = document.querySelector('meta[name="description"]').getAttribute("content");
    let titleText = document.querySelector('h1').textContent;
    document.querySelector('meta[property="og:title"]').setAttribute("content", titleText);
    document.querySelector('meta[property="og:description"]').setAttribute("content", description);
    document.querySelector('meta[property="twitter:description"]').setAttribute("content", description);
  };
</script>

</html>