

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en-US" > <![endif]-->
<!--[if gt IE 8]><!-->
<html class="no-js" lang="en-US"> <!--<![endif]-->

<head>
  <!-- cookie consent -->
  
    <!-- Combined Onetrust and Rudderstack Implementation Scripts -->
    <!-- Onetrust Initialization -->
    <script type="text/javascript" src="https://cdn.cookielaw.org/consent/92466579-1717-44d3-809d-a05fb02843ed-test/OtAutoBlock.js"></script>
    <script src="https://cdn.cookielaw.org/scripttemplates/otSDKStub.js" data-document-language="true" type="text/javascript" charset="UTF-8" data-domain-script="92466579-1717-44d3-809d-a05fb02843ed-test"></script>
    <link rel="stylesheet" id="db-onetrust-style" href="https://www.databricks.com/wp-content/uploads/db_onetrust.css" media="all" />
    <!-- Setting Rudderstack Write Key -->
    <script>window.rudderstackKey = "2SOR9fvSr5Fi6tN2ihPbVHnX1SZ" </script>
    <!-- Rudderstack Initialization + Onetrust Integration + Rudderstack Custom Events -->
    <script type="text/javascript" src="https://www.databricks.com/sites/default/files/rudderstack/v1/db-rudderstack-events.js"></script>

  <!-- cookie consent -->

  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta http-equiv="X-UA-Compatible" content="IE=9" />
  <meta content="Learn how Databricks SQL admins configure access to data objects from all SQL warehouses (formerly called SQL warehouses)." name="description" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0">
  <meta property="og:image" content="https://www.databricks.com/wp-content/uploads/2020/04/og-databricks.png">
  <meta property="og:image:type" content="image/png">
  <meta property="og:title" content="Enable data access configuration">
  <meta property="og:image:width" content="1200">
  <meta property="og:image:height" content="630">
  <meta property="og:type" content="website">
  <meta property="og:url" content="https://docs.databricks.com">
  <meta property="og:description" content="" id="og-description">
  <meta name="twitter:image" content="https://www.databricks.com/wp-content/uploads/2020/04/og-databricks.png">
  <meta name="twitter:site" content="@databricks">
  <meta name="twitter:creator" content="@databricks">
  <meta property="twitter:description" content="">
  
  <title>Enable data access configuration &#124; Databricks on AWS</title>
  
  
  <link rel="canonical" href="https://docs.databricks.com/en/compute/sql-warehouse/data-access-configuration.html">
  <!-- Start hreflang tag -->
  <link rel="alternate" hreflang="en" href="https://docs.databricks.com/en/compute/sql-warehouse/data-access-configuration.html" />
<link rel="alternate" hreflang="x-default" href="https://docs.databricks.com/en/compute/sql-warehouse/data-access-configuration.html" />
  <!-- End hreflang tag -->
  
  
  <link rel="shortcut icon" href="../../_static/favicon.ico" />
  

  

  

  <!-- Google Tag Manager -->
  <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'https://www.googletagmanager.com/gtm.js?id='+i+dl;
j.setAttributeNode(d.createAttribute('data-ot-ignore'));
f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-T85FQ33');</script>
  <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'https://www.googletagmanager.com/gtm.js?id='+i+dl;
j.setAttributeNode(d.createAttribute('data-ot-ignore'));
f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-TWTKQQ');</script>
    
  <!-- End Google Tag Manager -->


  <!-- MaxMind / GEO IP -->
  <script src="//js.maxmind.com/js/apis/geoip2/v2.1/geoip2.js" type="text/javascript"></script>
  <!-- End MaxMind / GEO IP -->

  
  
  <link href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,600&display=swap" rel="stylesheet">
  <link rel="preload" href="../../_static/fonts/DMSans-Bold.ttf" as="font">
  <link rel="preload" href="../../_static/fonts/DMSans-Regular.ttf" as="font">
  <link rel="preload" href="../../_static/fonts/DMMono-Regular.ttf" as="font">
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/css/custom.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/css/cloud-provider-selector.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/css/translation-selector.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/css/searchunify/main.css" type="text/css" />

  
  <link rel="index" title="Index" href="../../genindex.html" />
  <link rel="search" title="Search" href="../../search.html" />
  <link rel="top" title="Databricks on AWS" href="../../index.html" /> 
</head>

<body class="wy-body-for-nav" role="document">

  <!-- Google Tag Manager (noscript) -->
  <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-T85FQ33"
height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
  <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-TWTKQQ"
    height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
  <!-- End Google Tag Manager (noscript) -->

  
  <nav class="wy-nav-top header su_header" role="navigation" aria-label="top navigation">
    
<nav class="wy-nav-top header su_header" role="navigation" aria-label="top navigation">
  <div class="container-logo">
    <ul class="mobile-menu-toggle">
        <li class="menu-toggle">
            <i data-toggle="wy-nav-top" class="wy-nav-top-menu-button db-icon db-icon-menu pull-left"></i>
            
            <a href="https://www.databricks.com/" class="wy-nav-top-logo"><img src="../../_static/small-scale-lockup-full-color-rgb.svg" width="137" height="21"
              alt="Databricks" /></a>   
               
              </li>
    </ul>
    <ul class="su_nav-menu">
      <li class="menu-toggle">
        <i data-toggle="wy-nav-top" class="wy-nav-top-menu-button db-icon db-icon-menu pull-left"></i>
        
          
        
        <a href="https://www.databricks.com/" class="wy-nav-top-logo"><img src="../../_static/small-scale-lockup-full-color-rgb.svg" width="137" height="21"
            alt="Databricks" /></a></li>
        <!-- 
<li><a href="https://help.databricks.com/s/">Help Center</a></li>
<li class="active"><a href="https://docs.databricks.com/en/">Documentation</a></li>
<li><a href="https://kb.databricks.com/">Knowledge Base</a></li>
 -->
    </ul>
  </div>
  <div class="su_nav-right">
    <ul class="su_link-mobile">
  <!-- Mobile header code can go here -->
</ul>
<ul class="right-try-list">
   
</ul>
  </div>
</nav>
  </nav>

  <div class="su_sub-header">
    <div class="container">
      <div class="su_sub-header-inner">
        <!-- <div class="su_subnav-menu-right">
  <div id="auto" style="width: 100%;">
    <div ng-controller="SearchautoController">
      <div bind-html-compile="autocompleteHtml">
        <form class="su__search-box-1" disabled="disabled">
          <input class="su__search-input" type="search" name="Search box" id="su__search-b" placeholder="Search Documentation" disabled="disabled"/>
          <button class="su__search-button" type="submit" class="button button-success" disabled="disabled">
            <svg width="24" height="24" viewBox="0 0 24 24">
              <path
                d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"
                fill="#333"></path>
            </svg>
          </button>
        </form>
      </div>
    </div>
  </div>
</div> -->
        <div class="search-lng-gap"></div>
        <div style="margin-left: 16px; margin-right: 16px;">
          <!-- <select name="lng selector" id="lng-selector">
    <option value="../../../en/compute/sql-warehouse/data-access-configuration.html" class="notranslate">English</option>
    <option value="../../../ja/compute/sql-warehouse/data-access-configuration.html" class="notranslate">日本語</option>
    <option value="../../../pt/compute/sql-warehouse/data-access-configuration.html" class="notranslate">Português (Brasil)</option>
</select> -->
        </div>
        <div class="cloud-selector-container">
          <!-- <select name="cloud provider selector" id="cloud-provider-selector">
    <option value="aws" selected class="notranslate">
        Amazon Web Services
    </option>
    <option value="azure"  class="notranslate">
        Microsoft Azure
    </option>
    <option value="gcp"  class="notranslate">
        Google Cloud Platform
    </option>
</select> -->
        </div>
      </div>
    </div>
  </div>
  <page class="js-page-container">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side su_nav-side">
<div class="wy-side-scroll">
  <div class="wy-side-nav-search">
    

    

    

    
  </div>

  <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
    
      <a href="../../index.html" class="main-navigation-home">Databricks on AWS</a>
    

    
      

      
        <p class="caption"><span class="caption-text">Load &amp; manage data</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../rag-temp/index.html">RAG Studio</a></li>
</ul>

      
    
  </div>

  <div role="contentinfo">
    
  <p class="build_info notranslate"data-last-edit="December 23, 2023">
    Updated Jan 11, 2024
  </p>
<script>
  window.addEventListener('DOMContentLoaded',function(){
    var h1=document.querySelector('h1');
    var bi=document.querySelector('[data-last-edit]');
    if(h1 && bi){
      var ver = document.createElement('p');
      ver.className = 'version_info';
      ver.textContent = bi.getAttribute('data-last-edit');
      h1.parentElement.insertBefore(ver, h1.nextElementSibling);
    }
  });
</script>

    <p>
      
        <a id='feedbacklink' href="mailto:doc-feedback@databricks.com?subject=Documentation Feedback">Send us feedback</a>
      
    </p>
  </div>
</div>
</nav>
    
    
<main class="wy-grid-for-nav su_nav-grid">
  <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
    <div class="wy-nav-content su__nav_content">
      <div class="rst-content">
        





<div role="navigation" aria-label="breadcrumbs navigation" class="wy-breadcrumbs-wrapper">
  <ul class="wy-breadcrumbs">
    <li><a href="../../index.html">Documentation</a> <span class="db-icon db-icon-chevron-right"></span></li>
    
    
      <li>Enable data access configuration</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>
</div>
        
        <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
          <div itemprop="articleBody">
            
    
  <div class="section" id="enable-data-access-configuration">
<h1>Enable data access configuration<a class="headerlink" href="#enable-data-access-configuration" title="Permalink to this headline"> </a></h1>
<p>This article describes the data access configurations performed by Databricks administrators for all SQL warehouses using the UI.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If your workspace is enabled for Unity Catalog, you don’t need to perform the steps in this article. Unity Catalog supports SQL warehouses by default.</p>
</div>
<p>To configure all SQL warehouses using the REST API, see <a class="reference external" href="https://docs.databricks.com/api/workspace/warehouses">SQL Warehouses API</a>.</p>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>Changing these settings restarts all running SQL warehouses.</p>
</div>
<p>For a general overview of how to enable access to data, see <a class="reference internal" href="../../security/auth-authz/access-control/index.html"><span class="doc">Access control overview</span></a>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Databricks recommends using Unity Catalog volumes or external locations to connect to cloud object storage instead of instance profiles. Unity Catalog simplifies security and governance of your data by providing a central place to administer and audit data access across multiple workspaces in your account. See <a class="reference internal" href="../../data-governance/unity-catalog/index.html"><span class="doc">What is Unity Catalog?</span></a> and <a class="reference internal" href="../../data-governance/unity-catalog/best-practices.html#recommendations-for-using-external-locations"><span class="std std-ref">Recommendations for using external locations</span></a>.</p>
</div>
<div class="section" id="before-you-begin">
<h2>Before you begin<a class="headerlink" href="#before-you-begin" title="Permalink to this headline"> </a></h2>
<ul class="simple">
<li><p>You must be a Databricks workspace admin to configure settings for all SQL warehouses.</p></li>
</ul>
<ul class="simple">
<li><p><a class="reference internal" href="../../connect/storage/tutorial-s3-instance-profile.html"><span class="doc">Configure an instance profile</span></a>.</p></li>
</ul>
<div class="section" id="configure-a-sql-warehouse-to-use-an-instance-profile">
<span id="storage-access"></span><h3>Configure a SQL warehouse to use an instance profile<a class="headerlink" href="#configure-a-sql-warehouse-to-use-an-instance-profile" title="Permalink to this headline"> </a></h3>
<p>To configure all warehouses to use an AWS instance profile when accessing AWS storage:</p>
<ol class="arabic simple">
<li><p>Click your username in the top bar of the workspace and select <strong>Admin Settings</strong> from the drop down.</p></li>
<li><p>Click the <strong>Compute</strong> tab.</p></li>
<li><p>Click <strong>Manage</strong> next to <strong>SQL warehouses</strong>.</p></li>
<li><p>In the <strong>Instance Profile</strong> drop-down, select an instance profile.</p></li>
<li><p>Click <strong>Save</strong>.</p></li>
</ol>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<ul class="simple">
<li><p>If a user does not have permission to use the instance profile, all warehouses the user creates will fail to start.</p></li>
<li><p>If the instance profile is invalid, all SQL warehouses will become unhealthy.</p></li>
</ul>
</div>
<p>You can also configure an instance profile using the <a class="reference internal" href="../../dev-tools/terraform/index.html"><span class="doc">Databricks Terraform provider</span></a> and <a class="reference external" href="https://registry.terraform.io/providers/databricks/databricks/latest/docs/resources/sql_global_config">databricks_sql_global_config</a>.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>You can also edit the Data Access Configuration textbox entries directly.</p>
</div>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>To set a configuration property to the value of a secret without exposing the secret value to Spark, set the value to <code class="docutils literal notranslate"><span class="pre">{{secrets/&lt;secret-scope&gt;/&lt;secret-name&gt;}}</span></code>. Replace <code class="docutils literal notranslate"><span class="pre">&lt;secret-scope&gt;</span></code> with the secret scope and <code class="docutils literal notranslate"><span class="pre">&lt;secret-name&gt;</span></code> with the secret name. The value must start with {{secrets/ and end with }}. For more information about this syntax, see <a class="reference internal" href="../../security/secrets/secrets.html#syntax-for-referencing-secrets-in-a-spark-configuration-property-or-environment-variable"><span class="std std-ref">Syntax for referencing secrets in a Spark configuration property or environment variable</span></a>.</p>
</div>
<div class="section" id="configure-data-access-properties-for-sql-warehouses">
<span id="data-access-properties"></span><h3>Configure data access properties for SQL warehouses<a class="headerlink" href="#configure-data-access-properties-for-sql-warehouses" title="Permalink to this headline"> </a></h3>
<p>To configure all warehouses with data access properties, such as when you use an external metastore instead of the legacy Hive metastore:</p>
<ol class="arabic">
<li><p>Click your username in the top bar of the workspace and select <strong>Admin Settings</strong> from the drop down.</p></li>
<li><p>Click the <strong>Compute</strong> tab.</p></li>
<li><p>Click <strong>Manage</strong> next to <strong>SQL warehouses</strong>.</p></li>
<li><p>In the <strong>Data Access Configuration</strong> textbox, specify key-value pairs containing <a class="reference internal" href="#supported-properties"><span class="std std-ref">metastore properties</span></a>.</p>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>To set a Spark configuration property to the value of a secret without exposing the secret value to Spark, set the value to <code class="docutils literal notranslate"><span class="pre">{{secrets/&lt;secret-scope&gt;/&lt;secret-name&gt;}}</span></code>. Replace <code class="docutils literal notranslate"><span class="pre">&lt;secret-scope&gt;</span></code> with the secret scope and <code class="docutils literal notranslate"><span class="pre">&lt;secret-name&gt;</span></code> with the secret name. The value must start with <code class="docutils literal notranslate"><span class="pre">{{secrets/</span></code> and end with <code class="docutils literal notranslate"><span class="pre">}}</span></code>. For more information about this syntax, see <a class="reference internal" href="../../security/secrets/secrets.html#path-value"><span class="std std-ref">Syntax for referencing secrets in a Spark configuration property or environment variable</span></a>.</p>
</div>
</li>
<li><p>Click <strong>Save</strong>.</p></li>
</ol>
<p>You can also configure data access properties using the <a class="reference internal" href="../../dev-tools/terraform/index.html"><span class="doc">Databricks Terraform provider</span></a> and <a class="reference external" href="https://registry.terraform.io/providers/databricks/databricks/latest/docs/resources/sql_global_config">databricks_sql_global_config</a>.</p>
<div class="section" id="supported-properties">
<h4>Supported properties<a class="headerlink" href="#supported-properties" title="Permalink to this headline"> </a></h4>
<p>The following properties are supported for SQL warehouses. For an entry that ends with <code class="docutils literal notranslate"><span class="pre">*</span></code>, all properties within that prefix are supported. For example, <code class="docutils literal notranslate"><span class="pre">spark.sql.hive.metastore.*</span></code> indicates that both <code class="docutils literal notranslate"><span class="pre">spark.sql.hive.metastore.jars</span></code> and <code class="docutils literal notranslate"><span class="pre">spark.sql.hive.metastore.version</span></code> are supported, as well as any other properties that start with <code class="docutils literal notranslate"><span class="pre">spark.sql.hive.metastore</span></code>.</p>
<p>For properties whose values contain sensitive information, you can store the sensitive information in a <a class="reference internal" href="../../security/secrets/secrets.html"><span class="doc">secret</span></a> and set the property’s value to the secret name using the following syntax: <code class="docutils literal notranslate"><span class="pre">secrets/&lt;secret-scope&gt;/&lt;secret-name&gt;</span></code>.</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">spark.databricks.hive.metastore.glueCatalog.enabled</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">spark.databricks.delta.catalog.update.enabled</span> <span class="pre">false</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">spark.sql.hive.metastore.*</span></code> (<code class="docutils literal notranslate"><span class="pre">spark.sql.hive.metastore.jars</span></code> and <code class="docutils literal notranslate"><span class="pre">spark.sql.hive.metastore.jars.path</span></code> are unsupported for <a class="reference internal" href="../../serverless-compute/index.html"><span class="doc">serverless SQL warehouses</span></a>.)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">spark.sql.warehouse.dir</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">spark.hadoop.aws.region</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">spark.hadoop.datanucleus.*</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">spark.hadoop.fs.*</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">spark.hadoop.hive.*</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">spark.hadoop.javax.jdo.option.*</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">spark.hive.*</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">spark.hadoop.aws.glue.*</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">spark.databricks.cloudfetch.override.enabled</span></code></p></li>
</ul>
<p>For more information about how to set these properties, see <a class="reference internal" href="../../archive/external-metastores/external-hive-metastore.html"><span class="doc">External Hive metastore</span></a> and <a class="reference internal" href="../../archive/external-metastores/aws-glue-metastore.html"><span class="doc">AWS Glue data catalog</span></a>.</p>
</div>
</div>
</div>
<div class="section" id="confirm-or-set-up-an-aws-instance-profile-to-use-with-your-serverless-sql-warehouses">
<span id="aws-instance-profile-setup"></span><h2>Confirm or set up an AWS instance profile to use with your serverless SQL warehouses<a class="headerlink" href="#confirm-or-set-up-an-aws-instance-profile-to-use-with-your-serverless-sql-warehouses" title="Permalink to this headline"> </a></h2>
<p>If you already use an instance profile with Databricks SQL, the role associated with the instance profile needs a Databricks Serverless compute trust relationship statement so that serverless SQL warehouses can use it.</p>
<p>Depending on how and when your instance profile was created, you might not need to modify the role because it might already have the trust relationship. If the instance profile was created in the following ways, it likely has the trust relationship statement:</p>
<ul class="simple">
<li><p>After June 24, 2022, your instance profile was created as part of creating a Databricks workspace by using AWS Quickstart.</p></li>
<li><p>After June 24, 2022, someone in your organization followed steps in the Databricks article to <a class="reference internal" href="../../connect/storage/tutorial-s3-instance-profile.html"><span class="doc">create the instance profile manually</span></a>.</p></li>
</ul>
<p>This section describes how to <strong>confirm or update</strong> that the role associated with the instance profile has the trust relationship statement. That enables your serverless SQL warehouses to use the role to access your S3 buckets.</p>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>To perform these steps, you must be a Databricks workspace admin to confirm which instance profile your workspace uses for Databricks SQL. You must also be an AWS account administrator to check the role’s trust relationship policy or make any necessary changes. If you are not both of these types of admin, contact the appropriate admins in your organization to complete these steps.</p>
</div>
<ol class="arabic">
<li><p>In the <a class="reference internal" href="../../administration-guide/index.html#admin-settings"><span class="std std-ref">admin settings page</span></a>, click the <strong>Compute</strong> tab, then click <strong>Manage</strong> next to <strong>SQL warehouses</strong>.</p></li>
<li><p>Look in the <strong>Data Security</strong> section for the <strong>Instance Profile</strong> field. Confirm whether your workspace is configured to use an AWS instance profile for Databricks SQL to connect to AWS S3 buckets other than your root bucket.</p>
<ul class="simple">
<li><p>If you are using an instance profile, its name is visible in the <strong>Instance Profile</strong> field. Make a note of it for the next step.</p></li>
<li><p>If the field value is <strong>None</strong>, you are not using an <a class="reference internal" href="../../connect/storage/tutorial-s3-instance-profile.html"><span class="doc">instance profile</span></a> to access S3 buckets other than your workspace’s root bucket. Setup is complete.</p></li>
</ul>
</li>
<li><p>Confirm whether your instance profile name matches the associated role name.</p>
<ol class="loweralpha">
<li><p>In the AWS console, go to the <a class="reference external" href="https://console.aws.amazon.com/iam/home#/roles">IAM service’s Roles tab</a>. It lists all the IAM roles in your account.</p></li>
<li><p>Click the role with the name that matches the instance profile name in the Databricks SQL admin settings in the <strong>Data Security</strong> section for the <strong>Instance Profile</strong> field that you found earlier in this section.</p></li>
<li><p>In the summary area, find the <strong>Role ARN</strong> and <strong>Instance Profile ARNs</strong> fields.</p></li>
<li><p>Check if the last part of those two fields have matching names after the final slash. For example:</p>
<div class="figure align-default">
<img alt="Does instance profile name and role arn name match" src="../../_images/serverless-compute-aws-console-instance-profile-names.png" />
</div>
</li>
</ol>
</li>
<li><p>If you determined in the previous step that the role name (the text after the last slash in the role ARN) and the instance profile name (the text after the last slash in the instance profile ARN) do not match, <a class="reference internal" href="../../administration-guide/workspace-settings/manage-instance-profiles.html#edit-instance-profile"><span class="std std-ref">edit your instance profile registration</span></a> to specify your IAM role ARN.</p>
<ol class="loweralpha simple">
<li><p>To edit your instance profiles, look below the <strong>Instance profile</strong> field and click the <strong>Configure</strong> button.</p></li>
<li><p>Click your instance profile’s name.</p></li>
<li><p>Click <strong>Edit</strong>.</p></li>
<li><p>In the optional <strong>Role ARN</strong> field, paste the role ARN for the role associated with your instance profile. This is the key step that allows your instance profile to work with Databricks SQL Serverless even if the role name does not match the instance profile name.</p></li>
<li><p>Click <strong>Save</strong>.</p></li>
</ol>
</li>
<li><p>Within the AWS console, confirm or edit the trust relationship.</p>
<ol class="loweralpha">
<li><p>In the AWS console <a class="reference external" href="https://console.aws.amazon.com/iam/home#/roles">IAM service’s Roles tab</a>, click the instance profile role that you want to modify.</p></li>
<li><p>Click the <strong>Trust relationships</strong> tab.</p></li>
<li><p>View the existing trust policy. If the policy already includes the JSON block below, then this step was completed at an earlier time and you can ignore the following instructions.</p></li>
<li><p>Click <strong>Edit trust policy</strong>.</p></li>
<li><p>Within the existing <code class="docutils literal notranslate"><span class="pre">Statement</span></code> array, append the following JSON block to the end of the existing trust policy. Ensure that you don’t overwrite the existing policy.</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
<span class="nt">&quot;Effect&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Allow&quot;</span><span class="p">,</span>
<span class="nt">&quot;Principal&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;AWS&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">    </span><span class="s2">&quot;arn:aws:iam::790110701330:role/serverless-customer-resource-role&quot;</span>
<span class="w">  </span><span class="p">]</span>
<span class="p">},</span>
<span class="nt">&quot;Action&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;sts:AssumeRole&quot;</span><span class="p">,</span>
<span class="nt">&quot;Condition&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;StringEquals&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;sts:ExternalId&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">        </span><span class="s2">&quot;databricks-serverless-&lt;YOUR-WORKSPACE-ID1&gt;&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="s2">&quot;databricks-serverless-&lt;YOUR-WORKSPACE-ID2&gt;&quot;</span>
<span class="w">      </span><span class="p">]</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The only thing you need to change in the statement is the workspace ID. Replace the <code class="docutils literal notranslate"><span class="pre">YOUR_WORKSPACE-ID</span></code> with one or more <a class="reference internal" href="../../workspace/workspace-details.html#workspace-url"><span class="std std-ref">Databricks workspace IDs</span></a> for the workspaces that will use this role. To get your workspace ID while you are using your workspace, check the URL. For example, in <code class="docutils literal notranslate"><span class="pre">https://&lt;databricks-instance&gt;/?o=6280049833385130</span></code>, the number after <code class="docutils literal notranslate"><span class="pre">o=</span></code> is the workspace ID.</p>
<p>Do <strong>not</strong> edit the principal of the policy. The <code class="docutils literal notranslate"><span class="pre">Principal.AWS</span></code> field must continue to have the value <code class="docutils literal notranslate"><span class="pre">arn:aws:iam::790110701330:role/serverless-customer-resource-role</span></code>. This references a serverless compute role managed by Databricks.</p>
</li>
<li><p>Click <strong>Review policy</strong>.</p></li>
<li><p>Click <strong>Save changes</strong>.</p></li>
</ol>
</li>
</ol>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>If your instance profile changes at a later time, repeat these steps to ensure that the trust relationship for the instance profile’s role contains the required extra statement.</p>
</div>
</div>
<div class="section" id="troubleshooting">
<h2>Troubleshooting<a class="headerlink" href="#troubleshooting" title="Permalink to this headline"> </a></h2>
<p>If your trust relationship is misconfigured, clusters fail with a message that says “Request to create  a cluster failed with an exception INVALID_PARAMETER_VALUE: IAM role &lt;role-id&gt; does not have the required trust relationship.”</p>
<p>If you get this error, it could be that the workspace IDs were incorrect or possibly that that the trust policy was not updated correctly on the correct role.</p>
<p>Carefully perform the steps in <a class="reference internal" href="#aws-instance-profile-setup"><span class="std std-ref">Confirm or set up an AWS instance profile to use with your serverless SQL warehouses</span></a> to update the trust relationship.</p>
</div>
<div class="section" id="configuring-glue-metastore-for-serverless-sql-warehouses">
<span id="before-you-begin"></span><h2>Configuring Glue metastore for serverless SQL warehouses<a class="headerlink" href="#configuring-glue-metastore-for-serverless-sql-warehouses" title="Permalink to this headline"> </a></h2>
<p>If you need to specify an AWS Glue metastore or add additional data source configurations, update the <strong>Data Access Configuration</strong> field in the admin settings page. See <a class="reference internal" href="#"><span class="doc">Enable data access configuration</span></a>.</p>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>Serverless SQL warehouses support the default Databricks metastore and AWS Glue as a metastore, but do not support external Hive metastores.</p>
</div>
<p></p>
</div>
</div>


    
          </div>
        </div>
        <div  class="suapp-rating">
  <div id="suPageRateApp">
     <su-app></su-app>
   </div> 
 </div>
<hr> 
<footer>
  <div role="contentinfo">
      <p class="copyright">
          &copy; Databricks 2023. All rights reserved. Apache, Apache Spark, Spark, and the Spark logo are trademarks of the <a href="http://www.apache.org/">Apache Software Foundation</a>.
      </p>
      <p> 
        
          <a id='feedbacklink' href="mailto:doc-feedback@databricks.com?subject=Documentation Feedback">Send us feedback</a>
        
     | <a href="https://databricks.com/privacy-policy">Privacy Policy</a> | <a href="https://databricks.com/terms-of-use">Terms of Use</a></p>

  </div> 

</footer>
      </div>
    </div>
  </section>
</main>

  </page>
  
  <script type="text/javascript">
    var DOCUMENTATION_OPTIONS = {
      URL_ROOT: '../../',
      VERSION: '1.0',
      COLLAPSE_INDEX: false,
      FILE_SUFFIX: '.html',
      HAS_SOURCE: 'false'
    };
  </script>
  <script type="text/javascript" src="../../_static/jquery.js"></script>
  <script type="text/javascript" src="../../_static/underscore.js"></script>
  <script type="text/javascript" src="../../_static/doctools.js"></script>
  <script type="text/javascript" src="../../_static/language_data.js"></script>
  

  <script type="text/javascript" src="../../_static/js/clipboard.min.js"></script>
  <script type="text/javascript" src="../../_static/js/jquery.waypoints.min.js"></script>

  <!-- Select2 (https://select2.org/) -->
  <link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />
  <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
  <!-- End Select2 -->

  
  
  <script type="text/javascript" src="../../_static/js/localized.js"></script>
  <script type="text/javascript" src="../../_static/js/custom.js"></script>
  

  
  
  <script type="text/javascript">
    jQuery(function () {
      SphinxRtdTheme.StickyNav.enable();
    });

  </script>
  
 



  <script>
  window.__searchunifyLoaderConfig = JSON.parse('{"clients": {"en": "02c2e804-27e9-11ee-aefb-0242ac120011", "ja": "6a42c3f2-2820-11ee-aefb-0242ac120011", "pt": "6a86badd-2821-11ee-aefb-0242ac120011"}}')
</script>
<script type="text/javascript" src="../../_static/js/search-loader.js"></script>
</body>
<script type='text/javascript'>
  window.onload = function () {
    var description = document.querySelector('meta[name="description"]').getAttribute("content");
    let titleText = document.querySelector('h1').textContent;
    document.querySelector('meta[property="og:title"]').setAttribute("content", titleText);
    document.querySelector('meta[property="og:description"]').setAttribute("content", description);
    document.querySelector('meta[property="twitter:description"]').setAttribute("content", description);
  };
</script>

</html>