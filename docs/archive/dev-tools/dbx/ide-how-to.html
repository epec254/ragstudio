

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en-US" > <![endif]-->
<!--[if gt IE 8]><!-->
<html class="no-js" lang="en-US"> <!--<![endif]-->

<head>
  <!-- cookie consent -->
  
    <!-- Combined Onetrust and Rudderstack Implementation Scripts -->
    <!-- Onetrust Initialization -->
    <script type="text/javascript" src="https://cdn.cookielaw.org/consent/92466579-1717-44d3-809d-a05fb02843ed-test/OtAutoBlock.js"></script>
    <script src="https://cdn.cookielaw.org/scripttemplates/otSDKStub.js" data-document-language="true" type="text/javascript" charset="UTF-8" data-domain-script="92466579-1717-44d3-809d-a05fb02843ed-test"></script>
    <link rel="stylesheet" id="db-onetrust-style" href="https://www.databricks.com/wp-content/uploads/db_onetrust.css" media="all" />
    <!-- Setting Rudderstack Write Key -->
    <script>window.rudderstackKey = "2SOR9fvSr5Fi6tN2ihPbVHnX1SZ" </script>
    <!-- Rudderstack Initialization + Onetrust Integration + Rudderstack Custom Events -->
    <script type="text/javascript" src="https://www.databricks.com/sites/default/files/rudderstack/v1/db-rudderstack-events.js"></script>

  <!-- cookie consent -->

  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta http-equiv="X-UA-Compatible" content="IE=9" />
  <meta content="Learn how to use Visual Studio Code and Python to edit and submit code from an IDE that runs on Databricks compute resources." name="description" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0">
  <meta property="og:image" content="https://www.databricks.com/wp-content/uploads/2020/04/og-databricks.png">
  <meta property="og:image:type" content="image/png">
  <meta property="og:title" content="Use dbx with Visual Studio Code">
  <meta property="og:image:width" content="1200">
  <meta property="og:image:height" content="630">
  <meta property="og:type" content="website">
  <meta property="og:url" content="https://docs.databricks.com">
  <meta property="og:description" content="" id="og-description">
  <meta name="twitter:image" content="https://www.databricks.com/wp-content/uploads/2020/04/og-databricks.png">
  <meta name="twitter:site" content="@databricks">
  <meta name="twitter:creator" content="@databricks">
  <meta property="twitter:description" content="">
  
  <title>Use dbx with Visual Studio Code &#124; Databricks on AWS</title>
  
  
  <link rel="canonical" href="https://docs.databricks.com/en/archive/dev-tools/dbx/ide-how-to.html">
  <!-- Start hreflang tag -->
  <link rel="alternate" hreflang="en" href="https://docs.databricks.com/en/archive/dev-tools/dbx/ide-how-to.html" />
<link rel="alternate" hreflang="x-default" href="https://docs.databricks.com/en/archive/dev-tools/dbx/ide-how-to.html" />
  <!-- End hreflang tag -->
  
  
  <link rel="shortcut icon" href="../../../_static/favicon.ico" />
  

  

  

  <!-- Google Tag Manager -->
  <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'https://www.googletagmanager.com/gtm.js?id='+i+dl;
j.setAttributeNode(d.createAttribute('data-ot-ignore'));
f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-T85FQ33');</script>
  <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'https://www.googletagmanager.com/gtm.js?id='+i+dl;
j.setAttributeNode(d.createAttribute('data-ot-ignore'));
f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-TWTKQQ');</script>
    
  <!-- End Google Tag Manager -->


  <!-- MaxMind / GEO IP -->
  <script src="//js.maxmind.com/js/apis/geoip2/v2.1/geoip2.js" type="text/javascript"></script>
  <!-- End MaxMind / GEO IP -->

  
  
  <link href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,600&display=swap" rel="stylesheet">
  <link rel="preload" href="../../../_static/fonts/DMSans-Bold.ttf" as="font">
  <link rel="preload" href="../../../_static/fonts/DMSans-Regular.ttf" as="font">
  <link rel="preload" href="../../../_static/fonts/DMMono-Regular.ttf" as="font">
  <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/css/custom.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/css/cloud-provider-selector.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/css/translation-selector.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/css/searchunify/main.css" type="text/css" />

  
  <link rel="index" title="Index" href="../../../genindex.html" />
  <link rel="search" title="Search" href="../../../search.html" />
  <link rel="top" title="Databricks on AWS" href="../../../index.html" /> 
</head>

<body class="wy-body-for-nav" role="document">

  <!-- Google Tag Manager (noscript) -->
  <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-T85FQ33"
height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
  <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-TWTKQQ"
    height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
  <!-- End Google Tag Manager (noscript) -->

  
  <nav class="wy-nav-top header su_header" role="navigation" aria-label="top navigation">
    
<nav class="wy-nav-top header su_header" role="navigation" aria-label="top navigation">
  <div class="container-logo">
    <ul class="mobile-menu-toggle">
        <li class="menu-toggle">
            <i data-toggle="wy-nav-top" class="wy-nav-top-menu-button db-icon db-icon-menu pull-left"></i>
            
            <a href="https://www.databricks.com/" class="wy-nav-top-logo"><img src="../../../_static/small-scale-lockup-full-color-rgb.svg" width="137" height="21"
              alt="Databricks" /></a>   
               
              </li>
    </ul>
    <ul class="su_nav-menu">
      <li class="menu-toggle">
        <i data-toggle="wy-nav-top" class="wy-nav-top-menu-button db-icon db-icon-menu pull-left"></i>
        
          
        
        <a href="https://www.databricks.com/" class="wy-nav-top-logo"><img src="../../../_static/small-scale-lockup-full-color-rgb.svg" width="137" height="21"
            alt="Databricks" /></a></li>
        <!-- 
<li><a href="https://help.databricks.com/s/">Help Center</a></li>
<li class="active"><a href="https://docs.databricks.com/en/">Documentation</a></li>
<li><a href="https://kb.databricks.com/">Knowledge Base</a></li>
 -->
    </ul>
  </div>
  <div class="su_nav-right">
    <ul class="su_link-mobile">
  <!-- Mobile header code can go here -->
</ul>
<ul class="right-try-list">
   
</ul>
  </div>
</nav>
  </nav>

  <div class="su_sub-header">
    <div class="container">
      <div class="su_sub-header-inner">
        <!-- <div class="su_subnav-menu-right">
  <div id="auto" style="width: 100%;">
    <div ng-controller="SearchautoController">
      <div bind-html-compile="autocompleteHtml">
        <form class="su__search-box-1" disabled="disabled">
          <input class="su__search-input" type="search" name="Search box" id="su__search-b" placeholder="Search Documentation" disabled="disabled"/>
          <button class="su__search-button" type="submit" class="button button-success" disabled="disabled">
            <svg width="24" height="24" viewBox="0 0 24 24">
              <path
                d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"
                fill="#333"></path>
            </svg>
          </button>
        </form>
      </div>
    </div>
  </div>
</div> -->
        <div class="search-lng-gap"></div>
        <div style="margin-left: 16px; margin-right: 16px;">
          <!-- <select name="lng selector" id="lng-selector">
    <option value="../../../../en/archive/dev-tools/dbx/ide-how-to.html" class="notranslate">English</option>
    <option value="../../../../ja/archive/dev-tools/dbx/ide-how-to.html" class="notranslate">日本語</option>
    <option value="../../../../pt/archive/dev-tools/dbx/ide-how-to.html" class="notranslate">Português (Brasil)</option>
</select> -->
        </div>
        <div class="cloud-selector-container">
          <!-- <select name="cloud provider selector" id="cloud-provider-selector">
    <option value="aws" selected class="notranslate">
        Amazon Web Services
    </option>
    <option value="azure"  class="notranslate">
        Microsoft Azure
    </option>
    <option value="gcp"  class="notranslate">
        Google Cloud Platform
    </option>
</select> -->
        </div>
      </div>
    </div>
  </div>
  <page class="js-page-container">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side su_nav-side">
<div class="wy-side-scroll">
  <div class="wy-side-nav-search">
    

    

    

    
  </div>

  <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
    
      <a href="../../../index.html" class="main-navigation-home">Databricks on AWS</a>
    

    
      

      
        <p class="caption"><span class="caption-text">Load &amp; manage data</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../rag-temp/index.html">RAG Studio</a></li>
</ul>

      
    
  </div>

  <div role="contentinfo">
    
  <p class="build_info notranslate"data-last-edit="December 23, 2023">
    Updated Jan 11, 2024
  </p>
<script>
  window.addEventListener('DOMContentLoaded',function(){
    var h1=document.querySelector('h1');
    var bi=document.querySelector('[data-last-edit]');
    if(h1 && bi){
      var ver = document.createElement('p');
      ver.className = 'version_info';
      ver.textContent = bi.getAttribute('data-last-edit');
      h1.parentElement.insertBefore(ver, h1.nextElementSibling);
    }
  });
</script>

    <p>
      
        <a id='feedbacklink' href="mailto:doc-feedback@databricks.com?subject=Documentation Feedback">Send us feedback</a>
      
    </p>
  </div>
</div>
</nav>
    
    
<main class="wy-grid-for-nav su_nav-grid">
  <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
    <div class="wy-nav-content su__nav_content">
      <div class="rst-content">
        





<div role="navigation" aria-label="breadcrumbs navigation" class="wy-breadcrumbs-wrapper">
  <ul class="wy-breadcrumbs">
    <li><a href="../../../index.html">Documentation</a> <span class="db-icon db-icon-chevron-right"></span></li>
    
    
      <li>Use dbx with Visual Studio Code</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>
</div>
        
        <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
          <div itemprop="articleBody">
            
    
  <div class="section" id="use-dbx-with-visual-studio-code">
<h1>Use dbx with Visual Studio Code<a class="headerlink" href="#use-dbx-with-visual-studio-code" title="Permalink to this headline"> </a></h1>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>This documentation has been retired and might not be updated.</p>
<p>Databricks recommends that you use Databricks Asset Bundles instead of <code class="docutils literal notranslate"><span class="pre">dbx</span></code> by Databricks Labs. See <a class="reference internal" href="../../../dev-tools/bundles/index.html"><span class="doc">What are Databricks Asset Bundles?</span></a> and <a class="reference internal" href="dbx-migrate.html"><span class="doc">Migrate from dbx to bundles</span></a>.</p>
<p>To use Databricks with Visual Studio Code, see the article <a class="reference internal" href="../../../dev-tools/vscode-ext/index.html"><span class="doc">Databricks extension for Visual Studio Code</span></a>.</p>
</div>
<p>This article describes a Python-based <a class="reference external" href="https://github.com/databricks/ide-best-practices">code sample</a> that you can work with in any Python-compatible IDE. Specifically, this article describes how to work with this code sample in <a class="reference external" href="https://code.visualstudio.com/">Visual Studio Code</a>, which provides the following developer productivity features:</p>
<ul class="simple">
<li><p><a class="reference external" href="https://code.visualstudio.com/docs/languages/python#_autocomplete-and-intellisense">Code completion</a></p></li>
<li><p><a class="reference external" href="https://code.visualstudio.com/docs/languages/python#_linting">Linting</a></p></li>
<li><p><a class="reference external" href="https://code.visualstudio.com/docs/languages/python#_testing">Testing</a></p></li>
<li><p><a class="reference external" href="https://code.visualstudio.com/docs/editor/debugging">Debugging</a> code objects that do not require a real-time connection to remote Databricks resources.</p></li>
</ul>
<p>This article uses <a class="reference internal" href="dbx.html"><span class="doc">dbx by Databricks Labs</span></a> along with Visual Studio Code to submit the code sample to a remote Databricks <a class="reference internal" href="../../../workspace/index.html"><span class="doc">workspace</span></a>. <code class="docutils literal notranslate"><span class="pre">dbx</span></code> instructs Databricks to <a class="reference internal" href="../../../workflows/index.html"><span class="doc">Introduction to Databricks Workflows</span></a> to run the submitted code on a Databricks <a class="reference internal" href="../../../compute/index.html"><span class="doc">jobs cluster</span></a> in that workspace.</p>
<p>You can use popular third-party Git providers for version control and continuous integration and continuous delivery or continuous deployment (CI/CD) of your code. For version control, these Git providers include the following:</p>
<ul class="simple">
<li><p><a class="reference external" href="https://github.com">GitHub</a></p></li>
<li><p><a class="reference external" href="https://bitbucket.org">Bitbucket</a></p></li>
<li><p><a class="reference external" href="https://about.gitlab.com/">GitLab</a></p></li>
<li><p><a class="reference external" href="https://azure.microsoft.com/services/devops">Azure DevOps</a> (not available in Azure China regions)</p></li>
<li><p><a class="reference external" href="https://aws.amazon.com/codecommit">AWS CodeCommit</a></p></li>
<li><p><a class="reference external" href="https://docs.github.com/en/github-ae&#64;latest/admin/overview/about-github-ae">GitHub AE</a></p></li>
</ul>
<p>For CI/CD, <code class="docutils literal notranslate"><span class="pre">dbx</span></code> supports the following CI/CD platforms:</p>
<ul class="simple">
<li><p><a class="reference external" href="https://github.com/features/actions">GitHub Actions</a></p></li>
<li><p><a class="reference external" href="https://azure.microsoft.com/services/devops/pipelines/">Azure Pipelines</a></p></li>
<li><p><a class="reference external" href="https://docs.gitlab.com/ee/ci">GitLab CI/CD</a></p></li>
</ul>
<p>To demonstrate how version control and CI/CD can work, this article describes how to use Visual Studio Code, <code class="docutils literal notranslate"><span class="pre">dbx</span></code>, and this code sample, along with GitHub and GitHub Actions.</p>
<div class="section" id="code-sample-requirements">
<h2>Code sample requirements<a class="headerlink" href="#code-sample-requirements" title="Permalink to this headline"> </a></h2>
<p>To use this code sample, you must have the following:</p>
<ul class="simple">
<li><p>A Databricks workspace in your Databricks account. <a class="reference external" href="https://docs.databricks.com/administration-guide/account-settings-e2/workspaces.html">Create a workspace</a> if you do not already have one.</p></li>
<li><p>A GitHub account. <a class="reference external" href="https://docs.github.com/en/get-started/signing-up-for-github/signing-up-for-a-new-github-account">Create a GitHub account</a>, if you do not already have one.</p></li>
</ul>
<p>Additionally, on your local development machine, you must have the following:</p>
<ul>
<li><p><a class="reference external" href="https://www.python.org/downloads/">Python</a> version 3.8 or above.</p>
<p>You should use a version of Python that matches the one that is installed on your target clusters. To get the version of Python that is installed on an existing cluster, you can use the cluster’s <a class="reference internal" href="../../../compute/web-terminal.html"><span class="doc">web terminal</span></a> to run the <code class="docutils literal notranslate"><span class="pre">python</span> <span class="pre">--version</span></code> command. See also the “System environment” section in the <a class="reference internal" href="../../../release-notes/runtime/index.html"><span class="doc">Databricks Runtime release notes versions and compatibility</span></a> for the Databricks Runtime version for your target clusters. In any case, the version of Python must be 3.8 or above.</p>
<p>To get the version of Python that is currently referenced on your local machine, run <code class="docutils literal notranslate"><span class="pre">python</span> <span class="pre">--version</span></code> from your local terminal. (Depending on how you set up Python on your local machine, you may need to run <code class="docutils literal notranslate"><span class="pre">python3</span></code> instead of <code class="docutils literal notranslate"><span class="pre">python</span></code> throughout this article.) See also <a class="reference external" href="https://code.visualstudio.com/docs/python/python-tutorial#_select-a-python-interpreter">Select a Python interpreter</a>.</p>
</li>
<li><p><a class="reference external" href="https://pip.pypa.io/en/stable/installation/">pip</a>. <code class="docutils literal notranslate"><span class="pre">pip</span></code> is automatically installed with newer versions of Python. To check whether <code class="docutils literal notranslate"><span class="pre">pip</span></code> is already installed, run <code class="docutils literal notranslate"><span class="pre">pip</span> <span class="pre">--version</span></code> from your local terminal. (Depending on how you set up Python or <code class="docutils literal notranslate"><span class="pre">pip</span></code> on your local machine, you may need to run <code class="docutils literal notranslate"><span class="pre">pip3</span></code> instead of <code class="docutils literal notranslate"><span class="pre">pip</span></code> throughout this article.)</p></li>
<li><p><a class="reference external" href="https://pypi.org/project/dbx/">dbx</a> version 0.8.0 or above. You can install the <code class="docutils literal notranslate"><span class="pre">dbx</span></code> package from the Python Package Index (PyPI) by running <code class="docutils literal notranslate"><span class="pre">pip</span> <span class="pre">install</span> <span class="pre">dbx</span></code>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>You do not need to install <code class="docutils literal notranslate"><span class="pre">dbx</span></code> now. You can install it later in the code sample <a class="reference internal" href="#set-up-the-code-sample"><span class="std std-ref">setup</span></a> section.</p>
</div>
</li>
<li><p>A method to create Python <a class="reference external" href="https://docs.python.org/3/library/venv.html">virtual environments</a> to ensure you are using the correct versions of Python and package dependencies in your <code class="docutils literal notranslate"><span class="pre">dbx</span></code> projects. This article covers <a class="reference external" href="https://pipenv.pypa.io/">pipenv</a>.</p></li>
<li><p>The <a class="reference internal" href="../cli/index.html"><span class="doc">Databricks CLI version 0.18 or below</span></a>, set up with <a class="reference internal" href="../cli/index.html#set-up-authentication"><span class="std std-ref">authentication</span></a>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>You do not need to install the legacy Databricks CLI (Databricks CLI version 0.17) now. You can install it later in the code sample <a class="reference internal" href="#set-up-the-code-sample"><span class="std std-ref">setup</span></a> section. If you want to install it later, you must remember to set up authentication at that time instead.</p>
</div>
</li>
<li><p><a class="reference external" href="https://code.visualstudio.com/">Visual Studio Code</a>.</p></li>
<li><p>The <a class="reference external" href="https://marketplace.visualstudio.com/items?itemName=ms-python.python">Python</a> extension for Visual Studio Code.</p></li>
<li><p>The <a class="reference external" href="https://marketplace.visualstudio.com/items?itemName=GitHub.vscode-pull-request-github">GitHub Pull Requests and Issues</a> extension for Visual Studio Code.</p></li>
<li><p><a class="reference external" href="https://git-scm.com/downloads">Git</a>.</p></li>
</ul>
</div>
<div class="section" id="about-the-code-sample">
<h2>About the code sample<a class="headerlink" href="#about-the-code-sample" title="Permalink to this headline"> </a></h2>
<p>The Python code sample for this article, available in the <a class="reference external" href="https://github.com/databricks/ide-best-practices">databricks/ide-best-practices</a> repo in GitHub, does the following:</p>
<ol class="arabic simple">
<li><p>Gets data from the <a class="reference external" href="https://github.com/owid/covid-19-data">owid/covid-19-data</a> repo in GitHub.</p></li>
<li><p>Filters the data for a specific ISO country code.</p></li>
<li><p>Creates a pivot table from the data.</p></li>
<li><p>Performs data cleansing on the data.</p></li>
<li><p>Modularizes the code logic into reusable functions.</p></li>
<li><p>Unit tests the functions.</p></li>
<li><p>Provides <code class="docutils literal notranslate"><span class="pre">dbx</span></code> project configurations and settings to enable the code to write the data to a Delta table in a remote Databricks workspace.</p></li>
</ol>
</div>
<div class="section" id="set-up-the-code-sample">
<h2>Set up the code sample<a class="headerlink" href="#set-up-the-code-sample" title="Permalink to this headline"> </a></h2>
<p>After you have the <a class="reference internal" href="#code-sample-requirements"><span class="std std-ref">requirements</span></a> in place for this code sample, complete the following steps to begin using the code sample.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>These steps do not include setting up this code sample for CI/CD. You do not need to set up CI/CD to run this code sample. If you want to set up CI/CD later, see <a class="reference internal" href="#run-with-github-actions"><span class="std std-ref">Run with GitHub Actions</span></a>.</p>
</div>
<div class="section" id="step-1-create-a-python-virtual-environment">
<h3>Step 1: Create a Python virtual environment<a class="headerlink" href="#step-1-create-a-python-virtual-environment" title="Permalink to this headline"> </a></h3>
<ol class="arabic">
<li><p>From your terminal, create a blank folder to contain a virtual environment for this code sample. These instructions use a parent folder named <code class="docutils literal notranslate"><span class="pre">ide-demo</span></code>. You can give this folder any name you want. If you use a different name, replace the name throughout this article. After you create the folder, switch to it, and then start Visual Studio Code from that folder. Be sure to include the dot (<code class="docutils literal notranslate"><span class="pre">.</span></code>) after the <code class="docutils literal notranslate"><span class="pre">code</span></code> command.</p>
<p>For Linux and macOS:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>mkdir<span class="w"> </span>ide-demo
<span class="nb">cd</span><span class="w"> </span>ide-demo
code<span class="w"> </span>.
</pre></div>
</div>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>If you get the error <code class="docutils literal notranslate"><span class="pre">command</span> <span class="pre">not</span> <span class="pre">found:</span> <span class="pre">code</span></code>, see <a class="reference external" href="https://code.visualstudio.com/docs/setup/mac#_launching-from-the-command-line">Launching from the command line</a> on the Microsoft website.</p>
</div>
<p>For Windows:</p>
<div class="highlight-powershell notranslate"><div class="highlight"><pre><span></span><span class="nb">md </span><span class="n">ide-demo</span>
<span class="nb">cd </span><span class="n">ide-demo</span>
<span class="n">code</span> <span class="p">.</span>
</pre></div>
</div>
</li>
<li><p>In Visual Studio Code, on the menu bar, click <strong>View &gt; Terminal</strong>.</p></li>
<li><p>From the root of the <code class="docutils literal notranslate"><span class="pre">ide-demo</span></code> folder, run the <code class="docutils literal notranslate"><span class="pre">pipenv</span></code> command with the following option, where <code class="docutils literal notranslate"><span class="pre">&lt;version&gt;</span></code> is the target version of Python that you already have installed locally (and, ideally, a version that matches your target clusters’ version of Python), for example <code class="docutils literal notranslate"><span class="pre">3.8.14</span></code>.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>pipenv<span class="w"> </span>--python<span class="w"> </span>&lt;version&gt;
</pre></div>
</div>
<p>Make a note of the <code class="docutils literal notranslate"><span class="pre">Virtualenv</span> <span class="pre">location</span></code> value in the output of the <code class="docutils literal notranslate"><span class="pre">pipenv</span></code> command, as you will need it in the next step.</p>
</li>
<li><p>Select the target Python interpreter, and then activate the Python virtual environment:</p>
<ol class="loweralpha">
<li><p>On the menu bar, click <strong>View &gt; Command Palette</strong>, type <code class="docutils literal notranslate"><span class="pre">Python:</span> <span class="pre">Select</span></code>, and then click <strong>Python: Select Interpreter</strong>.</p></li>
<li><p>Select the Python interpreter within the path to the Python virtual environment that you just created. (This path is listed as the <code class="docutils literal notranslate"><span class="pre">Virtualenv</span> <span class="pre">location</span></code> value in the output of the <code class="docutils literal notranslate"><span class="pre">pipenv</span></code> command.)</p></li>
<li><p>On the menu bar, click <strong>View &gt; Command Palette</strong>, type <code class="docutils literal notranslate"><span class="pre">Terminal:</span> <span class="pre">Create</span></code>, and then click <strong>Terminal: Create New Terminal</strong>.</p></li>
<li><p>Make sure that the command prompt indicates that you are in the <code class="docutils literal notranslate"><span class="pre">pipenv</span></code> shell. To confirm, you should see something like <code class="docutils literal notranslate"><span class="pre">(&lt;your-username&gt;)</span></code> before your command prompt. If you do not see it, run the following command:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>pipenv<span class="w"> </span>shell
</pre></div>
</div>
<p>To exit the <code class="docutils literal notranslate"><span class="pre">pipenv</span></code> shell, run the command <code class="docutils literal notranslate"><span class="pre">exit</span></code>, and the parentheses disappear.</p>
</li>
</ol>
<p>For more information, see <a class="reference external" href="https://code.visualstudio.com/docs/python/environments">Using Python environments in VS Code</a> in the Visual Studio Code documentation.</p>
</li>
</ol>
</div>
<div class="section" id="step-2-clone-the-code-sample-from-github">
<h3>Step 2: Clone the code sample from GitHub<a class="headerlink" href="#step-2-clone-the-code-sample-from-github" title="Permalink to this headline"> </a></h3>
<ol class="arabic simple">
<li><p>In Visual Studio Code, open the <code class="docutils literal notranslate"><span class="pre">ide-demo</span></code> folder (<strong>File &gt; Open Folder</strong>), if it is not already open.</p></li>
<li><p>Click <strong>View &gt; Command Palette</strong>, type <code class="docutils literal notranslate"><span class="pre">Git:</span> <span class="pre">Clone</span></code>, and then click <strong>Git: Clone</strong>.</p></li>
<li><p>For <strong>Provide repository URL or pick a repository source</strong>, enter <code class="docutils literal notranslate"><span class="pre">https://github.com/databricks/ide-best-practices</span></code></p></li>
<li><p>Browse to your <code class="docutils literal notranslate"><span class="pre">ide-demo</span></code> folder, and click <strong>Select Repository Location</strong>.</p></li>
</ol>
</div>
<div class="section" id="step-3-install-the-code-samples-dependencies">
<h3>Step 3: Install the code sample’s dependencies<a class="headerlink" href="#step-3-install-the-code-samples-dependencies" title="Permalink to this headline"> </a></h3>
<ol class="arabic">
<li><p>Install a version of <code class="docutils literal notranslate"><span class="pre">dbx</span></code> and Databricks CLI version 0.18 or below that is compatible with your version of Python. To do this, in Visual Studio Code from your terminal, from your <code class="docutils literal notranslate"><span class="pre">ide-demo</span></code> folder with a <code class="docutils literal notranslate"><span class="pre">pipenv</span></code> shell activated (<code class="docutils literal notranslate"><span class="pre">pipenv</span> <span class="pre">shell</span></code>), run the following command:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>pip<span class="w"> </span>install<span class="w"> </span>dbx
</pre></div>
</div>
</li>
<li><p>Confirm that <code class="docutils literal notranslate"><span class="pre">dbx</span></code> is installed. To do this, run the following command:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>dbx<span class="w"> </span>--version
</pre></div>
</div>
<p>If the version number is returned, <code class="docutils literal notranslate"><span class="pre">dbx</span></code> is installed.</p>
<p>If the version number is below 0.8.0, upgrade <code class="docutils literal notranslate"><span class="pre">dbx</span></code> by running the following command, and then check the version number again:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>pip<span class="w"> </span>install<span class="w"> </span>dbx<span class="w"> </span>--upgrade
dbx<span class="w"> </span>--version

<span class="c1"># Or ...</span>
python<span class="w"> </span>-m<span class="w"> </span>pip<span class="w"> </span>install<span class="w"> </span>dbx<span class="w"> </span>--upgrade
dbx<span class="w"> </span>--version
</pre></div>
</div>
</li>
<li><p>When you install <code class="docutils literal notranslate"><span class="pre">dbx</span></code>, the legacy Databricks CLI (Databricks CLI version 0.17) is also automatically installed. To confirm that the legacy Databricks CLI (Databricks CLI version 0.17) is installed, run the following command:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>databricks<span class="w"> </span>--version
</pre></div>
</div>
<p>If Databricks CLI version 0.17 is returned, the legacy Databricks CLI is installed.</p>
</li>
<li><p>If you have not set up the legacy Databricks CLI (Databricks CLI version 0.17) with <a class="reference internal" href="../cli/index.html#set-up-authentication"><span class="std std-ref">authentication</span></a>, you must do it now. To confirm that authentication is set up, run the following basic command to get some summary information about your Databricks workspace. Be sure to include the forward slash (<code class="docutils literal notranslate"><span class="pre">/</span></code>) after the <code class="docutils literal notranslate"><span class="pre">ls</span></code> subcommand:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>databricks<span class="w"> </span>workspace<span class="w"> </span>ls<span class="w"> </span>/
</pre></div>
</div>
<p>If a list of root-level folder names for your workspace is returned, authentication is set up.</p>
</li>
<li><p>Install the Python packages that this code sample depends on. To do this, run the following command from the <code class="docutils literal notranslate"><span class="pre">ide-demo/ide-best-practices</span></code> folder:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>pip<span class="w"> </span>install<span class="w"> </span>-r<span class="w"> </span>unit-requirements.txt
</pre></div>
</div>
</li>
<li><p>Confirm that the code sample’s dependent packages are installed. To do this, run the following command:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>pip<span class="w"> </span>list
</pre></div>
</div>
<p>If the packages that are listed in the <code class="docutils literal notranslate"><span class="pre">requirements.txt</span></code> and <code class="docutils literal notranslate"><span class="pre">unit-requirements.txt</span></code> files are somewhere in this list, the dependent packages are installed.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The files listed in <code class="docutils literal notranslate"><span class="pre">requirements.txt</span></code> are for specific package versions. For better compatibility, you can cross-reference these versions with the <a class="reference internal" href="../../../compute/configure.html#node-types"><span class="std std-ref">cluster node type</span></a> that you want your Databricks workspace to use for running deployments on later. See the “System environment” section for your cluster’s Databricks Runtime version in <a class="reference internal" href="../../../release-notes/runtime/index.html"><span class="doc">Databricks Runtime release notes versions and compatibility</span></a>.</p>
</div>
</li>
</ol>
</div>
<div class="section" id="step-4-customize-the-code-sample-for-your-databricks-workspace">
<h3>Step 4: Customize the code sample for your Databricks workspace<a class="headerlink" href="#step-4-customize-the-code-sample-for-your-databricks-workspace" title="Permalink to this headline"> </a></h3>
<ol class="arabic">
<li><p>Customize the repo’s <code class="docutils literal notranslate"><span class="pre">dbx</span></code> project settings. To do this, in the <code class="docutils literal notranslate"><span class="pre">.dbx/project.json</span></code> file, change the value of the <code class="docutils literal notranslate"><span class="pre">profile</span></code> object from <code class="docutils literal notranslate"><span class="pre">DEFAULT</span></code> to the name of the profile that matches the one that you set up for authentication with the legacy Databricks CLI (Databricks CLI version 0.17). If you did not set up any non-default profile, leave <code class="docutils literal notranslate"><span class="pre">DEFAULT</span></code> as is. For example:</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;environments&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;default&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;profile&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;DEFAULT&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;storage_type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;mlflow&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;properties&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;workspace_directory&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;/Shared/dbx/covid_analysis&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;artifact_location&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;dbfs:/Shared/dbx/projects/covid_analysis&quot;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">},</span>
<span class="w">  </span><span class="nt">&quot;inplace_jinja_support&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span>
<span class="p">}</span>
</pre></div>
</div>
</li>
<li><p>Customize the <code class="docutils literal notranslate"><span class="pre">dbx</span></code> project’s deployment settings. To do this, in the <code class="docutils literal notranslate"><span class="pre">conf/deployment.yml</span></code> file, change the value of the <code class="docutils literal notranslate"><span class="pre">spark_version</span></code> and <code class="docutils literal notranslate"><span class="pre">node_type_id</span></code> objects from <code class="docutils literal notranslate"><span class="pre">10.4.x-scala2.12</span></code> and <code class="docutils literal notranslate"><span class="pre">m6gd.large</span></code> to the Databricks <a class="reference external" href="https://docs.databricks.com/api/workspace/introduction">runtime version string</a> and <a class="reference internal" href="../../../compute/configure.html#node-types"><span class="std std-ref">cluster node type</span></a> that you want your Databricks workspace to use for running deployments on.</p>
<p>For example, to specify Databricks Runtime 10.4 LTS and an <code class="docutils literal notranslate"><span class="pre">i3.xlarge</span></code> node type:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">environments</span><span class="p">:</span>
<span class="w">  </span><span class="nt">default</span><span class="p">:</span>
<span class="w">    </span><span class="nt">workflows</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;covid_analysis_etl_integ&quot;</span>
<span class="w">        </span><span class="nt">new_cluster</span><span class="p">:</span>
<span class="w">          </span><span class="nt">spark_version</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;10.4.x-scala2.12&quot;</span>
<span class="w">          </span><span class="nt">num_workers</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span>
<span class="w">        </span><span class="nt">node_type_id</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;i3.xlarge&quot;</span>
<span class="w">        </span><span class="nt">spark_python_task</span><span class="p">:</span>
<span class="w">          </span><span class="nt">python_file</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;file://jobs/covid_trends_job.py&quot;</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;covid_analysis_etl_prod&quot;</span>
<span class="w">        </span><span class="nt">new_cluster</span><span class="p">:</span>
<span class="w">          </span><span class="nt">spark_version</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;10.4.x-scala2.12&quot;</span>
<span class="w">          </span><span class="nt">num_workers</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span>
<span class="w">          </span><span class="nt">node_type_id</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;i3.xlarge&quot;</span>
<span class="w">          </span><span class="nt">spark_python_task</span><span class="p">:</span>
<span class="w">            </span><span class="nt">python_file</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;file://jobs/covid_trends_job.py&quot;</span>
<span class="w">          </span><span class="nt">parameters</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&quot;--prod&quot;</span><span class="p p-Indicator">]</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;covid_analysis_etl_raw&quot;</span>
<span class="w">        </span><span class="nt">new_cluster</span><span class="p">:</span>
<span class="w">          </span><span class="nt">spark_version</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;10.4.x-scala2.12&quot;</span>
<span class="w">          </span><span class="nt">num_workers</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span>
<span class="w">          </span><span class="nt">node_type_id</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;i3.xlarge&quot;</span>
<span class="w">          </span><span class="nt">spark_python_task</span><span class="p">:</span>
<span class="w">            </span><span class="nt">python_file</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;file://jobs/covid_trends_job_raw.py&quot;</span>
</pre></div>
</div>
</li>
</ol>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>In this example, each of these three job definitions has the same <code class="docutils literal notranslate"><span class="pre">spark_version</span></code> and <code class="docutils literal notranslate"><span class="pre">node_type_id</span></code> value. You can use different values for different job definitions. You can also create shared values and reuse them across job definitions, to reduce typing errors and code maintenance. See the <a class="reference external" href="https://dbx.readthedocs.io/en/latest/reference/deployment/#configuring-complex-deployments">YAML</a> example in the <code class="docutils literal notranslate"><span class="pre">dbx</span></code> documentation.</p>
</div>
</div>
</div>
<div class="section" id="explore-the-code-sample">
<h2>Explore the code sample<a class="headerlink" href="#explore-the-code-sample" title="Permalink to this headline"> </a></h2>
<p>After you <a class="reference internal" href="#set-up-the-code-sample"><span class="std std-ref">set up the code sample</span></a>, use the following information to learn about how the various files in the <code class="docutils literal notranslate"><span class="pre">ide-demo/ide-best-practices</span></code> folder work.</p>
<div class="section" id="code-modularization">
<h3>Code modularization<a class="headerlink" href="#code-modularization" title="Permalink to this headline"> </a></h3>
<div class="section" id="unmodularized-code">
<h4>Unmodularized code<a class="headerlink" href="#unmodularized-code" title="Permalink to this headline"> </a></h4>
<p>The <code class="docutils literal notranslate"><span class="pre">jobs/covid_trends_job_raw.py</span></code> file is an unmodularized version of the code logic. You can run this file by itself.</p>
</div>
<div class="section" id="modularized-code">
<h4>Modularized code<a class="headerlink" href="#modularized-code" title="Permalink to this headline"> </a></h4>
<p>The <code class="docutils literal notranslate"><span class="pre">jobs/covid_trends_job.py</span></code> file is a modularized version of the code logic. This file relies on the shared code in the <code class="docutils literal notranslate"><span class="pre">covid_analysis/transforms.py</span></code> file. The <code class="docutils literal notranslate"><span class="pre">covid_analysis/__init__.py</span></code> file treats the <code class="docutils literal notranslate"><span class="pre">covide_analysis</span></code> folder as a containing package.</p>
</div>
</div>
<div class="section" id="testing">
<h3>Testing<a class="headerlink" href="#testing" title="Permalink to this headline"> </a></h3>
<div class="section" id="unit-tests">
<h4>Unit tests<a class="headerlink" href="#unit-tests" title="Permalink to this headline"> </a></h4>
<p>The <code class="docutils literal notranslate"><span class="pre">tests/testdata.csv</span></code> file contains a small portion of the data in the <code class="docutils literal notranslate"><span class="pre">covid-hospitalizations.csv</span></code> file for testing purposes. The <code class="docutils literal notranslate"><span class="pre">tests/transforms_test.py</span></code> file contains the unit tests for the <code class="docutils literal notranslate"><span class="pre">covid_analysis/transforms.py</span></code> file.</p>
</div>
<div class="section" id="unit-test-runner">
<h4>Unit test runner<a class="headerlink" href="#unit-test-runner" title="Permalink to this headline"> </a></h4>
<p>The <code class="docutils literal notranslate"><span class="pre">pytest.ini</span></code> file contains configuration options for running tests with <a class="reference external" href="https://docs.pytest.org">pytest</a>. See <a class="reference external" href="https://docs.pytest.org/en/7.1.x/reference/customize.html#pytest-ini">pytest.ini</a> and <a class="reference external" href="https://docs.pytest.org/en/7.1.x/reference/reference.html#ini-options-ref">Configuration Options</a> in the <code class="docutils literal notranslate"><span class="pre">pytest</span></code> documentation.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">.coveragerc</span></code> file contains configuration options for Python code coverage measurements with <a class="reference external" href="https://coverage.readthedocs.io/en/6.4/index.html">coverage.py</a>. See <a class="reference external" href="https://coverage.readthedocs.io/en/6.4/config.html">Configuration reference</a> in the <code class="docutils literal notranslate"><span class="pre">coverage.py</span></code> documentation.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">requirements.txt</span></code> file, which is a subset of the <code class="docutils literal notranslate"><span class="pre">unit-requirements.txt</span></code> file that you ran earlier with <code class="docutils literal notranslate"><span class="pre">pip</span></code>, contains a list of packages that the unit tests also depend on.</p>
</div>
</div>
<div class="section" id="packaging">
<h3>Packaging<a class="headerlink" href="#packaging" title="Permalink to this headline"> </a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">setup.py</span></code> file provides commands to be run at the console (console scripts), such as the <code class="docutils literal notranslate"><span class="pre">pip</span></code> command, for packaging Python projects with <a class="reference external" href="https://setuptools.pypa.io/en/latest/index.html">setuptools</a>. See <a class="reference external" href="https://setuptools.pypa.io/en/latest/userguide/entry_point.html">Entry Points</a> in the <code class="docutils literal notranslate"><span class="pre">setuptools</span></code> documentation.</p>
</div>
<div class="section" id="other-files">
<h3>Other files<a class="headerlink" href="#other-files" title="Permalink to this headline"> </a></h3>
<p>There are other files in this code sample that have not been previously described:</p>
<ul class="simple">
<li><p>The <code class="docutils literal notranslate"><span class="pre">.github/workflows</span></code> folder contains three files, <code class="docutils literal notranslate"><span class="pre">databricks_pull_request_tests.yml</span></code>, <code class="docutils literal notranslate"><span class="pre">onpush.yml</span></code>, and <code class="docutils literal notranslate"><span class="pre">onrelease.yaml</span></code>, that represent the GitHub Actions, which are covered later in the <a class="reference internal" href="#run-with-github-actions"><span class="std std-ref">GitHub Actions</span></a> section.</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">.gitignore</span></code> file contains a list of local folders and files that Git ignores for your repo.</p></li>
</ul>
</div>
</div>
<div class="section" id="run-the-code-sample">
<h2>Run the code sample<a class="headerlink" href="#run-the-code-sample" title="Permalink to this headline"> </a></h2>
<p>You can use <code class="docutils literal notranslate"><span class="pre">dbx</span></code> on your local machine to instruct Databricks to run the code sample in your remote workspace on-demand, as described in the next subsection. Or you can <a class="reference internal" href="#run-with-github-actions"><span class="std std-ref">use GitHub Actions</span></a> to have GitHub run the code sample every time you push code changes to your GitHub repo.</p>
<div class="section" id="run-with-dbx">
<h3>Run with dbx<a class="headerlink" href="#run-with-dbx" title="Permalink to this headline"> </a></h3>
<ol class="arabic">
<li><p>Install the contents of the <code class="docutils literal notranslate"><span class="pre">covid_analysis</span></code> folder as a package in Python <code class="docutils literal notranslate"><span class="pre">setuptools</span></code> <a class="reference external" href="https://setuptools.pypa.io/en/latest/userguide/quickstart.html#development-mode">development mode</a> by running the following command from the root of your <code class="docutils literal notranslate"><span class="pre">dbx</span></code> project (for example, the <code class="docutils literal notranslate"><span class="pre">ide-demo/ide-best-practices</span></code> folder). Be sure to include the dot (<code class="docutils literal notranslate"><span class="pre">.</span></code>) at the end of this command:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>pip<span class="w"> </span>install<span class="w"> </span>-e<span class="w"> </span>.
</pre></div>
</div>
<p>This command creates a <code class="docutils literal notranslate"><span class="pre">covid_analysis.egg-info</span></code> folder, which contains information about the compiled version of the <code class="docutils literal notranslate"><span class="pre">covid_analysis/__init__.py</span></code> and <code class="docutils literal notranslate"><span class="pre">covid_analysis/transforms.py</span></code> files.</p>
</li>
<li><p>Run the tests by running the following command:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>pytest<span class="w"> </span>tests/
</pre></div>
</div>
<p>The tests’ results are displayed in the terminal. All four tests should show as passing.</p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>For additional approaches to testing, including testing for R and Scala notebooks, see <a class="reference internal" href="../../../notebooks/testing.html"><span class="doc">Unit testing for notebooks</span></a>.</p>
</div>
</li>
<li><p>Optionally, get test coverage metrics for your tests by running the following command:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>coverage<span class="w"> </span>run<span class="w"> </span>-m<span class="w"> </span>pytest<span class="w"> </span>tests/
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If a message displays that <code class="docutils literal notranslate"><span class="pre">coverage</span></code> cannot be found, run <code class="docutils literal notranslate"><span class="pre">pip</span> <span class="pre">install</span> <span class="pre">coverage</span></code>, and try again.</p>
</div>
<p>To view test coverage results, run the following command:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>coverage<span class="w"> </span>report<span class="w"> </span>-m
</pre></div>
</div>
</li>
<li><p>If all four tests pass, send the <code class="docutils literal notranslate"><span class="pre">dbx</span></code> project’s contents to your Databricks workspace, by running the following command:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>dbx<span class="w"> </span>deploy<span class="w"> </span>--environment<span class="o">=</span>default
</pre></div>
</div>
<p>Information about the project and its runs are sent to the location specified in the <code class="docutils literal notranslate"><span class="pre">workspace_directory</span></code> object in the <code class="docutils literal notranslate"><span class="pre">.dbx/project.json</span></code> file.</p>
<p>The project’s contents are sent to the location specified in the <code class="docutils literal notranslate"><span class="pre">artifact_location</span></code> object in the <code class="docutils literal notranslate"><span class="pre">.dbx/project.json</span></code> file.</p>
</li>
<li><p>Run the pre-production version of the code in your workspace, by running the following command:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>dbx<span class="w"> </span>launch<span class="w"> </span>covid_analysis_etl_integ
</pre></div>
</div>
<p>A link to the run’s results are displayed in the terminal. It should look something like this:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>https://&lt;your-workspace-instance-id&gt;/?o<span class="o">=</span><span class="m">1234567890123456</span><span class="c1">#job/123456789012345/run/12345</span>
</pre></div>
</div>
<p>Follow this link in your web browser to see the run’s results in your workspace.</p>
</li>
<li><p>Run the production version of the code in your workspace, by running the following command:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>dbx<span class="w"> </span>launch<span class="w"> </span>covid_analysis_etl_prod
</pre></div>
</div>
<p>A link to the run’s results are displayed in the terminal. It should look something like this:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>https://&lt;your-workspace-instance-id&gt;/?o<span class="o">=</span><span class="m">1234567890123456</span><span class="c1">#job/123456789012345/run/23456</span>
</pre></div>
</div>
<p>Follow this link in your web browser to see the run’s results in your workspace.</p>
</li>
</ol>
</div>
<div class="section" id="run-with-github-actions">
<h3>Run with GitHub Actions<a class="headerlink" href="#run-with-github-actions" title="Permalink to this headline"> </a></h3>
<p>In the project’s <code class="docutils literal notranslate"><span class="pre">.github/workflows</span></code> folder, the <code class="docutils literal notranslate"><span class="pre">onpush.yml</span></code> and <code class="docutils literal notranslate"><span class="pre">onrelease.yml</span></code> GitHub Actions files do the following:</p>
<ul class="simple">
<li><p>On each push to a tag that begins with <code class="docutils literal notranslate"><span class="pre">v</span></code>, uses <code class="docutils literal notranslate"><span class="pre">dbx</span></code> to deploy the <code class="docutils literal notranslate"><span class="pre">covid_analysis_etl_prod</span></code> job.</p></li>
<li><p>On each push that is not to a tag that begins with <code class="docutils literal notranslate"><span class="pre">v</span></code>:</p>
<ol class="loweralpha simple">
<li><p>Uses <code class="docutils literal notranslate"><span class="pre">pytest</span></code> to run the unit tests.</p></li>
<li><p>Uses <code class="docutils literal notranslate"><span class="pre">dbx</span></code> to deploy the file specified in the <code class="docutils literal notranslate"><span class="pre">covid_analysis_etl_integ</span></code> job to the remote workspace.</p></li>
<li><p>Uses <code class="docutils literal notranslate"><span class="pre">dbx</span></code> to launch the already-deployed file specified in the <code class="docutils literal notranslate"><span class="pre">covid_analysis_etl_integ</span></code> job on the remote workspace, tracing this run until it finishes.</p></li>
</ol>
</li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>An additional GitHub Actions file, <code class="docutils literal notranslate"><span class="pre">databricks_pull_request_tests.yml</span></code>, is provided for you as a template to experiment with, without impacting the <code class="docutils literal notranslate"><span class="pre">onpush.yml</span></code> and <code class="docutils literal notranslate"><span class="pre">onrelease.yml</span></code> GitHub Actions files. You can run this code sample without the <code class="docutils literal notranslate"><span class="pre">databricks_pull_request_tests.yml</span></code> GitHub Actions file. Its usage is not covered in this article.</p>
</div>
<p>The following subsections describe how to set up and run the <code class="docutils literal notranslate"><span class="pre">onpush.yml</span></code> and <code class="docutils literal notranslate"><span class="pre">onrelease.yml</span></code> GitHub Actions files.</p>
<div class="section" id="set-up-to-use-github-actions">
<h4>Set up to use GitHub Actions<a class="headerlink" href="#set-up-to-use-github-actions" title="Permalink to this headline"> </a></h4>
<p>Set up your Databricks workspace by following the instructions in <a class="reference internal" href="../../../dev-tools/ci-cd/ci-cd-sp.html"><span class="doc">Service principals for CI/CD</span></a>. This includes the following actions:</p>
<ol class="arabic simple">
<li><p>Create a Databricks service principal.</p></li>
<li><p>Create a Databricks access token for the Databricks service principal.</p></li>
</ol>
<p>As a security best practice, Databricks recommends that you use a Databricks access token for a Databricks service principal, instead of the Databricks personal access token for your workspace user, for enabling GitHub to authenticate with your Databricks workspace.</p>
<p>After you create the Databricks service principal and its Databricks access token, stop and make a note of the Databricks access token value, which you will you use in the next section.</p>
</div>
<div class="section" id="run-github-actions">
<h4>Run GitHub Actions<a class="headerlink" href="#run-github-actions" title="Permalink to this headline"> </a></h4>
<div class="section" id="step-1-publish-your-cloned-repo">
<h5>Step 1: Publish your cloned repo<a class="headerlink" href="#step-1-publish-your-cloned-repo" title="Permalink to this headline"> </a></h5>
<ol class="arabic simple">
<li><p>In Visual Studio Code, in the sidebar, click the <strong>GitHub</strong> icon. If the icon is not visible, enable the <strong>GitHub Pull Requests and Issues</strong> extension through the <strong>Extensions</strong> view (<strong>View &gt; Extensions</strong>) first.</p></li>
<li><p>If the <strong>Sign In</strong> button is visible, click it, and follow the on-screen instructions to sign in to your GitHub account.</p></li>
<li><p>On the menu bar, click <strong>View &gt; Command Palette</strong>, type <code class="docutils literal notranslate"><span class="pre">Publish</span> <span class="pre">to</span> <span class="pre">GitHub</span></code>, and then click <strong>Publish to GitHub</strong>.</p></li>
<li><p>Select an option to publish your cloned repo to your GitHub account.</p></li>
</ol>
</div>
<div class="section" id="step-2-add-encrypted-secrets-to-your-repo">
<h5>Step 2: Add encrypted secrets to your repo<a class="headerlink" href="#step-2-add-encrypted-secrets-to-your-repo" title="Permalink to this headline"> </a></h5>
<p>In the GitHub website for your published repo, follow the instructions in <a class="reference external" href="https://docs.github.com/en/actions/security-guides/encrypted-secrets#creating-encrypted-secrets-for-a-repository">Creating encrypted secrets for a repository</a>, for the following encrypted secrets:</p>
<ul class="simple">
<li><p>Create an encrypted secret named <code class="docutils literal notranslate"><span class="pre">DATABRICKS_HOST</span></code>, set to the value of your <a class="reference internal" href="../../../workspace/workspace-details.html#workspace-url"><span class="std std-ref">workspace instance URL</span></a>, for example <code class="docutils literal notranslate"><span class="pre">https://dbc-a1b2345c-d6e7.cloud.databricks.com</span></code>.</p></li>
<li><p>Create an encrypted secret named <code class="docutils literal notranslate"><span class="pre">DATABRICKS_TOKEN</span></code>, set to the value of the Databricks access token for the Databricks service principal.</p></li>
</ul>
</div>
<div class="section" id="step-3-create-and-publish-a-branch-to-your-repo">
<h5>Step 3: Create and publish a branch to your repo<a class="headerlink" href="#step-3-create-and-publish-a-branch-to-your-repo" title="Permalink to this headline"> </a></h5>
<ol class="arabic simple">
<li><p>In Visual Studio Code, in <strong>Source Control</strong> view (<strong>View &gt; Source Control</strong>), click the <strong>…</strong> (<strong>Views and More Actions</strong>) icon.</p></li>
<li><p>Click <strong>Branch &gt; Create Branch From</strong>.</p></li>
<li><p>Enter a name for the branch, for example <code class="docutils literal notranslate"><span class="pre">my-branch</span></code>.</p></li>
<li><p>Select the branch to create the branch from, for example <strong>main</strong>.</p></li>
<li><p>Make a minor change to one of the files in your local repo, and then save the file. For example, make a minor change to a code comment in the <code class="docutils literal notranslate"><span class="pre">tests/transforms_test.py</span></code> file.</p></li>
<li><p>In <strong>Source Control</strong> view, click the <strong>…</strong> (<strong>Views and More Actions</strong>) icon again.</p></li>
<li><p>Click <strong>Changes &gt; Stage All Changes</strong>.</p></li>
<li><p>Click the <strong>…</strong> (<strong>Views and More Actions</strong>) icon again.</p></li>
<li><p>Click <strong>Commit &gt; Commit Staged</strong>.</p></li>
<li><p>Enter a message for the commit.</p></li>
<li><p>Click the <strong>…</strong> (<strong>Views and More Actions</strong>) icon again.</p></li>
<li><p>Click <strong>Branch &gt; Publish Branch</strong>.</p></li>
</ol>
</div>
<div class="section" id="step-4-create-a-pull-request-and-merge">
<h5>Step 4: Create a pull request and merge<a class="headerlink" href="#step-4-create-a-pull-request-and-merge" title="Permalink to this headline"> </a></h5>
<ol class="arabic simple">
<li><p>Go to the GitHub website for your published repo, <code class="docutils literal notranslate"><span class="pre">https://github/&lt;your-GitHub-username&gt;/ide-best-practices</span></code>.</p></li>
<li><p>On the <strong>Pull requests</strong> tab, next to <strong>my-branch had recent pushes</strong>, click <strong>Compare &amp; pull request</strong>.</p></li>
<li><p>Click <strong>Create pull request</strong>.</p></li>
<li><p>On the pull request page, wait for the icon next to <strong>CI pipleline / ci-pipeline (push)</strong> to display a green check mark. (It may take a few moments for the several minutes for the icon to appear.) If there is a red X instead of a green check mark, click <strong>Details</strong> to find out why. If the icon or <strong>Details</strong> are no longer showing, click <strong>Show all checks</strong>.</p></li>
<li><p>If the green check mark appears, merge the pull request into the <code class="docutils literal notranslate"><span class="pre">main</span></code> branch by clicking <strong>Merge pull request</strong>.</p></li>
</ol>
</div>
</div>
</div>
</div>
</div>


    
          </div>
        </div>
        <div  class="suapp-rating">
  <div id="suPageRateApp">
     <su-app></su-app>
   </div> 
 </div>
<hr> 
<footer>
  <div role="contentinfo">
      <p class="copyright">
          &copy; Databricks 2023. All rights reserved. Apache, Apache Spark, Spark, and the Spark logo are trademarks of the <a href="http://www.apache.org/">Apache Software Foundation</a>.
      </p>
      <p> 
        
          <a id='feedbacklink' href="mailto:doc-feedback@databricks.com?subject=Documentation Feedback">Send us feedback</a>
        
     | <a href="https://databricks.com/privacy-policy">Privacy Policy</a> | <a href="https://databricks.com/terms-of-use">Terms of Use</a></p>

  </div> 

</footer>
      </div>
    </div>
  </section>
</main>

  </page>
  
  <script type="text/javascript">
    var DOCUMENTATION_OPTIONS = {
      URL_ROOT: '../../../',
      VERSION: '1.0',
      COLLAPSE_INDEX: false,
      FILE_SUFFIX: '.html',
      HAS_SOURCE: 'false'
    };
  </script>
  <script type="text/javascript" src="../../../_static/jquery.js"></script>
  <script type="text/javascript" src="../../../_static/underscore.js"></script>
  <script type="text/javascript" src="../../../_static/doctools.js"></script>
  <script type="text/javascript" src="../../../_static/language_data.js"></script>
  

  <script type="text/javascript" src="../../../_static/js/clipboard.min.js"></script>
  <script type="text/javascript" src="../../../_static/js/jquery.waypoints.min.js"></script>

  <!-- Select2 (https://select2.org/) -->
  <link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />
  <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
  <!-- End Select2 -->

  
  
  <script type="text/javascript" src="../../../_static/js/localized.js"></script>
  <script type="text/javascript" src="../../../_static/js/custom.js"></script>
  

  
  
  <script type="text/javascript">
    jQuery(function () {
      SphinxRtdTheme.StickyNav.enable();
    });

  </script>
  
 



  <script>
  window.__searchunifyLoaderConfig = JSON.parse('{"clients": {"en": "02c2e804-27e9-11ee-aefb-0242ac120011", "ja": "6a42c3f2-2820-11ee-aefb-0242ac120011", "pt": "6a86badd-2821-11ee-aefb-0242ac120011"}}')
</script>
<script type="text/javascript" src="../../../_static/js/search-loader.js"></script>
</body>
<script type='text/javascript'>
  window.onload = function () {
    var description = document.querySelector('meta[name="description"]').getAttribute("content");
    let titleText = document.querySelector('h1').textContent;
    document.querySelector('meta[property="og:title"]').setAttribute("content", titleText);
    document.querySelector('meta[property="og:description"]').setAttribute("content", description);
    document.querySelector('meta[property="twitter:description"]').setAttribute("content", description);
  };
</script>

</html>