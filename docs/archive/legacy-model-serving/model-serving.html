

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en-US" > <![endif]-->
<!--[if gt IE 8]><!-->
<html class="no-js" lang="en-US"> <!--<![endif]-->

<head>
  <!-- cookie consent -->
  
    <!-- Combined Onetrust and Rudderstack Implementation Scripts -->
    <!-- Onetrust Initialization -->
    <script type="text/javascript" src="https://cdn.cookielaw.org/consent/92466579-1717-44d3-809d-a05fb02843ed-test/OtAutoBlock.js"></script>
    <script src="https://cdn.cookielaw.org/scripttemplates/otSDKStub.js" data-document-language="true" type="text/javascript" charset="UTF-8" data-domain-script="92466579-1717-44d3-809d-a05fb02843ed-test"></script>
    <link rel="stylesheet" id="db-onetrust-style" href="https://www.databricks.com/wp-content/uploads/db_onetrust.css" media="all" />
    <!-- Setting Rudderstack Write Key -->
    <script>window.rudderstackKey = "2SOR9fvSr5Fi6tN2ihPbVHnX1SZ" </script>
    <!-- Rudderstack Initialization + Onetrust Integration + Rudderstack Custom Events -->
    <script type="text/javascript" src="https://www.databricks.com/sites/default/files/rudderstack/v1/db-rudderstack-events.js"></script>

  <!-- cookie consent -->

  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta http-equiv="X-UA-Compatible" content="IE=9" />
  <meta content="Learn how to deploy MLflow models as REST API endpoints with Databricks Legacy MLflow Model Serving." name="description" />
<meta content="noindex" name="robots" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0">
  <meta property="og:image" content="https://www.databricks.com/wp-content/uploads/2020/04/og-databricks.png">
  <meta property="og:image:type" content="image/png">
  <meta property="og:title" content="Legacy MLflow Model Serving on Databricks">
  <meta property="og:image:width" content="1200">
  <meta property="og:image:height" content="630">
  <meta property="og:type" content="website">
  <meta property="og:url" content="https://docs.databricks.com">
  <meta property="og:description" content="" id="og-description">
  <meta name="twitter:image" content="https://www.databricks.com/wp-content/uploads/2020/04/og-databricks.png">
  <meta name="twitter:site" content="@databricks">
  <meta name="twitter:creator" content="@databricks">
  <meta property="twitter:description" content="">
  
  <title>Legacy MLflow Model Serving on Databricks &#124; Databricks on AWS</title>
  
  
  <link rel="canonical" href="https://docs.databricks.com/en/archive/legacy-model-serving/model-serving.html">
  <!-- Start hreflang tag -->
  <link rel="alternate" hreflang="en" href="https://docs.databricks.com/en/archive/legacy-model-serving/model-serving.html" />
<link rel="alternate" hreflang="x-default" href="https://docs.databricks.com/en/archive/legacy-model-serving/model-serving.html" />
  <!-- End hreflang tag -->
  
  
  <link rel="shortcut icon" href="../../_static/favicon.ico" />
  

  

  

  <!-- Google Tag Manager -->
  <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'https://www.googletagmanager.com/gtm.js?id='+i+dl;
j.setAttributeNode(d.createAttribute('data-ot-ignore'));
f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-T85FQ33');</script>
  <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'https://www.googletagmanager.com/gtm.js?id='+i+dl;
j.setAttributeNode(d.createAttribute('data-ot-ignore'));
f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-TWTKQQ');</script>
    
  <!-- End Google Tag Manager -->


  <!-- MaxMind / GEO IP -->
  <script src="//js.maxmind.com/js/apis/geoip2/v2.1/geoip2.js" type="text/javascript"></script>
  <!-- End MaxMind / GEO IP -->

  
  
  <link href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,600&display=swap" rel="stylesheet">
  <link rel="preload" href="../../_static/fonts/DMSans-Bold.ttf" as="font">
  <link rel="preload" href="../../_static/fonts/DMSans-Regular.ttf" as="font">
  <link rel="preload" href="../../_static/fonts/DMMono-Regular.ttf" as="font">
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/css/custom.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/css/cloud-provider-selector.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/css/translation-selector.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/css/searchunify/main.css" type="text/css" />

  
  <link rel="index" title="Index" href="../../genindex.html" />
  <link rel="search" title="Search" href="../../search.html" />
  <link rel="top" title="Databricks on AWS" href="../../index.html" /> 
</head>

<body class="wy-body-for-nav" role="document">

  <!-- Google Tag Manager (noscript) -->
  <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-T85FQ33"
height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
  <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-TWTKQQ"
    height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
  <!-- End Google Tag Manager (noscript) -->

  
  <nav class="wy-nav-top header su_header" role="navigation" aria-label="top navigation">
    
<nav class="wy-nav-top header su_header" role="navigation" aria-label="top navigation">
  <div class="container-logo">
    <ul class="mobile-menu-toggle">
        <li class="menu-toggle">
            <i data-toggle="wy-nav-top" class="wy-nav-top-menu-button db-icon db-icon-menu pull-left"></i>
            
            <a href="https://www.databricks.com/" class="wy-nav-top-logo"><img src="../../_static/small-scale-lockup-full-color-rgb.svg" width="137" height="21"
              alt="Databricks" /></a>   
               
              </li>
    </ul>
    <ul class="su_nav-menu">
      <li class="menu-toggle">
        <i data-toggle="wy-nav-top" class="wy-nav-top-menu-button db-icon db-icon-menu pull-left"></i>
        
          
        
        <a href="https://www.databricks.com/" class="wy-nav-top-logo"><img src="../../_static/small-scale-lockup-full-color-rgb.svg" width="137" height="21"
            alt="Databricks" /></a></li>
        <!-- 
<li><a href="https://help.databricks.com/s/">Help Center</a></li>
<li class="active"><a href="https://docs.databricks.com/en/">Documentation</a></li>
<li><a href="https://kb.databricks.com/">Knowledge Base</a></li>
 -->
    </ul>
  </div>
  <div class="su_nav-right">
    <ul class="su_link-mobile">
  <!-- Mobile header code can go here -->
</ul>
<ul class="right-try-list">
   
</ul>
  </div>
</nav>
  </nav>

  <div class="su_sub-header">
    <div class="container">
      <div class="su_sub-header-inner">
        <!-- <div class="su_subnav-menu-right">
  <div id="auto" style="width: 100%;">
    <div ng-controller="SearchautoController">
      <div bind-html-compile="autocompleteHtml">
        <form class="su__search-box-1" disabled="disabled">
          <input class="su__search-input" type="search" name="Search box" id="su__search-b" placeholder="Search Documentation" disabled="disabled"/>
          <button class="su__search-button" type="submit" class="button button-success" disabled="disabled">
            <svg width="24" height="24" viewBox="0 0 24 24">
              <path
                d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"
                fill="#333"></path>
            </svg>
          </button>
        </form>
      </div>
    </div>
  </div>
</div> -->
        <div class="search-lng-gap"></div>
        <div style="margin-left: 16px; margin-right: 16px;">
          <!-- <select name="lng selector" id="lng-selector">
    <option value="../../../en/archive/legacy-model-serving/model-serving.html" class="notranslate">English</option>
    <option value="../../../ja/archive/legacy-model-serving/model-serving.html" class="notranslate">日本語</option>
    <option value="../../../pt/archive/legacy-model-serving/model-serving.html" class="notranslate">Português (Brasil)</option>
</select> -->
        </div>
        <div class="cloud-selector-container">
          <!-- <select name="cloud provider selector" id="cloud-provider-selector">
    <option value="aws" selected class="notranslate">
        Amazon Web Services
    </option>
    <option value="azure"  class="notranslate">
        Microsoft Azure
    </option>
    <option value="gcp"  class="notranslate">
        Google Cloud Platform
    </option>
</select> -->
        </div>
      </div>
    </div>
  </div>
  <page class="js-page-container">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side su_nav-side">
<div class="wy-side-scroll">
  <div class="wy-side-nav-search">
    

    

    

    
  </div>

  <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
    
      <a href="../../index.html" class="main-navigation-home">Databricks on AWS</a>
    

    
      

      
        <p class="caption"><span class="caption-text">Load &amp; manage data</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../rag-temp/index.html">RAG Studio</a></li>
</ul>

      
    
  </div>

  <div role="contentinfo">
    
  <p class="build_info notranslate"data-last-edit="December 23, 2023">
    Updated Jan 11, 2024
  </p>
<script>
  window.addEventListener('DOMContentLoaded',function(){
    var h1=document.querySelector('h1');
    var bi=document.querySelector('[data-last-edit]');
    if(h1 && bi){
      var ver = document.createElement('p');
      ver.className = 'version_info';
      ver.textContent = bi.getAttribute('data-last-edit');
      h1.parentElement.insertBefore(ver, h1.nextElementSibling);
    }
  });
</script>

    <p>
      
        <a id='feedbacklink' href="mailto:doc-feedback@databricks.com?subject=Documentation Feedback">Send us feedback</a>
      
    </p>
  </div>
</div>
</nav>
    
    
<main class="wy-grid-for-nav su_nav-grid">
  <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
    <div class="wy-nav-content su__nav_content">
      <div class="rst-content">
        





<div role="navigation" aria-label="breadcrumbs navigation" class="wy-breadcrumbs-wrapper">
  <ul class="wy-breadcrumbs">
    <li><a href="../../index.html">Documentation</a> <span class="db-icon db-icon-chevron-right"></span></li>
    
    
      <li>Legacy MLflow Model Serving on Databricks</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>
</div>
        
        <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
          <div itemprop="articleBody">
            
    
  <div class="section" id="legacy-mlflow-model-serving-on-databricks">
<h1>Legacy MLflow Model Serving on Databricks<a class="headerlink" href="#legacy-mlflow-model-serving-on-databricks" title="Permalink to this headline"> </a></h1>
<div class="preview admonition">
<p class="admonition-title">Preview</p>
<p>This feature is in <a class="reference internal" href="../../release-notes/release-types.html"><span class="doc">Public Preview</span></a>.</p>
</div>
<div class="admonition important">
<p class="admonition-title">Important</p>
<ul class="simple">
<li><p>This documentation has been retired and might not be updated. The products, services, or technologies mentioned in this content are no longer supported.</p></li>
<li><p>The guidance in this article is for Legacy MLflow Model Serving. Databricks recommends you migrate your model serving workflows to Model Serving for the enhanced model endpoint deployment and scalability. For more information, see <a class="reference internal" href="../../machine-learning/model-serving/index.html"><span class="doc">Model serving with Databricks</span></a>.</p></li>
</ul>
</div>
<p>Legacy MLflow Model Serving allows you to host machine learning models from Model Registry as REST endpoints that are updated automatically based on the availability of model versions and their stages. It uses a single-node cluster that runs under your own account within what is now called the classic compute plane. This compute plane includes the virtual network and its associated compute resources such as clusters for notebooks and jobs, pro and classic SQL warehouses, and Legacy model serving endpoints.</p>
<p>When you enable model serving for a given registered model, Databricks automatically creates a unique cluster for the model and deploys all non-archived versions of the model on that cluster. Databricks restarts the cluster if an error occurs and terminates the cluster when you disable model serving for the model. Model serving automatically syncs with Model Registry and deploys any new registered model versions. Deployed model versions can be queried with a standard REST API request. Databricks authenticates requests to the model using its standard authentication.</p>
<p>While this service is in preview, Databricks recommends its use for low throughput and non-critical applications. Target throughput is 200 qps and target availability is 99.5%, although no guarantee is made as to either. Additionally, there is a payload size limit of 16 MB per request.</p>
<p>Each model version is deployed using MLflow <a class="reference external" href="https://www.mlflow.org/docs/latest/models.html#deploy-mlflow-models">model deployment</a> and runs in a Conda environment specified by its dependencies.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<ul class="simple">
<li><p>The cluster is maintained as long as serving is enabled, even if no active model version exists. To terminate the serving cluster, disable model serving for the registered model.</p></li>
<li><p>The cluster is considered an all-purpose cluster, subject to all-purpose workload pricing.</p></li>
<li><p><a class="reference internal" href="../../init-scripts/global.html"><span class="doc">Global init scripts</span></a> are not run on model serving clusters.</p></li>
</ul>
</div>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>Anaconda Inc. updated their <a class="reference external" href="https://www.anaconda.com/terms-of-service">terms of service</a> for anaconda.org channels. Based on the new terms of service you may require a commercial license if you rely on Anaconda’s packaging and distribution. See <a class="reference external" href="https://www.anaconda.com/blog/anaconda-commercial-edition-faq">Anaconda Commercial Edition FAQ</a> for more information. Your use of any Anaconda channels is governed by their terms of service.</p>
<p>MLflow models logged before <a class="reference external" href="https://mlflow.org/news/2021/06/18/1.18.0-release/index.html">v1.18</a> (Databricks Runtime 8.3 ML or earlier) were by default logged with the conda <code class="docutils literal notranslate"><span class="pre">defaults</span></code> channel (<a class="reference external" href="https://repo.anaconda.com/pkgs/">https://repo.anaconda.com/pkgs/</a>) as a dependency. Because of this license change, Databricks has stopped the use of the <code class="docutils literal notranslate"><span class="pre">defaults</span></code> channel for models logged using MLflow v1.18 and above. The default channel logged is now <code class="docutils literal notranslate"><span class="pre">conda-forge</span></code>, which points at the community managed <a class="reference external" href="https://conda-forge.org/">https://conda-forge.org/</a>.</p>
<p>If you logged a model before MLflow v1.18 without excluding the <code class="docutils literal notranslate"><span class="pre">defaults</span></code> channel from the conda environment for the model, that model may have a dependency on the <code class="docutils literal notranslate"><span class="pre">defaults</span></code> channel that you may not have intended.
To manually confirm whether a model has this dependency, you can examine <code class="docutils literal notranslate"><span class="pre">channel</span></code> value in the <code class="docutils literal notranslate"><span class="pre">conda.yaml</span></code> file that is packaged with the logged model. For example, a model’s <code class="docutils literal notranslate"><span class="pre">conda.yaml</span></code> with a <code class="docutils literal notranslate"><span class="pre">defaults</span></code> channel dependency may look like this:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">channels</span><span class="p">:</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">defaults</span>
<span class="nt">dependencies</span><span class="p">:</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">python=3.8.8</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">pip</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">pip</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">mlflow</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">scikit-learn==0.23.2</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">cloudpickle==1.6.0</span>
<span class="w">      </span><span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">mlflow-env</span>
</pre></div>
</div>
<p>Because Databricks can not determine whether your use of the Anaconda repository to interact with your models is permitted under your relationship with Anaconda, Databricks is not forcing its customers to make any changes. If your use of the Anaconda.com repo through the use of Databricks is permitted under Anaconda’s terms, you do not need to take any action.</p>
<p>If you would like to change the channel used in a model’s environment, you can re-register the model to the model registry with a new <code class="docutils literal notranslate"><span class="pre">conda.yaml</span></code>. You can do this by specifying the channel in the <code class="docutils literal notranslate"><span class="pre">conda_env</span></code> parameter of <code class="docutils literal notranslate"><span class="pre">log_model()</span></code>.</p>
<p>For more information on the <code class="docutils literal notranslate"><span class="pre">log_model()</span></code> API, see the MLflow documentation for the model flavor you are working with, for example, <a class="reference external" href="https://www.mlflow.org/docs/latest/python_api/mlflow.sklearn.html#mlflow.sklearn.log_model">log_model for scikit-learn</a>.</p>
<p>For more information on <code class="docutils literal notranslate"><span class="pre">conda.yaml</span></code> files, see the <a class="reference external" href="https://www.mlflow.org/docs/latest/models.html#additional-logged-files">MLflow documentation</a>.</p>
</div>
<div class="section" id="requirements">
<h2>Requirements<a class="headerlink" href="#requirements" title="Permalink to this headline"> </a></h2>
<ul class="simple">
<li><p>Legacy MLflow Model Serving is available for Python MLflow models. You must declare all model dependencies in the conda environment. See <a class="reference internal" href="../../mlflow/log-model-dependencies.html"><span class="doc">Log model dependencies</span></a>.</p></li>
<li><p>To enable Model Serving, you must have <a class="reference internal" href="../../security/auth-authz/access-control/cluster-acl.html#cluster-create-permission"><span class="std std-ref">cluster creation permission</span></a>.</p></li>
</ul>
</div>
<div class="section" id="model-serving-from-model-registry">
<h2>Model serving from Model Registry<a class="headerlink" href="#model-serving-from-model-registry" title="Permalink to this headline"> </a></h2>
<p>Model serving is available in Databricks from Model Registry.</p>
<div class="section" id="enable-and-disable-model-serving">
<h3>Enable and disable model serving<a class="headerlink" href="#enable-and-disable-model-serving" title="Permalink to this headline"> </a></h3>
<p>You enable a model for serving from its <a class="reference internal" href="../../mlflow/model-registry.html#registered-model-page"><span class="std std-ref">registered model page</span></a>.</p>
<ol class="arabic">
<li><p>Click the <strong>Serving</strong> tab. If the model is not already enabled for serving, the <strong>Enable Serving</strong> button appears.</p>
<div class="figure align-default">
<img alt="Enable serving button" src="../../_images/enable-serving.png" />
</div>
</li>
<li><p>Click <strong>Enable Serving</strong>. The Serving tab appears with <strong>Status</strong> shown as Pending. After a few minutes, <strong>Status</strong> changes to Ready.</p></li>
</ol>
<p>To disable a model for serving, click <strong>Stop</strong>.</p>
</div>
<div class="section" id="validate-model-serving">
<h3>Validate model serving<a class="headerlink" href="#validate-model-serving" title="Permalink to this headline"> </a></h3>
<p>From the <strong>Serving</strong> tab, you can send a request to the served model and view the response.</p>
<div class="figure align-default">
<img alt="Enable serving" src="../../_images/enable-serving.gif" />
</div>
</div>
<div class="section" id="model-version-uris">
<h3>Model version URIs<a class="headerlink" href="#model-version-uris" title="Permalink to this headline"> </a></h3>
<p>Each deployed model version is assigned one or several unique URIs. At minimum, each model version is assigned a URI constructed as follows:</p>
<blockquote>
<div><p><code class="docutils literal notranslate"><span class="pre">&lt;databricks-instance&gt;/model/&lt;registered-model-name&gt;/&lt;model-version&gt;/invocations</span></code></p>
</div></blockquote>
<p>For example, to call version 1 of a model registered as <code class="docutils literal notranslate"><span class="pre">iris-classifier</span></code>, use this URI:</p>
<blockquote>
<div><p><code class="docutils literal notranslate"><span class="pre">https://&lt;databricks-instance&gt;/model/iris-classifier/1/invocations</span></code></p>
</div></blockquote>
<p>You can also call a model version by its stage. For example, if version 1 is in the <strong>Production</strong> stage, it can also be scored using this URI:</p>
<blockquote>
<div><p><code class="docutils literal notranslate"><span class="pre">https://&lt;databricks-instance&gt;/model/iris-classifier/Production/invocations</span></code></p>
</div></blockquote>
<p>The list of available model URIs appears at the top of the Model Versions tab on the serving page.</p>
</div>
</div>
<div class="section" id="manage-served-versions">
<h2>Manage served versions<a class="headerlink" href="#manage-served-versions" title="Permalink to this headline"> </a></h2>
<p>All active (non-archived) model versions are deployed, and you can query them using the URIs. Databricks automatically deploys new model versions when they are registered, and automatically removes old versions when they are archived.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>All deployed versions of a registered model share the same cluster.</p>
</div>
</div>
<div class="section" id="manage-model-access-rights">
<h2>Manage model access rights<a class="headerlink" href="#manage-model-access-rights" title="Permalink to this headline"> </a></h2>
<p>Model access rights are inherited from the Model Registry. Enabling or disabling the serving feature requires ‘manage’ permission on the registered model. Anyone with read rights can score any of the deployed versions.</p>
</div>
<div class="section" id="score-deployed-model-versions">
<span id="score"></span><h2>Score deployed model versions<a class="headerlink" href="#score-deployed-model-versions" title="Permalink to this headline"> </a></h2>
<p>To score a deployed model, you can use the UI or send a REST API request to the model URI.</p>
<div class="section" id="score-via-ui">
<h3>Score via UI<a class="headerlink" href="#score-via-ui" title="Permalink to this headline"> </a></h3>
<p>This is the easiest and fastest way to test the model. You can insert the model input data in JSON format and click <strong>Send Request</strong>. If the model has been logged with an input example (as shown in the graphic above), click <strong>Load Example</strong> to load the input example.</p>
</div>
<div class="section" id="score-via-rest-api-request">
<h3>Score via REST API request<a class="headerlink" href="#score-via-rest-api-request" title="Permalink to this headline"> </a></h3>
<p>You can send a scoring request through the REST API using <a class="reference external" href="https://docs.databricks.com/api/workspace/tokenmanagement">standard Databricks authentication</a>. The examples below demonstrate authentication using a personal access token with MLflow 1.x.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>As a security best practice when you authenticate with automated tools, systems, scripts, and apps, Databricks recommends that you use OAuth tokens.</p>
<p>If you use personal access token authentication, Databricks recommends using personal access tokens belonging to <a class="reference internal" href="../../administration-guide/users-groups/service-principals.html"><span class="doc">service principals</span></a> instead of workspace users. To create tokens for service principals, see <a class="reference internal" href="../../administration-guide/users-groups/service-principals.html#personal-access-tokens"><span class="std std-ref">Manage tokens for a service principal</span></a>.</p>
</div>
<p>Given a <code class="docutils literal notranslate"><span class="pre">MODEL_VERSION_URI</span></code> like <code class="docutils literal notranslate"><span class="pre">https://&lt;databricks-instance&gt;/model/iris-classifier/Production/invocations</span></code> (where <code class="docutils literal notranslate"><span class="pre">&lt;databricks-instance&gt;</span></code> is the <a class="reference internal" href="../../workspace/workspace-details.html#workspace-instance-names-urls-and-ids"><span class="std std-ref">name of your Databricks instance</span></a>) and a Databricks REST API token called <code class="docutils literal notranslate"><span class="pre">DATABRICKS_API_TOKEN</span></code>, the following examples show how to query a served model:</p>
<p>The following examples reflect the scoring format for models created with MLflow 1.x. If you prefer to use MLflow 2.0, you need to <a class="reference internal" href="#known-issues"><span class="std std-ref">update your request payload format</span></a>.</p>
<div class="js-code-language-tabs compound">
<div class="compound-first compound" lang="bash">
<p class="compound-first">Snippet to query a model accepting dataframe inputs.</p>
<div class="compound-middle highlight-bash notranslate"><div class="highlight"><pre><span></span>curl<span class="w"> </span>-X<span class="w"> </span>POST<span class="w"> </span>-u<span class="w"> </span>token:<span class="nv">$DATABRICKS_API_TOKEN</span><span class="w"> </span><span class="nv">$MODEL_VERSION_URI</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-H<span class="w"> </span><span class="s1">&#39;Content-Type: application/json&#39;</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-d<span class="w"> </span><span class="s1">&#39;[</span>
<span class="s1">    {</span>
<span class="s1">      &quot;sepal_length&quot;: 5.1,</span>
<span class="s1">      &quot;sepal_width&quot;: 3.5,</span>
<span class="s1">      &quot;petal_length&quot;: 1.4,</span>
<span class="s1">      &quot;petal_width&quot;: 0.2</span>
<span class="s1">    }</span>
<span class="s1">  ]&#39;</span>
</pre></div>
</div>
<p class="compound-middle">Snippet to query a model accepting tensor inputs. Tensor inputs should be formatted as described in <a class="reference external" href="https://www.tensorflow.org/tfx/serving/api_rest#request_format_2">TensorFlow Serving’s API docs</a>.</p>
<div class="compound-last highlight-bash notranslate"><div class="highlight"><pre><span></span>curl<span class="w"> </span>-X<span class="w"> </span>POST<span class="w"> </span>-u<span class="w"> </span>token:<span class="nv">$DATABRICKS_API_TOKEN</span><span class="w"> </span><span class="nv">$MODEL_VERSION_URI</span><span class="w"> </span><span class="se">\</span>
<span class="w">   </span>-H<span class="w"> </span><span class="s1">&#39;Content-Type: application/json&#39;</span><span class="w"> </span><span class="se">\</span>
<span class="w">   </span>-d<span class="w"> </span><span class="s1">&#39;{&quot;inputs&quot;: [[5.1, 3.5, 1.4, 0.2]]}&#39;</span>
</pre></div>
</div>
</div>
<div class="compound-middle compound" lang="python">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">requests</span>

<span class="k">def</span> <span class="nf">create_tf_serving_json</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
  <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;inputs&#39;</span><span class="p">:</span> <span class="p">{</span><span class="n">name</span><span class="p">:</span> <span class="n">data</span><span class="p">[</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span> <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">keys</span><span class="p">()}</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)</span> <span class="k">else</span> <span class="n">data</span><span class="o">.</span><span class="n">tolist</span><span class="p">()}</span>

<span class="k">def</span> <span class="nf">score_model</span><span class="p">(</span><span class="n">model_uri</span><span class="p">,</span> <span class="n">databricks_token</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
  <span class="n">headers</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;Authorization&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;Bearer </span><span class="si">{</span><span class="n">databricks_token</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Content-Type&quot;</span><span class="p">:</span> <span class="s2">&quot;application/json&quot;</span><span class="p">,</span>
  <span class="p">}</span>
  <span class="n">data_json</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">to_dict</span><span class="p">(</span><span class="n">orient</span><span class="o">=</span><span class="s1">&#39;records&#39;</span><span class="p">)</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)</span> <span class="k">else</span> <span class="n">create_tf_serving_json</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
  <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">request</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="s1">&#39;POST&#39;</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">,</span> <span class="n">url</span><span class="o">=</span><span class="n">model_uri</span><span class="p">,</span> <span class="n">json</span><span class="o">=</span><span class="n">data_json</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">!=</span> <span class="mi">200</span><span class="p">:</span>
      <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Request failed with status </span><span class="si">{</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
  <span class="k">return</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>

<span class="c1"># Scoring a model that accepts pandas DataFrames</span>
<span class="n">data</span> <span class="o">=</span>  <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">([{</span>
  <span class="s2">&quot;sepal_length&quot;</span><span class="p">:</span> <span class="mf">5.1</span><span class="p">,</span>
  <span class="s2">&quot;sepal_width&quot;</span><span class="p">:</span> <span class="mf">3.5</span><span class="p">,</span>
  <span class="s2">&quot;petal_length&quot;</span><span class="p">:</span> <span class="mf">1.4</span><span class="p">,</span>
  <span class="s2">&quot;petal_width&quot;</span><span class="p">:</span> <span class="mf">0.2</span>
<span class="p">}])</span>
<span class="n">score_model</span><span class="p">(</span><span class="n">MODEL_VERSION_URI</span><span class="p">,</span> <span class="n">DATABRICKS_API_TOKEN</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>

<span class="c1"># Scoring a model that accepts tensors</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">([[</span><span class="mf">5.1</span><span class="p">,</span> <span class="mf">3.5</span><span class="p">,</span> <span class="mf">1.4</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">]])</span>
<span class="n">score_model</span><span class="p">(</span><span class="n">MODEL_VERSION_URI</span><span class="p">,</span> <span class="n">DATABRICKS_API_TOKEN</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="compound-last compound" lang="PowerBI">
<p class="compound-first">You can score a dataset in Power BI Desktop using the following steps:</p>
<ol class="compound-last arabic">
<li><p>Open dataset you want to score.</p></li>
<li><p>Go to Transform Data.</p></li>
<li><p>Right-click in the left panel and select <strong>Create New Query</strong>.</p></li>
<li><p>Go to <strong>View &gt; Advanced Editor</strong>.</p></li>
<li><p>Replace the query body with the code snippet below, after filling in an appropriate <code class="docutils literal notranslate"><span class="pre">DATABRICKS_API_TOKEN</span></code> and <code class="docutils literal notranslate"><span class="pre">MODEL_VERSION_URI</span></code>.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="n">dataset</span> <span class="k">as</span> <span class="n">table</span> <span class="p">)</span> <span class="k">as</span> <span class="n">table</span> <span class="o">=&gt;</span>
<span class="n">let</span>
  <span class="n">call_predict</span> <span class="o">=</span> <span class="p">(</span><span class="n">dataset</span> <span class="k">as</span> <span class="n">table</span> <span class="p">)</span> <span class="k">as</span> <span class="nb">list</span> <span class="o">=&gt;</span>
  <span class="n">let</span>
    <span class="n">apiToken</span> <span class="o">=</span> <span class="n">DATABRICKS_API_TOKEN</span><span class="p">,</span>
    <span class="n">modelUri</span> <span class="o">=</span> <span class="n">MODEL_VERSION_URI</span><span class="p">,</span>
    <span class="n">responseList</span> <span class="o">=</span> <span class="n">Json</span><span class="o">.</span><span class="n">Document</span><span class="p">(</span><span class="n">Web</span><span class="o">.</span><span class="n">Contents</span><span class="p">(</span><span class="n">modelUri</span><span class="p">,</span>
      <span class="p">[</span>
        <span class="n">Headers</span> <span class="o">=</span> <span class="p">[</span>
          <span class="c1">#&quot;Content-Type&quot; = &quot;application/json&quot;,</span>
          <span class="c1">#&quot;Authorization&quot; = Text.Format(&quot;Bearer #{0}&quot;, {apiToken})</span>
        <span class="p">],</span>
        <span class="n">Content</span> <span class="o">=</span> <span class="n">Json</span><span class="o">.</span><span class="n">FromValue</span><span class="p">(</span><span class="n">dataset</span><span class="p">)</span>
      <span class="p">]</span>
    <span class="p">))</span>
  <span class="ow">in</span>
    <span class="n">responseList</span><span class="p">,</span>
  <span class="n">predictionList</span> <span class="o">=</span> <span class="n">List</span><span class="o">.</span><span class="n">Combine</span><span class="p">(</span><span class="n">List</span><span class="o">.</span><span class="n">Transform</span><span class="p">(</span><span class="n">Table</span><span class="o">.</span><span class="n">Split</span><span class="p">(</span><span class="n">dataset</span><span class="p">,</span> <span class="mi">256</span><span class="p">),</span> <span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="n">call_predict</span><span class="p">(</span><span class="n">x</span><span class="p">))),</span>
  <span class="n">predictionsTable</span> <span class="o">=</span> <span class="n">Table</span><span class="o">.</span><span class="n">FromList</span><span class="p">(</span><span class="n">predictionList</span><span class="p">,</span> <span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span><span class="n">x</span><span class="p">},</span> <span class="p">{</span><span class="s2">&quot;Prediction&quot;</span><span class="p">}),</span>
  <span class="n">datasetWithPrediction</span> <span class="o">=</span> <span class="n">Table</span><span class="o">.</span><span class="n">Join</span><span class="p">(</span>
    <span class="n">Table</span><span class="o">.</span><span class="n">AddIndexColumn</span><span class="p">(</span><span class="n">predictionsTable</span><span class="p">,</span> <span class="s2">&quot;index&quot;</span><span class="p">),</span> <span class="s2">&quot;index&quot;</span><span class="p">,</span>
    <span class="n">Table</span><span class="o">.</span><span class="n">AddIndexColumn</span><span class="p">(</span><span class="n">dataset</span><span class="p">,</span> <span class="s2">&quot;index&quot;</span><span class="p">),</span> <span class="s2">&quot;index&quot;</span><span class="p">)</span>
<span class="ow">in</span>
  <span class="n">datasetWithPrediction</span>
</pre></div>
</div>
</li>
<li><p>Name the query with your desired model name.</p></li>
<li><p>Open the advanced query editor for your dataset and apply the model function.</p></li>
</ol>
</div>
</div>
</div>
</div>
<div class="section" id="monitor-served-models">
<h2>Monitor served models<a class="headerlink" href="#monitor-served-models" title="Permalink to this headline"> </a></h2>
<p>The serving page displays status indicators for the serving cluster as well as individual model versions.</p>
<ul class="simple">
<li><p>To inspect the state of the serving cluster, use the <strong>Model Events</strong> tab, which displays a list of all serving events for this model.</p></li>
<li><p>To inspect the state of a single model version, click the <strong>Model Versions</strong> tab and scroll to view the <strong>Logs</strong> or <strong>Version Events</strong> tabs.</p></li>
</ul>
<div class="figure align-default">
<img alt="Serving tab" src="../../_images/serving-tab.png" />
</div>
</div>
<div class="section" id="customize-the-serving-cluster">
<h2>Customize the serving cluster<a class="headerlink" href="#customize-the-serving-cluster" title="Permalink to this headline"> </a></h2>
<p>To customize the serving cluster, use the <strong>Cluster Settings</strong> tab on the <strong>Serving</strong> tab .</p>
<div class="figure align-default">
<img alt="Cluster settings" src="../../_images/cluster-settings.png" />
</div>
<ul class="simple">
<li><p>To modify the memory size and number of cores of a serving cluster, use the <strong>Instance Type</strong> drop-down menu to select the desired cluster configuration. When you click <strong>Save</strong>, the existing cluster is terminated and a new cluster is created with the specified settings.</p></li>
<li><p>To add a tag, type the name and value in the <strong>Add Tag</strong> fields and click <strong>Add</strong>.</p></li>
<li><p>To edit or delete an existing tag, click one of the icons in the <strong>Actions</strong> column of the <strong>Tags</strong> table.</p></li>
</ul>
</div>
<div class="section" id="feature-store-integration">
<span id="customize-the-serving-cluster"></span><h2>Feature store integration<a class="headerlink" href="#feature-store-integration" title="Permalink to this headline"> </a></h2>
<p>Legacy model serving can automatically look up <a class="reference internal" href="../../machine-learning/feature-store/index.html"><span class="doc">feature values from published online stores</span></a>.</p>
<p>  .. aws:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Databricks</span> <span class="n">Legacy</span> <span class="n">MLflow</span> <span class="n">Model</span> <span class="n">Serving</span> <span class="n">supports</span> <span class="n">automatic</span> <span class="n">feature</span> <span class="n">lookup</span> <span class="kn">from</span> <span class="nn">these</span> <span class="n">online</span> <span class="n">stores</span><span class="p">:</span>

<span class="o">-</span> <span class="n">Amazon</span> <span class="n">DynamoDB</span> <span class="p">(</span><span class="n">v0</span><span class="mf">.3.8</span> <span class="ow">and</span> <span class="n">above</span><span class="p">)</span>
<span class="o">-</span> <span class="n">Amazon</span> <span class="n">Aurora</span> <span class="p">(</span><span class="n">MySQL</span><span class="o">-</span><span class="n">compatible</span><span class="p">)</span>
<span class="o">-</span> <span class="n">Amazon</span> <span class="n">RDS</span> <span class="n">MySQL</span>

<span class="o">..</span> <span class="n">azure</span><span class="p">::</span>

<span class="n">Databricks</span> <span class="n">Legacy</span> <span class="n">MLflow</span> <span class="n">Model</span> <span class="n">Serving</span> <span class="n">supports</span> <span class="n">automatic</span> <span class="n">feature</span> <span class="n">lookup</span> <span class="kn">from</span> <span class="nn">these</span> <span class="n">online</span> <span class="n">stores</span><span class="p">:</span>

<span class="o">-</span> <span class="n">Azure</span> <span class="n">Cosmos</span> <span class="n">DB</span> <span class="p">(</span><span class="n">v0</span><span class="mf">.5.0</span> <span class="ow">and</span> <span class="n">above</span><span class="p">)</span>
<span class="o">-</span> <span class="n">Azure</span> <span class="n">Database</span> <span class="k">for</span> <span class="n">MySQL</span>
</pre></div>
</div>
</div>
<div class="section" id="known-errors">
<span id="known-issues"></span><h2>Known errors<a class="headerlink" href="#known-errors" title="Permalink to this headline"> </a></h2>
<p><code class="docutils literal notranslate"><span class="pre">ResolvePackageNotFound:</span> <span class="pre">pyspark=3.1.0</span></code></p>
<p>This error can occur if a model depends on <code class="docutils literal notranslate"><span class="pre">pyspark</span></code> and is logged using Databricks Runtime 8.x.
If you see this error, specify the <code class="docutils literal notranslate"><span class="pre">pyspark</span></code> version explicitly when logging the model, using
the <a class="reference external" href="https://www.mlflow.org/docs/latest/projects.html#specifying-an-environment">`conda_env` parameter</a>.</p>
<p><code class="docutils literal notranslate"><span class="pre">Unrecognized</span> <span class="pre">content</span> <span class="pre">type</span> <span class="pre">parameters:</span> <span class="pre">format</span></code></p>
<p>This error can occur as a result of the new MLflow 2.0 scoring protocol format. If you are seeing this error, you are likely using an outdated scoring request format. To resolve the error, you can:</p>
<ul>
<li><p>Update your scoring request format to the latest protocol.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The following examples reflect the scoring format introduced in MLflow 2.0. If you prefer to use MLflow 1.x, you can modify your <code class="docutils literal notranslate"><span class="pre">log_model()</span></code> API calls to include the desired MLflow version dependency in the <code class="docutils literal notranslate"><span class="pre">extra_pip_requirements</span></code> parameter. Doing so ensures the appropriate scoring format is used.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>    <span class="n">mlflow</span><span class="o">.&lt;</span><span class="n">flavor</span><span class="o">&gt;.</span><span class="n">log_model</span><span class="p">(</span><span class="o">...</span><span class="p">,</span> <span class="n">extra_pip_requirements</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;mlflow==1.*&quot;</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="js-code-language-tabs compound">
<div class="compound-first compound" lang="bash">
<p class="compound-first">Query a model accepting pandas dataframe inputs.</p>
<div class="compound-middle highlight-bash notranslate"><div class="highlight"><pre><span></span>curl<span class="w"> </span>-X<span class="w"> </span>POST<span class="w"> </span>-u<span class="w"> </span>token:<span class="nv">$DATABRICKS_API_TOKEN</span><span class="w"> </span><span class="nv">$MODEL_VERSION_URI</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-H<span class="w"> </span><span class="s1">&#39;Content-Type: application/json&#39;</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-d<span class="w"> </span><span class="s1">&#39;{</span>
<span class="s1">      &quot;dataframe_records&quot;: [{&quot;sepal_length (cm)&quot;: 5.1, &quot;sepal_width (cm)&quot;: 3.5, &quot;petal_length (cm)&quot;: 1.4, &quot;petal_width&quot;: 0.2},</span>
<span class="s1">                            {&quot;sepal_length (cm)&quot;: 4.2, &quot;sepal_width (cm)&quot;: 5.0, &quot;petal_length (cm)&quot;: 0.8, &quot;petal_width&quot;: 0.5}]</span>
<span class="s1">      }&#39;</span>
</pre></div>
</div>
<p class="compound-middle">Query a model accepting tensor inputs. Tensor inputs should be formatted as described in <a class="reference external" href="https://www.tensorflow.org/tfx/serving/api_rest#request_format_2">TensorFlow Serving’s API docs</a>.</p>
<div class="compound-last highlight-bash notranslate"><div class="highlight"><pre><span></span>curl<span class="w"> </span>-X<span class="w"> </span>POST<span class="w"> </span>-u<span class="w"> </span>token:<span class="nv">$DATABRICKS_API_TOKEN</span><span class="w"> </span><span class="nv">$MODEL_VERSION_URI</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-H<span class="w"> </span><span class="s1">&#39;Content-Type: application/json&#39;</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-d<span class="w"> </span><span class="s1">&#39;{&quot;inputs&quot;: [[5.1, 3.5, 1.4, 0.2]]}&#39;</span>
</pre></div>
</div>
</div>
<div class="compound-middle compound" lang="python">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">requests</span>

<span class="k">def</span> <span class="nf">create_tf_serving_json</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
  <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;inputs&#39;</span><span class="p">:</span> <span class="p">{</span><span class="n">name</span><span class="p">:</span> <span class="n">data</span><span class="p">[</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span> <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">keys</span><span class="p">()}</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)</span> <span class="k">else</span> <span class="n">data</span><span class="o">.</span><span class="n">tolist</span><span class="p">()}</span>

<span class="k">def</span> <span class="nf">score_model</span><span class="p">(</span><span class="n">model_uri</span><span class="p">,</span> <span class="n">databricks_token</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
  <span class="n">headers</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;Authorization&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;Bearer </span><span class="si">{</span><span class="n">databricks_token</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Content-Type&quot;</span><span class="p">:</span> <span class="s2">&quot;application/json&quot;</span><span class="p">,</span>
  <span class="p">}</span>
  <span class="n">data_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;dataframe_split&#39;</span><span class="p">:</span> <span class="n">data</span><span class="o">.</span><span class="n">to_dict</span><span class="p">(</span><span class="n">orient</span><span class="o">=</span><span class="s1">&#39;split&#39;</span><span class="p">)}</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)</span> <span class="k">else</span> <span class="n">create_tf_serving_json</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
  <span class="n">data_json</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">data_dict</span><span class="p">)</span>
  <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">request</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="s1">&#39;POST&#39;</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">,</span> <span class="n">url</span><span class="o">=</span><span class="n">model_uri</span><span class="p">,</span> <span class="n">json</span><span class="o">=</span><span class="n">data_json</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">!=</span> <span class="mi">200</span><span class="p">:</span>
      <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Request failed with status </span><span class="si">{</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
  <span class="k">return</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>


<span class="c1"># Scoring a model that accepts pandas DataFrames</span>
<span class="n">data</span> <span class="o">=</span>  <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">([{</span>
  <span class="s2">&quot;sepal_length&quot;</span><span class="p">:</span> <span class="mf">5.1</span><span class="p">,</span>
  <span class="s2">&quot;sepal_width&quot;</span><span class="p">:</span> <span class="mf">3.5</span><span class="p">,</span>
  <span class="s2">&quot;petal_length&quot;</span><span class="p">:</span> <span class="mf">1.4</span><span class="p">,</span>
  <span class="s2">&quot;petal_width&quot;</span><span class="p">:</span> <span class="mf">0.2</span>
<span class="p">}])</span>
<span class="n">score_model</span><span class="p">(</span><span class="n">MODEL_VERSION_URI</span><span class="p">,</span> <span class="n">DATABRICKS_API_TOKEN</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>

<span class="c1"># Scoring a model that accepts tensors</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">([[</span><span class="mf">5.1</span><span class="p">,</span> <span class="mf">3.5</span><span class="p">,</span> <span class="mf">1.4</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">]])</span>
<span class="n">score_model</span><span class="p">(</span><span class="n">MODEL_VERSION_URI</span><span class="p">,</span> <span class="n">DATABRICKS_API_TOKEN</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="compound-last compound" lang="PowerBI">
<p class="compound-first">You can score a dataset in Power BI Desktop using the following steps:</p>
<ol class="compound-last arabic">
<li><p>Open dataset you want to score.</p></li>
<li><p>Go to Transform Data.</p></li>
<li><p>Right-click in the left panel and select <strong>Create New Query</strong>.</p></li>
<li><p>Go to <strong>View &gt; Advanced Editor</strong>.</p></li>
<li><p>Replace the query body with the code snippet below, after filling in an appropriate <code class="docutils literal notranslate"><span class="pre">DATABRICKS_API_TOKEN</span></code> and <code class="docutils literal notranslate"><span class="pre">MODEL_VERSION_URI</span></code>.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="n">dataset</span> <span class="k">as</span> <span class="n">table</span> <span class="p">)</span> <span class="k">as</span> <span class="n">table</span> <span class="o">=&gt;</span>
<span class="n">let</span>
  <span class="n">call_predict</span> <span class="o">=</span> <span class="p">(</span><span class="n">dataset</span> <span class="k">as</span> <span class="n">table</span> <span class="p">)</span> <span class="k">as</span> <span class="nb">list</span> <span class="o">=&gt;</span>
  <span class="n">let</span>
    <span class="n">apiToken</span> <span class="o">=</span> <span class="n">DATABRICKS_API_TOKEN</span><span class="p">,</span>
    <span class="n">modelUri</span> <span class="o">=</span> <span class="n">MODEL_VERSION_URI</span><span class="p">,</span>
    <span class="n">responseList</span> <span class="o">=</span> <span class="n">Json</span><span class="o">.</span><span class="n">Document</span><span class="p">(</span><span class="n">Web</span><span class="o">.</span><span class="n">Contents</span><span class="p">(</span><span class="n">modelUri</span><span class="p">,</span>
      <span class="p">[</span>
        <span class="n">Headers</span> <span class="o">=</span> <span class="p">[</span>
          <span class="c1">#&quot;Content-Type&quot; = &quot;application/json&quot;,</span>
          <span class="c1">#&quot;Authorization&quot; = Text.Format(&quot;Bearer #{0}&quot;, {apiToken})</span>
        <span class="p">],</span>
        <span class="n">Content</span> <span class="o">=</span> <span class="n">Json</span><span class="o">.</span><span class="n">FromValue</span><span class="p">(</span><span class="n">dataset</span><span class="p">)</span>
      <span class="p">]</span>
    <span class="p">))</span>
  <span class="ow">in</span>
    <span class="n">responseList</span><span class="p">,</span>
  <span class="n">predictionList</span> <span class="o">=</span> <span class="n">List</span><span class="o">.</span><span class="n">Combine</span><span class="p">(</span><span class="n">List</span><span class="o">.</span><span class="n">Transform</span><span class="p">(</span><span class="n">Table</span><span class="o">.</span><span class="n">Split</span><span class="p">(</span><span class="n">dataset</span><span class="p">,</span> <span class="mi">256</span><span class="p">),</span> <span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="n">call_predict</span><span class="p">(</span><span class="n">x</span><span class="p">))),</span>
  <span class="n">predictionsTable</span> <span class="o">=</span> <span class="n">Table</span><span class="o">.</span><span class="n">FromList</span><span class="p">(</span><span class="n">predictionList</span><span class="p">,</span> <span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span><span class="n">x</span><span class="p">},</span> <span class="p">{</span><span class="s2">&quot;Prediction&quot;</span><span class="p">}),</span>
  <span class="n">datasetWithPrediction</span> <span class="o">=</span> <span class="n">Table</span><span class="o">.</span><span class="n">Join</span><span class="p">(</span>
    <span class="n">Table</span><span class="o">.</span><span class="n">AddIndexColumn</span><span class="p">(</span><span class="n">predictionsTable</span><span class="p">,</span> <span class="s2">&quot;index&quot;</span><span class="p">),</span> <span class="s2">&quot;index&quot;</span><span class="p">,</span>
    <span class="n">Table</span><span class="o">.</span><span class="n">AddIndexColumn</span><span class="p">(</span><span class="n">dataset</span><span class="p">,</span> <span class="s2">&quot;index&quot;</span><span class="p">),</span> <span class="s2">&quot;index&quot;</span><span class="p">)</span>
<span class="ow">in</span>
  <span class="n">datasetWithPrediction</span>
</pre></div>
</div>
</li>
<li><p>Name the query with your desired model name.</p></li>
<li><p>Open the advanced query editor for your dataset and apply the model function.</p></li>
</ol>
</div>
</div>
</li>
<li><p>If your scoring request uses the MLflow client, like <code class="docutils literal notranslate"><span class="pre">mlflow.pyfunc.spark_udf()</span></code>, upgrade your MLflow client to version 2.0 or higher to use the latest format.  Learn more about the updated <a class="reference external" href="https://mlflow.org/docs/latest/models.html#deploy-mlflow-models">MLflow Model scoring protocol in MLflow 2.0</a>.</p></li>
</ul>
<p>For more information about input data formats accepted by the server (for example, pandas split-oriented format), see the <a class="reference external" href="https://www.mlflow.org/docs/latest/models.html#deploy-mlflow-models">MLflow documentation</a>.</p>
</div>
</div>


    
          </div>
        </div>
        <div  class="suapp-rating">
  <div id="suPageRateApp">
     <su-app></su-app>
   </div> 
 </div>
<hr> 
<footer>
  <div role="contentinfo">
      <p class="copyright">
          &copy; Databricks 2023. All rights reserved. Apache, Apache Spark, Spark, and the Spark logo are trademarks of the <a href="http://www.apache.org/">Apache Software Foundation</a>.
      </p>
      <p> 
        
          <a id='feedbacklink' href="mailto:doc-feedback@databricks.com?subject=Documentation Feedback">Send us feedback</a>
        
     | <a href="https://databricks.com/privacy-policy">Privacy Policy</a> | <a href="https://databricks.com/terms-of-use">Terms of Use</a></p>

  </div> 

</footer>
      </div>
    </div>
  </section>
</main>

  </page>
  
  <script type="text/javascript">
    var DOCUMENTATION_OPTIONS = {
      URL_ROOT: '../../',
      VERSION: '1.0',
      COLLAPSE_INDEX: false,
      FILE_SUFFIX: '.html',
      HAS_SOURCE: 'false'
    };
  </script>
  <script type="text/javascript" src="../../_static/jquery.js"></script>
  <script type="text/javascript" src="../../_static/underscore.js"></script>
  <script type="text/javascript" src="../../_static/doctools.js"></script>
  <script type="text/javascript" src="../../_static/language_data.js"></script>
  

  <script type="text/javascript" src="../../_static/js/clipboard.min.js"></script>
  <script type="text/javascript" src="../../_static/js/jquery.waypoints.min.js"></script>

  <!-- Select2 (https://select2.org/) -->
  <link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />
  <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
  <!-- End Select2 -->

  
  
  <script type="text/javascript" src="../../_static/js/localized.js"></script>
  <script type="text/javascript" src="../../_static/js/custom.js"></script>
  

  
  
  <script type="text/javascript">
    jQuery(function () {
      SphinxRtdTheme.StickyNav.enable();
    });

  </script>
  
 



  <script>
  window.__searchunifyLoaderConfig = JSON.parse('{"clients": {"en": "02c2e804-27e9-11ee-aefb-0242ac120011", "ja": "6a42c3f2-2820-11ee-aefb-0242ac120011", "pt": "6a86badd-2821-11ee-aefb-0242ac120011"}}')
</script>
<script type="text/javascript" src="../../_static/js/search-loader.js"></script>
</body>
<script type='text/javascript'>
  window.onload = function () {
    var description = document.querySelector('meta[name="description"]').getAttribute("content");
    let titleText = document.querySelector('h1').textContent;
    document.querySelector('meta[property="og:title"]').setAttribute("content", titleText);
    document.querySelector('meta[property="og:description"]').setAttribute("content", description);
    document.querySelector('meta[property="twitter:description"]').setAttribute("content", description);
  };
</script>

</html>