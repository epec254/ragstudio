

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en-US" > <![endif]-->
<!--[if gt IE 8]><!-->
<html class="no-js" lang="en-US"> <!--<![endif]-->

<head>
  <!-- cookie consent -->
  
    <!-- Combined Onetrust and Rudderstack Implementation Scripts -->
    <!-- Onetrust Initialization -->
    <script type="text/javascript" src="https://cdn.cookielaw.org/consent/92466579-1717-44d3-809d-a05fb02843ed-test/OtAutoBlock.js"></script>
    <script src="https://cdn.cookielaw.org/scripttemplates/otSDKStub.js" data-document-language="true" type="text/javascript" charset="UTF-8" data-domain-script="92466579-1717-44d3-809d-a05fb02843ed-test"></script>
    <link rel="stylesheet" id="db-onetrust-style" href="https://www.databricks.com/wp-content/uploads/db_onetrust.css" media="all" />
    <!-- Setting Rudderstack Write Key -->
    <script>window.rudderstackKey = "2SOR9fvSr5Fi6tN2ihPbVHnX1SZ" </script>
    <!-- Rudderstack Initialization + Onetrust Integration + Rudderstack Custom Events -->
    <script type="text/javascript" src="https://www.databricks.com/sites/default/files/rudderstack/v1/db-rudderstack-events.js"></script>

  <!-- cookie consent -->

  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta http-equiv="X-UA-Compatible" content="IE=9" />
  <meta content="Learn how to use the GROUP BY syntax of the SQL language in Databricks SQL." name="description" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0">
  <meta property="og:image" content="https://www.databricks.com/wp-content/uploads/2020/04/og-databricks.png">
  <meta property="og:image:type" content="image/png">
  <meta property="og:title" content="GROUP BY clause">
  <meta property="og:image:width" content="1200">
  <meta property="og:image:height" content="630">
  <meta property="og:type" content="website">
  <meta property="og:url" content="https://docs.databricks.com">
  <meta property="og:description" content="" id="og-description">
  <meta name="twitter:image" content="https://www.databricks.com/wp-content/uploads/2020/04/og-databricks.png">
  <meta name="twitter:site" content="@databricks">
  <meta name="twitter:creator" content="@databricks">
  <meta property="twitter:description" content="">
  
  <title>GROUP BY clause &#124; Databricks on AWS</title>
  
  
  <link rel="canonical" href="https://docs.databricks.com/en/sql/language-manual/sql-ref-syntax-qry-select-groupby.html">
  <!-- Start hreflang tag -->
  <link rel="alternate" hreflang="en" href="https://docs.databricks.com/en/sql/language-manual/sql-ref-syntax-qry-select-groupby.html" />
<link rel="alternate" hreflang="x-default" href="https://docs.databricks.com/en/sql/language-manual/sql-ref-syntax-qry-select-groupby.html" />
  <!-- End hreflang tag -->
  
  
  <link rel="shortcut icon" href="../../_static/favicon.ico" />
  

  

  

  <!-- Google Tag Manager -->
  <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'https://www.googletagmanager.com/gtm.js?id='+i+dl;
j.setAttributeNode(d.createAttribute('data-ot-ignore'));
f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-T85FQ33');</script>
  <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'https://www.googletagmanager.com/gtm.js?id='+i+dl;
j.setAttributeNode(d.createAttribute('data-ot-ignore'));
f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-TWTKQQ');</script>
    
  <!-- End Google Tag Manager -->


  <!-- MaxMind / GEO IP -->
  <script src="//js.maxmind.com/js/apis/geoip2/v2.1/geoip2.js" type="text/javascript"></script>
  <!-- End MaxMind / GEO IP -->

  
  
  <link href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,600&display=swap" rel="stylesheet">
  <link rel="preload" href="../../_static/fonts/DMSans-Bold.ttf" as="font">
  <link rel="preload" href="../../_static/fonts/DMSans-Regular.ttf" as="font">
  <link rel="preload" href="../../_static/fonts/DMMono-Regular.ttf" as="font">
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/css/custom.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/css/cloud-provider-selector.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/css/translation-selector.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/css/searchunify/main.css" type="text/css" />

  
  <link rel="index" title="Index" href="../../genindex.html" />
  <link rel="search" title="Search" href="../../search.html" />
  <link rel="top" title="Databricks on AWS" href="../../index.html" /> 
</head>

<body class="wy-body-for-nav" role="document">

  <!-- Google Tag Manager (noscript) -->
  <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-T85FQ33"
height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
  <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-TWTKQQ"
    height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
  <!-- End Google Tag Manager (noscript) -->

  
  <nav class="wy-nav-top header su_header" role="navigation" aria-label="top navigation">
    
<nav class="wy-nav-top header su_header" role="navigation" aria-label="top navigation">
  <div class="container-logo">
    <ul class="mobile-menu-toggle">
        <li class="menu-toggle">
            <i data-toggle="wy-nav-top" class="wy-nav-top-menu-button db-icon db-icon-menu pull-left"></i>
            
            <a href="https://www.databricks.com/" class="wy-nav-top-logo"><img src="../../_static/small-scale-lockup-full-color-rgb.svg" width="137" height="21"
              alt="Databricks" /></a>   
               
              </li>
    </ul>
    <ul class="su_nav-menu">
      <li class="menu-toggle">
        <i data-toggle="wy-nav-top" class="wy-nav-top-menu-button db-icon db-icon-menu pull-left"></i>
        
          
        
        <a href="https://www.databricks.com/" class="wy-nav-top-logo"><img src="../../_static/small-scale-lockup-full-color-rgb.svg" width="137" height="21"
            alt="Databricks" /></a></li>
        <!-- 
<li><a href="https://help.databricks.com/s/">Help Center</a></li>
<li class="active"><a href="https://docs.databricks.com/en/">Documentation</a></li>
<li><a href="https://kb.databricks.com/">Knowledge Base</a></li>
 -->
    </ul>
  </div>
  <div class="su_nav-right">
    <ul class="su_link-mobile">
  <!-- Mobile header code can go here -->
</ul>
<ul class="right-try-list">
   
</ul>
  </div>
</nav>
  </nav>

  <div class="su_sub-header">
    <div class="container">
      <div class="su_sub-header-inner">
        <!-- <div class="su_subnav-menu-right">
  <div id="auto" style="width: 100%;">
    <div ng-controller="SearchautoController">
      <div bind-html-compile="autocompleteHtml">
        <form class="su__search-box-1" disabled="disabled">
          <input class="su__search-input" type="search" name="Search box" id="su__search-b" placeholder="Search Documentation" disabled="disabled"/>
          <button class="su__search-button" type="submit" class="button button-success" disabled="disabled">
            <svg width="24" height="24" viewBox="0 0 24 24">
              <path
                d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"
                fill="#333"></path>
            </svg>
          </button>
        </form>
      </div>
    </div>
  </div>
</div> -->
        <div class="search-lng-gap"></div>
        <div style="margin-left: 16px; margin-right: 16px;">
          <!-- <select name="lng selector" id="lng-selector">
    <option value="../../../en/sql/language-manual/sql-ref-syntax-qry-select-groupby.html" class="notranslate">English</option>
    <option value="../../../ja/sql/language-manual/sql-ref-syntax-qry-select-groupby.html" class="notranslate">日本語</option>
    <option value="../../../pt/sql/language-manual/sql-ref-syntax-qry-select-groupby.html" class="notranslate">Português (Brasil)</option>
</select> -->
        </div>
        <div class="cloud-selector-container">
          <!-- <select name="cloud provider selector" id="cloud-provider-selector">
    <option value="aws" selected class="notranslate">
        Amazon Web Services
    </option>
    <option value="azure"  class="notranslate">
        Microsoft Azure
    </option>
    <option value="gcp"  class="notranslate">
        Google Cloud Platform
    </option>
</select> -->
        </div>
      </div>
    </div>
  </div>
  <page class="js-page-container">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side su_nav-side">
<div class="wy-side-scroll">
  <div class="wy-side-nav-search">
    

    

    

    
  </div>

  <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
    
      <a href="../../index.html" class="main-navigation-home">Databricks on AWS</a>
    

    
      

      
        <p class="caption"><span class="caption-text">Load &amp; manage data</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../rag-temp/index.html">RAG Studio</a></li>
</ul>

      
    
  </div>

  <div role="contentinfo">
    
  <p class="build_info notranslate"data-last-edit="December 23, 2023">
    Updated Jan 11, 2024
  </p>
<script>
  window.addEventListener('DOMContentLoaded',function(){
    var h1=document.querySelector('h1');
    var bi=document.querySelector('[data-last-edit]');
    if(h1 && bi){
      var ver = document.createElement('p');
      ver.className = 'version_info';
      ver.textContent = bi.getAttribute('data-last-edit');
      h1.parentElement.insertBefore(ver, h1.nextElementSibling);
    }
  });
</script>

    <p>
      
        <a id='feedbacklink' href="mailto:doc-feedback@databricks.com?subject=Documentation Feedback">Send us feedback</a>
      
    </p>
  </div>
</div>
</nav>
    
    
<main class="wy-grid-for-nav su_nav-grid">
  <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
    <div class="wy-nav-content su__nav_content">
      <div class="rst-content">
        





<div role="navigation" aria-label="breadcrumbs navigation" class="wy-breadcrumbs-wrapper">
  <ul class="wy-breadcrumbs">
    <li><a href="../../index.html">Documentation</a> <span class="db-icon db-icon-chevron-right"></span></li>
    
    
      <li>GROUP BY clause</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>
</div>
        
        <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
          <div itemprop="articleBody">
            
    
  <div class="section" id="group-by-clause">
<h1>GROUP BY clause<a class="headerlink" href="#group-by-clause" title="Permalink to this headline"> </a></h1>
<p><strong>Applies to:</strong> <img alt="check marked yes" src="../../_images/check.png" /> Databricks SQL <img alt="check marked yes" src="../../_images/check.png" /> Databricks Runtime</p>
<p>The <code class="docutils literal notranslate"><span class="pre">GROUP</span> <span class="pre">BY</span></code> clause is used to group the rows based on a set of specified grouping expressions and compute aggregations on the group of rows based on one or more specified aggregate functions.
Databricks SQL also supports advanced aggregations to do multiple aggregations for the same input record set via <code class="docutils literal notranslate"><span class="pre">GROUPING</span> <span class="pre">SETS</span></code>, <code class="docutils literal notranslate"><span class="pre">CUBE</span></code>, <code class="docutils literal notranslate"><span class="pre">ROLLUP</span></code> clauses.
The grouping expressions and advanced aggregations can be mixed in the <code class="docutils literal notranslate"><span class="pre">GROUP</span> <span class="pre">BY</span></code> clause and nested in a <code class="docutils literal notranslate"><span class="pre">GROUPING</span> <span class="pre">SETS</span></code> clause.</p>
<p>See more details in the Mixed/Nested Grouping Analytics section.</p>
<p>When a <code class="docutils literal notranslate"><span class="pre">FILTER</span></code> clause is attached to an aggregate function, only the matching rows are passed to that function.</p>
<div class="section" id="syntax">
<h2>Syntax<a class="headerlink" href="#syntax" title="Permalink to this headline"> </a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">GROUP</span> <span class="n">BY</span> <span class="n">ALL</span>

<span class="n">GROUP</span> <span class="n">BY</span> <span class="n">group_expression</span> <span class="p">[,</span> <span class="o">...</span><span class="p">]</span> <span class="p">[</span> <span class="n">WITH</span> <span class="n">ROLLUP</span> <span class="o">|</span> <span class="n">WITH</span> <span class="n">CUBE</span> <span class="p">]</span>

<span class="n">GROUP</span> <span class="n">BY</span> <span class="p">{</span> <span class="n">group_expression</span> <span class="o">|</span> <span class="p">{</span> <span class="n">ROLLUP</span> <span class="o">|</span> <span class="n">CUBE</span> <span class="o">|</span> <span class="n">GROUPING</span> <span class="n">SETS</span> <span class="p">}</span> <span class="p">(</span> <span class="n">grouping_set</span> <span class="p">[,</span> <span class="o">...</span><span class="p">]</span> <span class="p">)</span> <span class="p">}</span> <span class="p">[,</span> <span class="o">...</span><span class="p">]</span>

<span class="n">grouping_set</span>
   <span class="p">{</span> <span class="n">expression</span> <span class="o">|</span>
     <span class="p">(</span> <span class="p">[</span> <span class="n">expression</span> <span class="p">[,</span> <span class="o">...</span><span class="p">]</span> <span class="p">]</span> <span class="p">)</span> <span class="p">}</span>
</pre></div>
</div>
<p>While aggregate functions are defined as</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">aggregate_name</span> <span class="p">(</span> <span class="p">[</span> <span class="n">DISTINCT</span> <span class="p">]</span> <span class="n">expression</span> <span class="p">[,</span> <span class="o">...</span><span class="p">]</span> <span class="p">)</span> <span class="p">[</span> <span class="n">FILTER</span> <span class="p">(</span> <span class="n">WHERE</span> <span class="n">boolean_expression</span> <span class="p">)</span> <span class="p">]</span>
</pre></div>
</div>
</div>
<div class="section" id="parameters">
<h2>Parameters<a class="headerlink" href="#parameters" title="Permalink to this headline"> </a></h2>
<ul>
<li><p><strong>ALL</strong></p>
<p><strong>Applies to:</strong> <img alt="check marked yes" src="../../_images/check.png" /> Databricks SQL <img alt="check marked yes" src="../../_images/check.png" /> Databricks Runtime 12.1 and above</p>
<p>A shorthand notation to add all <code class="docutils literal notranslate"><span class="pre">SELECT</span></code>-list expressions not containing aggregate functions as <code class="docutils literal notranslate"><span class="pre">group_expression</span></code>s.
If no such expression exist <code class="docutils literal notranslate"><span class="pre">GROUP</span> <span class="pre">BY</span> <span class="pre">ALL</span></code> is equivalent to omitting the <code class="docutils literal notranslate"><span class="pre">GROUP</span> <span class="pre">BY</span></code> clause which results in a global aggregation.</p>
<p><code class="docutils literal notranslate"><span class="pre">GROUP</span> <span class="pre">BY</span> <span class="pre">ALL</span></code> is not guaranteed to produce a set of group expressions which can be resolved.
Databricks raises <a class="reference internal" href="../../error-messages/error-classes.html#unresolved_all_in_group_by"><span class="std std-ref">UNRESOLVED_ALL_IN_GROUP_BY</span></a> or <a class="reference internal" href="../../error-messages/missing-aggregation-error-class.html"><span class="doc">MISSING_AGGREGATION</span></a> if the produced clause is not well-formed.</p>
</li>
<li><p><strong>group_expression</strong></p>
<p>Specifies the criteria for grouping rows together.
The grouping of rows is performed based on result values of the grouping expressions.
A grouping expression may be a column name like <code class="docutils literal notranslate"><span class="pre">GROUP</span> <span class="pre">BY</span> <span class="pre">a</span></code>, column position like <code class="docutils literal notranslate"><span class="pre">GROUP</span> <span class="pre">BY</span> <span class="pre">0</span></code>, or an expression like <code class="docutils literal notranslate"><span class="pre">GROUP</span> <span class="pre">BY</span> <span class="pre">a</span> <span class="pre">+</span> <span class="pre">b</span></code>.
If <code class="docutils literal notranslate"><span class="pre">group_expression</span></code> contains an <a class="reference internal" href="sql-ref-functions-builtin.html#aggregate-functions"><span class="std std-ref">aggregate function</span></a> Databricks raises a <a class="reference internal" href="../../error-messages/group-by-aggregate-error-class.html"><span class="doc">GROUP_BY_AGGREGATE</span></a> error.</p>
</li>
<li><p><strong>grouping_set</strong></p>
<p>A grouping set is specified by zero or more comma-separated expressions in parentheses.
When the grouping set has only one element, parentheses can be omitted.
For example, <code class="docutils literal notranslate"><span class="pre">GROUPING</span> <span class="pre">SETS</span> <span class="pre">((a),</span> <span class="pre">(b))</span></code> is the same as <code class="docutils literal notranslate"><span class="pre">GROUPING</span> <span class="pre">SETS</span> <span class="pre">(a,</span> <span class="pre">b)</span></code>.</p>
</li>
<li><p><strong>GROUPING SETS</strong></p>
<p>Groups the rows for each grouping set specified after <code class="docutils literal notranslate"><span class="pre">GROUPING</span> <span class="pre">SETS</span></code>. For example:</p>
<p><code class="docutils literal notranslate"><span class="pre">GROUP</span> <span class="pre">BY</span> <span class="pre">GROUPING</span> <span class="pre">SETS</span> <span class="pre">((warehouse),</span> <span class="pre">(product))</span></code> is semantically equivalent to a union of results of <code class="docutils literal notranslate"><span class="pre">GROUP</span> <span class="pre">BY</span> <span class="pre">warehouse</span></code> and <code class="docutils literal notranslate"><span class="pre">GROUP</span> <span class="pre">BY</span> <span class="pre">product</span></code>.</p>
<p>This clause is a shorthand for a <code class="docutils literal notranslate"><span class="pre">UNION</span> <span class="pre">ALL</span></code> where each leg of the <code class="docutils literal notranslate"><span class="pre">UNION</span> <span class="pre">ALL</span></code> operator performs aggregation of each grouping set specified in the <code class="docutils literal notranslate"><span class="pre">GROUPING</span> <span class="pre">SETS</span></code> clause.</p>
<p>Similarly, <code class="docutils literal notranslate"><span class="pre">GROUP</span> <span class="pre">BY</span> <span class="pre">GROUPING</span> <span class="pre">SETS</span> <span class="pre">((warehouse,</span> <span class="pre">product),</span> <span class="pre">(product),</span> <span class="pre">())</span></code> is semantically equivalent to the union of results of <code class="docutils literal notranslate"><span class="pre">GROUP</span> <span class="pre">BY</span> <span class="pre">warehouse,</span> <span class="pre">product</span></code>, <code class="docutils literal notranslate"><span class="pre">GROUP</span> <span class="pre">BY</span> <span class="pre">product</span></code> and a global aggregate.</p>
</li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>For Hive compatibility Databricks SQL allows <code class="docutils literal notranslate"><span class="pre">GROUP</span> <span class="pre">BY</span> <span class="pre">...</span> <span class="pre">GROUPING</span> <span class="pre">SETS</span> <span class="pre">(...)</span></code>. The <code class="docutils literal notranslate"><span class="pre">GROUP</span> <span class="pre">BY</span></code> expressions are usually ignored, but if they contain extra expressions in addition to the <code class="docutils literal notranslate"><span class="pre">GROUPING</span> <span class="pre">SETS</span></code> expressions, the extra expressions will be included in the grouping expressions and the value is always null. For example, <code class="docutils literal notranslate"><span class="pre">SELECT</span> <span class="pre">a,</span> <span class="pre">b,</span> <span class="pre">c</span> <span class="pre">FROM</span> <span class="pre">...</span> <span class="pre">GROUP</span> <span class="pre">BY</span> <span class="pre">a,</span> <span class="pre">b,</span> <span class="pre">c</span> <span class="pre">GROUPING</span> <span class="pre">SETS</span> <span class="pre">(a,</span> <span class="pre">b)</span></code>, the output of column c is always null.</p>
</div>
<ul>
<li><p><strong>ROLLUP</strong></p>
<p>Specifies multiple levels of aggregations in a single statement.
This clause is used to compute aggregations based on multiple grouping sets.
<code class="docutils literal notranslate"><span class="pre">ROLLUP</span></code> is a shorthand for <code class="docutils literal notranslate"><span class="pre">GROUPING</span> <span class="pre">SETS</span></code>. For example:</p>
<p><code class="docutils literal notranslate"><span class="pre">GROUP</span> <span class="pre">BY</span> <span class="pre">warehouse,</span> <span class="pre">product</span> <span class="pre">WITH</span> <span class="pre">ROLLUP</span></code> or <code class="docutils literal notranslate"><span class="pre">GROUP</span> <span class="pre">BY</span> <span class="pre">ROLLUP(warehouse,</span> <span class="pre">product)</span></code> is equivalent to</p>
<p><code class="docutils literal notranslate"><span class="pre">GROUP</span> <span class="pre">BY</span> <span class="pre">GROUPING</span> <span class="pre">SETS((warehouse,</span> <span class="pre">product),</span> <span class="pre">(warehouse),</span> <span class="pre">())</span></code>.</p>
<p>While  <code class="docutils literal notranslate"><span class="pre">GROUP</span> <span class="pre">BY</span> <span class="pre">ROLLUP(warehouse,</span> <span class="pre">product,</span> <span class="pre">(warehouse,</span> <span class="pre">location))</span></code></p>
<p>is equivalent to <code class="docutils literal notranslate"><span class="pre">GROUP</span> <span class="pre">BY</span> <span class="pre">GROUPING</span> <span class="pre">SETS((warehouse,</span> <span class="pre">product,</span> <span class="pre">location),</span> <span class="pre">(warehouse,</span> <span class="pre">product),</span> <span class="pre">(warehouse),</span> <span class="pre">())</span></code>.</p>
<p>The N elements of a <code class="docutils literal notranslate"><span class="pre">ROLLUP</span></code> specification result in N+1 <code class="docutils literal notranslate"><span class="pre">GROUPING</span> <span class="pre">SETS</span></code>.</p>
</li>
<li><p><strong>CUBE</strong></p>
<p>The <code class="docutils literal notranslate"><span class="pre">CUBE</span></code> clause is used to perform aggregations based on a combination of grouping columns specified in the <code class="docutils literal notranslate"><span class="pre">GROUP</span> <span class="pre">BY</span></code> clause.
<code class="docutils literal notranslate"><span class="pre">CUBE</span></code> is a shorthand for <code class="docutils literal notranslate"><span class="pre">GROUPING</span> <span class="pre">SETS</span></code>. For example:</p>
<p><code class="docutils literal notranslate"><span class="pre">GROUP</span> <span class="pre">BY</span> <span class="pre">warehouse,</span> <span class="pre">product</span> <span class="pre">WITH</span> <span class="pre">CUBE</span></code> or <code class="docutils literal notranslate"><span class="pre">GROUP</span> <span class="pre">BY</span> <span class="pre">CUBE(warehouse,</span> <span class="pre">product)</span></code> is equivalent to</p>
<p><code class="docutils literal notranslate"><span class="pre">GROUP</span> <span class="pre">BY</span> <span class="pre">GROUPING</span> <span class="pre">SETS((warehouse,</span> <span class="pre">product),</span> <span class="pre">(warehouse),</span> <span class="pre">(product),</span> <span class="pre">())</span></code>.</p>
<p>While <code class="docutils literal notranslate"><span class="pre">GROUP</span> <span class="pre">BY</span> <span class="pre">CUBE(warehouse,</span> <span class="pre">product,</span> <span class="pre">(warehouse,</span> <span class="pre">location))</span></code></p>
<p>is equivalent to <code class="docutils literal notranslate"><span class="pre">GROUP</span> <span class="pre">BY</span> <span class="pre">GROUPING</span> <span class="pre">SETS((warehouse,</span> <span class="pre">product,</span> <span class="pre">location),</span> <span class="pre">(warehouse,</span> <span class="pre">product),</span> <span class="pre">(warehouse,</span> <span class="pre">location),</span> <span class="pre">(product,</span> <span class="pre">warehouse,</span> <span class="pre">location),</span> <span class="pre">(warehouse),</span> <span class="pre">(product),</span> <span class="pre">(warehouse,</span> <span class="pre">product),</span> <span class="pre">())</span></code>.</p>
<p>The N elements of a <code class="docutils literal notranslate"><span class="pre">CUBE</span></code> specification results in 2^N <code class="docutils literal notranslate"><span class="pre">GROUPING</span> <span class="pre">SETS</span></code>.</p>
</li>
<li><p><strong>aggregate_name</strong></p>
<p>An aggregate function name (MIN, MAX, COUNT, SUM, AVG, etc.).</p>
</li>
<li><p><strong>DISTINCT</strong></p>
<p>Removes duplicates in input rows before they are passed to aggregate functions.</p>
</li>
<li><p><strong>FILTER</strong></p>
<p>Filters the input rows for which the <code class="docutils literal notranslate"><span class="pre">boolean_expression</span></code> in the <code class="docutils literal notranslate"><span class="pre">WHERE</span></code> clause evaluates
to true are passed to the aggregate function; other rows are discarded.</p>
</li>
</ul>
</div>
<div class="section" id="mixednested-grouping-analytics">
<h2>Mixed/Nested Grouping Analytics<a class="headerlink" href="#mixednested-grouping-analytics" title="Permalink to this headline"> </a></h2>
<p>A <code class="docutils literal notranslate"><span class="pre">GROUP</span> <span class="pre">BY</span></code> clause can include multiple group_expressions and multiple <code class="docutils literal notranslate"><span class="pre">CUBE</span></code>, <code class="docutils literal notranslate"><span class="pre">ROLLUP</span></code>, and <code class="docutils literal notranslate"><span class="pre">GROUPING</span> <span class="pre">SETS</span></code>s.</p>
<p><code class="docutils literal notranslate"><span class="pre">GROUPING</span> <span class="pre">SETS</span></code> can also have nested <code class="docutils literal notranslate"><span class="pre">CUBE</span></code>, <code class="docutils literal notranslate"><span class="pre">ROLLUP</span></code>, or <code class="docutils literal notranslate"><span class="pre">GROUPING</span> <span class="pre">SETS</span></code> clauses. For example:</p>
<p><code class="docutils literal notranslate"><span class="pre">GROUPING</span> <span class="pre">SETS(ROLLUP(warehouse,</span> <span class="pre">location),</span> <span class="pre">CUBE(warehouse,</span> <span class="pre">location)),</span> <span class="pre">GROUPING</span> <span class="pre">SETS(warehouse,</span> <span class="pre">GROUPING</span> <span class="pre">SETS(location,</span> <span class="pre">GROUPING</span> <span class="pre">SETS(ROLLUP(warehouse,</span> <span class="pre">location),</span> <span class="pre">CUBE(warehouse,</span> <span class="pre">location))))</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">CUBE</span></code> and <code class="docutils literal notranslate"><span class="pre">ROLLUP</span></code> is just syntax sugar for <code class="docutils literal notranslate"><span class="pre">GROUPING</span> <span class="pre">SETS</span></code>.
Please refer to the sections above for how to translate <code class="docutils literal notranslate"><span class="pre">CUBE</span></code> and <code class="docutils literal notranslate"><span class="pre">ROLLUP</span></code> to <code class="docutils literal notranslate"><span class="pre">GROUPING</span> <span class="pre">SETS</span></code>.
<code class="docutils literal notranslate"><span class="pre">group_expression</span></code> can be treated as a single-group <code class="docutils literal notranslate"><span class="pre">GROUPING</span> <span class="pre">SETS</span></code> in this context.</p>
<p>For multiple <code class="docutils literal notranslate"><span class="pre">GROUPING</span> <span class="pre">SETS</span></code> in the <code class="docutils literal notranslate"><span class="pre">GROUP</span> <span class="pre">BY</span></code> clause, Databricks SQL generates a single <code class="docutils literal notranslate"><span class="pre">GROUPING</span> <span class="pre">SETS</span></code> by doing a cross-product of the original <code class="docutils literal notranslate"><span class="pre">GROUPING</span> <span class="pre">SETS</span></code>.</p>
<p>For nested <code class="docutils literal notranslate"><span class="pre">GROUPING</span> <span class="pre">SETS</span></code> in the <code class="docutils literal notranslate"><span class="pre">GROUPING</span> <span class="pre">SETS</span></code> clause, Databricks SQL simply takes its grouping sets and strips them. For example:</p>
<p><code class="docutils literal notranslate"><span class="pre">GROUP</span> <span class="pre">BY</span> <span class="pre">warehouse,</span> <span class="pre">GROUPING</span> <span class="pre">SETS((product),</span> <span class="pre">()),</span> <span class="pre">GROUPING</span> <span class="pre">SETS((location,</span> <span class="pre">size),</span> <span class="pre">(location),</span> <span class="pre">(size),</span> <span class="pre">())</span></code> and</p>
<p><code class="docutils literal notranslate"><span class="pre">GROUP</span> <span class="pre">BY</span> <span class="pre">warehouse,</span> <span class="pre">ROLLUP(product),</span> <span class="pre">CUBE(location,</span> <span class="pre">size)</span></code></p>
<p>are equivalent to <code class="docutils literal notranslate"><span class="pre">GROUP</span> <span class="pre">BY</span> <span class="pre">GROUPING</span> <span class="pre">SETS(</span> <span class="pre">(warehouse,</span> <span class="pre">product,</span> <span class="pre">location,</span> <span class="pre">size),</span> <span class="pre">(warehouse,</span> <span class="pre">product,</span> <span class="pre">location),</span> <span class="pre">(warehouse,</span> <span class="pre">product,</span> <span class="pre">size),</span> <span class="pre">(warehouse,</span> <span class="pre">product),</span> <span class="pre">(warehouse,</span> <span class="pre">location,</span> <span class="pre">size),</span> <span class="pre">(warehouse,</span> <span class="pre">location),</span> <span class="pre">(warehouse,</span> <span class="pre">size),</span> <span class="pre">(warehouse))</span></code>.</p>
<p>While <code class="docutils literal notranslate"><span class="pre">GROUP</span> <span class="pre">BY</span> <span class="pre">GROUPING</span> <span class="pre">SETS(GROUPING</span> <span class="pre">SETS(warehouse),</span> <span class="pre">GROUPING</span> <span class="pre">SETS((warehouse,</span> <span class="pre">product)))</span></code></p>
<p>is equivalent to <code class="docutils literal notranslate"><span class="pre">GROUP</span> <span class="pre">BY</span> <span class="pre">GROUPING</span> <span class="pre">SETS((warehouse),</span> <span class="pre">(warehouse,</span> <span class="pre">product))</span></code>.</p>
</div>
<div class="section" id="examples">
<h2>Examples<a class="headerlink" href="#examples" title="Permalink to this headline"> </a></h2>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">CREATE</span><span class="w"> </span><span class="n">TEMP</span><span class="w"> </span><span class="k">VIEW</span><span class="w"> </span><span class="n">dealer</span><span class="w"> </span><span class="p">(</span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">city</span><span class="p">,</span><span class="w"> </span><span class="n">car_model</span><span class="p">,</span><span class="w"> </span><span class="n">quantity</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span>
<span class="k">VALUES</span><span class="w"> </span><span class="p">(</span><span class="mi">100</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;Fremont&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;Honda Civic&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">10</span><span class="p">),</span>
<span class="w">       </span><span class="p">(</span><span class="mi">100</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;Fremont&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;Honda Accord&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">15</span><span class="p">),</span>
<span class="w">       </span><span class="p">(</span><span class="mi">100</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;Fremont&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;Honda CRV&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">7</span><span class="p">),</span>
<span class="w">       </span><span class="p">(</span><span class="mi">200</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;Dublin&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;Honda Civic&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">20</span><span class="p">),</span>
<span class="w">       </span><span class="p">(</span><span class="mi">200</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;Dublin&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;Honda Accord&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">10</span><span class="p">),</span>
<span class="w">       </span><span class="p">(</span><span class="mi">200</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;Dublin&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;Honda CRV&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">),</span>
<span class="w">       </span><span class="p">(</span><span class="mi">300</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;San Jose&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;Honda Civic&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="p">),</span>
<span class="w">       </span><span class="p">(</span><span class="mi">300</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;San Jose&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;Honda Accord&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">8</span><span class="p">);</span>

<span class="c1">-- Sum of quantity per dealership. Group by `id`.</span>
<span class="o">&gt;</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="k">sum</span><span class="p">(</span><span class="n">quantity</span><span class="p">)</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">dealer</span><span class="w"> </span><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">id</span><span class="w"> </span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">id</span><span class="p">;</span>
<span class="w">  </span><span class="n">id</span><span class="w"> </span><span class="k">sum</span><span class="p">(</span><span class="n">quantity</span><span class="p">)</span>
<span class="w"> </span><span class="c1">--- -------------</span>
<span class="w"> </span><span class="mi">100</span><span class="w">            </span><span class="mi">32</span>
<span class="w"> </span><span class="mi">200</span><span class="w">            </span><span class="mi">33</span>
<span class="w"> </span><span class="mi">300</span><span class="w">            </span><span class="mi">13</span>

<span class="c1">-- Use column position in GROUP by clause.</span>
<span class="o">&gt;</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="k">sum</span><span class="p">(</span><span class="n">quantity</span><span class="p">)</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">dealer</span><span class="w"> </span><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="w">  </span><span class="n">id</span><span class="w"> </span><span class="k">sum</span><span class="p">(</span><span class="n">quantity</span><span class="p">)</span>
<span class="w"> </span><span class="c1">--- -------------</span>
<span class="w"> </span><span class="mi">100</span><span class="w">            </span><span class="mi">32</span>
<span class="w"> </span><span class="mi">200</span><span class="w">            </span><span class="mi">33</span>
<span class="w"> </span><span class="mi">300</span><span class="w">            </span><span class="mi">13</span>

<span class="c1">-- Multiple aggregations.</span>
<span class="c1">-- 1. Sum of quantity per dealership.</span>
<span class="c1">-- 2. Max quantity per dealership.</span>
<span class="o">&gt;</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="k">sum</span><span class="p">(</span><span class="n">quantity</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="k">sum</span><span class="p">,</span><span class="w"> </span><span class="k">max</span><span class="p">(</span><span class="n">quantity</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="k">max</span>
<span class="w">    </span><span class="k">FROM</span><span class="w"> </span><span class="n">dealer</span><span class="w"> </span><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">id</span><span class="w"> </span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">id</span><span class="p">;</span>
<span class="w">  </span><span class="n">id</span><span class="w"> </span><span class="k">sum</span><span class="w"> </span><span class="k">max</span>
<span class="w"> </span><span class="c1">--- --- ---</span>
<span class="w"> </span><span class="mi">100</span><span class="w">  </span><span class="mi">32</span><span class="w">  </span><span class="mi">15</span>
<span class="w"> </span><span class="mi">200</span><span class="w">  </span><span class="mi">33</span><span class="w">  </span><span class="mi">20</span>
<span class="w"> </span><span class="mi">300</span><span class="w">  </span><span class="mi">13</span><span class="w">   </span><span class="mi">8</span>

<span class="c1">-- Count the number of distinct dealers in cities per car_model.</span>
<span class="o">&gt;</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="n">car_model</span><span class="p">,</span><span class="w"> </span><span class="k">count</span><span class="p">(</span><span class="k">DISTINCT</span><span class="w"> </span><span class="n">city</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="k">count</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">dealer</span><span class="w"> </span><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">car_model</span><span class="p">;</span>
<span class="w">    </span><span class="n">car_model</span><span class="w"> </span><span class="k">count</span>
<span class="w"> </span><span class="c1">------------ -----</span>
<span class="w">  </span><span class="n">Honda</span><span class="w"> </span><span class="n">Civic</span><span class="w">     </span><span class="mi">3</span>
<span class="w">    </span><span class="n">Honda</span><span class="w"> </span><span class="n">CRV</span><span class="w">     </span><span class="mi">2</span>
<span class="w"> </span><span class="n">Honda</span><span class="w"> </span><span class="n">Accord</span><span class="w">     </span><span class="mi">3</span>

<span class="c1">-- Count the number of distinct dealers in cities per car_model, using GROUP BY ALL</span>
<span class="o">&gt;</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="n">car_model</span><span class="p">,</span><span class="w"> </span><span class="k">count</span><span class="p">(</span><span class="k">DISTINCT</span><span class="w"> </span><span class="n">city</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="k">count</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">dealer</span><span class="w"> </span><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="k">ALL</span><span class="p">;</span>
<span class="w">    </span><span class="n">car_model</span><span class="w"> </span><span class="k">count</span>
<span class="w"> </span><span class="c1">------------ -----</span>
<span class="w">  </span><span class="n">Honda</span><span class="w"> </span><span class="n">Civic</span><span class="w">     </span><span class="mi">3</span>
<span class="w">    </span><span class="n">Honda</span><span class="w"> </span><span class="n">CRV</span><span class="w">     </span><span class="mi">2</span>
<span class="w"> </span><span class="n">Honda</span><span class="w"> </span><span class="n">Accord</span><span class="w">     </span><span class="mi">3</span>

<span class="c1">-- Sum of only &#39;Honda Civic&#39; and &#39;Honda CRV&#39; quantities per dealership.</span>
<span class="o">&gt;</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="n">id</span><span class="p">,</span>
<span class="w">         </span><span class="k">sum</span><span class="p">(</span><span class="n">quantity</span><span class="p">)</span><span class="w"> </span><span class="n">FILTER</span><span class="w"> </span><span class="p">(</span><span class="k">WHERE</span><span class="w"> </span><span class="n">car_model</span><span class="w"> </span><span class="k">IN</span><span class="w"> </span><span class="p">(</span><span class="s1">&#39;Honda Civic&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;Honda CRV&#39;</span><span class="p">))</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="o">`</span><span class="k">sum</span><span class="p">(</span><span class="n">quantity</span><span class="p">)</span><span class="o">`</span>
<span class="w">    </span><span class="k">FROM</span><span class="w"> </span><span class="n">dealer</span>
<span class="w">    </span><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">id</span><span class="w"> </span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">id</span><span class="p">;</span>
<span class="w">  </span><span class="n">id</span><span class="w"> </span><span class="k">sum</span><span class="p">(</span><span class="n">quantity</span><span class="p">)</span>
<span class="w"> </span><span class="c1">--- -------------</span>
<span class="w"> </span><span class="mi">100</span><span class="w">            </span><span class="mi">17</span>
<span class="w"> </span><span class="mi">200</span><span class="w">            </span><span class="mi">23</span>
<span class="w"> </span><span class="mi">300</span><span class="w">             </span><span class="mi">5</span>

<span class="c1">-- Aggregations using multiple sets of grouping columns in a single statement.</span>
<span class="c1">-- Following performs aggregations based on four sets of grouping columns.</span>
<span class="c1">-- 1. city, car_model</span>
<span class="c1">-- 2. city</span>
<span class="c1">-- 3. car_model</span>
<span class="c1">-- 4. Empty grouping set. Returns quantities for all city and car models.</span>
<span class="o">&gt;</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="n">city</span><span class="p">,</span><span class="w"> </span><span class="n">car_model</span><span class="p">,</span><span class="w"> </span><span class="k">sum</span><span class="p">(</span><span class="n">quantity</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="k">sum</span>
<span class="w">    </span><span class="k">FROM</span><span class="w"> </span><span class="n">dealer</span>
<span class="w">    </span><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="k">GROUPING</span><span class="w"> </span><span class="k">SETS</span><span class="w"> </span><span class="p">((</span><span class="n">city</span><span class="p">,</span><span class="w"> </span><span class="n">car_model</span><span class="p">),</span><span class="w"> </span><span class="p">(</span><span class="n">city</span><span class="p">),</span><span class="w"> </span><span class="p">(</span><span class="n">car_model</span><span class="p">),</span><span class="w"> </span><span class="p">())</span>
<span class="w">    </span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">city</span><span class="p">;</span>
<span class="w">      </span><span class="n">city</span><span class="w">    </span><span class="n">car_model</span><span class="w"> </span><span class="k">sum</span>
<span class="w"> </span><span class="c1">--------- ------------ ---</span>
<span class="w">      </span><span class="k">null</span><span class="w">         </span><span class="k">null</span><span class="w">  </span><span class="mi">78</span>
<span class="w">      </span><span class="k">null</span><span class="w">  </span><span class="n">HondaAccord</span><span class="w">  </span><span class="mi">33</span>
<span class="w">      </span><span class="k">null</span><span class="w">     </span><span class="n">HondaCRV</span><span class="w">  </span><span class="mi">10</span>
<span class="w">      </span><span class="k">null</span><span class="w">   </span><span class="n">HondaCivic</span><span class="w">  </span><span class="mi">35</span>
<span class="w">    </span><span class="n">Dublin</span><span class="w">         </span><span class="k">null</span><span class="w">  </span><span class="mi">33</span>
<span class="w">    </span><span class="n">Dublin</span><span class="w">  </span><span class="n">HondaAccord</span><span class="w">  </span><span class="mi">10</span>
<span class="w">    </span><span class="n">Dublin</span><span class="w">     </span><span class="n">HondaCRV</span><span class="w">   </span><span class="mi">3</span>
<span class="w">    </span><span class="n">Dublin</span><span class="w">   </span><span class="n">HondaCivic</span><span class="w">  </span><span class="mi">20</span>
<span class="w">   </span><span class="n">Fremont</span><span class="w">         </span><span class="k">null</span><span class="w">  </span><span class="mi">32</span>
<span class="w">   </span><span class="n">Fremont</span><span class="w">  </span><span class="n">HondaAccord</span><span class="w">  </span><span class="mi">15</span>
<span class="w">   </span><span class="n">Fremont</span><span class="w">     </span><span class="n">HondaCRV</span><span class="w">   </span><span class="mi">7</span>
<span class="w">   </span><span class="n">Fremont</span><span class="w">   </span><span class="n">HondaCivic</span><span class="w">  </span><span class="mi">10</span>
<span class="w">  </span><span class="n">San</span><span class="w"> </span><span class="n">Jose</span><span class="w">         </span><span class="k">null</span><span class="w">  </span><span class="mi">13</span>
<span class="w">  </span><span class="n">San</span><span class="w"> </span><span class="n">Jose</span><span class="w">  </span><span class="n">HondaAccord</span><span class="w">   </span><span class="mi">8</span>
<span class="w">  </span><span class="n">San</span><span class="w"> </span><span class="n">Jose</span><span class="w">   </span><span class="n">HondaCivic</span><span class="w">   </span><span class="mi">5</span>

<span class="c1">-- Group by processing with `ROLLUP` clause.</span>
<span class="c1">-- Equivalent GROUP BY GROUPING SETS ((city, car_model), (city), ())</span>
<span class="o">&gt;</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="n">city</span><span class="p">,</span><span class="w"> </span><span class="n">car_model</span><span class="p">,</span><span class="w"> </span><span class="k">sum</span><span class="p">(</span><span class="n">quantity</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="k">sum</span>
<span class="w">    </span><span class="k">FROM</span><span class="w"> </span><span class="n">dealer</span>
<span class="w">    </span><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">city</span><span class="p">,</span><span class="w"> </span><span class="n">car_model</span><span class="w"> </span><span class="k">WITH</span><span class="w"> </span><span class="k">ROLLUP</span>
<span class="w">    </span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">city</span><span class="p">,</span><span class="w"> </span><span class="n">car_model</span><span class="p">;</span>
<span class="w">      </span><span class="n">city</span><span class="w">    </span><span class="n">car_model</span><span class="w"> </span><span class="k">sum</span>
<span class="w"> </span><span class="c1">--------- ------------ ---</span>
<span class="w">      </span><span class="k">null</span><span class="w">         </span><span class="k">null</span><span class="w">  </span><span class="mi">78</span>
<span class="w">    </span><span class="n">Dublin</span><span class="w">         </span><span class="k">null</span><span class="w">  </span><span class="mi">33</span>
<span class="w">    </span><span class="n">Dublin</span><span class="w">  </span><span class="n">HondaAccord</span><span class="w">  </span><span class="mi">10</span>
<span class="w">    </span><span class="n">Dublin</span><span class="w">     </span><span class="n">HondaCRV</span><span class="w">   </span><span class="mi">3</span>
<span class="w">    </span><span class="n">Dublin</span><span class="w">   </span><span class="n">HondaCivic</span><span class="w">  </span><span class="mi">20</span>
<span class="w">   </span><span class="n">Fremont</span><span class="w">         </span><span class="k">null</span><span class="w">  </span><span class="mi">32</span>
<span class="w">   </span><span class="n">Fremont</span><span class="w">  </span><span class="n">HondaAccord</span><span class="w">  </span><span class="mi">15</span>
<span class="w">   </span><span class="n">Fremont</span><span class="w">     </span><span class="n">HondaCRV</span><span class="w">   </span><span class="mi">7</span>
<span class="w">   </span><span class="n">Fremont</span><span class="w">   </span><span class="n">HondaCivic</span><span class="w">  </span><span class="mi">10</span>
<span class="w">  </span><span class="n">San</span><span class="w"> </span><span class="n">Jose</span><span class="w">         </span><span class="k">null</span><span class="w">  </span><span class="mi">13</span>
<span class="w">  </span><span class="n">San</span><span class="w"> </span><span class="n">Jose</span><span class="w">  </span><span class="n">HondaAccord</span><span class="w">   </span><span class="mi">8</span>
<span class="w">  </span><span class="n">San</span><span class="w"> </span><span class="n">Jose</span><span class="w">   </span><span class="n">HondaCivic</span><span class="w">   </span><span class="mi">5</span>

<span class="c1">-- Group by processing with `CUBE` clause.</span>
<span class="c1">-- Equivalent GROUP BY GROUPING SETS ((city, car_model), (city), (car_model), ())</span>
<span class="o">&gt;</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="n">city</span><span class="p">,</span><span class="w"> </span><span class="n">car_model</span><span class="p">,</span><span class="w"> </span><span class="k">sum</span><span class="p">(</span><span class="n">quantity</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="k">sum</span>
<span class="w">    </span><span class="k">FROM</span><span class="w"> </span><span class="n">dealer</span>
<span class="w">    </span><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">city</span><span class="p">,</span><span class="w"> </span><span class="n">car_model</span><span class="w"> </span><span class="k">WITH</span><span class="w"> </span><span class="k">CUBE</span>
<span class="w">    </span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">city</span><span class="p">,</span><span class="w"> </span><span class="n">car_model</span><span class="p">;</span>
<span class="w">      </span><span class="n">city</span><span class="w">    </span><span class="n">car_model</span><span class="w"> </span><span class="k">sum</span>
<span class="w"> </span><span class="c1">--------- ------------ ---</span>
<span class="w">      </span><span class="k">null</span><span class="w">         </span><span class="k">null</span><span class="w">  </span><span class="mi">78</span>
<span class="w">      </span><span class="k">null</span><span class="w">  </span><span class="n">HondaAccord</span><span class="w">  </span><span class="mi">33</span>
<span class="w">      </span><span class="k">null</span><span class="w">     </span><span class="n">HondaCRV</span><span class="w">  </span><span class="mi">10</span>
<span class="w">      </span><span class="k">null</span><span class="w">   </span><span class="n">HondaCivic</span><span class="w">  </span><span class="mi">35</span>
<span class="w">    </span><span class="n">Dublin</span><span class="w">         </span><span class="k">null</span><span class="w">  </span><span class="mi">33</span>
<span class="w">    </span><span class="n">Dublin</span><span class="w">  </span><span class="n">HondaAccord</span><span class="w">  </span><span class="mi">10</span>
<span class="w">    </span><span class="n">Dublin</span><span class="w">     </span><span class="n">HondaCRV</span><span class="w">   </span><span class="mi">3</span>
<span class="w">    </span><span class="n">Dublin</span><span class="w">   </span><span class="n">HondaCivic</span><span class="w">  </span><span class="mi">20</span>
<span class="w">   </span><span class="n">Fremont</span><span class="w">         </span><span class="k">null</span><span class="w">  </span><span class="mi">32</span>
<span class="w">   </span><span class="n">Fremont</span><span class="w">  </span><span class="n">HondaAccord</span><span class="w">  </span><span class="mi">15</span>
<span class="w">   </span><span class="n">Fremont</span><span class="w">     </span><span class="n">HondaCRV</span><span class="w">   </span><span class="mi">7</span>
<span class="w">   </span><span class="n">Fremont</span><span class="w">   </span><span class="n">HondaCivic</span><span class="w">  </span><span class="mi">10</span>
<span class="w">  </span><span class="n">San</span><span class="w"> </span><span class="n">Jose</span><span class="w">         </span><span class="k">null</span><span class="w">  </span><span class="mi">13</span>
<span class="w">  </span><span class="n">San</span><span class="w"> </span><span class="n">Jose</span><span class="w">  </span><span class="n">HondaAccord</span><span class="w">   </span><span class="mi">8</span>
<span class="w">  </span><span class="n">San</span><span class="w"> </span><span class="n">Jose</span><span class="w">   </span><span class="n">HondaCivic</span><span class="w">   </span><span class="mi">5</span>

<span class="c1">--Prepare data for ignore nulls example</span>
<span class="o">&gt;</span><span class="w"> </span><span class="k">CREATE</span><span class="w"> </span><span class="n">TEMP</span><span class="w"> </span><span class="k">VIEW</span><span class="w"> </span><span class="n">person</span><span class="w"> </span><span class="p">(</span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">age</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span>
<span class="w">   </span><span class="k">VALUES</span><span class="w"> </span><span class="p">(</span><span class="mi">100</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;Mary&#39;</span><span class="p">,</span><span class="w"> </span><span class="k">NULL</span><span class="p">),</span>
<span class="w">          </span><span class="p">(</span><span class="mi">200</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;John&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">30</span><span class="p">),</span>
<span class="w">          </span><span class="p">(</span><span class="mi">300</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;Mike&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">80</span><span class="p">),</span>
<span class="w">          </span><span class="p">(</span><span class="mi">400</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;Dan&#39;</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="mi">50</span><span class="p">);</span>

<span class="c1">--Select the first row in column age</span>
<span class="o">&gt;</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="k">FIRST</span><span class="p">(</span><span class="n">age</span><span class="p">)</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">person</span><span class="p">;</span>
<span class="w">  </span><span class="k">first</span><span class="p">(</span><span class="n">age</span><span class="p">,</span><span class="w"> </span><span class="k">false</span><span class="p">)</span>
<span class="w"> </span><span class="c1">--------------------</span>
<span class="w">  </span><span class="k">NULL</span>

<span class="c1">--Get the first row in column `age` ignore nulls,last row in column `id` and sum of column `id`.</span>
<span class="o">&gt;</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="k">FIRST</span><span class="p">(</span><span class="n">age</span><span class="w"> </span><span class="k">IGNORE</span><span class="w"> </span><span class="n">NULLS</span><span class="p">),</span><span class="w"> </span><span class="k">LAST</span><span class="p">(</span><span class="n">id</span><span class="p">),</span><span class="w"> </span><span class="k">SUM</span><span class="p">(</span><span class="n">id</span><span class="p">)</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">person</span><span class="p">;</span>
<span class="w">  </span><span class="k">first</span><span class="p">(</span><span class="n">age</span><span class="p">,</span><span class="w"> </span><span class="k">true</span><span class="p">)</span><span class="w">    </span><span class="k">last</span><span class="p">(</span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="k">false</span><span class="p">)</span><span class="w">    </span><span class="k">sum</span><span class="p">(</span><span class="n">id</span><span class="p">)</span>
<span class="w"> </span><span class="c1">------------------- ------------------ ----------</span>
<span class="w">  </span><span class="mi">30</span><span class="w">                  </span><span class="mi">400</span><span class="w">                </span><span class="mi">1000</span>
</pre></div>
</div>
</div>
<div class="section" id="related-articles">
<h2>Related articles<a class="headerlink" href="#related-articles" title="Permalink to this headline"> </a></h2>
<ul class="simple">
<li><p><a class="reference internal" href="sql-ref-syntax-qry-select-having.html"><span class="doc">HAVING</span></a></p></li>
<li><p><a class="reference internal" href="sql-ref-syntax-qry-select-qualify.html"><span class="doc">QUALIFY</span></a></p></li>
<li><p><a class="reference internal" href="sql-ref-syntax-qry-select.html"><span class="doc">SELECT</span></a></p></li>
</ul>
</div>
</div>


    
          </div>
        </div>
        <div  class="suapp-rating">
  <div id="suPageRateApp">
     <su-app></su-app>
   </div> 
 </div>
<hr> 
<footer>
  <div role="contentinfo">
      <p class="copyright">
          &copy; Databricks 2023. All rights reserved. Apache, Apache Spark, Spark, and the Spark logo are trademarks of the <a href="http://www.apache.org/">Apache Software Foundation</a>.
      </p>
      <p> 
        
          <a id='feedbacklink' href="mailto:doc-feedback@databricks.com?subject=Documentation Feedback">Send us feedback</a>
        
     | <a href="https://databricks.com/privacy-policy">Privacy Policy</a> | <a href="https://databricks.com/terms-of-use">Terms of Use</a></p>

  </div> 

</footer>
      </div>
    </div>
  </section>
</main>

  </page>
  
  <script type="text/javascript">
    var DOCUMENTATION_OPTIONS = {
      URL_ROOT: '../../',
      VERSION: '1.0',
      COLLAPSE_INDEX: false,
      FILE_SUFFIX: '.html',
      HAS_SOURCE: 'false'
    };
  </script>
  <script type="text/javascript" src="../../_static/jquery.js"></script>
  <script type="text/javascript" src="../../_static/underscore.js"></script>
  <script type="text/javascript" src="../../_static/doctools.js"></script>
  <script type="text/javascript" src="../../_static/language_data.js"></script>
  

  <script type="text/javascript" src="../../_static/js/clipboard.min.js"></script>
  <script type="text/javascript" src="../../_static/js/jquery.waypoints.min.js"></script>

  <!-- Select2 (https://select2.org/) -->
  <link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />
  <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
  <!-- End Select2 -->

  
  
  <script type="text/javascript" src="../../_static/js/localized.js"></script>
  <script type="text/javascript" src="../../_static/js/custom.js"></script>
  

  
  
  <script type="text/javascript">
    jQuery(function () {
      SphinxRtdTheme.StickyNav.enable();
    });

  </script>
  
 



  <script>
  window.__searchunifyLoaderConfig = JSON.parse('{"clients": {"en": "02c2e804-27e9-11ee-aefb-0242ac120011", "ja": "6a42c3f2-2820-11ee-aefb-0242ac120011", "pt": "6a86badd-2821-11ee-aefb-0242ac120011"}}')
</script>
<script type="text/javascript" src="../../_static/js/search-loader.js"></script>
</body>
<script type='text/javascript'>
  window.onload = function () {
    var description = document.querySelector('meta[name="description"]').getAttribute("content");
    let titleText = document.querySelector('h1').textContent;
    document.querySelector('meta[property="og:title"]').setAttribute("content", titleText);
    document.querySelector('meta[property="og:description"]').setAttribute("content", description);
    document.querySelector('meta[property="twitter:description"]').setAttribute("content", description);
  };
</script>

</html>