

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en-US" > <![endif]-->
<!--[if gt IE 8]><!-->
<html class="no-js" lang="en-US"> <!--<![endif]-->

<head>
  <!-- cookie consent -->
  
    <!-- Combined Onetrust and Rudderstack Implementation Scripts -->
    <!-- Onetrust Initialization -->
    <script type="text/javascript" src="https://cdn.cookielaw.org/consent/92466579-1717-44d3-809d-a05fb02843ed-test/OtAutoBlock.js"></script>
    <script src="https://cdn.cookielaw.org/scripttemplates/otSDKStub.js" data-document-language="true" type="text/javascript" charset="UTF-8" data-domain-script="92466579-1717-44d3-809d-a05fb02843ed-test"></script>
    <link rel="stylesheet" id="db-onetrust-style" href="https://www.databricks.com/wp-content/uploads/db_onetrust.css" media="all" />
    <!-- Setting Rudderstack Write Key -->
    <script>window.rudderstackKey = "2SOR9fvSr5Fi6tN2ihPbVHnX1SZ" </script>
    <!-- Rudderstack Initialization + Onetrust Integration + Rudderstack Custom Events -->
    <script type="text/javascript" src="https://www.databricks.com/sites/default/files/rudderstack/v1/db-rudderstack-events.js"></script>

  <!-- cookie consent -->

  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta http-equiv="X-UA-Compatible" content="IE=9" />
  <meta content="Learn how to encrypt traffic in transit (on-the-wire, or OTW) between Databricks cluster worker nodes. This is also known as inter-node encryption." name="description" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0">
  <meta property="og:image" content="https://www.databricks.com/wp-content/uploads/2020/04/og-databricks.png">
  <meta property="og:image:type" content="image/png">
  <meta property="og:title" content="Encrypt traffic between cluster worker nodes">
  <meta property="og:image:width" content="1200">
  <meta property="og:image:height" content="630">
  <meta property="og:type" content="website">
  <meta property="og:url" content="https://docs.databricks.com">
  <meta property="og:description" content="" id="og-description">
  <meta name="twitter:image" content="https://www.databricks.com/wp-content/uploads/2020/04/og-databricks.png">
  <meta name="twitter:site" content="@databricks">
  <meta name="twitter:creator" content="@databricks">
  <meta property="twitter:description" content="">
  
  <title>Encrypt traffic between cluster worker nodes &#124; Databricks on AWS</title>
  
  
  <link rel="canonical" href="https://docs.databricks.com/en/security/keys/encrypt-otw.html">
  <!-- Start hreflang tag -->
  <link rel="alternate" hreflang="en" href="https://docs.databricks.com/en/security/keys/encrypt-otw.html" />
<link rel="alternate" hreflang="x-default" href="https://docs.databricks.com/en/security/keys/encrypt-otw.html" />
  <!-- End hreflang tag -->
  
  
  <link rel="shortcut icon" href="../../_static/favicon.ico" />
  

  

  

  <!-- Google Tag Manager -->
  <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'https://www.googletagmanager.com/gtm.js?id='+i+dl;
j.setAttributeNode(d.createAttribute('data-ot-ignore'));
f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-T85FQ33');</script>
  <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'https://www.googletagmanager.com/gtm.js?id='+i+dl;
j.setAttributeNode(d.createAttribute('data-ot-ignore'));
f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-TWTKQQ');</script>
    
  <!-- End Google Tag Manager -->


  <!-- MaxMind / GEO IP -->
  <script src="//js.maxmind.com/js/apis/geoip2/v2.1/geoip2.js" type="text/javascript"></script>
  <!-- End MaxMind / GEO IP -->

  
  
  <link href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,600&display=swap" rel="stylesheet">
  <link rel="preload" href="../../_static/fonts/DMSans-Bold.ttf" as="font">
  <link rel="preload" href="../../_static/fonts/DMSans-Regular.ttf" as="font">
  <link rel="preload" href="../../_static/fonts/DMMono-Regular.ttf" as="font">
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/css/custom.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/css/cloud-provider-selector.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/css/translation-selector.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/css/searchunify/main.css" type="text/css" />

  
  <link rel="index" title="Index" href="../../genindex.html" />
  <link rel="search" title="Search" href="../../search.html" />
  <link rel="top" title="Databricks on AWS" href="../../index.html" /> 
</head>

<body class="wy-body-for-nav" role="document">

  <!-- Google Tag Manager (noscript) -->
  <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-T85FQ33"
height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
  <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-TWTKQQ"
    height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
  <!-- End Google Tag Manager (noscript) -->

  
  <nav class="wy-nav-top header su_header" role="navigation" aria-label="top navigation">
    
<nav class="wy-nav-top header su_header" role="navigation" aria-label="top navigation">
  <div class="container-logo">
    <ul class="mobile-menu-toggle">
        <li class="menu-toggle">
            <i data-toggle="wy-nav-top" class="wy-nav-top-menu-button db-icon db-icon-menu pull-left"></i>
            
            <a href="https://www.databricks.com/" class="wy-nav-top-logo"><img src="../../_static/small-scale-lockup-full-color-rgb.svg" width="137" height="21"
              alt="Databricks" /></a>   
               
              </li>
    </ul>
    <ul class="su_nav-menu">
      <li class="menu-toggle">
        <i data-toggle="wy-nav-top" class="wy-nav-top-menu-button db-icon db-icon-menu pull-left"></i>
        
          
        
        <a href="https://www.databricks.com/" class="wy-nav-top-logo"><img src="../../_static/small-scale-lockup-full-color-rgb.svg" width="137" height="21"
            alt="Databricks" /></a></li>
        <!-- 
<li><a href="https://help.databricks.com/s/">Help Center</a></li>
<li class="active"><a href="https://docs.databricks.com/en/">Documentation</a></li>
<li><a href="https://kb.databricks.com/">Knowledge Base</a></li>
 -->
    </ul>
  </div>
  <div class="su_nav-right">
    <ul class="su_link-mobile">
  <!-- Mobile header code can go here -->
</ul>
<ul class="right-try-list">
   
</ul>
  </div>
</nav>
  </nav>

  <div class="su_sub-header">
    <div class="container">
      <div class="su_sub-header-inner">
        <!-- <div class="su_subnav-menu-right">
  <div id="auto" style="width: 100%;">
    <div ng-controller="SearchautoController">
      <div bind-html-compile="autocompleteHtml">
        <form class="su__search-box-1" disabled="disabled">
          <input class="su__search-input" type="search" name="Search box" id="su__search-b" placeholder="Search Documentation" disabled="disabled"/>
          <button class="su__search-button" type="submit" class="button button-success" disabled="disabled">
            <svg width="24" height="24" viewBox="0 0 24 24">
              <path
                d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"
                fill="#333"></path>
            </svg>
          </button>
        </form>
      </div>
    </div>
  </div>
</div> -->
        <div class="search-lng-gap"></div>
        <div style="margin-left: 16px; margin-right: 16px;">
          <!-- <select name="lng selector" id="lng-selector">
    <option value="../../../en/security/keys/encrypt-otw.html" class="notranslate">English</option>
    <option value="../../../ja/security/keys/encrypt-otw.html" class="notranslate">日本語</option>
    <option value="../../../pt/security/keys/encrypt-otw.html" class="notranslate">Português (Brasil)</option>
</select> -->
        </div>
        <div class="cloud-selector-container">
          <!-- <select name="cloud provider selector" id="cloud-provider-selector">
    <option value="aws" selected class="notranslate">
        Amazon Web Services
    </option>
    <option value="azure"  class="notranslate">
        Microsoft Azure
    </option>
    <option value="gcp"  class="notranslate">
        Google Cloud Platform
    </option>
</select> -->
        </div>
      </div>
    </div>
  </div>
  <page class="js-page-container">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side su_nav-side">
<div class="wy-side-scroll">
  <div class="wy-side-nav-search">
    

    

    

    
  </div>

  <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
    
      <a href="../../index.html" class="main-navigation-home">Databricks on AWS</a>
    

    
      

      
        <p class="caption"><span class="caption-text">Load &amp; manage data</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../rag-temp/index.html">RAG Studio</a></li>
</ul>

      
    
  </div>

  <div role="contentinfo">
    
  <p class="build_info notranslate"data-last-edit="December 23, 2023">
    Updated Jan 11, 2024
  </p>
<script>
  window.addEventListener('DOMContentLoaded',function(){
    var h1=document.querySelector('h1');
    var bi=document.querySelector('[data-last-edit]');
    if(h1 && bi){
      var ver = document.createElement('p');
      ver.className = 'version_info';
      ver.textContent = bi.getAttribute('data-last-edit');
      h1.parentElement.insertBefore(ver, h1.nextElementSibling);
    }
  });
</script>

    <p>
      
        <a id='feedbacklink' href="mailto:doc-feedback@databricks.com?subject=Documentation Feedback">Send us feedback</a>
      
    </p>
  </div>
</div>
</nav>
    
    
<main class="wy-grid-for-nav su_nav-grid">
  <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
    <div class="wy-nav-content su__nav_content">
      <div class="rst-content">
        





<div role="navigation" aria-label="breadcrumbs navigation" class="wy-breadcrumbs-wrapper">
  <ul class="wy-breadcrumbs">
    <li><a href="../../index.html">Documentation</a> <span class="db-icon db-icon-chevron-right"></span></li>
    
    
      <li>Encrypt traffic between cluster worker nodes</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>
</div>
        
        <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
          <div itemprop="articleBody">
            
    
  <p></p>
<p></p>
<div class="section" id="encrypt-traffic-between-cluster-worker-nodes">
<h1>Encrypt traffic between cluster worker nodes<a class="headerlink" href="#encrypt-traffic-between-cluster-worker-nodes" title="Permalink to this headline"> </a></h1>
<div class="preview admonition">
<p class="admonition-title">Preview</p>
<p>This feature is in <a class="reference internal" href="../../release-notes/release-types.html"><span class="doc">Public Preview</span></a>.</p>
</div>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>The <a class="reference internal" href="#example-init-script"><span class="std std-ref">example init script</span></a> that is referenced in this article derives its shared encryption secret from the hash of the keystore stored in DBFS. If you rotate the secret by updating the keystore file in DBFS, all running clusters must be restarted. Otherwise, Spark workers may to fail to authenticate with the Spark driver due to inconsistent shared secret, causing jobs to slow down. Furthermore, since the shared secret is stored in DBFS, any user with DBFS access can retrieve the secret using a notebook.</p>
<p>As an alternative, you can use one of the following AWS instance types, which automatically encrypt data between worker nodes with no extra configuration required: <code class="docutils literal notranslate"><span class="pre">C5a</span></code>, <code class="docutils literal notranslate"><span class="pre">C5ad</span></code>, <code class="docutils literal notranslate"><span class="pre">C5n</span></code>, <code class="docutils literal notranslate"><span class="pre">C6i</span></code>, <code class="docutils literal notranslate"><span class="pre">C6id</span></code>, <code class="docutils literal notranslate"><span class="pre">C6in</span></code>, <code class="docutils literal notranslate"><span class="pre">D3</span></code>, <code class="docutils literal notranslate"><span class="pre">D3en</span></code>, <code class="docutils literal notranslate"><span class="pre">G4dn</span></code>, <code class="docutils literal notranslate"><span class="pre">G5</span></code>, <code class="docutils literal notranslate"><span class="pre">I3en</span></code>, <code class="docutils literal notranslate"><span class="pre">I4i</span></code>, <code class="docutils literal notranslate"><span class="pre">M5dn</span></code>, <code class="docutils literal notranslate"><span class="pre">M5n</span></code>, <code class="docutils literal notranslate"><span class="pre">M5zn</span></code>, <code class="docutils literal notranslate"><span class="pre">M6i</span></code>, <code class="docutils literal notranslate"><span class="pre">M6id</span></code>, <code class="docutils literal notranslate"><span class="pre">M6idn</span></code>, <code class="docutils literal notranslate"><span class="pre">M6in</span></code>, <code class="docutils literal notranslate"><span class="pre">P3dn</span></code>, <code class="docutils literal notranslate"><span class="pre">R-fleet</span></code>, <code class="docutils literal notranslate"><span class="pre">R5dn</span></code>, <code class="docutils literal notranslate"><span class="pre">R5n</span></code>, <code class="docutils literal notranslate"><span class="pre">R6i</span></code>, <code class="docutils literal notranslate"><span class="pre">R6id</span></code>, <code class="docutils literal notranslate"><span class="pre">R6idn</span></code>, <code class="docutils literal notranslate"><span class="pre">R6in</span></code>, and Databricks fleet instance types <code class="docutils literal notranslate"><span class="pre">M-fleet</span></code>, <code class="docutils literal notranslate"><span class="pre">MD-fleet</span></code>, and <code class="docutils literal notranslate"><span class="pre">RD-fleet</span></code>..</p>
</div>
<div class="section" id="requirements">
<h2>Requirements<a class="headerlink" href="#requirements" title="Permalink to this headline"> </a></h2>
<p>This feature requires the <a class="reference external" href="https://databricks.com/product/pricing/platform-addons">Enterprise plan</a>. Contact your Databricks account team for more information.</p>
</div>
<div class="section" id="how-the-init-script-works">
<h2>How the init script works<a class="headerlink" href="#how-the-init-script-works" title="Permalink to this headline"> </a></h2>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>The <a class="reference internal" href="#example-init-script"><span class="std std-ref">example init script</span></a> that is referenced in this article derives its shared encryption secret from the hash of the keystore stored in DBFS. If you rotate the secret by updating the keystore file in DBFS, all running clusters must be restarted. Otherwise, Spark workers may to fail to authenticate with the Spark driver due to inconsistent shared secret, causing jobs to slow down. Furthermore, since the shared secret is stored in DBFS, any user with DBFS access can retrieve the secret using a notebook.</p>
</div>
<p>User queries and transformations are typically sent to your clusters over an encrypted channel. By default, however, the data exchanged between worker nodes in a cluster is not encrypted. If your environment requires that data be encrypted at all times, whether at rest or in transit, you can create an init script that configures your clusters to encrypt traffic between worker nodes, using AES 128-bit encryption over a TLS 1.2 connection.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Although AES enables cryptographic routines to take advantage of hardware acceleration, there’s a performance penalty compared to unencrypted traffic. This penalty can result in queries taking longer on an encrypted cluster, depending on the amount of data shuffled between nodes.</p>
</div>
<p>Enabling encryption of traffic between worker nodes requires setting Spark configuration parameters through an init script. You can use a <a class="reference internal" href="../../init-scripts/cluster-scoped.html"><span class="doc">cluster-scoped init script</span></a> for a single cluster or add a cluster-scoped init script to your cluster policies if you want all clusters in your workspace to use worker-to-worker encryption.</p>
<p>One time, copy the keystore file to a directory in DBFS. Then create the init script that  applies the encryption settings.</p>
<p>The init script must perform the following tasks:</p>
<ol class="arabic simple">
<li><p>Get the JKS keystore file and password.</p></li>
<li><p>Set the Spark executor configuration.</p></li>
<li><p>Set the Spark driver configuration.</p></li>
</ol>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The JKS keystore file used for enabling SSL/HTTPS is dynamically generated for each workspace. The JKS keystore file’s password is hardcoded and not intended to protect the confidentiality of the keystore.</p>
</div>
<p>The following is an example init script that implements these three tasks to generate the cluster encryption configuration.</p>
</div>
<div class="section" id="example-init-script">
<h2>Example init script<a class="headerlink" href="#example-init-script" title="Permalink to this headline"> </a></h2>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/bin/bash</span>

<span class="nb">set</span><span class="w"> </span>-euo<span class="w"> </span>pipefail

<span class="nv">keystore_dbfs_file</span><span class="o">=</span><span class="s2">&quot;/dbfs/&lt;keystore-directory&gt;/jetty_ssl_driver_keystore.jks&quot;</span>

<span class="c1">## Wait till keystore file is available via Fuse</span>

<span class="nv">max_attempts</span><span class="o">=</span><span class="m">30</span>
<span class="k">while</span><span class="w"> </span><span class="o">[</span><span class="w"> </span>!<span class="w"> </span>-f<span class="w"> </span><span class="si">${</span><span class="nv">keystore_dbfs_file</span><span class="si">}</span><span class="w"> </span><span class="o">]</span><span class="p">;</span>
<span class="k">do</span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="o">[</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$max_attempts</span><span class="s2">&quot;</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="o">]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;ERROR: Unable to find the file : </span><span class="nv">$keystore_dbfs_file</span><span class="s2"> .Failing the script.&quot;</span>
<span class="w">    </span><span class="nb">exit</span><span class="w"> </span><span class="m">1</span>
<span class="w">  </span><span class="k">fi</span>
<span class="w">  </span>sleep<span class="w"> </span>2s
<span class="w">  </span><span class="o">((</span>max_attempts--<span class="o">))</span>
<span class="k">done</span>
<span class="w"> </span><span class="c1">## Derive shared internode encryption secret from the hash of the keystore file</span>
<span class="nv">sasl_secret</span><span class="o">=</span><span class="k">$(</span>sha256sum<span class="w"> </span><span class="nv">$keystore_dbfs_file</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>cut<span class="w"> </span>-d<span class="s1">&#39; &#39;</span><span class="w"> </span>-f1<span class="k">)</span>


<span class="k">if</span><span class="w"> </span><span class="o">[</span><span class="w"> </span>-z<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">sasl_secret</span><span class="si">}</span><span class="s2">&quot;</span><span class="w"> </span><span class="o">]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">  </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;ERROR: Unable to derive the secret.Failing the script.&quot;</span>
<span class="w">  </span><span class="nb">exit</span><span class="w"> </span><span class="m">1</span>
<span class="k">fi</span>

<span class="c1"># The JKS keystore file used for enabling SSL/HTTPS</span>
<span class="nv">local_keystore_file</span><span class="o">=</span><span class="s2">&quot;</span><span class="nv">$DB_HOME</span><span class="s2">/keys/jetty_ssl_driver_keystore.jks&quot;</span>
<span class="c1"># Password of the JKS keystore file. This jks password is hardcoded and is not intended to protect the confidentiality</span>
<span class="c1"># of the keystore. Do not assume the keystore file itself is protected.</span>
<span class="nv">local_keystore_password</span><span class="o">=</span><span class="s2">&quot;gb1gQqZ9ZIHS&quot;</span>

<span class="c1">## Updating spark-branch.conf is only needed for driver</span>

<span class="k">if</span><span class="w"> </span><span class="o">[[</span><span class="w"> </span><span class="nv">$DB_IS_DRIVER</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;TRUE&quot;</span><span class="w"> </span><span class="o">]]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">  </span><span class="nv">driver_conf</span><span class="o">=</span><span class="si">${</span><span class="nv">DB_HOME</span><span class="si">}</span>/driver/conf/spark-branch.conf
<span class="w">  </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Configuring driver conf at </span><span class="nv">$driver_conf</span><span class="s2">&quot;</span>

<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="o">[</span><span class="w"> </span>!<span class="w"> </span>-e<span class="w"> </span><span class="nv">$driver_conf</span><span class="w"> </span><span class="o">]</span><span class="w"> </span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">    </span>touch<span class="w"> </span><span class="nv">$driver_conf</span>
<span class="w">  </span><span class="k">fi</span>

cat<span class="w"> </span><span class="s">&lt;&lt; EOF &gt;&gt;  $driver_conf</span>
<span class="s">  [driver] {</span>
<span class="s">    // Configure inter-node authentication</span>
<span class="s">   &quot;spark.authenticate&quot; = true</span>
<span class="s">   &quot;spark.authenticate.secret&quot; = &quot;$sasl_secret&quot;</span>
<span class="s">   // Configure AES encryption</span>
<span class="s">   &quot;spark.network.crypto.enabled&quot; = true</span>
<span class="s">   &quot;spark.network.crypto.saslFallback&quot; = false</span>
<span class="s">   // Configure SSL</span>
<span class="s">   &quot;spark.ssl.enabled&quot; = true</span>
<span class="s">   &quot;spark.ssl.keyPassword&quot; = &quot;$local_keystore_password&quot;</span>
<span class="s">   &quot;spark.ssl.keyStore&quot; = &quot;$local_keystore_file&quot;</span>
<span class="s">   &quot;spark.ssl.keyStorePassword&quot; = &quot;$local_keystore_password&quot;</span>
<span class="s">   &quot;spark.ssl.protocol&quot; =&quot;TLSv1.3&quot;</span>
<span class="s">   &quot;spark.ssl.standalone.enabled&quot; = true</span>
<span class="s">   &quot;spark.ssl.ui.enabled&quot; = true</span>
<span class="s">   }</span>
<span class="s">EOF</span>
<span class="w">  </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Successfully configured driver conf at </span><span class="nv">$driver_conf</span><span class="s2">&quot;</span>
<span class="k">fi</span>

<span class="c1"># Setting configs in spark-defaults.conf for the spark master and worker</span>

<span class="nv">spark_defaults_conf</span><span class="o">=</span><span class="s2">&quot;</span><span class="nv">$DB_HOME</span><span class="s2">/spark/conf/spark-defaults.conf&quot;</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Configuring spark defaults conf at </span><span class="nv">$spark_defaults_conf</span><span class="s2">&quot;</span>
<span class="k">if</span><span class="w"> </span><span class="o">[</span><span class="w"> </span>!<span class="w"> </span>-e<span class="w"> </span><span class="nv">$spark_defaults_conf</span><span class="w"> </span><span class="o">]</span><span class="w"> </span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">  </span>touch<span class="w"> </span><span class="nv">$spark_defaults_conf</span>
<span class="k">fi</span>

cat<span class="w"> </span><span class="s">&lt;&lt; EOF &gt;&gt;  $spark_defaults_conf</span>
<span class="s">spark.authenticate true</span>
<span class="s">spark.authenticate.secret $sasl_secret</span>
<span class="s">spark.network.crypto.enabled true</span>
<span class="s">spark.network.crypto.saslFallback false</span>

<span class="s">spark.ssl.enabled true</span>
<span class="s">spark.ssl.keyPassword $local_keystore_password</span>
<span class="s">spark.ssl.keyStore $local_keystore_file</span>
<span class="s">spark.ssl.keyStorePassword $local_keystore_password</span>
<span class="s">spark.ssl.protocol TLSv1.3</span>
<span class="s">spark.ssl.standalone.enabled true</span>
<span class="s">spark.ssl.ui.enabled true</span>
<span class="s">EOF</span>

<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Successfully configured spark defaults conf at </span><span class="nv">$spark_defaults_conf</span><span class="s2">&quot;</span>
</pre></div>
</div>
<p>Once the initialization of the driver and worker nodes is complete, all traffic between these nodes is encrypted using the keystore file.</p>
</div>
<div class="section" id="notebook-example-install-an-encryption-init-script">
<h2>Notebook example: Install an encryption init script<a class="headerlink" href="#notebook-example-install-an-encryption-init-script" title="Permalink to this headline"> </a></h2>
<p>This following notebook copies the keystore file and generates the init script in DBFS. You can use the init script to create new clusters with encryption enabled.</p>
<div class="embedded-notebook-section section" id="install-an-encryption-init-script-notebook">
<span id="cluster-encryption-init-script"></span><h3>Install an encryption init script notebook<a class="headerlink" href="#install-an-encryption-init-script-notebook" title="Permalink to this headline"> </a></h3>
<div class="embedded-notebook">
    <p class="notebook-import-help">
        <a href="/_extras/notebooks/source/cluster-encryption-init-script.html"            target="_blank">Open notebook in new tab</a>
        <button class="embedded-notebook-copy-to-clipboard"                copy-path-to-clipboard-on-click="/_extras/notebooks/source/cluster-encryption-init-script.html">            <img src="/_static/clippy.svg"                alt="Copy to clipboard">            Copy link for import        </button>    <div class="embedded-notebook-container">        <div class="loading-spinner"></div>        <iframe data-src="/_extras/notebooks/source/cluster-encryption-init-script.html"            id="9a5d06b7b0dbfa0c1c880a9b50a064b10d74596971948c4fbb122aef650c9de8" height="1000px" width="100%"            style="overflow-y:hidden;" scrolling="no"></iframe>    </div></div></div>
</div>
<div class="section" id="disable-encryption-between-worker-nodes">
<h2>Disable encryption between worker nodes<a class="headerlink" href="#disable-encryption-between-worker-nodes" title="Permalink to this headline"> </a></h2>
<p>To disable encryption between worker nodes, remove the init script from the cluster configuration, then restart the cluster.</p>
</div>
</div>


    
          </div>
        </div>
        <div  class="suapp-rating">
  <div id="suPageRateApp">
     <su-app></su-app>
   </div> 
 </div>
<hr> 
<footer>
  <div role="contentinfo">
      <p class="copyright">
          &copy; Databricks 2023. All rights reserved. Apache, Apache Spark, Spark, and the Spark logo are trademarks of the <a href="http://www.apache.org/">Apache Software Foundation</a>.
      </p>
      <p> 
        
          <a id='feedbacklink' href="mailto:doc-feedback@databricks.com?subject=Documentation Feedback">Send us feedback</a>
        
     | <a href="https://databricks.com/privacy-policy">Privacy Policy</a> | <a href="https://databricks.com/terms-of-use">Terms of Use</a></p>

  </div> 

</footer>
      </div>
    </div>
  </section>
</main>

  </page>
  
  <script type="text/javascript">
    var DOCUMENTATION_OPTIONS = {
      URL_ROOT: '../../',
      VERSION: '1.0',
      COLLAPSE_INDEX: false,
      FILE_SUFFIX: '.html',
      HAS_SOURCE: 'false'
    };
  </script>
  <script type="text/javascript" src="../../_static/jquery.js"></script>
  <script type="text/javascript" src="../../_static/underscore.js"></script>
  <script type="text/javascript" src="../../_static/doctools.js"></script>
  <script type="text/javascript" src="../../_static/language_data.js"></script>
  

  <script type="text/javascript" src="../../_static/js/clipboard.min.js"></script>
  <script type="text/javascript" src="../../_static/js/jquery.waypoints.min.js"></script>

  <!-- Select2 (https://select2.org/) -->
  <link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />
  <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
  <!-- End Select2 -->

  
  
  <script type="text/javascript" src="../../_static/js/localized.js"></script>
  <script type="text/javascript" src="../../_static/js/custom.js"></script>
  

  
  
  <script type="text/javascript">
    jQuery(function () {
      SphinxRtdTheme.StickyNav.enable();
    });

  </script>
  
 



  <script>
  window.__searchunifyLoaderConfig = JSON.parse('{"clients": {"en": "02c2e804-27e9-11ee-aefb-0242ac120011", "ja": "6a42c3f2-2820-11ee-aefb-0242ac120011", "pt": "6a86badd-2821-11ee-aefb-0242ac120011"}}')
</script>
<script type="text/javascript" src="../../_static/js/search-loader.js"></script>
</body>
<script type='text/javascript'>
  window.onload = function () {
    var description = document.querySelector('meta[name="description"]').getAttribute("content");
    let titleText = document.querySelector('h1').textContent;
    document.querySelector('meta[property="og:title"]').setAttribute("content", titleText);
    document.querySelector('meta[property="og:description"]').setAttribute("content", description);
    document.querySelector('meta[property="twitter:description"]').setAttribute("content", description);
  };
</script>

</html>