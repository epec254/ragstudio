

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en-US" > <![endif]-->
<!--[if gt IE 8]><!-->
<html class="no-js" lang="en-US"> <!--<![endif]-->

<head>
  <!-- cookie consent -->
  
    <!-- Combined Onetrust and Rudderstack Implementation Scripts -->
    <!-- Onetrust Initialization -->
    <script type="text/javascript" src="https://cdn.cookielaw.org/consent/92466579-1717-44d3-809d-a05fb02843ed-test/OtAutoBlock.js"></script>
    <script src="https://cdn.cookielaw.org/scripttemplates/otSDKStub.js" data-document-language="true" type="text/javascript" charset="UTF-8" data-domain-script="92466579-1717-44d3-809d-a05fb02843ed-test"></script>
    <link rel="stylesheet" id="db-onetrust-style" href="https://www.databricks.com/wp-content/uploads/db_onetrust.css" media="all" />
    <!-- Setting Rudderstack Write Key -->
    <script>window.rudderstackKey = "2SOR9fvSr5Fi6tN2ihPbVHnX1SZ" </script>
    <!-- Rudderstack Initialization + Onetrust Integration + Rudderstack Custom Events -->
    <script type="text/javascript" src="https://www.databricks.com/sites/default/files/rudderstack/v1/db-rudderstack-events.js"></script>

  <!-- cookie consent -->

  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta http-equiv="X-UA-Compatible" content="IE=9" />
  <meta content="Learn how to configure VPC peering to connect Databricks clusters to other parts of your AWS infrastructure using private IP addresses within the internal AWS network." name="description" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0">
  <meta property="og:image" content="https://www.databricks.com/wp-content/uploads/2020/04/og-databricks.png">
  <meta property="og:image:type" content="image/png">
  <meta property="og:title" content="VPC peering">
  <meta property="og:image:width" content="1200">
  <meta property="og:image:height" content="630">
  <meta property="og:type" content="website">
  <meta property="og:url" content="https://docs.databricks.com">
  <meta property="og:description" content="" id="og-description">
  <meta name="twitter:image" content="https://www.databricks.com/wp-content/uploads/2020/04/og-databricks.png">
  <meta name="twitter:site" content="@databricks">
  <meta name="twitter:creator" content="@databricks">
  <meta property="twitter:description" content="">
  
  <title>VPC peering &#124; Databricks on AWS</title>
  
  
  <link rel="canonical" href="https://docs.databricks.com/en/security/network/classic/vpc-peering.html">
  <!-- Start hreflang tag -->
  <link rel="alternate" hreflang="en" href="https://docs.databricks.com/en/security/network/classic/vpc-peering.html" />
<link rel="alternate" hreflang="x-default" href="https://docs.databricks.com/en/security/network/classic/vpc-peering.html" />
  <!-- End hreflang tag -->
  
  
  <link rel="shortcut icon" href="../../../_static/favicon.ico" />
  

  

  

  <!-- Google Tag Manager -->
  <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'https://www.googletagmanager.com/gtm.js?id='+i+dl;
j.setAttributeNode(d.createAttribute('data-ot-ignore'));
f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-T85FQ33');</script>
  <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'https://www.googletagmanager.com/gtm.js?id='+i+dl;
j.setAttributeNode(d.createAttribute('data-ot-ignore'));
f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-TWTKQQ');</script>
    
  <!-- End Google Tag Manager -->


  <!-- MaxMind / GEO IP -->
  <script src="//js.maxmind.com/js/apis/geoip2/v2.1/geoip2.js" type="text/javascript"></script>
  <!-- End MaxMind / GEO IP -->

  
  
  <link href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,600&display=swap" rel="stylesheet">
  <link rel="preload" href="../../../_static/fonts/DMSans-Bold.ttf" as="font">
  <link rel="preload" href="../../../_static/fonts/DMSans-Regular.ttf" as="font">
  <link rel="preload" href="../../../_static/fonts/DMMono-Regular.ttf" as="font">
  <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/css/custom.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/css/cloud-provider-selector.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/css/translation-selector.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/css/searchunify/main.css" type="text/css" />

  
  <link rel="index" title="Index" href="../../../genindex.html" />
  <link rel="search" title="Search" href="../../../search.html" />
  <link rel="top" title="Databricks on AWS" href="../../../index.html" /> 
</head>

<body class="wy-body-for-nav" role="document">

  <!-- Google Tag Manager (noscript) -->
  <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-T85FQ33"
height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
  <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-TWTKQQ"
    height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
  <!-- End Google Tag Manager (noscript) -->

  
  <nav class="wy-nav-top header su_header" role="navigation" aria-label="top navigation">
    
<nav class="wy-nav-top header su_header" role="navigation" aria-label="top navigation">
  <div class="container-logo">
    <ul class="mobile-menu-toggle">
        <li class="menu-toggle">
            <i data-toggle="wy-nav-top" class="wy-nav-top-menu-button db-icon db-icon-menu pull-left"></i>
            
            <a href="https://www.databricks.com/" class="wy-nav-top-logo"><img src="../../../_static/small-scale-lockup-full-color-rgb.svg" width="137" height="21"
              alt="Databricks" /></a>   
               
              </li>
    </ul>
    <ul class="su_nav-menu">
      <li class="menu-toggle">
        <i data-toggle="wy-nav-top" class="wy-nav-top-menu-button db-icon db-icon-menu pull-left"></i>
        
          
        
        <a href="https://www.databricks.com/" class="wy-nav-top-logo"><img src="../../../_static/small-scale-lockup-full-color-rgb.svg" width="137" height="21"
            alt="Databricks" /></a></li>
        <!-- 
<li><a href="https://help.databricks.com/s/">Help Center</a></li>
<li class="active"><a href="https://docs.databricks.com/en/">Documentation</a></li>
<li><a href="https://kb.databricks.com/">Knowledge Base</a></li>
 -->
    </ul>
  </div>
  <div class="su_nav-right">
    <ul class="su_link-mobile">
  <!-- Mobile header code can go here -->
</ul>
<ul class="right-try-list">
   
</ul>
  </div>
</nav>
  </nav>

  <div class="su_sub-header">
    <div class="container">
      <div class="su_sub-header-inner">
        <!-- <div class="su_subnav-menu-right">
  <div id="auto" style="width: 100%;">
    <div ng-controller="SearchautoController">
      <div bind-html-compile="autocompleteHtml">
        <form class="su__search-box-1" disabled="disabled">
          <input class="su__search-input" type="search" name="Search box" id="su__search-b" placeholder="Search Documentation" disabled="disabled"/>
          <button class="su__search-button" type="submit" class="button button-success" disabled="disabled">
            <svg width="24" height="24" viewBox="0 0 24 24">
              <path
                d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"
                fill="#333"></path>
            </svg>
          </button>
        </form>
      </div>
    </div>
  </div>
</div> -->
        <div class="search-lng-gap"></div>
        <div style="margin-left: 16px; margin-right: 16px;">
          <!-- <select name="lng selector" id="lng-selector">
    <option value="../../../../en/security/network/classic/vpc-peering.html" class="notranslate">English</option>
    <option value="../../../../ja/security/network/classic/vpc-peering.html" class="notranslate">日本語</option>
    <option value="../../../../pt/security/network/classic/vpc-peering.html" class="notranslate">Português (Brasil)</option>
</select> -->
        </div>
        <div class="cloud-selector-container">
          <!-- <select name="cloud provider selector" id="cloud-provider-selector">
    <option value="aws" selected class="notranslate">
        Amazon Web Services
    </option>
    <option value="azure"  class="notranslate">
        Microsoft Azure
    </option>
    <option value="gcp"  class="notranslate">
        Google Cloud Platform
    </option>
</select> -->
        </div>
      </div>
    </div>
  </div>
  <page class="js-page-container">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side su_nav-side">
<div class="wy-side-scroll">
  <div class="wy-side-nav-search">
    

    

    

    
  </div>

  <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
    
      <a href="../../../index.html" class="main-navigation-home">Databricks on AWS</a>
    

    
      

      
        <p class="caption"><span class="caption-text">Load &amp; manage data</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../rag-temp/index.html">RAG Studio</a></li>
</ul>

      
    
  </div>

  <div role="contentinfo">
    
  <p class="build_info notranslate"data-last-edit="December 23, 2023">
    Updated Jan 11, 2024
  </p>
<script>
  window.addEventListener('DOMContentLoaded',function(){
    var h1=document.querySelector('h1');
    var bi=document.querySelector('[data-last-edit]');
    if(h1 && bi){
      var ver = document.createElement('p');
      ver.className = 'version_info';
      ver.textContent = bi.getAttribute('data-last-edit');
      h1.parentElement.insertBefore(ver, h1.nextElementSibling);
    }
  });
</script>

    <p>
      
        <a id='feedbacklink' href="mailto:doc-feedback@databricks.com?subject=Documentation Feedback">Send us feedback</a>
      
    </p>
  </div>
</div>
</nav>
    
    
<main class="wy-grid-for-nav su_nav-grid">
  <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
    <div class="wy-nav-content su__nav_content">
      <div class="rst-content">
        





<div role="navigation" aria-label="breadcrumbs navigation" class="wy-breadcrumbs-wrapper">
  <ul class="wy-breadcrumbs">
    <li><a href="../../../index.html">Documentation</a> <span class="db-icon db-icon-chevron-right"></span></li>
    
    
      <li>VPC peering</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>
</div>
        
        <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
          <div itemprop="articleBody">
            
    
  <div class="section" id="vpc-peering">
<h1>VPC peering<a class="headerlink" href="#vpc-peering" title="Permalink to this headline"> </a></h1>
<p>VPC peering allows your Databricks clusters to connect to your other AWS infrastructure (RDS, Redshift, Kafka, Cassandra, and so on) using private IP addresses within the internal AWS network.</p>
<p>The VPC hosting the other infrastructure must have a CIDR range distinct from the Databricks VPC and any other CIDR range included as a destination in the Databricks VPC main route table.  If you have a conflict, you can contact Databricks support to inquire about moving your Databricks VPC to a new CIDR range of your choice.  You can view this by searching for the Databricks VPC in your AWS Console, clicking on the main route table associated with it, and then examining the <strong>Route Tables</strong> tab.  Here is an example of a main route table for a Databricks deployment that is already peered with several other VPCs:</p>
<div class="figure align-default">
<img alt="Databricks VPC Route Table" src="../../../_images/dbc-vpc-route-table.png" />
</div>
<p>For information on VPC peering, see the <a class="reference external" href="https://docs.aws.amazon.com/vpc/latest/userguide/vpc-peering.html">AWS VPC Peering guide</a>.</p>
<p>This guide walks you through an example of peering an AWS Aurora RDS to your Databricks VPC using the AWS Console.  If you prefer a programmatic solution, go to <a class="reference internal" href="#programmatic-peering"><span class="std std-ref">Programmatic VPC peering</span></a> for a notebook that performs all of the steps for you.  Finally, there is a <a class="reference internal" href="#troubleshooting"><span class="std std-ref">troubleshooting</span></a> section for common problems and resolutions.</p>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>Consult your AWS/devops team before trying to set up VPC peering. Some familiarity with AWS as well as sufficient permissions will ensure this process goes smoothly. The notebook can help you make this transition, however depending on your environment it is important to ensure to make the necessary modifications to ensure there is no impact to the your existing infrastructure.</p>
</div>
<div class="section" id="aws-console-example">
<h2>AWS Console example<a class="headerlink" href="#aws-console-example" title="Permalink to this headline"> </a></h2>
<p>The following diagram illustrates all of the different components that are involved in peering your Databricks deployment to your other AWS infrastructure.  In the example, Databricks is deployed in one AWS account and the Aurora RDS is deployed into another.  A peering connection is established to link the two VPCs across both AWS accounts.</p>
<div class="figure align-default">
<img alt="VPC Peering Connection Across AWS Accounts" src="../../../_images/aws-vpc-peer-diagram.png" />
</div>
<p>As you move through this process within your own AWS Console, it helps to keep a table of information to refer back to. Record the following:</p>
<ol class="arabic simple">
<li><p>ID and CIDR Range of your Databricks VPC.</p></li>
<li><p>ID and CIDR Range of your other infrastructure (Aurora RDS).</p></li>
<li><p>ID of the main route table of your Databricks VPC.</p></li>
</ol>
<table class="docutils align-default">
<colgroup>
<col style="width: 18%" />
<col style="width: 41%" />
<col style="width: 20%" />
<col style="width: 21%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>AWS Service</p></th>
<th class="head"><p>Name</p></th>
<th class="head"><p>ID</p></th>
<th class="head"><p>CIDR Range</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>VPC</p></td>
<td><p>Databricks VPC</p></td>
<td><p>vpc-dbcb3fbc</p></td>
<td><p>10.126.0.0/16</p></td>
</tr>
<tr class="row-odd"><td><p>VPC</p></td>
<td><p>Aurora RDS VPC</p></td>
<td><p>vpc-7b52471c</p></td>
<td><p>172.78.0.0/16</p></td>
</tr>
<tr class="row-even"><td><p>Route Table</p></td>
<td><p>Databricks Main Route Table</p></td>
<td><p>rtb-3775c750</p></td>
<td></td>
</tr>
</tbody>
</table>
<div class="section" id="step-1-create-a-peering-connection">
<h3>Step 1: Create a peering connection<a class="headerlink" href="#step-1-create-a-peering-connection" title="Permalink to this headline"> </a></h3>
<ol class="arabic">
<li><p>Navigate to the <strong>VPC Dashboard</strong>.</p></li>
<li><p>Select <strong>Peering Connections</strong>.</p></li>
<li><p>Click <strong>Create Peering Connection</strong></p></li>
<li><p>Set the <strong>VPC Requester</strong> to the Databricks VPC ID.</p></li>
<li><p>Set the <strong>VPC Acceptor</strong> to the Aurora VPC ID.</p></li>
<li><p>Click <strong>Create Peering Connection</strong>.</p>
<div class="figure align-default">
<img alt="Create Peering Connection" src="../../../_images/aws-peering-connection.png" />
</div>
</li>
</ol>
</div>
<div class="section" id="step-2-record-the-id-of-the-peering-connection">
<h3>Step 2: Record the ID of the peering connection<a class="headerlink" href="#step-2-record-the-id-of-the-peering-connection" title="Permalink to this headline"> </a></h3>
<table class="docutils align-default">
<colgroup>
<col style="width: 25%" />
<col style="width: 38%" />
<col style="width: 18%" />
<col style="width: 19%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>AWS Service</p></th>
<th class="head"><p>Name</p></th>
<th class="head"><p>ID</p></th>
<th class="head"><p>CIDR Range</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>VPC</p></td>
<td><p>Databricks VPC</p></td>
<td><p>vpc-dbcb3fbc</p></td>
<td><p>10.126.0.0/16</p></td>
</tr>
<tr class="row-odd"><td><p>VPC</p></td>
<td><p>Aurora RDS VPC</p></td>
<td><p>vpc-7b52471c</p></td>
<td><p>172.78.0.0/16</p></td>
</tr>
<tr class="row-even"><td><p>Route Table</p></td>
<td><p>Databricks Main Route Table</p></td>
<td><p>rtb-3775c750</p></td>
<td></td>
</tr>
<tr class="row-odd"><td><p>Peering Connection</p></td>
<td><p>Databricks VPC &lt;&gt; Aurora VPC</p></td>
<td><p>pcx-4d148024</p></td>
<td></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="step-3-accept-the-peering-connection-request">
<h3>Step 3: Accept the peering connection request<a class="headerlink" href="#step-3-accept-the-peering-connection-request" title="Permalink to this headline"> </a></h3>
<p>The VPC with the Aurora RDS will need to have its owner approve the request.  The status on Peering Connections indicates <strong>Pending Acceptance</strong> until this is done.</p>
<div class="figure align-default">
<img alt="Peering Connection Pending Acceptance" src="../../../_images/aws-vpc-peering-connection-pending.png" />
</div>
<p>Select <strong>Actions &gt; Accept Request</strong>.</p>
<div class="figure align-default">
<img alt="Peering Connection Accept Request" src="../../../_images/aws-vpc-peering-connection-accept.png" />
</div>
</div>
<div class="section" id="step-4-add-dns-resolution-to-peering-connection">
<h3>Step 4: Add DNS resolution to peering connection<a class="headerlink" href="#step-4-add-dns-resolution-to-peering-connection" title="Permalink to this headline"> </a></h3>
<ol class="arabic simple">
<li><p>Log into the AWS Account that hosts the Databricks VPC.</p></li>
<li><p>Navigate to the <strong>VPC Dashboard</strong>.</p></li>
<li><p>Select <strong>Peering Connections</strong>.</p></li>
<li><p>From the Actions menu, select <strong>Edit DNS Settings</strong>.</p></li>
<li><p>Click to enable <strong>DNS resolution</strong>.</p></li>
<li><p>Log into the AWS Account that hosts the Aurora VPC and repeat steps 2 - 4.</p></li>
</ol>
<div class="figure align-default">
<img alt="Enable DNS Resolution" src="../../../_images/aws-vpc-peering-connection-enable-dns.png" />
</div>
</div>
<div class="section" id="step-5-add-destination-to-databricks-vpc-main-route-table">
<h3>Step 5: Add destination to Databricks VPC main route table<a class="headerlink" href="#step-5-add-destination-to-databricks-vpc-main-route-table" title="Permalink to this headline"> </a></h3>
<ol class="arabic">
<li><p>Select <strong>Route Tables</strong> in the VPC Dashboard.</p></li>
<li><p>Search for the Databricks VPC ID.</p></li>
<li><p>Click the <strong>Edit</strong> button under the <strong>Routes</strong> tab.</p></li>
<li><p>Click <strong>Add another route</strong>.</p></li>
<li><p>Enter the CIDR range of the Aurora VPC for the <strong>Destination</strong>.</p></li>
<li><p>Enter the ID of the peering connection for the <strong>Target</strong>.</p>
<div class="figure align-default">
<img alt="Databricks VPC Route Destinations" src="../../../_images/dbc-vpc-route-table-route.png" />
</div>
</li>
</ol>
</div>
<div class="section" id="step-6-add-destination-to-aurora-vpc-main-route-table">
<h3>Step 6: Add destination to Aurora VPC main route table<a class="headerlink" href="#step-6-add-destination-to-aurora-vpc-main-route-table" title="Permalink to this headline"> </a></h3>
<ol class="arabic">
<li><p>Select <strong>Route Tables</strong> in the VPC Dashboard.</p></li>
<li><p>Search for the Aurora VPC ID.</p></li>
<li><p>Click the <strong>Edit</strong> button under the <strong>Routes</strong> tab.</p></li>
<li><p>Click <strong>Add another route</strong>.</p></li>
<li><p>Enter the CIDR range of the Databricks VPC for the <strong>Destination</strong>.</p></li>
<li><p>Enter the ID of the peering connection for the <strong>Target</strong>.</p>
<div class="figure align-default">
<img alt="Aurora VPC Route Destinations" src="../../../_images/aurora-vpc-route-table-route.png" />
</div>
</li>
</ol>
</div>
<div class="section" id="step-7-find-the-databricks-unmanaged-security-group">
<h3>Step 7: Find the Databricks unmanaged security group<a class="headerlink" href="#step-7-find-the-databricks-unmanaged-security-group" title="Permalink to this headline"> </a></h3>
<ol class="arabic simple">
<li><p>Select <strong>Security Groups</strong> in the VPC Dashboard.</p></li>
<li><p>Search for the ID of the Databricks VPC.</p></li>
<li><p>Find and Record the ID of the security group with <strong>Unmanaged</strong> in the name.  Do <em>not</em> select the Managed security group.</p></li>
</ol>
<table class="docutils align-default">
<colgroup>
<col style="width: 25%" />
<col style="width: 38%" />
<col style="width: 18%" />
<col style="width: 19%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>AWS Service</p></th>
<th class="head"><p>Name</p></th>
<th class="head"><p>ID</p></th>
<th class="head"><p>CIDR Range</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>VPC</p></td>
<td><p>Databricks VPC</p></td>
<td><p>vpc-dbcb3fbc</p></td>
<td><p>10.126.0.0/16</p></td>
</tr>
<tr class="row-odd"><td><p>VPC</p></td>
<td><p>Aurora RDS VPC</p></td>
<td><p>vpc-7b52471c</p></td>
<td><p>172.78.0.0/16</p></td>
</tr>
<tr class="row-even"><td><p>Route Table</p></td>
<td><p>Databricks Main Route Table</p></td>
<td><p>rtb-3775c750</p></td>
<td></td>
</tr>
<tr class="row-odd"><td><p>Peering Connection</p></td>
<td><p>Databricks VPC &lt;&gt; Aurora VPC</p></td>
<td><p>pcx-4d148024</p></td>
<td></td>
</tr>
<tr class="row-even"><td><p>Security Group</p></td>
<td><p>Databricks Unmanaged Group</p></td>
<td><p>sg-96016bef</p></td>
<td></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="step-8-add-rule-to-unmanaged-security-group">
<h3>Step 8: Add rule to unmanaged security group<a class="headerlink" href="#step-8-add-rule-to-unmanaged-security-group" title="Permalink to this headline"> </a></h3>
<ol class="arabic">
<li><p>Select <strong>Security Groups</strong> in the VPC Dashboard.</p></li>
<li><p>Search for the ID of the Aurora VPC.</p></li>
<li><p>Add an <strong>Inbound Rule</strong> by clicking <strong>Edit</strong> and then <strong>Add Another Rule</strong>.</p></li>
<li><p>Select <strong>Custom TCP Rule</strong> or the service that relates to your RDS.</p></li>
<li><p>Set the <strong>Port Range</strong> to correspond to your RDS service.  The default for Aurora [MySQL] is 3306.</p></li>
<li><p>Set the <strong>Source</strong> to be the security group ID of the <strong>Unmanaged</strong> Databricks security group.</p>
<div class="figure align-default">
<img alt="Aurora Security Group Rule" src="../../../_images/aurora-security-group-rule.png" />
</div>
</li>
</ol>
</div>
<div class="section" id="step-9-test-connectivity">
<h3>Step 9: Test connectivity<a class="headerlink" href="#step-9-test-connectivity" title="Permalink to this headline"> </a></h3>
<ol class="arabic">
<li><p>Create a Databricks cluster.</p></li>
<li><p>Check to see if you can connect to the database with the following <code class="docutils literal notranslate"><span class="pre">netcat</span></code> command:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>%sh<span class="w"> </span>nc<span class="w"> </span>-zv<span class="w"> </span>&lt;hostname&gt;<span class="w"> </span>&lt;port&gt;
</pre></div>
</div>
<div class="figure align-default">
<img alt="Validate Connectivity" src="../../../_images/aws-vpc-peering-validate.png" />
</div>
</li>
</ol>
</div>
</div>
<div class="section" id="programmatic-vpc-peering">
<span id="programmatic-peering"></span><h2>Programmatic VPC peering<a class="headerlink" href="#programmatic-vpc-peering" title="Permalink to this headline"> </a></h2>
<p>This notebook supports two scenarios:</p>
<ul class="simple">
<li><p>Establishing VPC peering between Databricks VPC and another VPC in the same AWS account</p></li>
<li><p>Establishing VPC peering between Databricks VPC and another VPC in a different AWS account</p></li>
</ul>
<div class="embedded-notebook-section section" id="vpc-peering-notebook">
<span id="vpc-peering"></span><h3>VPC peering notebook<a class="headerlink" href="#vpc-peering-notebook" title="Permalink to this headline"> </a></h3>
<div class="embedded-notebook">
    <p class="notebook-import-help">
        <a href="/_extras/notebooks/source/vpc-peering.html"            target="_blank">Open notebook in new tab</a>
        <button class="embedded-notebook-copy-to-clipboard"                copy-path-to-clipboard-on-click="/_extras/notebooks/source/vpc-peering.html">            <img src="/_static/clippy.svg"                alt="Copy to clipboard">            Copy link for import        </button>    <div class="embedded-notebook-container">        <div class="loading-spinner"></div>        <iframe data-src="/_extras/notebooks/source/vpc-peering.html"            id="aa7077cab4d11bee4baec9a2ff4c565722e4d0f9a2cac272c880137628eeefd3" height="1000px" width="100%"            style="overflow-y:hidden;" scrolling="no"></iframe>    </div></div></div>
</div>
<div class="section" id="troubleshooting">
<h2>Troubleshooting<a class="headerlink" href="#troubleshooting" title="Permalink to this headline"> </a></h2>
<p><strong>Can’t establish connectivity with <code class="docutils literal notranslate"><span class="pre">netcat</span></code></strong></p>
<p>If you can’t establish connectivity with <code class="docutils literal notranslate"><span class="pre">netcat</span></code>, check that the hostname is resolving via DNS by using the <code class="docutils literal notranslate"><span class="pre">host</span></code> Linux command.  If the hostname does not resolve, verify that you have enabled DNS resolution in your peering connection.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>%sh<span class="w"> </span>host<span class="w"> </span>-t<span class="w"> </span>a<span class="w"> </span>&lt;hostname&gt;
</pre></div>
</div>
<div class="figure align-default">
<img alt="Validate DNS Resolution" src="../../../_images/aws-validate-dns.png" />
</div>
<p><strong>Can’t establish connectivity with the hostname or the IP address</strong></p>
<p>If you aren’t able to establish connectivity with either the hostname or the IP address, verify that the VPC of your Aurora RDS has 3 subnets associated with its main route table.</p>
<ol class="arabic">
<li><p>Select <strong>Subnets</strong> from the <strong>VPC Dashboard</strong> and search for the ID of the Aurora VPC. There should be a subnet for each availability zone.</p>
<div class="figure align-default">
<img alt="Aurora VPC Subnets" src="../../../_images/aws-vpc-aurora-subnets.png" />
</div>
</li>
<li><p>Make sure that each of those subnets are associated with the main route table.</p>
<ol class="loweralpha">
<li><p>Select <strong>Route Tables</strong> from the VPC Dashboard and search for the main route table associated with the Aurora RDS.</p></li>
<li><p>Click the <strong>Subnet Associations</strong> tab and then <strong>Edit</strong>. You should see all 3 subnets in the list, but none of them should have <strong>Associate</strong> selected.</p>
<div class="figure align-default">
<img alt="Aurora Subnet Associations" src="../../../_images/aurora-subnet-associations.png" />
</div>
</li>
</ol>
</li>
</ol>
<p><strong>DNS is not working</strong></p>
<p>Check in Route 53 and confirm that the Databricks VPC is associated with the private hosted zones used within your VPC.</p>
</div>
</div>


    
          </div>
        </div>
        <div  class="suapp-rating">
  <div id="suPageRateApp">
     <su-app></su-app>
   </div> 
 </div>
<hr> 
<footer>
  <div role="contentinfo">
      <p class="copyright">
          &copy; Databricks 2023. All rights reserved. Apache, Apache Spark, Spark, and the Spark logo are trademarks of the <a href="http://www.apache.org/">Apache Software Foundation</a>.
      </p>
      <p> 
        
          <a id='feedbacklink' href="mailto:doc-feedback@databricks.com?subject=Documentation Feedback">Send us feedback</a>
        
     | <a href="https://databricks.com/privacy-policy">Privacy Policy</a> | <a href="https://databricks.com/terms-of-use">Terms of Use</a></p>

  </div> 

</footer>
      </div>
    </div>
  </section>
</main>

  </page>
  
  <script type="text/javascript">
    var DOCUMENTATION_OPTIONS = {
      URL_ROOT: '../../../',
      VERSION: '1.0',
      COLLAPSE_INDEX: false,
      FILE_SUFFIX: '.html',
      HAS_SOURCE: 'false'
    };
  </script>
  <script type="text/javascript" src="../../../_static/jquery.js"></script>
  <script type="text/javascript" src="../../../_static/underscore.js"></script>
  <script type="text/javascript" src="../../../_static/doctools.js"></script>
  <script type="text/javascript" src="../../../_static/language_data.js"></script>
  

  <script type="text/javascript" src="../../../_static/js/clipboard.min.js"></script>
  <script type="text/javascript" src="../../../_static/js/jquery.waypoints.min.js"></script>

  <!-- Select2 (https://select2.org/) -->
  <link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />
  <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
  <!-- End Select2 -->

  
  
  <script type="text/javascript" src="../../../_static/js/localized.js"></script>
  <script type="text/javascript" src="../../../_static/js/custom.js"></script>
  

  
  
  <script type="text/javascript">
    jQuery(function () {
      SphinxRtdTheme.StickyNav.enable();
    });

  </script>
  
 



  <script>
  window.__searchunifyLoaderConfig = JSON.parse('{"clients": {"en": "02c2e804-27e9-11ee-aefb-0242ac120011", "ja": "6a42c3f2-2820-11ee-aefb-0242ac120011", "pt": "6a86badd-2821-11ee-aefb-0242ac120011"}}')
</script>
<script type="text/javascript" src="../../../_static/js/search-loader.js"></script>
</body>
<script type='text/javascript'>
  window.onload = function () {
    var description = document.querySelector('meta[name="description"]').getAttribute("content");
    let titleText = document.querySelector('h1').textContent;
    document.querySelector('meta[property="og:title"]').setAttribute("content", titleText);
    document.querySelector('meta[property="og:description"]').setAttribute("content", description);
    document.querySelector('meta[property="twitter:description"]').setAttribute("content", description);
  };
</script>

</html>