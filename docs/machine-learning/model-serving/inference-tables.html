

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en-US" > <![endif]-->
<!--[if gt IE 8]><!-->
<html class="no-js" lang="en-US"> <!--<![endif]-->

<head>
  <!-- cookie consent -->
  
    <!-- Combined Onetrust and Rudderstack Implementation Scripts -->
    <!-- Onetrust Initialization -->
    <script type="text/javascript" src="https://cdn.cookielaw.org/consent/92466579-1717-44d3-809d-a05fb02843ed-test/OtAutoBlock.js"></script>
    <script src="https://cdn.cookielaw.org/scripttemplates/otSDKStub.js" data-document-language="true" type="text/javascript" charset="UTF-8" data-domain-script="92466579-1717-44d3-809d-a05fb02843ed-test"></script>
    <link rel="stylesheet" id="db-onetrust-style" href="https://www.databricks.com/wp-content/uploads/db_onetrust.css" media="all" />
    <!-- Setting Rudderstack Write Key -->
    <script>window.rudderstackKey = "2SOR9fvSr5Fi6tN2ihPbVHnX1SZ" </script>
    <!-- Rudderstack Initialization + Onetrust Integration + Rudderstack Custom Events -->
    <script type="text/javascript" src="https://www.databricks.com/sites/default/files/rudderstack/v1/db-rudderstack-events.js"></script>

  <!-- cookie consent -->

  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta http-equiv="X-UA-Compatible" content="IE=9" />
  <meta content="Learn about inference tables for monitoring model serving endpoints, including what they log and feature limitations." name="description" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0">
  <meta property="og:image" content="https://www.databricks.com/wp-content/uploads/2020/04/og-databricks.png">
  <meta property="og:image:type" content="image/png">
  <meta property="og:title" content="Inference tables for monitoring and debugging models">
  <meta property="og:image:width" content="1200">
  <meta property="og:image:height" content="630">
  <meta property="og:type" content="website">
  <meta property="og:url" content="https://docs.databricks.com">
  <meta property="og:description" content="" id="og-description">
  <meta name="twitter:image" content="https://www.databricks.com/wp-content/uploads/2020/04/og-databricks.png">
  <meta name="twitter:site" content="@databricks">
  <meta name="twitter:creator" content="@databricks">
  <meta property="twitter:description" content="">
  
  <title>Inference tables for monitoring and debugging models &#124; Databricks on AWS</title>
  
  
  <link rel="canonical" href="https://docs.databricks.com/en/machine-learning/model-serving/inference-tables.html">
  <!-- Start hreflang tag -->
  <link rel="alternate" hreflang="en" href="https://docs.databricks.com/en/machine-learning/model-serving/inference-tables.html" />
<link rel="alternate" hreflang="x-default" href="https://docs.databricks.com/en/machine-learning/model-serving/inference-tables.html" />
  <!-- End hreflang tag -->
  
  
  <link rel="shortcut icon" href="../../_static/favicon.ico" />
  

  

  

  <!-- Google Tag Manager -->
  <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'https://www.googletagmanager.com/gtm.js?id='+i+dl;
j.setAttributeNode(d.createAttribute('data-ot-ignore'));
f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-T85FQ33');</script>
  <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'https://www.googletagmanager.com/gtm.js?id='+i+dl;
j.setAttributeNode(d.createAttribute('data-ot-ignore'));
f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-TWTKQQ');</script>
    
  <!-- End Google Tag Manager -->


  <!-- MaxMind / GEO IP -->
  <script src="//js.maxmind.com/js/apis/geoip2/v2.1/geoip2.js" type="text/javascript"></script>
  <!-- End MaxMind / GEO IP -->

  
  
  <link href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,600&display=swap" rel="stylesheet">
  <link rel="preload" href="../../_static/fonts/DMSans-Bold.ttf" as="font">
  <link rel="preload" href="../../_static/fonts/DMSans-Regular.ttf" as="font">
  <link rel="preload" href="../../_static/fonts/DMMono-Regular.ttf" as="font">
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/css/custom.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/css/cloud-provider-selector.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/css/translation-selector.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/css/searchunify/main.css" type="text/css" />

  
  <link rel="index" title="Index" href="../../genindex.html" />
  <link rel="search" title="Search" href="../../search.html" />
  <link rel="top" title="Databricks on AWS" href="../../index.html" /> 
</head>

<body class="wy-body-for-nav" role="document">

  <!-- Google Tag Manager (noscript) -->
  <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-T85FQ33"
height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
  <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-TWTKQQ"
    height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
  <!-- End Google Tag Manager (noscript) -->

  
  <nav class="wy-nav-top header su_header" role="navigation" aria-label="top navigation">
    
<nav class="wy-nav-top header su_header" role="navigation" aria-label="top navigation">
  <div class="container-logo">
    <ul class="mobile-menu-toggle">
        <li class="menu-toggle">
            <i data-toggle="wy-nav-top" class="wy-nav-top-menu-button db-icon db-icon-menu pull-left"></i>
            
            <a href="https://www.databricks.com/" class="wy-nav-top-logo"><img src="../../_static/small-scale-lockup-full-color-rgb.svg" width="137" height="21"
              alt="Databricks" /></a>   
               
              </li>
    </ul>
    <ul class="su_nav-menu">
      <li class="menu-toggle">
        <i data-toggle="wy-nav-top" class="wy-nav-top-menu-button db-icon db-icon-menu pull-left"></i>
        
          
        
        <a href="https://www.databricks.com/" class="wy-nav-top-logo"><img src="../../_static/small-scale-lockup-full-color-rgb.svg" width="137" height="21"
            alt="Databricks" /></a></li>
        <!-- 
<li><a href="https://help.databricks.com/s/">Help Center</a></li>
<li class="active"><a href="https://docs.databricks.com/en/">Documentation</a></li>
<li><a href="https://kb.databricks.com/">Knowledge Base</a></li>
 -->
    </ul>
  </div>
  <div class="su_nav-right">
    <ul class="su_link-mobile">
  <!-- Mobile header code can go here -->
</ul>
<ul class="right-try-list">
   
</ul>
  </div>
</nav>
  </nav>

  <div class="su_sub-header">
    <div class="container">
      <div class="su_sub-header-inner">
        <!-- <div class="su_subnav-menu-right">
  <div id="auto" style="width: 100%;">
    <div ng-controller="SearchautoController">
      <div bind-html-compile="autocompleteHtml">
        <form class="su__search-box-1" disabled="disabled">
          <input class="su__search-input" type="search" name="Search box" id="su__search-b" placeholder="Search Documentation" disabled="disabled"/>
          <button class="su__search-button" type="submit" class="button button-success" disabled="disabled">
            <svg width="24" height="24" viewBox="0 0 24 24">
              <path
                d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"
                fill="#333"></path>
            </svg>
          </button>
        </form>
      </div>
    </div>
  </div>
</div> -->
        <div class="search-lng-gap"></div>
        <div style="margin-left: 16px; margin-right: 16px;">
          <!-- <select name="lng selector" id="lng-selector">
    <option value="../../../en/machine-learning/model-serving/inference-tables.html" class="notranslate">English</option>
    <option value="../../../ja/machine-learning/model-serving/inference-tables.html" class="notranslate">日本語</option>
    <option value="../../../pt/machine-learning/model-serving/inference-tables.html" class="notranslate">Português (Brasil)</option>
</select> -->
        </div>
        <div class="cloud-selector-container">
          <!-- <select name="cloud provider selector" id="cloud-provider-selector">
    <option value="aws" selected class="notranslate">
        Amazon Web Services
    </option>
    <option value="azure"  class="notranslate">
        Microsoft Azure
    </option>
    <option value="gcp"  class="notranslate">
        Google Cloud Platform
    </option>
</select> -->
        </div>
      </div>
    </div>
  </div>
  <page class="js-page-container">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side su_nav-side">
<div class="wy-side-scroll">
  <div class="wy-side-nav-search">
    

    

    

    
  </div>

  <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
    
      <a href="../../index.html" class="main-navigation-home">Databricks on AWS</a>
    

    
      

      
        <p class="caption"><span class="caption-text">Load &amp; manage data</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../rag-temp/index.html">RAG Studio</a></li>
</ul>

      
    
  </div>

  <div role="contentinfo">
    
  <p class="build_info notranslate"data-last-edit="December 23, 2023">
    Updated Jan 11, 2024
  </p>
<script>
  window.addEventListener('DOMContentLoaded',function(){
    var h1=document.querySelector('h1');
    var bi=document.querySelector('[data-last-edit]');
    if(h1 && bi){
      var ver = document.createElement('p');
      ver.className = 'version_info';
      ver.textContent = bi.getAttribute('data-last-edit');
      h1.parentElement.insertBefore(ver, h1.nextElementSibling);
    }
  });
</script>

    <p>
      
        <a id='feedbacklink' href="mailto:doc-feedback@databricks.com?subject=Documentation Feedback">Send us feedback</a>
      
    </p>
  </div>
</div>
</nav>
    
    
<main class="wy-grid-for-nav su_nav-grid">
  <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
    <div class="wy-nav-content su__nav_content">
      <div class="rst-content">
        





<div role="navigation" aria-label="breadcrumbs navigation" class="wy-breadcrumbs-wrapper">
  <ul class="wy-breadcrumbs">
    <li><a href="../../index.html">Documentation</a> <span class="db-icon db-icon-chevron-right"></span></li>
    
    
      <li>Inference tables for monitoring and debugging models</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>
</div>
        
        <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
          <div itemprop="articleBody">
            
    
  <div class="section" id="inference-tables-for-monitoring-and-debugging-models">
<h1>Inference tables for monitoring and debugging models<a class="headerlink" href="#inference-tables-for-monitoring-and-debugging-models" title="Permalink to this headline"> </a></h1>
<div class="preview admonition">
<p class="admonition-title">Preview</p>
<p>This feature is in <a class="reference internal" href="../../release-notes/release-types.html"><span class="doc">Public Preview</span></a>.</p>
</div>
<p>This article describes inference tables for monitoring served models. The following diagram shows a typical workflow with inference tables. The inference table automatically captures incoming requests and outgoing responses for a model serving endpoint and logs them as a Unity Catalog Delta table. You can use the data in this table to monitor, debug, and improve ML models.</p>
<div class="figure align-default">
<img alt="Inference tables workflow" src="../../_images/inference-tables-diagram.png" />
</div>
<div class="section" id="what-are-inference-tables">
<h2>What are inference tables?<a class="headerlink" href="#what-are-inference-tables" title="Permalink to this headline"> </a></h2>
<p>Monitoring the performance of models in production workflows is an important aspect of the AI and ML model lifecycle. Inference Tables simplify monitoring and diagnostics for models by continuously logging serving request inputs and responses (predictions) from Databricks Model Serving endpoints and saving them into a Delta table in Unity Catalog. You can then use all of the capabilities of the Databricks platform, such as DBSQL queries, notebooks, and Lakehouse Monitoring to monitor, debug, and optimize your models.</p>
<p>You can enable inference tables on any existing or newly created model serving endpoint, and requests to that endpoint are then automatically logged to a table in UC.</p>
<p>Some common applications for inference tables are the following:</p>
<ul class="simple">
<li><p>Monitor data and model quality. You can continuously monitor your model performance and data drift using Lakehouse Monitoring. Lakehouse Monitoring automatically generates data and model quality dashboards that you can share with stakeholders. Additionally, you can enable alerts to know when you need to retrain your model based on shifts in incoming data or reductions in model performance.</p></li>
<li><p>Debug production issues. Inference Tables log data like HTTP status codes, model execution times, and request and response JSON code. You can use this performance data for debugging purposes. You can also use the historical data in Inference Tables to compare model performance on historical requests.</p></li>
<li><p>Create a training corpus. By joining Inference Tables with ground truth labels, you can create a training corpus that you can use to re-train or fine-tune and improve your model. Using Databricks Workflows, you can set up a continuous feedback loop and automate re-training.</p></li>
</ul>
</div>
<div class="section" id="requirements">
<span id="requirement"></span><h2>Requirements<a class="headerlink" href="#requirements" title="Permalink to this headline"> </a></h2>
<ul class="simple">
<li><p>Your workspace must have Unity Catalog enabled.</p></li>
<li><p>To enable inference tables on an endpoint both the creator of the endpoint and the modifier need the following permissions:</p>
<ul>
<li><p><strong>Can Manage</strong> permission on the endpoint.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">USE</span> <span class="pre">CATALOG</span></code> permissions on the specified catalog.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">USE</span> <span class="pre">SCHEMA</span></code> permissions on the specified schema.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">CREATE</span> <span class="pre">TABLE</span></code> permissions in the schema.</p></li>
</ul>
</li>
</ul>
</div>
<div class="section" id="enable-and-disable-inference-tables">
<h2>Enable and disable inference tables<a class="headerlink" href="#enable-and-disable-inference-tables" title="Permalink to this headline"> </a></h2>
<p>This section shows you how to enable or disable inference tables using the Databricks UI. You can also use the API; see <a class="reference internal" href="enable-model-serving-inference-tables.html"><span class="doc">Enable inference tables on model serving endpoints using the API</span></a> for instructions.</p>
<p>The owner of the inference tables is the user who created the endpoint. All access control lists (ACLs) on the table follow the standard Unity Catalog permissions and can be modified by the table owner.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>The inference table could become corrupted if you do any of the following:</p>
<ul class="simple">
<li><p>Change the table schema.</p></li>
<li><p>Change the table name.</p></li>
<li><p>Delete the table.</p></li>
<li><p>Lose permissions to the Unity Catalog catalog or schema.</p></li>
</ul>
<p>In this case, the <code class="docutils literal notranslate"><span class="pre">auto_capture_config</span></code> of the endpoint status shows a <code class="docutils literal notranslate"><span class="pre">FAILED</span></code> state for the payload table. If this happens, you must create a new endpoint to continue using inference tables.</p>
</div>
<p>To enable inference tables during endpoint creation use the following steps:</p>
<ol class="arabic">
<li><p>Click <strong>Serving</strong> in the Databricks Machine Learning UI.</p></li>
<li><p>Click <strong>Create serving endpoint</strong>.</p></li>
<li><p>On the endpoint creation page, click the right-pointing arrow next to <strong>Inference tables (optional)</strong>.</p></li>
<li><p>Select <strong>Enable inference tables</strong>.</p></li>
<li><p>In the drop-down menus, select the desired catalog and schema where you would like the table to be located.</p>
<div class="figure align-default">
<img alt="catalog and schema for inference table" src="../../_images/inference-table-location.png" />
</div>
</li>
<li><p>The default table name is <code class="docutils literal notranslate"><span class="pre">&lt;catalog&gt;.&lt;schema&gt;.&lt;endpoint-name&gt;_payload</span></code>. If desired, you can enter a custom table prefix.</p></li>
<li><p>Click <strong>Create serving endpoint</strong>.</p></li>
</ol>
<p>You can also enable inference tables on an existing endpoint. To edit an existing endpoint configuration do the following:</p>
<ol class="arabic simple">
<li><p>Navigate to your endpoint page.</p></li>
<li><p>Click <strong>Edit configuration</strong>.</p></li>
<li><p>Follow the previous instructions, starting with step 3.</p></li>
<li><p>When you are done, click <strong>Update serving endpoint</strong>.</p></li>
</ol>
<p>Follow these instructions to disable inference tables:</p>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>When you disable inference tables on an endpoint, you cannot re-enable them. To continue using inference tables, you must create a new endpoint and enable inference tables on it.</p>
</div>
<ol class="arabic simple">
<li><p>Navigate to your endpoint page.</p></li>
<li><p>Click <strong>Edit configuration</strong>.</p></li>
<li><p>Click <strong>Enable inference table</strong> to remove the checkmark.</p></li>
<li><p>Once you are satisfied with the endpoint specifications, click <strong>Update serving endpoint</strong>.</p></li>
</ol>
<div class="toctree-wrapper compound">
</div>
</div>
<div class="section" id="workflow-monitor-model-performance-using-inference-tables">
<span id="model-monitoring"></span><h2>Workflow: Monitor model performance using inference tables<a class="headerlink" href="#workflow-monitor-model-performance-using-inference-tables" title="Permalink to this headline"> </a></h2>
<p>To monitor model performance using inference tables, follow these steps:</p>
<ol class="arabic simple">
<li><p>Enable <a class="reference internal" href="enable-model-serving-inference-tables.html"><span class="doc">inference tables</span></a> on your endpoint, either during endpoint creation or by updating it afterwards.</p></li>
<li><p>Schedule a workflow to process the JSON payloads in the inference table by unpacking them according to the schema of the endpoint.</p></li>
<li><p>(Optional) Join the unpacked requests and responses with ground-truth labels to allow model quality metrics to be calculated.</p></li>
<li><p>Create a monitor over the resulting Delta table and refresh the metrics.</p></li>
</ol>
<p>The starter notebooks implement this workflow.</p>
</div>
<div class="section" id="starter-notebook-for-monitoring-an-inference-table">
<h2>Starter notebook for monitoring an inference table<a class="headerlink" href="#starter-notebook-for-monitoring-an-inference-table" title="Permalink to this headline"> </a></h2>
<p>The following notebook implements the steps outlined above to unpack requests from a Lakehouse Monitoring inference table. The notebook can be run on demand, or on a recurring schedule using <a class="reference internal" href="../../notebooks/schedule-notebook-jobs.html"><span class="doc">Databricks Workflows</span></a>.</p>
<div class="embedded-notebook-section section" id="inference-table-lakehouse-monitoring-starter-notebook">
<span id="inference-table-monitor"></span><h3>Inference table Lakehouse Monitoring starter notebook<a class="headerlink" href="#inference-table-lakehouse-monitoring-starter-notebook" title="Permalink to this headline"> </a></h3>
<div class="embedded-notebook">
    <p class="notebook-import-help">
        <a href="/_extras/notebooks/source/monitoring/inference-table-monitor.html"            target="_blank">Open notebook in new tab</a>
        <button class="embedded-notebook-copy-to-clipboard"                copy-path-to-clipboard-on-click="/_extras/notebooks/source/monitoring/inference-table-monitor.html">            <img src="/_static/clippy.svg"                alt="Copy to clipboard">            Copy link for import        </button>    <div class="embedded-notebook-container">        <div class="loading-spinner"></div>        <iframe data-src="/_extras/notebooks/source/monitoring/inference-table-monitor.html"            id="ced53a22290c3639551b1a8bc6108737fbbbd972c18dcd2cfd498dfc836f2812" height="1000px" width="100%"            style="overflow-y:hidden;" scrolling="no"></iframe>    </div></div></div>
</div>
<div class="section" id="starter-notebook-for-monitoring-text-quality-from-endpoints-serving-llms">
<h2>Starter notebook for monitoring text quality from endpoints serving LLMs<a class="headerlink" href="#starter-notebook-for-monitoring-text-quality-from-endpoints-serving-llms" title="Permalink to this headline"> </a></h2>
<p>The following notebook unpacks requests from an inference table, computes a set of text evaluation metrics (such as readability and toxicity), and enables monitoring over these metrics. The notebook can be run on demand, or on a recurring schedule using <a class="reference internal" href="../../notebooks/schedule-notebook-jobs.html"><span class="doc">Databricks Workflows</span></a>.</p>
<div class="embedded-notebook-section section" id="llm-inference-table-lakehouse-monitoring-starter-notebook">
<span id="llm-inference-table-monitor"></span><h3>LLM inference table Lakehouse Monitoring starter notebook<a class="headerlink" href="#llm-inference-table-lakehouse-monitoring-starter-notebook" title="Permalink to this headline"> </a></h3>
<div class="embedded-notebook">
    <p class="notebook-import-help">
        <a href="/_extras/notebooks/source/monitoring/llm-inference-table-monitor.html"            target="_blank">Open notebook in new tab</a>
        <button class="embedded-notebook-copy-to-clipboard"                copy-path-to-clipboard-on-click="/_extras/notebooks/source/monitoring/llm-inference-table-monitor.html">            <img src="/_static/clippy.svg"                alt="Copy to clipboard">            Copy link for import        </button>    <div class="embedded-notebook-container">        <div class="loading-spinner"></div>        <iframe data-src="/_extras/notebooks/source/monitoring/llm-inference-table-monitor.html"            id="f88e2530ab5cd6ce7e164fc86cbe857ce7229b210bc284512dc7851599c0c50b" height="1000px" width="100%"            style="overflow-y:hidden;" scrolling="no"></iframe>    </div></div></div>
</div>
<div class="section" id="query-and-analyze-results-in-the-inference-table">
<h2>Query and analyze results in the inference table<a class="headerlink" href="#query-and-analyze-results-in-the-inference-table" title="Permalink to this headline"> </a></h2>
<p>After your served models are ready, all requests made to your models are logged automatically to the inference table, along with the responses. You can view the table in the UI, query the table from DBSQL or a notebook, or query the table using the REST API.</p>
<p><strong>To view the table in the UI:</strong>
On the endpoint page, click the name of the inference table to open the table in Catalog Explorer.</p>
<div class="figure align-default">
<img alt="link to inference table name on endpoint page" src="../../_images/inference-table-name.png" />
</div>
<p><strong>To query the table from DBSQL or a Databricks notebook:</strong>
You can run code similar to the following to query the inference table.</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="o">&lt;</span><span class="k">catalog</span><span class="o">&gt;</span><span class="p">.</span><span class="o">&lt;</span><span class="k">schema</span><span class="o">&gt;</span><span class="p">.</span><span class="o">&lt;</span><span class="n">payload_table</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>If you enabled inference tables using the UI, <code class="docutils literal notranslate"><span class="pre">payload_table</span></code> is the table name you assigned when you created the endpoint. If you enabled inference tables using the API, <code class="docutils literal notranslate"><span class="pre">payload_table</span></code> is reported in the <code class="docutils literal notranslate"><span class="pre">state</span></code> section of the <code class="docutils literal notranslate"><span class="pre">auto_capture_config</span></code> response. For an example, see <a class="reference internal" href="enable-model-serving-inference-tables.html"><span class="doc">Enable inference tables on model serving endpoints using the API</span></a>.</p>
<div class="section" id="performance-note">
<h3>Performance note<a class="headerlink" href="#performance-note" title="Permalink to this headline"> </a></h3>
<p>After invoking the endpoint, you can see the invocation logged to your inference table within 10 minutes after sending a scoring request. In addition, Databricks guarantees log delivery happens at least once, so it is possible, though unlikely, that duplicate logs are sent.</p>
</div>
</div>
<div class="section" id="unity-catalog-inference-table-schema">
<span id="uc-inference-table-schema"></span><h2>Unity Catalog inference table schema<a class="headerlink" href="#unity-catalog-inference-table-schema" title="Permalink to this headline"> </a></h2>
<p>Each request and response that gets logged to an inference table is written to a Delta table  with the following schema:</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If you invoke the endpoint with a batch of inputs, the whole batch is logged as one row.</p>
</div>
<table class="docutils align-default">
<colgroup>
<col style="width: 6%" />
<col style="width: 89%" />
<col style="width: 5%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Column name</p></th>
<th class="head"><p>Description</p></th>
<th class="head"><p>Type</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">databricks_request_id</span></code></p></td>
<td><p> A Databricks generated request identifier attached to all model serving requests.</p></td>
<td><p> STRING</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">client_request_id</span></code></p></td>
<td><p> An optional client generated request identifier that can be specified in the model serving request body. See <a class="reference internal" href="#client-id"><span class="std std-ref">Specify `client_request_id`</span></a> for more information. </p></td>
<td><p> STRING</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">date</span></code></p></td>
<td><p> The UTC date on which the model serving request was received.</p></td>
<td><p> DATE</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">timestamp_ms</span></code></p></td>
<td><p> The timestamp in epoch milliseconds on when the model serving request was received.</p></td>
<td><p> LONG</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">status_code</span></code></p></td>
<td><p> The HTTP status code that was returned from the model.</p></td>
<td><p> INT</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">sampling_fraction</span></code></p></td>
<td><p> The sampling fraction used in the event that the request was down-sampled. This value is between 0 and 1, where 1 represents that 100% of incoming requests were included.</p></td>
<td><p> DOUBLE</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">execution_time_ms</span></code></p></td>
<td><p> The execution time in milliseconds for which the model performed inference. This does not include overhead network latencies and only represents the time it took for the model to generate predictions.</p></td>
<td><p> LONG</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">request</span></code></p></td>
<td><p> The raw request JSON body that was sent to the model serving endpoint.</p></td>
<td><p> STRING</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">response</span></code></p></td>
<td><p> The raw response JSON body that was returned by the model serving endpoint.</p></td>
<td><p> STRING</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">request_metadata</span></code></p></td>
<td><p> A map of metadata related to the model serving endpoint associated with the request. This map contains the endpoint name, model name, and model version used for your endpoint.</p></td>
<td><p> MAP&lt;STRING, STRING&gt;</p></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="specify-client_request_id">
<span id="client-id"></span><h2>Specify client_request_id<a class="headerlink" href="#specify-client_request_id" title="Permalink to this headline"> </a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">client_request_id</span></code> field is an optional value the user can provide in the model serving request body. This allows the user to provide their own identifier for a request that shows up in the final inference table under the <code class="docutils literal notranslate"><span class="pre">client_request_id</span></code> and can be used for joining your request with other tables that use the <code class="docutils literal notranslate"><span class="pre">client_request_id</span></code>, like ground truth label joining. To specify a <code class="docutils literal notranslate"><span class="pre">client_request_id</span></code>, include it at as a top level key of the request payload. If no <code class="docutils literal notranslate"><span class="pre">client_request_id</span></code> is specified, the value appears as null in the row corresponding to the request.</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;client_request_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;&lt;user-provided-id&gt;&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;dataframe_records&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;sepal length (cm)&quot;</span><span class="p">:</span><span class="w"> </span><span class="mf">5.1</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;sepal width (cm)&quot;</span><span class="p">:</span><span class="w"> </span><span class="mf">3.5</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;petal length (cm)&quot;</span><span class="p">:</span><span class="w"> </span><span class="mf">1.4</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;petal width (cm)&quot;</span><span class="p">:</span><span class="w"> </span><span class="mf">0.2</span>
<span class="w">    </span><span class="p">},</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;sepal length (cm)&quot;</span><span class="p">:</span><span class="w"> </span><span class="mf">4.9</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;sepal width (cm)&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;petal length (cm)&quot;</span><span class="p">:</span><span class="w"> </span><span class="mf">1.4</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;petal width (cm)&quot;</span><span class="p">:</span><span class="w"> </span><span class="mf">0.2</span>
<span class="w">    </span><span class="p">},</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;sepal length (cm)&quot;</span><span class="p">:</span><span class="w"> </span><span class="mf">4.7</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;sepal width (cm)&quot;</span><span class="p">:</span><span class="w"> </span><span class="mf">3.2</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;petal length (cm)&quot;</span><span class="p">:</span><span class="w"> </span><span class="mf">1.3</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;petal width (cm)&quot;</span><span class="p">:</span><span class="w"> </span><span class="mf">0.2</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">client_request_id</span></code> can later be used for ground truth label joins if there are other tables that have labels associated with the <code class="docutils literal notranslate"><span class="pre">client_request_id</span></code>.</p>
</div>
<div class="section" id="limitations">
<h2>Limitations<a class="headerlink" href="#limitations" title="Permalink to this headline"> </a></h2>
<ul class="simple">
<li><p>Customer managed keys are not supported.</p></li>
<li><p>Inference Tables only work with CPU endpoints. If you are enrolled in the Model Serving GPU serving public preview, reach out to your Databricks account team for possible custom solutions.</p></li>
<li><p>AWS PrivateLink is not supported by default. Reach out to your Databricks account team to enable it.</p></li>
<li><p>When inference tables is enabled, the limit for the total max concurrency across all served models in a single endpoint is 128. Reach out to your Databricks account team to request an increase to this limit.</p></li>
<li><p>Inference tables do not support endpoints that host <a class="reference internal" href="../foundation-models/index.html"><span class="doc">foundation models</span></a>. </p></li>
</ul>
</div>
</div>


    
          </div>
        </div>
        <div  class="suapp-rating">
  <div id="suPageRateApp">
     <su-app></su-app>
   </div> 
 </div>
<hr> 
<footer>
  <div role="contentinfo">
      <p class="copyright">
          &copy; Databricks 2023. All rights reserved. Apache, Apache Spark, Spark, and the Spark logo are trademarks of the <a href="http://www.apache.org/">Apache Software Foundation</a>.
      </p>
      <p> 
        
          <a id='feedbacklink' href="mailto:doc-feedback@databricks.com?subject=Documentation Feedback">Send us feedback</a>
        
     | <a href="https://databricks.com/privacy-policy">Privacy Policy</a> | <a href="https://databricks.com/terms-of-use">Terms of Use</a></p>

  </div> 

</footer>
      </div>
    </div>
  </section>
</main>

  </page>
  
  <script type="text/javascript">
    var DOCUMENTATION_OPTIONS = {
      URL_ROOT: '../../',
      VERSION: '1.0',
      COLLAPSE_INDEX: false,
      FILE_SUFFIX: '.html',
      HAS_SOURCE: 'false'
    };
  </script>
  <script type="text/javascript" src="../../_static/jquery.js"></script>
  <script type="text/javascript" src="../../_static/underscore.js"></script>
  <script type="text/javascript" src="../../_static/doctools.js"></script>
  <script type="text/javascript" src="../../_static/language_data.js"></script>
  

  <script type="text/javascript" src="../../_static/js/clipboard.min.js"></script>
  <script type="text/javascript" src="../../_static/js/jquery.waypoints.min.js"></script>

  <!-- Select2 (https://select2.org/) -->
  <link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />
  <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
  <!-- End Select2 -->

  
  
  <script type="text/javascript" src="../../_static/js/localized.js"></script>
  <script type="text/javascript" src="../../_static/js/custom.js"></script>
  

  
  
  <script type="text/javascript">
    jQuery(function () {
      SphinxRtdTheme.StickyNav.enable();
    });

  </script>
  
 



  <script>
  window.__searchunifyLoaderConfig = JSON.parse('{"clients": {"en": "02c2e804-27e9-11ee-aefb-0242ac120011", "ja": "6a42c3f2-2820-11ee-aefb-0242ac120011", "pt": "6a86badd-2821-11ee-aefb-0242ac120011"}}')
</script>
<script type="text/javascript" src="../../_static/js/search-loader.js"></script>
</body>
<script type='text/javascript'>
  window.onload = function () {
    var description = document.querySelector('meta[name="description"]').getAttribute("content");
    let titleText = document.querySelector('h1').textContent;
    document.querySelector('meta[property="og:title"]').setAttribute("content", titleText);
    document.querySelector('meta[property="og:description"]').setAttribute("content", description);
    document.querySelector('meta[property="twitter:description"]').setAttribute("content", description);
  };
</script>

</html>