

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en-US" > <![endif]-->
<!--[if gt IE 8]><!-->
<html class="no-js" lang="en-US"> <!--<![endif]-->

<head>
  <!-- cookie consent -->
  
    <!-- Combined Onetrust and Rudderstack Implementation Scripts -->
    <!-- Onetrust Initialization -->
    <script type="text/javascript" src="https://cdn.cookielaw.org/consent/92466579-1717-44d3-809d-a05fb02843ed-test/OtAutoBlock.js"></script>
    <script src="https://cdn.cookielaw.org/scripttemplates/otSDKStub.js" data-document-language="true" type="text/javascript" charset="UTF-8" data-domain-script="92466579-1717-44d3-809d-a05fb02843ed-test"></script>
    <link rel="stylesheet" id="db-onetrust-style" href="https://www.databricks.com/wp-content/uploads/db_onetrust.css" media="all" />
    <!-- Setting Rudderstack Write Key -->
    <script>window.rudderstackKey = "2SOR9fvSr5Fi6tN2ihPbVHnX1SZ" </script>
    <!-- Rudderstack Initialization + Onetrust Integration + Rudderstack Custom Events -->
    <script type="text/javascript" src="https://www.databricks.com/sites/default/files/rudderstack/v1/db-rudderstack-events.js"></script>

  <!-- cookie consent -->

  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta http-equiv="X-UA-Compatible" content="IE=9" />
  <meta content="Learn how to set up metric collection for your Model Serving endpoints with the metrics export API and common monitoring systems, Prometheus and Datadog." name="description" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0">
  <meta property="og:image" content="https://www.databricks.com/wp-content/uploads/2020/04/og-databricks.png">
  <meta property="og:image:type" content="image/png">
  <meta property="og:title" content="Track and export serving endpoint health metrics to Prometheus and Datadog">
  <meta property="og:image:width" content="1200">
  <meta property="og:image:height" content="630">
  <meta property="og:type" content="website">
  <meta property="og:url" content="https://docs.databricks.com">
  <meta property="og:description" content="" id="og-description">
  <meta name="twitter:image" content="https://www.databricks.com/wp-content/uploads/2020/04/og-databricks.png">
  <meta name="twitter:site" content="@databricks">
  <meta name="twitter:creator" content="@databricks">
  <meta property="twitter:description" content="">
  
  <title>Track and export serving endpoint health metrics to Prometheus and Datadog &#124; Databricks on AWS</title>
  
  
  <link rel="canonical" href="https://docs.databricks.com/en/machine-learning/model-serving/metrics-export-serving-endpoint.html">
  <!-- Start hreflang tag -->
  <link rel="alternate" hreflang="en" href="https://docs.databricks.com/en/machine-learning/model-serving/metrics-export-serving-endpoint.html" />
<link rel="alternate" hreflang="x-default" href="https://docs.databricks.com/en/machine-learning/model-serving/metrics-export-serving-endpoint.html" />
  <!-- End hreflang tag -->
  
  
  <link rel="shortcut icon" href="../../_static/favicon.ico" />
  

  

  

  <!-- Google Tag Manager -->
  <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'https://www.googletagmanager.com/gtm.js?id='+i+dl;
j.setAttributeNode(d.createAttribute('data-ot-ignore'));
f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-T85FQ33');</script>
  <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'https://www.googletagmanager.com/gtm.js?id='+i+dl;
j.setAttributeNode(d.createAttribute('data-ot-ignore'));
f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-TWTKQQ');</script>
    
  <!-- End Google Tag Manager -->


  <!-- MaxMind / GEO IP -->
  <script src="//js.maxmind.com/js/apis/geoip2/v2.1/geoip2.js" type="text/javascript"></script>
  <!-- End MaxMind / GEO IP -->

  
  
  <link href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,600&display=swap" rel="stylesheet">
  <link rel="preload" href="../../_static/fonts/DMSans-Bold.ttf" as="font">
  <link rel="preload" href="../../_static/fonts/DMSans-Regular.ttf" as="font">
  <link rel="preload" href="../../_static/fonts/DMMono-Regular.ttf" as="font">
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/css/custom.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/css/cloud-provider-selector.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/css/translation-selector.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/css/searchunify/main.css" type="text/css" />

  
  <link rel="index" title="Index" href="../../genindex.html" />
  <link rel="search" title="Search" href="../../search.html" />
  <link rel="top" title="Databricks on AWS" href="../../index.html" /> 
</head>

<body class="wy-body-for-nav" role="document">

  <!-- Google Tag Manager (noscript) -->
  <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-T85FQ33"
height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
  <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-TWTKQQ"
    height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
  <!-- End Google Tag Manager (noscript) -->

  
  <nav class="wy-nav-top header su_header" role="navigation" aria-label="top navigation">
    
<nav class="wy-nav-top header su_header" role="navigation" aria-label="top navigation">
  <div class="container-logo">
    <ul class="mobile-menu-toggle">
        <li class="menu-toggle">
            <i data-toggle="wy-nav-top" class="wy-nav-top-menu-button db-icon db-icon-menu pull-left"></i>
            
            <a href="https://www.databricks.com/" class="wy-nav-top-logo"><img src="../../_static/small-scale-lockup-full-color-rgb.svg" width="137" height="21"
              alt="Databricks" /></a>   
               
              </li>
    </ul>
    <ul class="su_nav-menu">
      <li class="menu-toggle">
        <i data-toggle="wy-nav-top" class="wy-nav-top-menu-button db-icon db-icon-menu pull-left"></i>
        
          
        
        <a href="https://www.databricks.com/" class="wy-nav-top-logo"><img src="../../_static/small-scale-lockup-full-color-rgb.svg" width="137" height="21"
            alt="Databricks" /></a></li>
        <!-- 
<li><a href="https://help.databricks.com/s/">Help Center</a></li>
<li class="active"><a href="https://docs.databricks.com/en/">Documentation</a></li>
<li><a href="https://kb.databricks.com/">Knowledge Base</a></li>
 -->
    </ul>
  </div>
  <div class="su_nav-right">
    <ul class="su_link-mobile">
  <!-- Mobile header code can go here -->
</ul>
<ul class="right-try-list">
   
</ul>
  </div>
</nav>
  </nav>

  <div class="su_sub-header">
    <div class="container">
      <div class="su_sub-header-inner">
        <!-- <div class="su_subnav-menu-right">
  <div id="auto" style="width: 100%;">
    <div ng-controller="SearchautoController">
      <div bind-html-compile="autocompleteHtml">
        <form class="su__search-box-1" disabled="disabled">
          <input class="su__search-input" type="search" name="Search box" id="su__search-b" placeholder="Search Documentation" disabled="disabled"/>
          <button class="su__search-button" type="submit" class="button button-success" disabled="disabled">
            <svg width="24" height="24" viewBox="0 0 24 24">
              <path
                d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"
                fill="#333"></path>
            </svg>
          </button>
        </form>
      </div>
    </div>
  </div>
</div> -->
        <div class="search-lng-gap"></div>
        <div style="margin-left: 16px; margin-right: 16px;">
          <!-- <select name="lng selector" id="lng-selector">
    <option value="../../../en/machine-learning/model-serving/metrics-export-serving-endpoint.html" class="notranslate">English</option>
    <option value="../../../ja/machine-learning/model-serving/metrics-export-serving-endpoint.html" class="notranslate">日本語</option>
    <option value="../../../pt/machine-learning/model-serving/metrics-export-serving-endpoint.html" class="notranslate">Português (Brasil)</option>
</select> -->
        </div>
        <div class="cloud-selector-container">
          <!-- <select name="cloud provider selector" id="cloud-provider-selector">
    <option value="aws" selected class="notranslate">
        Amazon Web Services
    </option>
    <option value="azure"  class="notranslate">
        Microsoft Azure
    </option>
    <option value="gcp"  class="notranslate">
        Google Cloud Platform
    </option>
</select> -->
        </div>
      </div>
    </div>
  </div>
  <page class="js-page-container">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side su_nav-side">
<div class="wy-side-scroll">
  <div class="wy-side-nav-search">
    

    

    

    
  </div>

  <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
    
      <a href="../../index.html" class="main-navigation-home">Databricks on AWS</a>
    

    
      

      
        <p class="caption"><span class="caption-text">Load &amp; manage data</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../rag-temp/index.html">RAG Studio</a></li>
</ul>

      
    
  </div>

  <div role="contentinfo">
    
  <p class="build_info notranslate"data-last-edit="December 23, 2023">
    Updated Jan 11, 2024
  </p>
<script>
  window.addEventListener('DOMContentLoaded',function(){
    var h1=document.querySelector('h1');
    var bi=document.querySelector('[data-last-edit]');
    if(h1 && bi){
      var ver = document.createElement('p');
      ver.className = 'version_info';
      ver.textContent = bi.getAttribute('data-last-edit');
      h1.parentElement.insertBefore(ver, h1.nextElementSibling);
    }
  });
</script>

    <p>
      
        <a id='feedbacklink' href="mailto:doc-feedback@databricks.com?subject=Documentation Feedback">Send us feedback</a>
      
    </p>
  </div>
</div>
</nav>
    
    
<main class="wy-grid-for-nav su_nav-grid">
  <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
    <div class="wy-nav-content su__nav_content">
      <div class="rst-content">
        





<div role="navigation" aria-label="breadcrumbs navigation" class="wy-breadcrumbs-wrapper">
  <ul class="wy-breadcrumbs">
    <li><a href="../../index.html">Documentation</a> <span class="db-icon db-icon-chevron-right"></span></li>
    
    
      <li>Track and export serving endpoint health metrics to Prometheus and Datadog</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>
</div>
        
        <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
          <div itemprop="articleBody">
            
    
  <div class="section" id="track-and-export-serving-endpoint-health-metrics-to-prometheus-and-datadog">
<h1>Track and export serving endpoint health metrics to Prometheus and Datadog<a class="headerlink" href="#track-and-export-serving-endpoint-health-metrics-to-prometheus-and-datadog" title="Permalink to this headline"> </a></h1>
<p>This article provides an overview of serving endpoint health metrics and shows how to use the metrics export API to export endpoint metrics to <a class="reference external" href="https://prometheus.io/docs/introduction/overview/">Prometheus</a> and <a class="reference external" href="https://docs.datadoghq.com/api/latest/">Datadog</a>.</p>
<p>Endpoint health metrics measures infrastructure and metrics such as latency, request rate, error rate, CPU usage, memory usage, etc. This tells you how your serving infrastructure is behaving.</p>
<div class="section" id="requirements">
<h2>Requirements<a class="headerlink" href="#requirements" title="Permalink to this headline"> </a></h2>
<ul>
<li><p>Read access to the desired endpoint and personal access token (PAT) which can be generated in <strong>User Settings</strong> in the Databricks Machine Learning UI to access the endpoint.</p></li>
<li><p>An existing <a class="reference internal" href="index.html"><span class="doc">model serving</span></a> endpoint. You can validate this by checking the endpoint health with the following:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>curl<span class="w"> </span>-n<span class="w"> </span>-X<span class="w"> </span>GET<span class="w"> </span>-H<span class="w"> </span><span class="s2">&quot;Authorization: Bearer [PAT]&quot;</span><span class="w"> </span>https://<span class="o">[</span>DATABRICKS_HOST<span class="o">]</span>/api/2.0/serving-endpoints/<span class="o">[</span>ENDPOINT_NAME<span class="o">]</span>
</pre></div>
</div>
</li>
<li><p>Validate the export metrics API:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>curl<span class="w"> </span>-n<span class="w"> </span>-X<span class="w"> </span>GET<span class="w"> </span>-H<span class="w"> </span><span class="s2">&quot;Authorization: Bearer [PAT]&quot;</span><span class="w"> </span>https://<span class="o">[</span>DATABRICKS_HOST<span class="o">]</span>/api/2.0/serving-endpoints/<span class="o">[</span>ENDPOINT_NAME<span class="o">]</span>/metrics
</pre></div>
</div>
</li>
</ul>
</div>
<div class="section" id="serving-endpoint-metrics-definitions">
<h2>Serving endpoint metrics definitions<a class="headerlink" href="#serving-endpoint-metrics-definitions" title="Permalink to this headline"> </a></h2>
<table class="docutils align-default">
<colgroup>
<col style="width: 8%" />
<col style="width: 92%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Metric</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p> <strong>Latency (ms)</strong></p></td>
<td><p> Captures the median (P50) and 99th percentile (P99) round-trip latency times within Databricks. This does not include additional Databricks-related latencies like authentication and rate limiting</p></td>
</tr>
<tr class="row-odd"><td><p> <strong>Request rate (per second)</strong></p></td>
<td><p> Measures the number of requests processed per second. This rate is calculated by totaling the number of requests within a minute and then dividing by 60 (the number of seconds in a minute).</p></td>
</tr>
<tr class="row-even"><td><p> <strong>Request error rate (per second)</strong></p></td>
<td><p> Tracks the rate of 4xx and 5xx HTTP error responses per second. Similar to the request rate, it’s computed by aggregating the total number of unsuccessful requests within a minute and dividing by 60.</p></td>
</tr>
<tr class="row-odd"><td><p> <strong>CPU usage (%)</strong></p></td>
<td><p> Shows the average CPU utilization percentage across all server replicas. In the context of Databricks infrastructure, a replica refers to virtual machine nodes. Depending on your configured concurrency settings, Databricks creates multiple replicas to manage model traffic efficiently.</p></td>
</tr>
<tr class="row-even"><td><p> <strong>Memory usage (%)</strong></p></td>
<td><p> Shows the average memory utilization percentage across all server replicas.</p></td>
</tr>
<tr class="row-odd"><td><p> <strong>Provisioned concurrency</strong></p></td>
<td><p> Provisioned concurrency is the maximum number of parallel requests that the system can handle. Provisioned concurrency dynamically adjusts within the minimum and maximum limits of the compute scale-out range, varying in response to incoming traffic.</p></td>
</tr>
<tr class="row-even"><td><p> <strong>GPU usage (%)</strong></p></td>
<td><p> Represents the average GPU utilization, as reported by the <a class="reference external" href="https://developer.nvidia.com/dcgm">NVIDIA DCGM</a> exporter. If the instance type has multiple GPUs, each is tracked separately (such as, <code class="docutils literal notranslate"><span class="pre">gpu0</span></code>, <code class="docutils literal notranslate"><span class="pre">gpu1</span></code>, …, <code class="docutils literal notranslate"><span class="pre">gpuN</span></code>). The utilization is averaged across all server replicas and sampled once a minute. Note: The infrequent sampling means this metric is most accurate under a constant load.</p></td>
</tr>
<tr class="row-odd"><td><p> <strong>GPU memory usage (%)</strong></p></td>
<td><p> Indicates the average percentage of utilized frame buffer memory on each GPU based on NVIDIA DCGM exporter data. As with GPU usage, this metric is averaged across replicas and sampled every minute. It’s most reliable under consistent load conditions.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="prometheus-integration">
<h2>Prometheus integration<a class="headerlink" href="#prometheus-integration" title="Permalink to this headline"> </a></h2>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Regardless of which type of deployment you have in your production environment, the scraping configuration should be similar.</p>
</div>
<p>The guidance in this section follows the Prometheus documentation to start a Prometheus service locally using docker.</p>
<ol class="arabic">
<li><p>Write a <code class="docutils literal notranslate"><span class="pre">yaml</span></code> config file and name it <code class="docutils literal notranslate"><span class="pre">prometheus.yml</span></code>. The following is an example:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="w"> </span><span class="nt">global</span><span class="p">:</span>
<span class="w">  </span><span class="nt">scrape_interval</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1m</span>
<span class="w">  </span><span class="nt">scrape_timeout</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">10s</span>
<span class="w"> </span><span class="nt">scrape_configs</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">job_name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;prometheus&quot;</span>
<span class="w">    </span><span class="nt">metrics_path</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;/api/2.0/serving-endpoints/[ENDPOINT_NAME]/metrics&quot;</span>
<span class="w">    </span><span class="nt">scheme</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;https&quot;</span>
<span class="w">    </span><span class="nt">authorization</span><span class="p">:</span>
<span class="w">     </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Bearer&quot;</span>
<span class="w">     </span><span class="nt">credentials</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;[PAT_TOKEN]&quot;</span>

<span class="w">  </span><span class="w w-Error"> </span><span class="nt">static_configs</span><span class="p">:</span>
<span class="w">     </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">targets</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&quot;dbc-741cfa95-12d1.dev.databricks.com&quot;</span><span class="p p-Indicator">]</span>
</pre></div>
</div>
</li>
<li><p>Start Prometheus locally with the following command:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="w">   </span>docker<span class="w"> </span>run<span class="w"> </span><span class="se">\</span>
<span class="w">   </span>-p<span class="w"> </span><span class="m">9090</span>:9090<span class="w"> </span><span class="se">\</span>
<span class="w">   </span>-v<span class="w"> </span>/path/to/prometheus.yml:/etc/prometheus/prometheus.yml<span class="w"> </span><span class="se">\</span>
<span class="w">   </span>prom/prometheus
</pre></div>
</div>
</li>
<li><p>Navigate to <code class="docutils literal notranslate"><span class="pre">http://localhost:9090</span></code> to check if your local Prometheus service is up and running.</p></li>
<li><p>Check the Prometheus scraper status and debug errors from: <code class="docutils literal notranslate"><span class="pre">http://localhost:9090/targets?search=</span></code></p></li>
<li><p>Once the target is fully up and running, you can query the provided metrics, like <code class="docutils literal notranslate"><span class="pre">cpu_usage_percentage</span></code> or <code class="docutils literal notranslate"><span class="pre">mem_usage_percentage</span></code>, in the UI.</p></li>
</ol>
</div>
<div class="section" id="datadog-integration">
<h2>Datadog integration<a class="headerlink" href="#datadog-integration" title="Permalink to this headline"> </a></h2>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The preliminary set up for this example is based on the free edition.</p>
</div>
<p><a class="reference external" href="https://docs.datadoghq.com/">Datadog</a> has a variety of agents that can be deployed in different environments. For demonstration purposes, the following launches a Mac OS agent locally that scrapes the metrics endpoint in your Databricks host. The configuration for using other agents should be in a similar pattern.</p>
<ol class="arabic">
<li><p>Register a datadog account.</p></li>
<li><p>Install OpenMetrics integration in your <a class="reference external" href="https://app.datadoghq.com/integrations">account dashboard</a>, so Datadog can accept and process OpenMetrics data.</p></li>
<li><p>Follow the <a class="reference external" href="https://app.datadoghq.com/account/settings#agent/mac">Datadog documentation</a> to get your Datadog agent up and running. For this example, use the DMG package option to have everything installed including <code class="docutils literal notranslate"><span class="pre">launchctl</span></code> and <code class="docutils literal notranslate"><span class="pre">datadog-agent</span></code>.</p></li>
<li><p>Locate your OpenMetrics configuration. For this example, the configuration is at <code class="docutils literal notranslate"><span class="pre">~/.datadog-agent/conf.d/openmetrics.d/conf.yaml.default</span></code>. The following is an example configuration <code class="docutils literal notranslate"><span class="pre">yaml</span></code> file.</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="w"> </span><span class="nt">instances</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">openmetrics_endpoint</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">https://[DATABRICKS_HOST]/api/2.0/serving-endpoints/[ENDPOINT_NAME]/metrics</span>

<span class="w">  </span><span class="w w-Error"> </span><span class="nt">metrics</span><span class="p">:</span>
<span class="w">   </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">cpu_usage_percentage</span><span class="p">:</span>
<span class="w">       </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">cpu_usage_percentage</span>
<span class="w">       </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">gauge</span>
<span class="w">   </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">mem_usage_percentage</span><span class="p">:</span>
<span class="w">       </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">mem_usage_percentage</span>
<span class="w">       </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">gauge</span>
<span class="w">   </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">provisioned_concurrent_requests_total</span><span class="p">:</span>
<span class="w">       </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">provisioned_concurrent_requests_total</span>
<span class="w">       </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">gauge</span>
<span class="w">   </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">request_4xx_count_total</span><span class="p">:</span>
<span class="w">       </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">request_4xx_count_total</span>
<span class="w">       </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">gauge</span>
<span class="w">   </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">request_5xx_count_total</span><span class="p">:</span>
<span class="w">       </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">request_5xx_count_total</span>
<span class="w">       </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">gauge</span>
<span class="w">   </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">request_count_total</span><span class="p">:</span>
<span class="w">       </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">request_count_total</span>
<span class="w">       </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">gauge</span>
<span class="w">   </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">request_latency_ms</span><span class="p">:</span>
<span class="w">       </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">request_latency_ms</span>
<span class="w">       </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">histogram</span>

<span class="w">   </span><span class="nt">tag_by_endpoint</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">false</span>

<span class="w">   </span><span class="nt">send_distribution_buckets</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>

<span class="w">   </span><span class="nt">headers</span><span class="p">:</span>
<span class="w">     </span><span class="nt">Authorization</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Bearer [PAT]</span>
<span class="w">     </span><span class="nt">Content-Type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">application/openmetrics-text</span>
</pre></div>
</div>
</li>
<li><p>Start datadog agent using <code class="docutils literal notranslate"><span class="pre">launchctl</span> <span class="pre">start</span> <span class="pre">com.datadoghq.agent</span></code>.</p></li>
<li><p>Every time you need to make changes to your config, you need to restart the agent to pick up the change.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="w"> </span>launchctl<span class="w"> </span>stop<span class="w"> </span>com.datadoghq.agent
<span class="w"> </span>launchctl<span class="w"> </span>start<span class="w"> </span>com.datadoghq.agent
</pre></div>
</div>
</li>
<li><p>Check the agent health with <code class="docutils literal notranslate"><span class="pre">datadog-agent</span> <span class="pre">health</span></code>.</p></li>
<li><p>Check agent status with <code class="docutils literal notranslate"><span class="pre">datadog-agent</span> <span class="pre">status</span></code>. You should be able to see a response like the following. If not, debug with the error message. Potential issues may be due to an expired PAT token, or an incorrect URL.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="w"> </span>openmetrics<span class="w"> </span><span class="o">(</span><span class="m">2</span>.2.2<span class="o">)</span>
<span class="w"> </span>-------------------
<span class="w">   </span>Instance<span class="w"> </span>ID:<span class="w"> </span>openmetrics:<span class="w"> </span>xxxxxxxxxxxxxxxx<span class="w"> </span><span class="o">[</span>OK<span class="o">]</span>
<span class="w">   </span>Configuration<span class="w"> </span>Source:<span class="w"> </span>file:/opt/datadog-agent/etc/conf.d/openmetrics.d/conf.yaml.default
<span class="w">   </span>Total<span class="w"> </span>Runs:<span class="w"> </span><span class="m">1</span>
<span class="w">   </span>Metric<span class="w"> </span>Samples:<span class="w"> </span>Last<span class="w"> </span>Run:<span class="w"> </span><span class="m">2</span>,<span class="w"> </span>Total:<span class="w"> </span><span class="m">2</span>
<span class="w">   </span>Events:<span class="w"> </span>Last<span class="w"> </span>Run:<span class="w"> </span><span class="m">0</span>,<span class="w"> </span>Total:<span class="w"> </span><span class="m">0</span>
<span class="w">   </span>Service<span class="w"> </span>Checks:<span class="w"> </span>Last<span class="w"> </span>Run:<span class="w"> </span><span class="m">1</span>,<span class="w"> </span>Total:<span class="w"> </span><span class="m">1</span>
<span class="w">   </span>Average<span class="w"> </span>Execution<span class="w"> </span>Time<span class="w"> </span>:<span class="w"> </span>274ms
<span class="w">   </span>Last<span class="w"> </span>Execution<span class="w"> </span>Date<span class="w"> </span>:<span class="w"> </span><span class="m">2022</span>-09-21<span class="w"> </span><span class="m">23</span>:00:41<span class="w"> </span>PDT<span class="w"> </span>/<span class="w"> </span><span class="m">2022</span>-09-22<span class="w"> </span><span class="m">06</span>:00:41<span class="w"> </span>UTC<span class="w"> </span><span class="o">(</span>xxxxxxxx<span class="o">)</span>
<span class="w">   </span>Last<span class="w"> </span>Successful<span class="w"> </span>Execution<span class="w"> </span>Date<span class="w"> </span>:<span class="w"> </span><span class="m">2022</span>-09-21<span class="w"> </span><span class="m">23</span>:00:41<span class="w"> </span>PDT<span class="w"> </span>/<span class="w"> </span><span class="m">2022</span>-09-22<span class="w"> </span><span class="m">06</span>:00:41<span class="w"> </span>UTC<span class="w"> </span><span class="o">(</span>xxxxxxx<span class="o">)</span>
</pre></div>
</div>
</li>
<li><p>Agent status can also be seen from the UI at:<a class="reference external" href="http://127.0.0.1:5002/">http://127.0.0.1:5002/</a>.</p>
<p>If your agent is fully up and running, you can navigate back to your Datadog dashboard to query the metrics. You can also create a monitor or alert based on the metric data:<a class="reference external" href="https://app.datadoghq.com/monitors/create/metric">https://app.datadoghq.com/monitors/create/metric</a>.</p>
</li>
</ol>
</div>
</div>


    
          </div>
        </div>
        <div  class="suapp-rating">
  <div id="suPageRateApp">
     <su-app></su-app>
   </div> 
 </div>
<hr> 
<footer>
  <div role="contentinfo">
      <p class="copyright">
          &copy; Databricks 2023. All rights reserved. Apache, Apache Spark, Spark, and the Spark logo are trademarks of the <a href="http://www.apache.org/">Apache Software Foundation</a>.
      </p>
      <p> 
        
          <a id='feedbacklink' href="mailto:doc-feedback@databricks.com?subject=Documentation Feedback">Send us feedback</a>
        
     | <a href="https://databricks.com/privacy-policy">Privacy Policy</a> | <a href="https://databricks.com/terms-of-use">Terms of Use</a></p>

  </div> 

</footer>
      </div>
    </div>
  </section>
</main>

  </page>
  
  <script type="text/javascript">
    var DOCUMENTATION_OPTIONS = {
      URL_ROOT: '../../',
      VERSION: '1.0',
      COLLAPSE_INDEX: false,
      FILE_SUFFIX: '.html',
      HAS_SOURCE: 'false'
    };
  </script>
  <script type="text/javascript" src="../../_static/jquery.js"></script>
  <script type="text/javascript" src="../../_static/underscore.js"></script>
  <script type="text/javascript" src="../../_static/doctools.js"></script>
  <script type="text/javascript" src="../../_static/language_data.js"></script>
  

  <script type="text/javascript" src="../../_static/js/clipboard.min.js"></script>
  <script type="text/javascript" src="../../_static/js/jquery.waypoints.min.js"></script>

  <!-- Select2 (https://select2.org/) -->
  <link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />
  <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
  <!-- End Select2 -->

  
  
  <script type="text/javascript" src="../../_static/js/localized.js"></script>
  <script type="text/javascript" src="../../_static/js/custom.js"></script>
  

  
  
  <script type="text/javascript">
    jQuery(function () {
      SphinxRtdTheme.StickyNav.enable();
    });

  </script>
  
 



  <script>
  window.__searchunifyLoaderConfig = JSON.parse('{"clients": {"en": "02c2e804-27e9-11ee-aefb-0242ac120011", "ja": "6a42c3f2-2820-11ee-aefb-0242ac120011", "pt": "6a86badd-2821-11ee-aefb-0242ac120011"}}')
</script>
<script type="text/javascript" src="../../_static/js/search-loader.js"></script>
</body>
<script type='text/javascript'>
  window.onload = function () {
    var description = document.querySelector('meta[name="description"]').getAttribute("content");
    let titleText = document.querySelector('h1').textContent;
    document.querySelector('meta[property="og:title"]').setAttribute("content", titleText);
    document.querySelector('meta[property="og:description"]').setAttribute("content", description);
    document.querySelector('meta[property="twitter:description"]').setAttribute("content", description);
  };
</script>

</html>