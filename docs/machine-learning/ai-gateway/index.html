

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en-US" > <![endif]-->
<!--[if gt IE 8]><!-->
<html class="no-js" lang="en-US"> <!--<![endif]-->

<head>
  <!-- cookie consent -->
  
    <!-- Combined Onetrust and Rudderstack Implementation Scripts -->
    <!-- Onetrust Initialization -->
    <script type="text/javascript" src="https://cdn.cookielaw.org/consent/92466579-1717-44d3-809d-a05fb02843ed-test/OtAutoBlock.js"></script>
    <script src="https://cdn.cookielaw.org/scripttemplates/otSDKStub.js" data-document-language="true" type="text/javascript" charset="UTF-8" data-domain-script="92466579-1717-44d3-809d-a05fb02843ed-test"></script>
    <link rel="stylesheet" id="db-onetrust-style" href="https://www.databricks.com/wp-content/uploads/db_onetrust.css" media="all" />
    <!-- Setting Rudderstack Write Key -->
    <script>window.rudderstackKey = "2SOR9fvSr5Fi6tN2ihPbVHnX1SZ" </script>
    <!-- Rudderstack Initialization + Onetrust Integration + Rudderstack Custom Events -->
    <script type="text/javascript" src="https://www.databricks.com/sites/default/files/rudderstack/v1/db-rudderstack-events.js"></script>

  <!-- cookie consent -->

  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta http-equiv="X-UA-Compatible" content="IE=9" />
  <meta content="This article provides an overview of Databricks AI Gateway, its supported models and providers, and its limitations." name="description" />
<meta content="noindex" name="robots" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0">
  <meta property="og:image" content="https://www.databricks.com/wp-content/uploads/2020/04/og-databricks.png">
  <meta property="og:image:type" content="image/png">
  <meta property="og:title" content="Databricks AI Gateway">
  <meta property="og:image:width" content="1200">
  <meta property="og:image:height" content="630">
  <meta property="og:type" content="website">
  <meta property="og:url" content="https://docs.databricks.com">
  <meta property="og:description" content="" id="og-description">
  <meta name="twitter:image" content="https://www.databricks.com/wp-content/uploads/2020/04/og-databricks.png">
  <meta name="twitter:site" content="@databricks">
  <meta name="twitter:creator" content="@databricks">
  <meta property="twitter:description" content="">
  
  <title>Databricks AI Gateway &#124; Databricks on AWS</title>
  
  
  <link rel="canonical" href="https://docs.databricks.com/en/machine-learning/ai-gateway/index.html">
  <!-- Start hreflang tag -->
  <link rel="alternate" hreflang="en" href="https://docs.databricks.com/en/machine-learning/ai-gateway/index.html" />
<link rel="alternate" hreflang="x-default" href="https://docs.databricks.com/en/machine-learning/ai-gateway/index.html" />
  <!-- End hreflang tag -->
  
  
  <link rel="shortcut icon" href="../../_static/favicon.ico" />
  

  

  

  <!-- Google Tag Manager -->
  <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'https://www.googletagmanager.com/gtm.js?id='+i+dl;
j.setAttributeNode(d.createAttribute('data-ot-ignore'));
f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-T85FQ33');</script>
  <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'https://www.googletagmanager.com/gtm.js?id='+i+dl;
j.setAttributeNode(d.createAttribute('data-ot-ignore'));
f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-TWTKQQ');</script>
    
  <!-- End Google Tag Manager -->


  <!-- MaxMind / GEO IP -->
  <script src="//js.maxmind.com/js/apis/geoip2/v2.1/geoip2.js" type="text/javascript"></script>
  <!-- End MaxMind / GEO IP -->

  
  
  <link href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,600&display=swap" rel="stylesheet">
  <link rel="preload" href="../../_static/fonts/DMSans-Bold.ttf" as="font">
  <link rel="preload" href="../../_static/fonts/DMSans-Regular.ttf" as="font">
  <link rel="preload" href="../../_static/fonts/DMMono-Regular.ttf" as="font">
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/css/custom.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/css/cloud-provider-selector.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/css/translation-selector.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/css/searchunify/main.css" type="text/css" />

  
  <link rel="index" title="Index" href="../../genindex.html" />
  <link rel="search" title="Search" href="../../search.html" />
  <link rel="top" title="Databricks on AWS" href="../../index.html" /> 
</head>

<body class="wy-body-for-nav" role="document">

  <!-- Google Tag Manager (noscript) -->
  <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-T85FQ33"
height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
  <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-TWTKQQ"
    height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
  <!-- End Google Tag Manager (noscript) -->

  
  <nav class="wy-nav-top header su_header" role="navigation" aria-label="top navigation">
    
<nav class="wy-nav-top header su_header" role="navigation" aria-label="top navigation">
  <div class="container-logo">
    <ul class="mobile-menu-toggle">
        <li class="menu-toggle">
            <i data-toggle="wy-nav-top" class="wy-nav-top-menu-button db-icon db-icon-menu pull-left"></i>
            
            <a href="https://www.databricks.com/" class="wy-nav-top-logo"><img src="../../_static/small-scale-lockup-full-color-rgb.svg" width="137" height="21"
              alt="Databricks" /></a>   
               
              </li>
    </ul>
    <ul class="su_nav-menu">
      <li class="menu-toggle">
        <i data-toggle="wy-nav-top" class="wy-nav-top-menu-button db-icon db-icon-menu pull-left"></i>
        
          
        
        <a href="https://www.databricks.com/" class="wy-nav-top-logo"><img src="../../_static/small-scale-lockup-full-color-rgb.svg" width="137" height="21"
            alt="Databricks" /></a></li>
        <!-- 
<li><a href="https://help.databricks.com/s/">Help Center</a></li>
<li class="active"><a href="https://docs.databricks.com/en/">Documentation</a></li>
<li><a href="https://kb.databricks.com/">Knowledge Base</a></li>
 -->
    </ul>
  </div>
  <div class="su_nav-right">
    <ul class="su_link-mobile">
  <!-- Mobile header code can go here -->
</ul>
<ul class="right-try-list">
   
</ul>
  </div>
</nav>
  </nav>

  <div class="su_sub-header">
    <div class="container">
      <div class="su_sub-header-inner">
        <!-- <div class="su_subnav-menu-right">
  <div id="auto" style="width: 100%;">
    <div ng-controller="SearchautoController">
      <div bind-html-compile="autocompleteHtml">
        <form class="su__search-box-1" disabled="disabled">
          <input class="su__search-input" type="search" name="Search box" id="su__search-b" placeholder="Search Documentation" disabled="disabled"/>
          <button class="su__search-button" type="submit" class="button button-success" disabled="disabled">
            <svg width="24" height="24" viewBox="0 0 24 24">
              <path
                d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"
                fill="#333"></path>
            </svg>
          </button>
        </form>
      </div>
    </div>
  </div>
</div> -->
        <div class="search-lng-gap"></div>
        <div style="margin-left: 16px; margin-right: 16px;">
          <!-- <select name="lng selector" id="lng-selector">
    <option value="../../../en/machine-learning/ai-gateway/index.html" class="notranslate">English</option>
    <option value="../../../ja/machine-learning/ai-gateway/index.html" class="notranslate">日本語</option>
    <option value="../../../pt/machine-learning/ai-gateway/index.html" class="notranslate">Português (Brasil)</option>
</select> -->
        </div>
        <div class="cloud-selector-container">
          <!-- <select name="cloud provider selector" id="cloud-provider-selector">
    <option value="aws" selected class="notranslate">
        Amazon Web Services
    </option>
    <option value="azure"  class="notranslate">
        Microsoft Azure
    </option>
    <option value="gcp"  class="notranslate">
        Google Cloud Platform
    </option>
</select> -->
        </div>
      </div>
    </div>
  </div>
  <page class="js-page-container">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side su_nav-side">
<div class="wy-side-scroll">
  <div class="wy-side-nav-search">
    

    

    

    
  </div>

  <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
    
      <a href="../../index.html" class="main-navigation-home">Databricks on AWS</a>
    

    
      

      
        <p class="caption"><span class="caption-text">Load &amp; manage data</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../rag-temp/index.html">RAG Studio</a></li>
</ul>

      
    
  </div>

  <div role="contentinfo">
    
  <p class="build_info notranslate"data-last-edit="December 23, 2023">
    Updated Jan 11, 2024
  </p>
<script>
  window.addEventListener('DOMContentLoaded',function(){
    var h1=document.querySelector('h1');
    var bi=document.querySelector('[data-last-edit]');
    if(h1 && bi){
      var ver = document.createElement('p');
      ver.className = 'version_info';
      ver.textContent = bi.getAttribute('data-last-edit');
      h1.parentElement.insertBefore(ver, h1.nextElementSibling);
    }
  });
</script>

    <p>
      
        <a id='feedbacklink' href="mailto:doc-feedback@databricks.com?subject=Documentation Feedback">Send us feedback</a>
      
    </p>
  </div>
</div>
</nav>
    
    
<main class="wy-grid-for-nav su_nav-grid">
  <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
    <div class="wy-nav-content su__nav_content">
      <div class="rst-content">
        





<div role="navigation" aria-label="breadcrumbs navigation" class="wy-breadcrumbs-wrapper">
  <ul class="wy-breadcrumbs">
    <li><a href="../../index.html">Documentation</a> <span class="db-icon db-icon-chevron-right"></span></li>
    
    
      <li>Databricks AI Gateway</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>
</div>
        
        <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
          <div itemprop="articleBody">
            
    
  <p></p>
<div class="section" id="databricks-ai-gateway">
<h1>Databricks AI Gateway<a class="headerlink" href="#databricks-ai-gateway" title="Permalink to this headline"> </a></h1>
<div class="preview admonition">
<p class="admonition-title">Preview</p>
<p>This feature is in <a class="reference internal" href="../../release-notes/release-types.html"><span class="doc">Private Preview</span></a>. To try it, reach out to your Databricks contact.</p>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>The guidance in this article is for AI Gateway in Private Preview. Databricks recommends using Model Serving support of <a class="reference internal" href="../../generative-ai/external-models/index.html"><span class="doc">external models</span></a>, a Public Preview capability that allows you to centrally manage and access third party hosted foundation models.</p>
</div>
<p>This article describes Databricks AI Gateway including its supported model providers and limitations.</p>
<p>To enroll in the Private Preview, please <a class="reference external" href="https://docs.google.com/forms/d/1w43HtHcgXo_nw3OQbGLOsHO_mlwpkqTUnKKxTnxiU8Y/viewform?edit_requested=true">submit the enrollment form</a>.</p>
<div class="section" id="what-is-ai-gateway">
<h2>What is AI Gateway?<a class="headerlink" href="#what-is-ai-gateway" title="Permalink to this headline"> </a></h2>
<p>The Databricks AI Gateway is designed to streamline the usage and management of various large language model (LLM) providers, such as OpenAI and Anthropic, within an organization. It offers a high-level interface that simplifies the interaction with these services by providing a unified endpoint to handle specific LLM related requests.</p>
<p>A major advantage of using the AI Gateway is its centralized credential management. By storing API keys in one secure location, organizations can significantly enhance their security posture by minimizing the exposure of sensitive API keys throughout the system. It also helps to prevent exposing these keys within code or requiring end-users to manage keys safely.</p>
<p>The AI gateway is designed to easily define and manage routes using a straightforward REST API. This enables the incorporation of new LLM providers or provider LLM types into the system without necessitating changes to applications that interface with it.</p>
<p>This simplification and centralization of language model interactions, coupled with the added layer of security for API key management and cost controls, make the AI Gateway an ideal choice for organizations that require agility when using LLMs on a regular basis.</p>
<p>See <a class="reference internal" href="ai-gateway-tutorial.html"><span class="doc">Tutorial: Create routes and query OpenAI provider models using Databricks AI Gateway</span></a> for step-by-step guidance on route creation and querying models on those routes.</p>
</div>
<div class="section" id="model-providers">
<span id="provider"></span><h2>Model providers<a class="headerlink" href="#model-providers" title="Permalink to this headline"> </a></h2>
<p>The AI Gateway is designed to support a variety of model providers. A provider represents the source of the machine learning models, such as OpenAI, Anthropic, and so on. Each provider has its specific characteristics and configurations that are encapsulated within the model part of a route in the Databricks AI Gateway.</p>
<p>The AI Gateway supports the following providers:</p>
<ul class="simple">
<li><p><strong>openai</strong>: This is used for models offered by <a class="reference external" href="https://platform.openai.com/">OpenAI</a> and the <a class="reference external" href="https://learn.microsoft.com/azure/cognitive-services/openai/">Azure</a> integrations for Azure OpenAI and Azure OpenAI with AAD.</p></li>
<li><p><strong>mosaicml</strong>: This is used for models offered by <a class="reference external" href="https://docs.mosaicml.com/en/latest/">MosaicML</a>.</p></li>
<li><p><strong>anthropic</strong>: This is used for models offered by <a class="reference external" href="https://docs.anthropic.com/claude/docs">Anthropic</a>.</p></li>
<li><p><strong>cohere</strong>: This is used for models offered by <a class="reference external" href="https://docs.cohere.com/docs">Cohere</a>.</p></li>
<li><p><strong>databricks-model-serving</strong>: This is used for Databricks Model Serving endpoints with compatible schemas. See <a class="reference internal" href="#serving-endpoints"><span class="std std-ref">Use models served on Databricks Model Serving endpoints</span></a>.</p></li>
<li><p><strong>aws-bedrock</strong>: This is used for models offered by <a class="reference external" href="https://aws.amazon.com/bedrock/">AWS Bedrock</a>.</p></li>
</ul>
<p>Remember, the provider you specify must be one that the Databricks AI Gateway supports. If the provider is not supported, the AI Gateway returns an error when trying to route requests to that provider.</p>
</div>
<div class="section" id="supported-models">
<span id="supported"></span><h2>Supported models<a class="headerlink" href="#supported-models" title="Permalink to this headline"> </a></h2>
<p>The model you choose directly affects the results of the responses you get from the API calls. Therefore, choose a model that fits your use-case requirements. For instance, for generating conversational responses, you can choose a chat model. Conversely, for generating embeddings of text, you can choose an embedding model.</p>
<p>The table below presents a non-exhaustive list of models and a corresponding <a class="reference internal" href="#route"><span class="std std-ref">route type</span></a> within the Databricks AI Gateway.  Model associations listed below can be used as a helpful guide when configuring a given route for any newly released model types as they become available with a given provider. Customers are responsible for ensuring compliance with applicable model licenses.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>With the rapid development of LLMs, there is no guarantee that this list is up to date at all times.</p>
</div>
<table class="docutils align-default">
<colgroup>
<col style="width: 6%" />
<col style="width: 7%" />
<col style="width: 17%" />
<col style="width: 8%" />
<col style="width: 14%" />
<col style="width: 10%" />
<col style="width: 7%" />
<col style="width: 30%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Route type</p></th>
<th class="head"><p>OpenAI</p></th>
<th class="head"><p>MosaicML</p></th>
<th class="head"><p>Anthropic</p></th>
<th class="head"><p>Cohere</p></th>
<th class="head"><p>Azure OpenAI</p></th>
<th class="head"><p>MLflow</p></th>
<th class="head"><p>AWS Bedrock</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p> llm/v1/completions</p></td>
<td><p> gpt-3.5-turbo, gpt-4</p></td>
<td><p> mpt-7b-instruct, mpt-30b-instruct, llama2-70b-chat †</p></td>
<td><p> claude-1, claude-1.3-100k</p></td>
<td><p> command, command-light-nightly</p></td>
<td><p> text-davinci-003, gpt-35-turbo</p></td>
<td><p> MLflow served models*</p></td>
<td><p> Anthropic: claude-instant-v1, claude-v1, claude-v2</p>
<p>Cohere: command-text-v14</p>
<p>AI21 Labs: j2-grande-instruct, j2-jumbo-instruct, j2-mid, j2-mid-v1, j2-ultra, j2-ultra-v1</p>
</td>
</tr>
<tr class="row-odd"><td><p> llm/v1/chat</p></td>
<td><p> gpt-3.5-turbo, gpt-4</p></td>
<td><p> llama2-70b-chat†</p></td>
<td></td>
<td></td>
<td><p> gpt-35-turbo gpt-4</p></td>
<td><p> MLflow served models*</p></td>
<td></td>
</tr>
<tr class="row-even"><td><p> llm/v1/embeddings</p></td>
<td><p> text-embedding-ada-002</p></td>
<td><p> instructor-large instructor-xl</p></td>
<td></td>
<td><p> embed-english-v2.0, embed-multilingual-v2.0</p></td>
<td><p> text-embedding-ada-002</p></td>
<td><p> MLflow served models**</p></td>
<td><p> Amazon: titan-embed-text-v1</p></td>
</tr>
</tbody>
</table>
<p>† Llama 2 is licensed under the <a class="reference external" href="https://ai.meta.com/llama/license/">LLAMA 2 Community License</a>, Copyright © Meta Platforms, Inc. All Rights Reserved.</p>
<div class="section" id="use-mosaicml-hosted-open-source-models">
<h3>Use MosaicML-hosted open source models<a class="headerlink" href="#use-mosaicml-hosted-open-source-models" title="Permalink to this headline"> </a></h3>
<p>AI Gateway also provides access to MosaicML’s open source models as hosted APIs. These APIs provide fast and easy access to state-of-the-art open source models for rapid experimentation and token-based pricing. MosaicML supports the <code class="docutils literal notranslate"><span class="pre">Instructor-XL</span></code>, a 1.2B parameter instruction fine-tuned embedding model by HKUNLP, and the <code class="docutils literal notranslate"><span class="pre">Llama2-70b-Chat</span></code> API which was trained on 2 trillion tokens and fine-tuned for dialogue, safety, and helpfulness by Meta.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Llama 2 is licensed under the <a class="reference external" href="https://ai.meta.com/llama/license/">LLAMA 2 Community License</a>, Copyright © Meta Platforms, Inc. All Rights Reserved.</p>
</div>
<p>To access these models via AI Gateway, you can create MosaicML routes like for the other providers.</p>
<p>The following example demonstrates how to create a route with MosaicML for the Llama2-70b-Chat model:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">create_route</span><span class="p">(</span>
    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;mosaicml-llama-completions&quot;</span><span class="p">,</span>
    <span class="n">route_type</span><span class="o">=</span><span class="s2">&quot;llm/v1/completions&quot;</span><span class="p">,</span>
    <span class="n">model</span><span class="o">=</span><span class="p">{</span>
        <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;llama2-70b-chat&quot;</span><span class="p">,</span>
        <span class="s2">&quot;provider&quot;</span><span class="p">:</span> <span class="s2">&quot;mosaicml&quot;</span><span class="p">,</span>
        <span class="s2">&quot;mosaicml_config&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;mosaicml_api_key&quot;</span><span class="p">:</span> <span class="s2">&quot;&lt;YOUR_MOSAIC_API_KEY&gt;&quot;</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">)</span>
</pre></div>
</div>
<p>For the <code class="docutils literal notranslate"><span class="pre">Instructor-XL</span></code> embeddings model, the route can be created like so:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">create_route</span><span class="p">(</span>
        <span class="n">name</span><span class="o">=</span><span class="s2">&quot;mosaicml-embeddings&quot;</span><span class="p">,</span>
        <span class="n">route_type</span><span class="o">=</span><span class="s2">&quot;llm/v1/embeddings&quot;</span><span class="p">,</span>
        <span class="n">model</span><span class="o">=</span><span class="p">{</span>
            <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;instructor-xl&quot;</span><span class="p">,</span>
            <span class="s2">&quot;provider&quot;</span><span class="p">:</span> <span class="s2">&quot;mosaicml&quot;</span><span class="p">,</span>
            <span class="s2">&quot;mosaicml_config&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;mosaicml_api_key&quot;</span><span class="p">:</span> <span class="s2">&quot;&lt;YOUR_MOSAIC_API_KEY&gt;&quot;</span>
            <span class="p">}</span>
        <span class="p">}</span>
<span class="p">)</span>
</pre></div>
</div>
<p>To query these routes, you can use the <a class="reference internal" href="query-ai-gateway-routes.html#rest-api"><span class="std std-ref">REST API</span></a> or the {ref}<code class="docutils literal notranslate"><span class="pre">gateway_fluent_api</span></code>, like in the following example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">mlflow.gateway</span> <span class="kn">import</span> <span class="n">query</span>

<span class="n">response</span> <span class="o">=</span> <span class="n">query</span><span class="p">(</span>
    <span class="n">route</span><span class="o">=</span><span class="s2">&quot;mosaicml-llama-completions&quot;</span><span class="p">,</span>
    <span class="n">data</span><span class="o">=</span><span class="p">{</span>
        <span class="s2">&quot;prompt&quot;</span><span class="p">:</span> <span class="s2">&quot;What is MLflow?&quot;</span><span class="p">,</span>
    <span class="p">}</span>
<span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">response</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="use-models-served-on-databricks-model-serving-endpoints">
<span id="serving-endpoints"></span><h3>Use models served on Databricks Model Serving endpoints<a class="headerlink" href="#use-models-served-on-databricks-model-serving-endpoints" title="Permalink to this headline"> </a></h3>
<p>The Databricks AI Gateway supports <a class="reference internal" href="../model-serving/create-manage-serving-endpoints.html"><span class="doc">Databricks Model Serving endpoints</span></a> as providers for the <code class="docutils literal notranslate"><span class="pre">llm/v1/completions</span></code> route type. These endpoints must accept the <a class="reference internal" href="query-ai-gateway-routes.html#standard-parameters"><span class="std std-ref">standard query parameters</span></a> that are marked <strong>required</strong>, and they must produce responses in the following format:</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;candidates&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">     </span><span class="s2">&quot;Completion 1 text&quot;</span><span class="p">,</span>
<span class="w">     </span><span class="s2">&quot;Completion 2 text&quot;</span><span class="p">,</span>
<span class="w">     </span><span class="s2">&quot;...&quot;</span>
<span class="w">  </span><span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>
<p>For a detailed example of creating a Databricks Model Serving endpoint with a compatible <code class="docutils literal notranslate"><span class="pre">MLflow</span> <span class="pre">Model</span> <span class="pre">Signature</span></code> and querying it through the AI Gateway, see {ref}<code class="docutils literal notranslate"><span class="pre">gateway_databricks_model_serving_completions_example</span></code>.</p>
</div>
</div>
<div class="section" id="routes">
<span id="route"></span><h2>Routes<a class="headerlink" href="#routes" title="Permalink to this headline"> </a></h2>
<p><code class="docutils literal notranslate"><span class="pre">Routes</span></code> are central to how the Databricks AI Gateway functions. Each route acts as a proxy endpoint for the user, forwarding requests to its configured provider.</p>
<p>A route in the Databricks AI Gateway consists of the following fields:</p>
<ul class="simple">
<li><p><strong>name</strong>: This is the unique identifier for the route. This is part of the URL when making API calls via the Databricks AI Gateway.</p></li>
<li><p><strong>route_type</strong>: The type of the route corresponds to the type of language model interaction you desire. For instance, <code class="docutils literal notranslate"><span class="pre">llm/v1/completions</span></code> for text completion operations, <code class="docutils literal notranslate"><span class="pre">llm/v1/embeddings</span></code> for text embeddings, and <code class="docutils literal notranslate"><span class="pre">llm/v1/chat</span></code> for chat operations.</p>
<ul>
<li><p>“llm/v1/completions”</p></li>
<li><p>“llm/v1/chat”</p></li>
<li><p>“llm/v1/embeddings”</p></li>
</ul>
</li>
<li><p><strong>model</strong>: Defines the model to which this route forwards requests. When specifying a model, it is critical that the provider supports the model you are requesting. For instance, <code class="docutils literal notranslate"><span class="pre">openai</span></code> as a provider supports models like <code class="docutils literal notranslate"><span class="pre">text-embedding-ada-002</span></code>, but other providers might not. If the model is not supported by the provider, the Databricks AI Gateway returns an HTTP 4xx error when trying to route requests to that model.</p></li>
</ul>
<p>The model field contains the following details:</p>
<ul class="simple">
<li><p><strong>provider</strong>: Specifies the name of the provider for this model. This is a string value that needs to correspond to a <a class="reference internal" href="#provider"><span class="std std-ref">provider</span></a> the Databricks AI Gateway supports. For example, <code class="docutils literal notranslate"><span class="pre">openai</span></code> for OpenAI’s <code class="docutils literal notranslate"><span class="pre">GPT-3.5</span></code> models.</p>
<ul>
<li><p>“openai”</p></li>
<li><p>“mosaicml”</p></li>
<li><p>“anthropic”</p></li>
<li><p>“cohere”</p></li>
<li><p>“azure” / “azuread”</p></li>
<li><p>“aws-bedrock”</p></li>
</ul>
</li>
<li><p><strong>name</strong>: The name of the model to use. For example, <code class="docutils literal notranslate"><span class="pre">gpt-3.5-turbo</span></code> for OpenAI’s <code class="docutils literal notranslate"><span class="pre">GPT-3.5-Turbo</span></code> model.</p></li>
<li><p><strong>config</strong>: Contains any additional configuration details required for the model. This includes specifying the API base URL and the API key. See <a class="reference internal" href="#configure-parameters"><span class="std std-ref">Configuring the Provider for a Route</span></a>.</p></li>
</ul>
<p>The following is an example of route creation with the <code class="docutils literal notranslate"><span class="pre">mlflow.gateway.create_route</span></code> API. In this example, a request sent to the embeddings route is forwarded to the <code class="docutils literal notranslate"><span class="pre">text-embedding-ada-002</span></code> model provided by <code class="docutils literal notranslate"><span class="pre">openai</span></code>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">create_route</span><span class="p">(</span>
    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;embeddings&quot;</span><span class="p">,</span>
    <span class="n">route_type</span><span class="o">=</span><span class="s2">&quot;llm/v1/embeddings&quot;</span><span class="p">,</span>
    <span class="n">model</span><span class="o">=</span><span class="p">{</span>
        <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;text-embedding-ada-002&quot;</span><span class="p">,</span>
        <span class="s2">&quot;provider&quot;</span><span class="p">:</span> <span class="s2">&quot;openai&quot;</span><span class="p">,</span>
        <span class="s2">&quot;openai_config&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;openai_api_key&quot;</span><span class="p">:</span> <span class="s2">&quot;&lt;YOUR_OPENAI_API_KEY&gt;&quot;</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">)</span>
</pre></div>
</div>
<div class="section" id="configure-the-provider-for-a-route">
<span id="configure-parameters"></span><h3>Configure the provider for a route<a class="headerlink" href="#configure-the-provider-for-a-route" title="Permalink to this headline"> </a></h3>
<p>When you create a route, you must supply the required configurations for the specified model provider. The following sections summarize the available route configuration parameters for each model provider.</p>
<p></p>
</div>
<div class="section" id="openai">
<h3>OpenAI<a class="headerlink" href="#openai" title="Permalink to this headline"> </a></h3>
<table class="docutils align-default">
<colgroup>
<col style="width: 18%" />
<col style="width: 54%" />
<col style="width: 6%" />
<col style="width: 22%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Configuration Parameter</p></th>
<th class="head"><p>Description</p></th>
<th class="head"><p>Required</p></th>
<th class="head"><p>Default</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p> <code class="docutils literal notranslate"><span class="pre">openai_api_key</span></code></p></td>
<td><p> This is the API key for the OpenAI service.</p></td>
<td><p> Yes</p></td>
<td></td>
</tr>
<tr class="row-odd"><td><p> <code class="docutils literal notranslate"><span class="pre">openai_api_type</span></code></p></td>
<td><p> This is an optional field to specify the type of OpenAI API to use.</p></td>
<td><p> No</p></td>
<td></td>
</tr>
<tr class="row-even"><td><p> <code class="docutils literal notranslate"><span class="pre">openai_api_base</span></code></p></td>
<td><p> This is the base URL for the OpenAI API.</p></td>
<td><p> No</p></td>
<td><p> <code class="docutils literal notranslate"><span class="pre">https://api.openai.com/v1</span></code></p></td>
</tr>
<tr class="row-odd"><td><p> <code class="docutils literal notranslate"><span class="pre">openai_api_version</span></code></p></td>
<td><p> This is an optional field to specify the OpenAI API version.</p></td>
<td><p> No</p></td>
<td></td>
</tr>
<tr class="row-even"><td><p> <code class="docutils literal notranslate"><span class="pre">openai_organization</span></code></p></td>
<td><p> This is an optional field to specify the organization in OpenAI.</p></td>
<td><p> No</p></td>
<td></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="mosaicml">
<h3>MosaicML<a class="headerlink" href="#mosaicml" title="Permalink to this headline"> </a></h3>
<table class="docutils align-default">
<colgroup>
<col style="width: 28%" />
<col style="width: 54%" />
<col style="width: 10%" />
<col style="width: 8%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Configuration Parameter</p></th>
<th class="head"><p>Description</p></th>
<th class="head"><p>Required</p></th>
<th class="head"><p>Default</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p> <code class="docutils literal notranslate"><span class="pre">mosaicml_api_key</span></code></p></td>
<td><p> This is the API key for the MosaicML service.</p></td>
<td><p> Yes</p></td>
<td></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="cohere">
<h3>Cohere<a class="headerlink" href="#cohere" title="Permalink to this headline"> </a></h3>
<table class="docutils align-default">
<colgroup>
<col style="width: 28%" />
<col style="width: 53%" />
<col style="width: 10%" />
<col style="width: 9%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Configuration Parameter</p></th>
<th class="head"><p>Description</p></th>
<th class="head"><p>Required</p></th>
<th class="head"><p>Default</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p> <code class="docutils literal notranslate"><span class="pre">cohere_api_key</span></code></p></td>
<td><p> This is the API key for the Cohere service.</p></td>
<td><p> Yes</p></td>
<td></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="anthropic">
<h3>Anthropic<a class="headerlink" href="#anthropic" title="Permalink to this headline"> </a></h3>
<table class="docutils align-default">
<colgroup>
<col style="width: 27%" />
<col style="width: 55%" />
<col style="width: 10%" />
<col style="width: 8%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Configuration Parameter</p></th>
<th class="head"><p>Description</p></th>
<th class="head"><p>Required</p></th>
<th class="head"><p>Default</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p> <code class="docutils literal notranslate"><span class="pre">anthropic_api_key</span></code></p></td>
<td><p> This is the API key for the Anthropic service.</p></td>
<td><p> Yes</p></td>
<td></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="azure-openai">
<h3>Azure OpenAI<a class="headerlink" href="#azure-openai" title="Permalink to this headline"> </a></h3>
<p>Azure OpenAI has distinct features as compared with the direct OpenAI service. For an overview, please see <a class="reference external" href="https://learn.microsoft.com/azure/cognitive-services/openai/how-to/switching-endpoints">the comparison documentation</a>.</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 10%" />
<col style="width: 84%" />
<col style="width: 3%" />
<col style="width: 3%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Configuration Parameter</p></th>
<th class="head"><p>Description</p></th>
<th class="head"><p>Required</p></th>
<th class="head"><p>Default</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p> <code class="docutils literal notranslate"><span class="pre">openai_api_key</span></code></p></td>
<td><p> This is the API key for the Azure OpenAI service.</p></td>
<td><p> Yes</p></td>
<td></td>
</tr>
<tr class="row-odd"><td><p> <code class="docutils literal notranslate"><span class="pre">openai_api_type</span></code></p></td>
<td><p> Adjust this parameter to represent the preferred security access validation protocol. For access token validation, use <code class="docutils literal notranslate"><span class="pre">azure</span></code>. For authentication using Azure Active Directory (Azure AD) use, <code class="docutils literal notranslate"><span class="pre">azuread</span></code>.</p></td>
<td><p> Yes</p></td>
<td></td>
</tr>
<tr class="row-even"><td><p> <code class="docutils literal notranslate"><span class="pre">openai_api_base</span></code></p></td>
<td><p> This is the base URL for the Azure OpenAI API service provided by Azure.</p></td>
<td><p> Yes</p></td>
<td></td>
</tr>
<tr class="row-odd"><td><p> <code class="docutils literal notranslate"><span class="pre">openai_api_version</span></code></p></td>
<td><p> The version of the Azure OpenAI service to utilize, specified by a date.</p></td>
<td><p> Yes</p></td>
<td></td>
</tr>
<tr class="row-even"><td><p> <code class="docutils literal notranslate"><span class="pre">openai_deployment_name</span></code></p></td>
<td><p> This is the name of the deployment resource for the Azure OpenAI service.</p></td>
<td><p> Yes</p></td>
<td></td>
</tr>
<tr class="row-odd"><td><p> <code class="docutils literal notranslate"><span class="pre">openai_organization</span></code></p></td>
<td><p> This is an optional field to specify the organization in OpenAI.</p></td>
<td><p> No</p></td>
<td></td>
</tr>
</tbody>
</table>
<p>The following example demonstrates how to create a route with Azure OpenAI:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">create_route</span><span class="p">(</span>
    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;completions&quot;</span><span class="p">,</span>
    <span class="n">route_type</span><span class="o">=</span><span class="s2">&quot;llm/v1/completions&quot;</span><span class="p">,</span>
    <span class="n">model</span><span class="o">=</span><span class="p">{</span>
        <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;gpt-35-turbo&quot;</span><span class="p">,</span>
        <span class="s2">&quot;provider&quot;</span><span class="p">:</span> <span class="s2">&quot;openai&quot;</span><span class="p">,</span>
        <span class="s2">&quot;openai_config&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;openai_api_type&quot;</span><span class="p">:</span> <span class="s2">&quot;azuread&quot;</span> <span class="c1"># or &quot;azure&quot; depending on security access validation protocol.</span>
            <span class="s2">&quot;openai_api_key&quot;</span><span class="p">:</span> <span class="s2">&quot;&lt;YOUR_AZURE_OPENAI_API_KEY&gt;&quot;</span>
            <span class="s2">&quot;openai_deployment_name&quot;</span><span class="p">:</span> <span class="s2">&quot;</span><span class="si">{your_azure_openai_deployment_name}</span><span class="s2">&quot;</span>
            <span class="s2">&quot;openai_api_base&quot;</span><span class="p">:</span> <span class="s2">&quot;https://</span><span class="si">{your_azure_openai_resource_name}</span><span class="s2">-azureopenai.openai.azure.com/&quot;</span>
            <span class="s2">&quot;openai_api_version&quot;</span><span class="p">:</span> <span class="s2">&quot;2023-05-15&quot;</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="databricks-model-serving">
<h3>Databricks Model Serving<a class="headerlink" href="#databricks-model-serving" title="Permalink to this headline"> </a></h3>
<table class="docutils align-default">
<colgroup>
<col style="width: 13%" />
<col style="width: 79%" />
<col style="width: 4%" />
<col style="width: 4%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Configuration Parameter</p></th>
<th class="head"><p>Description</p></th>
<th class="head"><p>Required</p></th>
<th class="head"><p>Default</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p> <code class="docutils literal notranslate"><span class="pre">databricks_api_token</span></code></p></td>
<td><p> A Databricks access token corresponding to a user or service principal that has <strong>Can Query</strong> access to the model serving endpoint associated with the route.</p></td>
<td><p> Yes</p></td>
<td></td>
</tr>
<tr class="row-odd"><td><p> <code class="docutils literal notranslate"><span class="pre">databricks_workspace_url</span></code></p></td>
<td><p> The URL of the workspace containing the model serving endpoint associated with the route.</p></td>
<td><p> Yes</p></td>
<td></td>
</tr>
</tbody>
</table>
<p>The following example demonstrates how to create a route with a Databricks Model Serving endpoint:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">create_route</span><span class="p">(</span>
    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;databricks-completions&quot;</span><span class="p">,</span>
    <span class="n">route_type</span><span class="o">=</span><span class="s2">&quot;llm/v1/completions&quot;</span><span class="p">,</span>
    <span class="n">model</span><span class="o">=</span><span class="p">{</span>
        <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;mpt-7b-instruct&quot;</span><span class="p">,</span>
        <span class="s2">&quot;provider&quot;</span><span class="p">:</span> <span class="s2">&quot;databricks-model-serving&quot;</span><span class="p">,</span>
        <span class="s2">&quot;databricks_model_serving_config&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;databricks_api_token&quot;</span><span class="p">:</span> <span class="s2">&quot;&lt;YOUR_DATABRICKS_ACCESS_TOKEN&gt;&quot;</span>
            <span class="s2">&quot;databricks_workspace_url&quot;</span><span class="p">:</span> <span class="s2">&quot;&lt;URL_OF_DATABRICKS_WORKSPACE_CONTAINING_ENDPOINT&gt;&quot;</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="aws-bedrock">
<h3>AWS Bedrock<a class="headerlink" href="#aws-bedrock" title="Permalink to this headline"> </a></h3>
<p>To use AWS Bedrock in the Databricks AI Gateway, customers need to make sure Bedrock is enabled in the specified AWS region,
and the specified AWS key pair have the appropriate permissions to interact with Bedrock services. For more information,
see <a class="reference external" href="https://docs.aws.amazon.com/IAM/latest/UserGuide/id_credentials_access-keys.html">AWS Identity and Access Management</a>.</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 15%" />
<col style="width: 76%" />
<col style="width: 5%" />
<col style="width: 4%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Configuration Parameter</p></th>
<th class="head"><p>Description</p></th>
<th class="head"><p>Required</p></th>
<th class="head"><p>Default</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p> <code class="docutils literal notranslate"><span class="pre">aws_region</span></code></p></td>
<td><p> The AWS region to use. Bedrock has to be enabled there.</p></td>
<td><p> Yes</p></td>
<td></td>
</tr>
<tr class="row-odd"><td><p> <code class="docutils literal notranslate"><span class="pre">aws_access_key_id</span></code></p></td>
<td><p> An AWS access key ID with permissions to interact with Bedrock services.</p></td>
<td><p> Yes</p></td>
<td></td>
</tr>
<tr class="row-even"><td><p> <code class="docutils literal notranslate"><span class="pre">aws_secret_access_key</span></code></p></td>
<td><p> An AWS secret access key paired with the access key ID, with permissions to interact with Bedrock services.</p></td>
<td><p> Yes</p></td>
<td></td>
</tr>
<tr class="row-odd"><td><p> <code class="docutils literal notranslate"><span class="pre">bedrock_provider</span></code></p></td>
<td><p> The underlying provider in AWS Bedrock. Supported values (case insensitive) include: Anthropic, Cohere, AI21Labs, Amazon</p></td>
<td><p> Yes</p></td>
<td></td>
</tr>
</tbody>
</table>
<p>The following example demonstrates how to create a route with AWS Bedrock.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">create_route</span><span class="p">(</span>
    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;bedrock-anthropic-completions&quot;</span><span class="p">,</span>
    <span class="n">route_type</span><span class="o">=</span><span class="s2">&quot;llm/v1/completions&quot;</span><span class="p">,</span>
    <span class="n">model</span><span class="o">=</span><span class="p">{</span>
        <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;claude-v2&quot;</span><span class="p">,</span>
        <span class="s2">&quot;provider&quot;</span><span class="p">:</span> <span class="s2">&quot;aws-bedrock&quot;</span><span class="p">,</span>
        <span class="s2">&quot;aws_bedrock_config&quot;</span><span class="p">:</span> <span class="p">{</span>
          <span class="s2">&quot;aws_region&quot;</span><span class="p">:</span> <span class="s2">&quot;&lt;YOUR_AWS_REGION&gt;&quot;</span><span class="p">,</span>
          <span class="s2">&quot;aws_access_key_id&quot;</span><span class="p">:</span> <span class="s2">&quot;&lt;YOUR_AWS_ACCESS_KEY_ID&gt;&quot;</span><span class="p">,</span>
          <span class="s2">&quot;aws_secret_access_key&quot;</span><span class="p">:</span> <span class="s2">&quot;&lt;YOUR_AWS_SECRET_ACCESS_KEY&gt;&quot;</span><span class="p">,</span>
          <span class="s2">&quot;bedrock_provider&quot;</span><span class="p">:</span> <span class="s2">&quot;anthropic&quot;</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">)</span>
</pre></div>
</div>
<p>If there are AWS permission issues, Databricks recommends verifying the credentials directly with the <a class="reference external" href="https://docs.aws.amazon.com/bedrock/latest/APIReference/welcome.html">AWS Bedrock API</a>.</p>
</div>
</div>
<div class="section" id="langchain-integration">
<h2>LangChain integration<a class="headerlink" href="#langchain-integration" title="Permalink to this headline"> </a></h2>
<p>LangChain has <a class="reference external" href="https://python.langchain.com/docs/ecosystem/integrations/mlflow_ai_gateway">an integration for MLflow AI Gateway</a>. This integration enable users to use prompt engineering, retrieval augmented generation, and other techniques with LLMs in the gateway.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">mlflow</span>
<span class="kn">from</span> <span class="nn">langchain</span> <span class="kn">import</span> <span class="n">LLMChain</span><span class="p">,</span> <span class="n">PromptTemplate</span>
<span class="kn">from</span> <span class="nn">langchain.llms</span> <span class="kn">import</span> <span class="n">MlflowAIGateway</span>

<span class="n">gateway</span> <span class="o">=</span> <span class="n">MlflowAIGateway</span><span class="p">(</span>
    <span class="n">gateway_uri</span><span class="o">=</span><span class="s2">&quot;databricks&quot;</span><span class="p">,</span>
    <span class="n">route</span><span class="o">=</span><span class="s2">&quot;completions&quot;</span><span class="p">,</span>
    <span class="n">params</span><span class="o">=</span><span class="p">{</span>
        <span class="s2">&quot;temperature&quot;</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span>
        <span class="s2">&quot;top_p&quot;</span><span class="p">:</span> <span class="mf">0.1</span><span class="p">,</span>
    <span class="p">},</span>
<span class="p">)</span>

<span class="n">llm_chain</span> <span class="o">=</span> <span class="n">LLMChain</span><span class="p">(</span>
    <span class="n">llm</span><span class="o">=</span><span class="n">gateway</span><span class="p">,</span>
    <span class="n">prompt</span><span class="o">=</span><span class="n">PromptTemplate</span><span class="p">(</span>
        <span class="n">input_variables</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;adjective&quot;</span><span class="p">],</span>
        <span class="n">template</span><span class="o">=</span><span class="s2">&quot;Tell me a </span><span class="si">{adjective}</span><span class="s2"> joke&quot;</span><span class="p">,</span>
    <span class="p">),</span>
<span class="p">)</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">llm_chain</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">adjective</span><span class="o">=</span><span class="s2">&quot;funny&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>

<span class="k">with</span> <span class="n">mlflow</span><span class="o">.</span><span class="n">start_run</span><span class="p">():</span>
    <span class="n">model_info</span> <span class="o">=</span> <span class="n">mlflow</span><span class="o">.</span><span class="n">langchain</span><span class="o">.</span><span class="n">log_model</span><span class="p">(</span><span class="n">chain</span><span class="p">,</span> <span class="s2">&quot;model&quot;</span><span class="p">)</span>

<span class="n">model</span> <span class="o">=</span> <span class="n">mlflow</span><span class="o">.</span><span class="n">pyfunc</span><span class="o">.</span><span class="n">load_model</span><span class="p">(</span><span class="n">model_info</span><span class="o">.</span><span class="n">model_uri</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">([{</span><span class="s2">&quot;adjective&quot;</span><span class="p">:</span> <span class="s2">&quot;funny&quot;</span><span class="p">}]))</span>
</pre></div>
</div>
</div>
<div class="section" id="limitations">
<h2>Limitations<a class="headerlink" href="#limitations" title="Permalink to this headline"> </a></h2>
<ul class="simple">
<li><p>Operability and support channels might be insufficient for production use. Support is best effort and informal. Reach out to your account or external Slack channel for best effort support.</p></li>
<li><p>This Private Preview is free of charge, however customers still incur charges for DBUs.</p></li>
<li><p>This product might change or might never be released.</p></li>
<li><p>Databricks may terminate the preview or your access to it with 2 weeks of notice.</p></li>
<li><p>There might be API changes before Public Preview or General Availability. Customers are notified with at least 2 weeks notice before any significant changes so that they have time to update their projects.</p></li>
<li><p>Non-public information about the preview (including the fact that there is a preview for the feature itself) is confidential.</p></li>
</ul>
</div>
<div class="section" id="additional-resources">
<h2>Additional resources<a class="headerlink" href="#additional-resources" title="Permalink to this headline"> </a></h2>
<ul class="simple">
<li><p><a class="reference internal" href="ai-gateway-tutorial.html"><span class="doc">Tutorial: Create routes and query OpenAI provider models using Databricks AI Gateway</span></a></p></li>
<li><p><a class="reference internal" href="query-ai-gateway-routes.html"><span class="doc">Query models made accessible using the AI Gateway</span></a></p></li>
<li><p><a class="reference internal" href="query-ai-gateway-mlflow-models.html"><span class="doc">Query the AI Gateway using an MLflow model</span></a></p></li>
<li><p><a class="reference internal" href="streaming.html"><span class="doc">Enable streaming output in Databricks AI gateway</span></a></p></li>
</ul>
</div>
</div>


    
          </div>
        </div>
        <div  class="suapp-rating">
  <div id="suPageRateApp">
     <su-app></su-app>
   </div> 
 </div>
<hr> 
<footer>
  <div role="contentinfo">
      <p class="copyright">
          &copy; Databricks 2023. All rights reserved. Apache, Apache Spark, Spark, and the Spark logo are trademarks of the <a href="http://www.apache.org/">Apache Software Foundation</a>.
      </p>
      <p> 
        
          <a id='feedbacklink' href="mailto:doc-feedback@databricks.com?subject=Documentation Feedback">Send us feedback</a>
        
     | <a href="https://databricks.com/privacy-policy">Privacy Policy</a> | <a href="https://databricks.com/terms-of-use">Terms of Use</a></p>

  </div> 

</footer>
      </div>
    </div>
  </section>
</main>

  </page>
  
  <script type="text/javascript">
    var DOCUMENTATION_OPTIONS = {
      URL_ROOT: '../../',
      VERSION: '1.0',
      COLLAPSE_INDEX: false,
      FILE_SUFFIX: '.html',
      HAS_SOURCE: 'false'
    };
  </script>
  <script type="text/javascript" src="../../_static/jquery.js"></script>
  <script type="text/javascript" src="../../_static/underscore.js"></script>
  <script type="text/javascript" src="../../_static/doctools.js"></script>
  <script type="text/javascript" src="../../_static/language_data.js"></script>
  

  <script type="text/javascript" src="../../_static/js/clipboard.min.js"></script>
  <script type="text/javascript" src="../../_static/js/jquery.waypoints.min.js"></script>

  <!-- Select2 (https://select2.org/) -->
  <link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />
  <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
  <!-- End Select2 -->

  
  
  <script type="text/javascript" src="../../_static/js/localized.js"></script>
  <script type="text/javascript" src="../../_static/js/custom.js"></script>
  

  
  
  <script type="text/javascript">
    jQuery(function () {
      SphinxRtdTheme.StickyNav.enable();
    });

  </script>
  
 



  <script>
  window.__searchunifyLoaderConfig = JSON.parse('{"clients": {"en": "02c2e804-27e9-11ee-aefb-0242ac120011", "ja": "6a42c3f2-2820-11ee-aefb-0242ac120011", "pt": "6a86badd-2821-11ee-aefb-0242ac120011"}}')
</script>
<script type="text/javascript" src="../../_static/js/search-loader.js"></script>
</body>
<script type='text/javascript'>
  window.onload = function () {
    var description = document.querySelector('meta[name="description"]').getAttribute("content");
    let titleText = document.querySelector('h1').textContent;
    document.querySelector('meta[property="og:title"]').setAttribute("content", titleText);
    document.querySelector('meta[property="og:description"]').setAttribute("content", description);
    document.querySelector('meta[property="twitter:description"]').setAttribute("content", description);
  };
</script>

</html>