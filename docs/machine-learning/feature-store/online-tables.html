

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en-US" > <![endif]-->
<!--[if gt IE 8]><!-->
<html class="no-js" lang="en-US"> <!--<![endif]-->

<head>
  <!-- cookie consent -->
  
    <!-- Combined Onetrust and Rudderstack Implementation Scripts -->
    <!-- Onetrust Initialization -->
    <script type="text/javascript" src="https://cdn.cookielaw.org/consent/92466579-1717-44d3-809d-a05fb02843ed-test/OtAutoBlock.js"></script>
    <script src="https://cdn.cookielaw.org/scripttemplates/otSDKStub.js" data-document-language="true" type="text/javascript" charset="UTF-8" data-domain-script="92466579-1717-44d3-809d-a05fb02843ed-test"></script>
    <link rel="stylesheet" id="db-onetrust-style" href="https://www.databricks.com/wp-content/uploads/db_onetrust.css" media="all" />
    <!-- Setting Rudderstack Write Key -->
    <script>window.rudderstackKey = "2SOR9fvSr5Fi6tN2ihPbVHnX1SZ" </script>
    <!-- Rudderstack Initialization + Onetrust Integration + Rudderstack Custom Events -->
    <script type="text/javascript" src="https://www.databricks.com/sites/default/files/rudderstack/v1/db-rudderstack-events.js"></script>

  <!-- cookie consent -->

  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta http-equiv="X-UA-Compatible" content="IE=9" />
  <meta content="Learn about using Online Tables for real-time feature serving in the Databricks platform." name="description" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0">
  <meta property="og:image" content="https://www.databricks.com/wp-content/uploads/2020/04/og-databricks.png">
  <meta property="og:image:type" content="image/png">
  <meta property="og:title" content="Use online tables for real-time feature serving">
  <meta property="og:image:width" content="1200">
  <meta property="og:image:height" content="630">
  <meta property="og:type" content="website">
  <meta property="og:url" content="https://docs.databricks.com">
  <meta property="og:description" content="" id="og-description">
  <meta name="twitter:image" content="https://www.databricks.com/wp-content/uploads/2020/04/og-databricks.png">
  <meta name="twitter:site" content="@databricks">
  <meta name="twitter:creator" content="@databricks">
  <meta property="twitter:description" content="">
  
  <title>Use online tables for real-time feature serving &#124; Databricks on AWS</title>
  
  
  <link rel="canonical" href="https://docs.databricks.com/en/machine-learning/feature-store/online-tables.html">
  <!-- Start hreflang tag -->
  <link rel="alternate" hreflang="en" href="https://docs.databricks.com/en/machine-learning/feature-store/online-tables.html" />
<link rel="alternate" hreflang="x-default" href="https://docs.databricks.com/en/machine-learning/feature-store/online-tables.html" />
  <!-- End hreflang tag -->
  
  
  <link rel="shortcut icon" href="../../_static/favicon.ico" />
  

  

  

  <!-- Google Tag Manager -->
  <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'https://www.googletagmanager.com/gtm.js?id='+i+dl;
j.setAttributeNode(d.createAttribute('data-ot-ignore'));
f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-T85FQ33');</script>
  <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'https://www.googletagmanager.com/gtm.js?id='+i+dl;
j.setAttributeNode(d.createAttribute('data-ot-ignore'));
f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-TWTKQQ');</script>
    
  <!-- End Google Tag Manager -->


  <!-- MaxMind / GEO IP -->
  <script src="//js.maxmind.com/js/apis/geoip2/v2.1/geoip2.js" type="text/javascript"></script>
  <!-- End MaxMind / GEO IP -->

  
  
  <link href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,600&display=swap" rel="stylesheet">
  <link rel="preload" href="../../_static/fonts/DMSans-Bold.ttf" as="font">
  <link rel="preload" href="../../_static/fonts/DMSans-Regular.ttf" as="font">
  <link rel="preload" href="../../_static/fonts/DMMono-Regular.ttf" as="font">
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/css/custom.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/css/cloud-provider-selector.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/css/translation-selector.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/css/searchunify/main.css" type="text/css" />

  
  <link rel="index" title="Index" href="../../genindex.html" />
  <link rel="search" title="Search" href="../../search.html" />
  <link rel="top" title="Databricks on AWS" href="../../index.html" /> 
</head>

<body class="wy-body-for-nav" role="document">

  <!-- Google Tag Manager (noscript) -->
  <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-T85FQ33"
height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
  <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-TWTKQQ"
    height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
  <!-- End Google Tag Manager (noscript) -->

  
  <nav class="wy-nav-top header su_header" role="navigation" aria-label="top navigation">
    
<nav class="wy-nav-top header su_header" role="navigation" aria-label="top navigation">
  <div class="container-logo">
    <ul class="mobile-menu-toggle">
        <li class="menu-toggle">
            <i data-toggle="wy-nav-top" class="wy-nav-top-menu-button db-icon db-icon-menu pull-left"></i>
            
            <a href="https://www.databricks.com/" class="wy-nav-top-logo"><img src="../../_static/small-scale-lockup-full-color-rgb.svg" width="137" height="21"
              alt="Databricks" /></a>   
               
              </li>
    </ul>
    <ul class="su_nav-menu">
      <li class="menu-toggle">
        <i data-toggle="wy-nav-top" class="wy-nav-top-menu-button db-icon db-icon-menu pull-left"></i>
        
          
        
        <a href="https://www.databricks.com/" class="wy-nav-top-logo"><img src="../../_static/small-scale-lockup-full-color-rgb.svg" width="137" height="21"
            alt="Databricks" /></a></li>
        <!-- 
<li><a href="https://help.databricks.com/s/">Help Center</a></li>
<li class="active"><a href="https://docs.databricks.com/en/">Documentation</a></li>
<li><a href="https://kb.databricks.com/">Knowledge Base</a></li>
 -->
    </ul>
  </div>
  <div class="su_nav-right">
    <ul class="su_link-mobile">
  <!-- Mobile header code can go here -->
</ul>
<ul class="right-try-list">
   
</ul>
  </div>
</nav>
  </nav>

  <div class="su_sub-header">
    <div class="container">
      <div class="su_sub-header-inner">
        <!-- <div class="su_subnav-menu-right">
  <div id="auto" style="width: 100%;">
    <div ng-controller="SearchautoController">
      <div bind-html-compile="autocompleteHtml">
        <form class="su__search-box-1" disabled="disabled">
          <input class="su__search-input" type="search" name="Search box" id="su__search-b" placeholder="Search Documentation" disabled="disabled"/>
          <button class="su__search-button" type="submit" class="button button-success" disabled="disabled">
            <svg width="24" height="24" viewBox="0 0 24 24">
              <path
                d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"
                fill="#333"></path>
            </svg>
          </button>
        </form>
      </div>
    </div>
  </div>
</div> -->
        <div class="search-lng-gap"></div>
        <div style="margin-left: 16px; margin-right: 16px;">
          <!-- <select name="lng selector" id="lng-selector">
    <option value="../../../en/machine-learning/feature-store/online-tables.html" class="notranslate">English</option>
    <option value="../../../ja/machine-learning/feature-store/online-tables.html" class="notranslate">日本語</option>
    <option value="../../../pt/machine-learning/feature-store/online-tables.html" class="notranslate">Português (Brasil)</option>
</select> -->
        </div>
        <div class="cloud-selector-container">
          <!-- <select name="cloud provider selector" id="cloud-provider-selector">
    <option value="aws" selected class="notranslate">
        Amazon Web Services
    </option>
    <option value="azure"  class="notranslate">
        Microsoft Azure
    </option>
    <option value="gcp"  class="notranslate">
        Google Cloud Platform
    </option>
</select> -->
        </div>
      </div>
    </div>
  </div>
  <page class="js-page-container">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side su_nav-side">
<div class="wy-side-scroll">
  <div class="wy-side-nav-search">
    

    

    

    
  </div>

  <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
    
      <a href="../../index.html" class="main-navigation-home">Databricks on AWS</a>
    

    
      

      
        <p class="caption"><span class="caption-text">Load &amp; manage data</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../rag-temp/index.html">RAG Studio</a></li>
</ul>

      
    
  </div>

  <div role="contentinfo">
    
  <p class="build_info notranslate"data-last-edit="December 23, 2023">
    Updated Jan 11, 2024
  </p>
<script>
  window.addEventListener('DOMContentLoaded',function(){
    var h1=document.querySelector('h1');
    var bi=document.querySelector('[data-last-edit]');
    if(h1 && bi){
      var ver = document.createElement('p');
      ver.className = 'version_info';
      ver.textContent = bi.getAttribute('data-last-edit');
      h1.parentElement.insertBefore(ver, h1.nextElementSibling);
    }
  });
</script>

    <p>
      
        <a id='feedbacklink' href="mailto:doc-feedback@databricks.com?subject=Documentation Feedback">Send us feedback</a>
      
    </p>
  </div>
</div>
</nav>
    
    
<main class="wy-grid-for-nav su_nav-grid">
  <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
    <div class="wy-nav-content su__nav_content">
      <div class="rst-content">
        





<div role="navigation" aria-label="breadcrumbs navigation" class="wy-breadcrumbs-wrapper">
  <ul class="wy-breadcrumbs">
    <li><a href="../../index.html">Documentation</a> <span class="db-icon db-icon-chevron-right"></span></li>
    
    
      <li>Use online tables for real-time feature serving</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>
</div>
        
        <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
          <div itemprop="articleBody">
            
    
  <div class="section" id="use-online-tables-for-real-time-feature-serving">
<h1>Use online tables for real-time feature serving<a class="headerlink" href="#use-online-tables-for-real-time-feature-serving" title="Permalink to this headline"> </a></h1>
<div class="preview admonition">
<p class="admonition-title">Preview</p>
<p>Online Tables are in public preview with limited capacity. During the limited preview, ingesting data into Online Tables consumes SQL Serverless DBUs. Final pricing for Online Tables will be made available at a future date. Please sign up <a class="reference external" href="https://forms.gle/9jLZkpXnJF9ZcxtQA">here</a> to participate in the preview.</p>
<p>Online Tables Preview is available in the following regions: <code class="docutils literal notranslate"><span class="pre">us-east-1</span></code>, <code class="docutils literal notranslate"><span class="pre">us-west-2</span></code>, <code class="docutils literal notranslate"><span class="pre">eu-west-1</span></code>, <code class="docutils literal notranslate"><span class="pre">ap-southeast-2</span></code>.</p>
</div>
<p>An online table is a read-only copy of a Delta Table that is stored in row-oriented format optimized for online access. Online Tables are fully serverless tables that auto-scale throughput capacity with the request load and provide low latency and high throughput access to data of any scale. Online Tables are designed to work with Databricks Model Serving, Feature &amp; Function Serving, and retrieval-augmented generation (RAG) applications where they are used for fast data lookups.</p>
<p>Creating an online table is a one-step process. Just select the Delta Table from the Catalog Explorer and select <strong>Create online table</strong>.</p>
<div class="section" id="requirements">
<h2>Requirements<a class="headerlink" href="#requirements" title="Permalink to this headline"> </a></h2>
<ul class="simple">
<li><p>The workspace must be enabled for Unity Catalog. Follow the <a class="reference internal" href="../../data-governance/unity-catalog/get-started.html"><span class="doc">documentation</span></a> to create a Unity Catalog Metastore, enable it in a workspace, and create a Catalog.</p></li>
<li><p>A Databricks admin must accept the Serverless Terms of Service in the account console.</p></li>
</ul>
</div>
<div class="section" id="work-with-online-tables">
<h2>Work with online tables<a class="headerlink" href="#work-with-online-tables" title="Permalink to this headline"> </a></h2>
<p>This section describes how to create and delete online tables, and how to check the status and trigger updates of online tables.</p>
<div class="section" id="create">
<h3>Create<a class="headerlink" href="#create" title="Permalink to this headline"> </a></h3>
<p>You create an online table from the Catalog Explorer. For information about required permissions, see <a class="reference internal" href="#permissions"><span class="std std-ref">User permissions</span></a>.</p>
<ol class="arabic">
<li><p>To create an online table, the source Delta table must have a primary key. If the Delta table you want to use does not have a primary key, create one by following these instructions: <a class="reference internal" href="uc/feature-tables-uc.html#use-existing-uc-table"><span class="std std-ref">Use an existing Delta table in Unity Catalog as a feature table</span></a>.</p></li>
<li><p>In Catalog Explorer, navigate to the source table that you want to sync to an online table. From the <img alt="Kebab menu" src="../../_images/kebab-menu.png" /> kebab menu, select <strong>Create online table</strong>.</p>
<div class="figure align-default">
<img alt="select create online table" src="../../_images/create-online-table.png" />
</div>
</li>
<li><p>Use the selectors in the dialog to configure the online table.</p>
<div class="figure align-default">
<img alt="configure online table dialog" src="../../_images/create-online-table-dlg.png" />
</div>
<p><strong>Name</strong>: Name to use for the online table in Unity Catalog.</p>
<p><strong>Primary Key</strong>: Column(s) in the source table to use as primary key(s) in the online table.</p>
<p><strong>Timeseries Key</strong>: (Optional). Column in the source table to use as timeseries key. When specified, the online table includes only the row with the latest timeseries key value for each primary key.</p>
<p><strong>Sync mode</strong>: Specifies how the synchronization pipeline updates the online table. Select one of <strong>Snapshot</strong>, <strong>Triggered</strong>, or <strong>Continuous</strong>.</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 3%" />
<col style="width: 97%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Policy</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p> Snapshot</p></td>
<td><p> The pipeline runs once to take a snapshot of the source table and copy it to the online table. Subsequent changes to the source table are automatically reflected in the online table by taking a new snapshot of the source and creating a new copy. The content of the online table is updated atomically.</p></td>
</tr>
<tr class="row-odd"><td><p> Triggered</p></td>
<td><p>  The pipeline runs once to create an initial snapshot copy of the source table in the online table. Unlike the Snapshot sync mode, when the online table is refreshed, only changes since the last pipeline execution are retrieved and applied to the online table. The incremental refresh can be manually triggered or automatically triggered according to a schedule.</p></td>
</tr>
<tr class="row-even"><td><p> Continuous</p></td>
<td><p> The pipeline runs continuously. Subsequent changes to the source table are incrementally applied to the online table in real time streaming mode. No manual refresh is necessary.</p></td>
</tr>
</tbody>
</table>
</li>
</ol>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>To support <strong>Triggered</strong> or <strong>Continuous</strong> sync mode, the source table must have <a class="reference internal" href="../../delta/delta-change-data-feed.html"><span class="doc">Change data feed</span></a> enabled.</p>
</div>
<ol class="arabic simple">
<li><p>When you are done, click <strong>Confirm</strong>. The online table page appears.</p></li>
<li><p>The new online table is created under the catalog, schema, and name specified in the creation dialog. In Catalog Explorer, the online table is indicated by <img alt="online table icon" src="../../_images/online-table-icon.png" />.</p></li>
</ol>
</div>
<div class="section" id="check-status-and-trigger-update">
<h3>Check status and trigger update<a class="headerlink" href="#check-status-and-trigger-update" title="Permalink to this headline"> </a></h3>
<p>To check the status of the online table, click the name of the table in the Catalog to open it. The online table page appears with the <strong>Overview</strong> tab open. The <strong>Data Ingest</strong> section shows the status of the latest update. To trigger an update, click <strong>Sync now</strong>. The <strong>Data Ingest</strong> section also includes a link to the Delta Live Tables pipeline that updates the table.</p>
<div class="figure align-default">
<img alt="view of online table page in catalog" src="../../_images/online-table-in-catalog.png" />
</div>
</div>
<div class="section" id="delete">
<h3>Delete<a class="headerlink" href="#delete" title="Permalink to this headline"> </a></h3>
<p>From the online table page, select <strong>Delete</strong> from the <img alt="Kebab menu" src="../../_images/kebab-menu.png" /> kebab menu.</p>
</div>
</div>
<div class="section" id="serve-online-table-data-using-a-feature-serving-endpoint">
<h2>Serve online table data using a feature serving endpoint<a class="headerlink" href="#serve-online-table-data-using-a-feature-serving-endpoint" title="Permalink to this headline"> </a></h2>
<p>For models and applications hosted outside of Databricks, you can create a feature serving endpoint to serve features from online tables. The endpoint makes features available at low latency using a REST API.</p>
<ol class="arabic">
<li><p>Create a feature spec.</p>
<p>When you create a feature spec, you specify the source Delta table. This allows the feature spec to be used in both offline and online scenarios. For online lookups, the serving endpoint automatically uses the online table to perform low-latency feature lookups.</p>
<p>The source Delta table and the online table must use the same primary key.</p>
<p>The feature spec can be viewed in the <strong>Function</strong> tab in Catalog Explorer.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">fe</span> <span class="o">=</span> <span class="n">FeatureEngineeringClient</span><span class="p">()</span>
<span class="n">fe</span><span class="o">.</span><span class="n">create_feature_spec</span><span class="p">(</span>
  <span class="n">name</span><span class="o">=</span><span class="s2">&quot;catalog.default.user_preferences_spec&quot;</span><span class="p">,</span>
  <span class="n">features</span><span class="o">=</span><span class="p">[</span>
    <span class="n">FeatureLookup</span><span class="p">(</span>
      <span class="n">table_name</span><span class="o">=</span><span class="s2">&quot;user_preferences&quot;</span><span class="p">,</span>
      <span class="n">lookup_key</span><span class="o">=</span><span class="s2">&quot;user_id&quot;</span>
    <span class="p">)</span>
  <span class="p">]</span>
<span class="p">)</span>
</pre></div>
</div>
</li>
<li><p>Create a feature serving endpoint.</p>
<p>This step assumes that you have created an online table named <code class="docutils literal notranslate"><span class="pre">user_preferences_online_table</span></code> that synchonizes data from the Delta table <code class="docutils literal notranslate"><span class="pre">user_preferences</span></code>. Use the feature spec to create a feature serving endpoint. The endpoint makes data available through a REST API using the associated online table.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The user who performs this operation must be the owner of both the offline table and online table.</p>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">fe</span><span class="o">.</span><span class="n">create_feature_serving_endpoint</span><span class="p">(</span>
<span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;user-preferences&quot;</span><span class="p">,</span>
<span class="n">config</span><span class="o">=</span><span class="n">EndpointCoreConfig</span><span class="p">(</span>
  <span class="n">served_entities</span><span class="o">=</span><span class="n">ServedEntity</span><span class="p">(</span>
    <span class="n">feature_spec_name</span><span class="o">=</span><span class="s2">&quot;catalog.default.user_preferences_spec&quot;</span><span class="p">,</span>
    <span class="n">workload_size</span><span class="o">=</span><span class="s2">&quot;Small&quot;</span><span class="p">,</span>
    <span class="n">scale_to_zero_enabled</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
  <span class="p">)</span>
<span class="p">)</span>
</pre></div>
</div>
</li>
<li><p>Get data from the feature serving endpoint.</p>
<p>To access the API endpoint, send an HTTP GET request to the endpoint URL. The example shows how to do this using Python APIs. For other languages and tools, see <a class="reference internal" href="feature-function-serving.html"><span class="doc">Feature &amp; Function Serving</span></a>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">url</span> <span class="o">=</span> <span class="s2">&quot;https://</span><span class="si">{workspace_url}</span><span class="s2">/serving-endpoints/user-preferences/invocations&quot;</span>
<span class="n">databricks_token</span> <span class="o">=</span> <span class="n">mlflow</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">databricks_utils</span><span class="o">.</span><span class="n">get_databricks_host_creds</span><span class="p">()</span><span class="o">.</span><span class="n">token</span>

<span class="n">headers</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;Authorization&#39;</span><span class="p">:</span> <span class="sa">f</span><span class="s1">&#39;Bearer </span><span class="si">{</span><span class="n">databricks_token</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;Content-Type&#39;</span><span class="p">:</span> <span class="s1">&#39;application/json&#39;</span><span class="p">}</span>

<span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
  <span class="s2">&quot;dataframe_records&quot;</span><span class="p">:</span> <span class="p">[{</span><span class="s2">&quot;user_id&quot;</span><span class="p">:</span> <span class="n">user_id</span><span class="p">}]</span>
<span class="p">}</span>
<span class="n">data_json</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">allow_nan</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">request</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="s1">&#39;POST&#39;</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">,</span> <span class="n">url</span><span class="o">=</span><span class="n">url</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data_json</span><span class="p">)</span>
<span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">!=</span> <span class="mi">200</span><span class="p">:</span>
  <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Request failed with status </span><span class="si">{</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="si">}</span><span class="s1">, </span><span class="si">{</span><span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()[</span><span class="s1">&#39;outputs&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;hotel_preference&#39;</span><span class="p">])</span>
</pre></div>
</div>
</li>
</ol>
</div>
<div class="section" id="use-online-tables-with-rag-applications">
<h2>Use online tables with RAG applications<a class="headerlink" href="#use-online-tables-with-rag-applications" title="Permalink to this headline"> </a></h2>
<p>RAG applications are a common use case for online tables. You create an online table for the structured data that the RAG application needs and host it on a feature serving endpoint. The RAG application uses the feature serving endpoint to look up relevant data from the online table.</p>
<p>The typical steps are as follows:</p>
<ol class="arabic simple">
<li><p>Create a feature serving endpoint.</p></li>
<li><p>Create a LangChainTool that uses the endpoint to look up relevant data.</p></li>
<li><p>Use the tool in the LangChain agent to retrieve relevant data.</p></li>
<li><p>Create a model serving endpoint to host the LangChain application.</p></li>
</ol>
<p>For step-by-step instructions, see the following example notebook.</p>
</div>
<div class="section" id="notebook-examples">
<h2>Notebook examples<a class="headerlink" href="#notebook-examples" title="Permalink to this headline"> </a></h2>
<p>The following notebook illustrates how to publish features to online tables for real-time serving and automated feature lookup.</p>
<div class="embedded-notebook-section section" id="online-tables-demo-notebook">
<span id="online-tables"></span><h3>Online tables demo notebook<a class="headerlink" href="#online-tables-demo-notebook" title="Permalink to this headline"> </a></h3>
<div class="embedded-notebook">
    <p class="notebook-import-help">
        <a href="/_extras/notebooks/source/machine-learning/online-tables.html"            target="_blank">Open notebook in new tab</a>
        <button class="embedded-notebook-copy-to-clipboard"                copy-path-to-clipboard-on-click="/_extras/notebooks/source/machine-learning/online-tables.html">            <img src="/_static/clippy.svg"                alt="Copy to clipboard">            Copy link for import        </button>    <div class="embedded-notebook-container">        <div class="loading-spinner"></div>        <iframe data-src="/_extras/notebooks/source/machine-learning/online-tables.html"            id="3ce43086d640c55f4aae807585ebef413d4dda77032dc0da578b4515f72d83de" height="1000px" width="100%"            style="overflow-y:hidden;" scrolling="no"></iframe>    </div></div></div>
<p>The following notebook illustrates how to use Databricks online tables and feature serving endpoints for retrieval augmented generation (RAG) applications.</p>
<div class="embedded-notebook-section section" id="online-tables-with-rag-applications-demo-notebook">
<span id="structured-data-for-rag"></span><h3>Online tables with RAG applications demo notebook<a class="headerlink" href="#online-tables-with-rag-applications-demo-notebook" title="Permalink to this headline"> </a></h3>
<div class="embedded-notebook">
    <p class="notebook-import-help">
        <a href="/_extras/notebooks/source/machine-learning/structured-data-for-rag.html"            target="_blank">Open notebook in new tab</a>
        <button class="embedded-notebook-copy-to-clipboard"                copy-path-to-clipboard-on-click="/_extras/notebooks/source/machine-learning/structured-data-for-rag.html">            <img src="/_static/clippy.svg"                alt="Copy to clipboard">            Copy link for import        </button>    <div class="embedded-notebook-container">        <div class="loading-spinner"></div>        <iframe data-src="/_extras/notebooks/source/machine-learning/structured-data-for-rag.html"            id="0bc4b4c3ae070279f1ca1b78a937d2ab85dd2ff5b628802b2532e48eb7bc7f8d" height="1000px" width="100%"            style="overflow-y:hidden;" scrolling="no"></iframe>    </div></div></div>
</div>
<div class="section" id="use-online-tables-with-databricks-model-serving">
<h2>Use online tables with Databricks Model Serving<a class="headerlink" href="#use-online-tables-with-databricks-model-serving" title="Permalink to this headline"> </a></h2>
<p>You can use online tables to look up features for Databricks Model Serving. When you sync a feature table to an online table, models trained using features from that feature table automatically look up feature values from the online table during inference. No additional configuration is required.</p>
<ol class="arabic">
<li><p>Use a <code class="docutils literal notranslate"><span class="pre">FeatureLookup</span></code> to train the model.</p>
<p>For model training, use features from the offline feature table in the model training set, as shown in the following example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">training_set</span> <span class="o">=</span> <span class="n">fe</span><span class="o">.</span><span class="n">create_training_set</span><span class="p">(</span>
  <span class="n">df</span><span class="o">=</span><span class="n">id_rt_feature_labels</span><span class="p">,</span>
  <span class="n">label</span><span class="o">=</span><span class="s1">&#39;quality&#39;</span><span class="p">,</span>
  <span class="n">feature_lookups</span><span class="o">=</span><span class="p">[</span>
      <span class="n">FeatureLookup</span><span class="p">(</span>
          <span class="n">table_name</span><span class="o">=</span><span class="s2">&quot;user_preferences&quot;</span><span class="p">,</span>
          <span class="n">lookup_key</span><span class="o">=</span><span class="s2">&quot;user_id&quot;</span>
      <span class="p">)</span>
  <span class="p">],</span>
  <span class="n">exclude_columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;user_id&#39;</span><span class="p">],</span>
<span class="p">)</span>
</pre></div>
</div>
</li>
<li><p>Serve the model with Databricks Model Serving. The model automatically looks up features from the online table. See <a class="reference internal" href="automatic-feature-lookup.html"><span class="doc">Automatic feature lookup with MLflow models on Databricks</span></a> for details.</p></li>
</ol>
</div>
<div class="section" id="user-permissions">
<span id="permissions"></span><h2>User permissions<a class="headerlink" href="#user-permissions" title="Permalink to this headline"> </a></h2>
<p>You must have the following permissions to create an online table:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">SELECT</span></code> privilege on the source table.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">USE_CATALOG</span></code> privilege on the destination catalog.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">USE_SCHEMA</span></code> and <code class="docutils literal notranslate"><span class="pre">CREATE_TABLE</span></code> privilege on the destination schema.</p></li>
</ul>
<p>To manage the data synchronization pipeline of an online table, you must either be the owner of the online table or be granted the REFRESH privilege on the online table. Users who do not have USE_CATALOG and USE_SCHEMA privileges on the catalog will not see the online table in Catalog Explorer.</p>
<p>The Unity Catalog metastore must have <a class="reference internal" href="../../data-governance/unity-catalog/manage-privileges/upgrade-privilege-model.html"><span class="doc">Privilege Model Version 1.0</span></a>.</p>
</div>
<div class="section" id="endpoint-permission-model">
<h2>Endpoint permission model<a class="headerlink" href="#endpoint-permission-model" title="Permalink to this headline"> </a></h2>
<p>A unique system service principal is automatically created for a feature serving or model serving endpoint with limited permissions required to query data and execute functions. This service principal allows endpoints to access data and function resources independently of the user who created the resource and ensures that the endpoint can continue to function if the creator leaves the workspace.</p>
<p>The lifetime of this system service principal is the lifetime of the endpoint. Audit logs may indicate system generated records for the owner of the Unity Catalog catalog granting necessary privileges to this system service principal.</p>
<p>For general information about managing production environments, see <a class="reference internal" href="../../security/auth-authz/access-control/serving-endpoint-acl.html#recommendations-for-production-serving-endpoints"><span class="std std-ref">Recommendations for production serving endpoints</span></a>.</p>
</div>
<div class="section" id="limitations">
<h2>Limitations<a class="headerlink" href="#limitations" title="Permalink to this headline"> </a></h2>
<ul class="simple">
<li><p>Only one online table is supported per source table.</p></li>
<li><p>Columns of data types ARRAY, MAP, or STRUCT cannot be used as primary keys in the online table.</p></li>
<li><p>If a column is used as a primary key in the online table, all rows in the source table where the column contains null values are ignored.</p></li>
<li><p>Foreign, system, and internal tables are not supported as source tables.</p></li>
<li><p>Source tables without Delta change data feed enabled support only the <strong>Snapshot</strong> sync mode.</p></li>
<li><p>Delta Sharing tables are only supported in the <strong>Snapshot</strong> sync mode.</p></li>
<li><p>Catalog, schema, and table names of the online table can only contain alphanumeric characters and underscores, and must not start with numbers. Dashes (<code class="docutils literal notranslate"><span class="pre">-</span></code>) are not allowed.</p></li>
<li><p>Columns of String type are limited to 64KB length.</p></li>
<li><p>The maximum size of the row is 2MB.</p></li>
<li><p>The maximum size of an online table during gated public preview is 200GB uncompressed user data.</p></li>
<li><p>The combined size of all online tables in a Unity Catalog metastore during gated public preview is 1TB uncompressed user data.</p></li>
</ul>
</div>
<div class="section" id="troubleshooting">
<h2>Troubleshooting<a class="headerlink" href="#troubleshooting" title="Permalink to this headline"> </a></h2>
<div class="section" id="“create-online-table”-does-not-appear-in-catalog-explorer">
<h3>“Create online table” does not appear in Catalog Explorer.<a class="headerlink" href="#“create-online-table”-does-not-appear-in-catalog-explorer" title="Permalink to this headline"> </a></h3>
<p>The cause is usually that the table you are trying to sync from (the source table) is not a supported type. Make sure the source table’s Securable Kind (shown in the Catalog Explorer <strong>Details</strong> tab) is one of the supported options below:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">TABLE_EXTERNAL</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">TABLE_DELTA</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">TABLE_DELTA_EXTERNAL</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">TABLE_DELTASHARING</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">TABLE_DELTASHARING_MUTABLE</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">TABLE_STREAMING_LIVE_TABLE</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">TABLE_STANDARD</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">TABLE_FEATURE_STORE</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">TABLE_FEATURE_STORE_EXTERNAL</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">TABLE_VIEW</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">TABLE_VIEW_DELTASHARING</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">TABLE_MATERIALIZED_VIEW</span></code></p></li>
</ul>
</div>
<div class="section" id="i-cannot-select-either-“triggered”-or-&quot;continuous&quot;-sync-modes-when-creating-an-online-table">
<h3>I cannot select either “Triggered” or “Continuous” sync modes when creating an online table.<a class="headerlink" href="#i-cannot-select-either-“triggered”-or-"continuous"-sync-modes-when-creating-an-online-table" title="Permalink to this headline"> </a></h3>
<p>This happens if the source table does not have Delta change data feed enabled or if it is a View or Materialized View. To use the <strong>Incremental</strong> sync mode, either enable change data feed on the source table, or use a non-view table.</p>
</div>
</div>
</div>


    
          </div>
        </div>
        <div  class="suapp-rating">
  <div id="suPageRateApp">
     <su-app></su-app>
   </div> 
 </div>
<hr> 
<footer>
  <div role="contentinfo">
      <p class="copyright">
          &copy; Databricks 2023. All rights reserved. Apache, Apache Spark, Spark, and the Spark logo are trademarks of the <a href="http://www.apache.org/">Apache Software Foundation</a>.
      </p>
      <p> 
        
          <a id='feedbacklink' href="mailto:doc-feedback@databricks.com?subject=Documentation Feedback">Send us feedback</a>
        
     | <a href="https://databricks.com/privacy-policy">Privacy Policy</a> | <a href="https://databricks.com/terms-of-use">Terms of Use</a></p>

  </div> 

</footer>
      </div>
    </div>
  </section>
</main>

  </page>
  
  <script type="text/javascript">
    var DOCUMENTATION_OPTIONS = {
      URL_ROOT: '../../',
      VERSION: '1.0',
      COLLAPSE_INDEX: false,
      FILE_SUFFIX: '.html',
      HAS_SOURCE: 'false'
    };
  </script>
  <script type="text/javascript" src="../../_static/jquery.js"></script>
  <script type="text/javascript" src="../../_static/underscore.js"></script>
  <script type="text/javascript" src="../../_static/doctools.js"></script>
  <script type="text/javascript" src="../../_static/language_data.js"></script>
  

  <script type="text/javascript" src="../../_static/js/clipboard.min.js"></script>
  <script type="text/javascript" src="../../_static/js/jquery.waypoints.min.js"></script>

  <!-- Select2 (https://select2.org/) -->
  <link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />
  <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
  <!-- End Select2 -->

  
  
  <script type="text/javascript" src="../../_static/js/localized.js"></script>
  <script type="text/javascript" src="../../_static/js/custom.js"></script>
  

  
  
  <script type="text/javascript">
    jQuery(function () {
      SphinxRtdTheme.StickyNav.enable();
    });

  </script>
  
 



  <script>
  window.__searchunifyLoaderConfig = JSON.parse('{"clients": {"en": "02c2e804-27e9-11ee-aefb-0242ac120011", "ja": "6a42c3f2-2820-11ee-aefb-0242ac120011", "pt": "6a86badd-2821-11ee-aefb-0242ac120011"}}')
</script>
<script type="text/javascript" src="../../_static/js/search-loader.js"></script>
</body>
<script type='text/javascript'>
  window.onload = function () {
    var description = document.querySelector('meta[name="description"]').getAttribute("content");
    let titleText = document.querySelector('h1').textContent;
    document.querySelector('meta[property="og:title"]').setAttribute("content", titleText);
    document.querySelector('meta[property="og:description"]').setAttribute("content", description);
    document.querySelector('meta[property="twitter:description"]').setAttribute("content", description);
  };
</script>

</html>