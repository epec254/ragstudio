

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en-US" > <![endif]-->
<!--[if gt IE 8]><!-->
<html class="no-js" lang="en-US"> <!--<![endif]-->

<head>
  <!-- cookie consent -->
  
    <!-- Combined Onetrust and Rudderstack Implementation Scripts -->
    <!-- Onetrust Initialization -->
    <script type="text/javascript" src="https://cdn.cookielaw.org/consent/92466579-1717-44d3-809d-a05fb02843ed-test/OtAutoBlock.js"></script>
    <script src="https://cdn.cookielaw.org/scripttemplates/otSDKStub.js" data-document-language="true" type="text/javascript" charset="UTF-8" data-domain-script="92466579-1717-44d3-809d-a05fb02843ed-test"></script>
    <link rel="stylesheet" id="db-onetrust-style" href="https://www.databricks.com/wp-content/uploads/db_onetrust.css" media="all" />
    <!-- Setting Rudderstack Write Key -->
    <script>window.rudderstackKey = "2SOR9fvSr5Fi6tN2ihPbVHnX1SZ" </script>
    <!-- Rudderstack Initialization + Onetrust Integration + Rudderstack Custom Events -->
    <script type="text/javascript" src="https://www.databricks.com/sites/default/files/rudderstack/v1/db-rudderstack-events.js"></script>

  <!-- cookie consent -->

  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta http-equiv="X-UA-Compatible" content="IE=9" />
  <meta content="Learn how to create and work with feature tables in Databricks Unity Catalog including how to update, control access, and browse feature tables." name="description" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0">
  <meta property="og:image" content="https://www.databricks.com/wp-content/uploads/2020/04/og-databricks.png">
  <meta property="og:image:type" content="image/png">
  <meta property="og:title" content="Feature Engineering in Unity Catalog">
  <meta property="og:image:width" content="1200">
  <meta property="og:image:height" content="630">
  <meta property="og:type" content="website">
  <meta property="og:url" content="https://docs.databricks.com">
  <meta property="og:description" content="" id="og-description">
  <meta name="twitter:image" content="https://www.databricks.com/wp-content/uploads/2020/04/og-databricks.png">
  <meta name="twitter:site" content="@databricks">
  <meta name="twitter:creator" content="@databricks">
  <meta property="twitter:description" content="">
  
  <title>Feature Engineering in Unity Catalog &#124; Databricks on AWS</title>
  
  
  <link rel="canonical" href="https://docs.databricks.com/en/machine-learning/feature-store/uc/feature-tables-uc.html">
  <!-- Start hreflang tag -->
  <link rel="alternate" hreflang="en" href="https://docs.databricks.com/en/machine-learning/feature-store/uc/feature-tables-uc.html" />
<link rel="alternate" hreflang="x-default" href="https://docs.databricks.com/en/machine-learning/feature-store/uc/feature-tables-uc.html" />
  <!-- End hreflang tag -->
  
  
  <link rel="shortcut icon" href="../../../_static/favicon.ico" />
  

  

  

  <!-- Google Tag Manager -->
  <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'https://www.googletagmanager.com/gtm.js?id='+i+dl;
j.setAttributeNode(d.createAttribute('data-ot-ignore'));
f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-T85FQ33');</script>
  <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'https://www.googletagmanager.com/gtm.js?id='+i+dl;
j.setAttributeNode(d.createAttribute('data-ot-ignore'));
f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-TWTKQQ');</script>
    
  <!-- End Google Tag Manager -->


  <!-- MaxMind / GEO IP -->
  <script src="//js.maxmind.com/js/apis/geoip2/v2.1/geoip2.js" type="text/javascript"></script>
  <!-- End MaxMind / GEO IP -->

  
  
  <link href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,600&display=swap" rel="stylesheet">
  <link rel="preload" href="../../../_static/fonts/DMSans-Bold.ttf" as="font">
  <link rel="preload" href="../../../_static/fonts/DMSans-Regular.ttf" as="font">
  <link rel="preload" href="../../../_static/fonts/DMMono-Regular.ttf" as="font">
  <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/css/custom.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/css/cloud-provider-selector.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/css/translation-selector.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/css/searchunify/main.css" type="text/css" />

  
  <link rel="index" title="Index" href="../../../genindex.html" />
  <link rel="search" title="Search" href="../../../search.html" />
  <link rel="top" title="Databricks on AWS" href="../../../index.html" /> 
</head>

<body class="wy-body-for-nav" role="document">

  <!-- Google Tag Manager (noscript) -->
  <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-T85FQ33"
height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
  <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-TWTKQQ"
    height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
  <!-- End Google Tag Manager (noscript) -->

  
  <nav class="wy-nav-top header su_header" role="navigation" aria-label="top navigation">
    
<nav class="wy-nav-top header su_header" role="navigation" aria-label="top navigation">
  <div class="container-logo">
    <ul class="mobile-menu-toggle">
        <li class="menu-toggle">
            <i data-toggle="wy-nav-top" class="wy-nav-top-menu-button db-icon db-icon-menu pull-left"></i>
            
            <a href="https://www.databricks.com/" class="wy-nav-top-logo"><img src="../../../_static/small-scale-lockup-full-color-rgb.svg" width="137" height="21"
              alt="Databricks" /></a>   
               
              </li>
    </ul>
    <ul class="su_nav-menu">
      <li class="menu-toggle">
        <i data-toggle="wy-nav-top" class="wy-nav-top-menu-button db-icon db-icon-menu pull-left"></i>
        
          
        
        <a href="https://www.databricks.com/" class="wy-nav-top-logo"><img src="../../../_static/small-scale-lockup-full-color-rgb.svg" width="137" height="21"
            alt="Databricks" /></a></li>
        <!-- 
<li><a href="https://help.databricks.com/s/">Help Center</a></li>
<li class="active"><a href="https://docs.databricks.com/en/">Documentation</a></li>
<li><a href="https://kb.databricks.com/">Knowledge Base</a></li>
 -->
    </ul>
  </div>
  <div class="su_nav-right">
    <ul class="su_link-mobile">
  <!-- Mobile header code can go here -->
</ul>
<ul class="right-try-list">
   
</ul>
  </div>
</nav>
  </nav>

  <div class="su_sub-header">
    <div class="container">
      <div class="su_sub-header-inner">
        <!-- <div class="su_subnav-menu-right">
  <div id="auto" style="width: 100%;">
    <div ng-controller="SearchautoController">
      <div bind-html-compile="autocompleteHtml">
        <form class="su__search-box-1" disabled="disabled">
          <input class="su__search-input" type="search" name="Search box" id="su__search-b" placeholder="Search Documentation" disabled="disabled"/>
          <button class="su__search-button" type="submit" class="button button-success" disabled="disabled">
            <svg width="24" height="24" viewBox="0 0 24 24">
              <path
                d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"
                fill="#333"></path>
            </svg>
          </button>
        </form>
      </div>
    </div>
  </div>
</div> -->
        <div class="search-lng-gap"></div>
        <div style="margin-left: 16px; margin-right: 16px;">
          <!-- <select name="lng selector" id="lng-selector">
    <option value="../../../../en/machine-learning/feature-store/uc/feature-tables-uc.html" class="notranslate">English</option>
    <option value="../../../../ja/machine-learning/feature-store/uc/feature-tables-uc.html" class="notranslate">日本語</option>
    <option value="../../../../pt/machine-learning/feature-store/uc/feature-tables-uc.html" class="notranslate">Português (Brasil)</option>
</select> -->
        </div>
        <div class="cloud-selector-container">
          <!-- <select name="cloud provider selector" id="cloud-provider-selector">
    <option value="aws" selected class="notranslate">
        Amazon Web Services
    </option>
    <option value="azure"  class="notranslate">
        Microsoft Azure
    </option>
    <option value="gcp"  class="notranslate">
        Google Cloud Platform
    </option>
</select> -->
        </div>
      </div>
    </div>
  </div>
  <page class="js-page-container">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side su_nav-side">
<div class="wy-side-scroll">
  <div class="wy-side-nav-search">
    

    

    

    
  </div>

  <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
    
      <a href="../../../index.html" class="main-navigation-home">Databricks on AWS</a>
    

    
      

      
        <p class="caption"><span class="caption-text">Load &amp; manage data</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../rag-temp/index.html">RAG Studio</a></li>
</ul>

      
    
  </div>

  <div role="contentinfo">
    
  <p class="build_info notranslate"data-last-edit="December 23, 2023">
    Updated Jan 11, 2024
  </p>
<script>
  window.addEventListener('DOMContentLoaded',function(){
    var h1=document.querySelector('h1');
    var bi=document.querySelector('[data-last-edit]');
    if(h1 && bi){
      var ver = document.createElement('p');
      ver.className = 'version_info';
      ver.textContent = bi.getAttribute('data-last-edit');
      h1.parentElement.insertBefore(ver, h1.nextElementSibling);
    }
  });
</script>

    <p>
      
        <a id='feedbacklink' href="mailto:doc-feedback@databricks.com?subject=Documentation Feedback">Send us feedback</a>
      
    </p>
  </div>
</div>
</nav>
    
    
<main class="wy-grid-for-nav su_nav-grid">
  <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
    <div class="wy-nav-content su__nav_content">
      <div class="rst-content">
        





<div role="navigation" aria-label="breadcrumbs navigation" class="wy-breadcrumbs-wrapper">
  <ul class="wy-breadcrumbs">
    <li><a href="../../../index.html">Documentation</a> <span class="db-icon db-icon-chevron-right"></span></li>
    
    
      <li>Feature Engineering in Unity Catalog</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>
</div>
        
        <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
          <div itemprop="articleBody">
            
    
  <div class="section" id="feature-engineering-in-unity-catalog">
<span id="feature-engineering-in-uc"></span><h1>Feature Engineering in Unity Catalog<a class="headerlink" href="#feature-engineering-in-unity-catalog" title="Permalink to this headline"> </a></h1>
<p>This page describes how to create and work with feature tables in Unity Catalog.</p>
<p>This page applies only to workspaces that are enabled for Unity Catalog. If your workspace is not enabled for Unity Catalog, see <a class="reference internal" href="../workspace-feature-store/feature-tables.html"><span class="doc">Work with features in Workspace Feature Store</span></a>.</p>
<div class="section" id="requirements">
<h2>Requirements<a class="headerlink" href="#requirements" title="Permalink to this headline"> </a></h2>
<p>Feature Engineering in Unity Catalog requires Databricks Runtime 13.2 ML or above. In addition, the Unity Catalog metastore must have <a class="reference internal" href="../../../data-governance/unity-catalog/manage-privileges/upgrade-privilege-model.html"><span class="doc">Privilege Model Version 1.0</span></a>.</p>
<p>It is possible to use Feature Engineering in Unity Catalog in Databricks Runtime 13.1 ML and below with the following limitations:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">drop_table</span></code> is not supported. Use <a class="reference internal" href="#delete-feature-table"><span class="std std-ref">SQL command to delete feature table in Unity Catalog</span></a>.</p></li>
<li><p>Catalog, schema, and table names can contain only alphanumeric characters and underscores (_).</p></li>
<li><p>Logging models to Unity Catalog is not supported.</p></li>
</ul>
</div>
<div class="section" id="install-feature-engineering-in-unity-catalog-python-client">
<span id="install-feature-engineering-in-uc-python-client"></span><h2>Install Feature Engineering in Unity Catalog Python client<a class="headerlink" href="#install-feature-engineering-in-unity-catalog-python-client" title="Permalink to this headline"> </a></h2>
<p>Feature Engineering in Unity Catalog provides a Python client <code class="docutils literal notranslate"><span class="pre">FeatureEngineeringClient</span></code>. The class is available on PyPI with the <code class="docutils literal notranslate"><span class="pre">databricks-feature-engineering</span></code> package and is pre-installed in Databricks Runtime 13.2 ML and above. If you are using a non-ML Databricks Runtime, you need to install the client manually. Use the <a class="reference internal" href="../../../release-notes/runtime/index.html#feature-engineering-compatibility-matrix"><span class="std std-ref">compatibility matrix</span></a> to find the right version for your Databricks Runtime version.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="n">pip</span> <span class="n">install</span> <span class="n">databricks</span><span class="o">-</span><span class="n">feature</span><span class="o">-</span><span class="n">engineering</span>

<span class="n">dbutils</span><span class="o">.</span><span class="n">library</span><span class="o">.</span><span class="n">restartPython</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="section" id="create-a-catalog-and-a-schema-for-feature-tables-in-unity-catalog">
<span id="create-a-catalog-and-a-schema-for-feature-tables-in-uc"></span><h2>Create a catalog and a schema for feature tables in Unity Catalog<a class="headerlink" href="#create-a-catalog-and-a-schema-for-feature-tables-in-unity-catalog" title="Permalink to this headline"> </a></h2>
<p>You must create a new <a class="reference internal" href="../../../lakehouse/data-objects.html#catalog"><span class="std std-ref">catalog</span></a> or use an existing catalog for feature tables.</p>
<p>To create a new catalog, you must have the <code class="docutils literal notranslate"><span class="pre">CREATE</span> <span class="pre">CATALOG</span></code> privilege on the <a class="reference internal" href="../../../lakehouse/data-objects.html#metastore"><span class="std std-ref">metastore</span></a>.</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">CREATE</span><span class="w"> </span><span class="k">CATALOG</span><span class="w"> </span><span class="k">IF</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">EXISTS</span><span class="w"> </span><span class="o">&lt;</span><span class="k">catalog</span><span class="o">-</span><span class="n">name</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>To use an existing catalog, you must have the <code class="docutils literal notranslate"><span class="pre">USE</span> <span class="pre">CATALOG</span></code> privilege on the catalog.</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="n">USE</span><span class="w"> </span><span class="k">CATALOG</span><span class="w"> </span><span class="o">&lt;</span><span class="k">catalog</span><span class="o">-</span><span class="n">name</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>Feature tables in Unity Catalog must be stored in a <a class="reference internal" href="../../../lakehouse/data-objects.html#database"><span class="std std-ref">schema</span></a>. To create a new schema in the catalog, you must have the <code class="docutils literal notranslate"><span class="pre">CREATE</span> <span class="pre">SCHEMA</span></code> privilege on the catalog.</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">CREATE</span><span class="w"> </span><span class="k">SCHEMA</span><span class="w"> </span><span class="k">IF</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">EXISTS</span><span class="w"> </span><span class="o">&lt;</span><span class="k">schema</span><span class="o">-</span><span class="n">name</span><span class="o">&gt;</span>
</pre></div>
</div>
</div>
<div class="section" id="create-a-feature-table-in-unity-catalog">
<span id="create-a-feature-table-in-uc"></span><span id="create-feature-table"></span><h2>Create a feature table in Unity Catalog<a class="headerlink" href="#create-a-feature-table-in-unity-catalog" title="Permalink to this headline"> </a></h2>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>You can also use an existing Delta table in Unity Catalog as a feature table. See <a class="reference internal" href="#use-existing-uc-table"><span class="std std-ref">Use an existing Delta table in Unity Catalog as a feature table</span></a>.</p>
</div>
<p>Feature tables in Unity Catalog are <a class="reference internal" href="../../../delta/index.html"><span class="doc">Delta tables</span></a> managed by Unity Catalog. Feature tables must have a primary key. The name of a feature table in Unity Catalog has a three-level structure, <code class="docutils literal notranslate"><span class="pre">&lt;catalog-name&gt;.&lt;schema-name&gt;.&lt;table-name&gt;</span></code>.</p>
<p>You can use Databricks SQL or the Python <code class="docutils literal notranslate"><span class="pre">FeatureEngineeringClient</span></code> to create feature tables in Unity Catalog.</p>
<div class="js-code-language-tabs compound">
<div class="compound-first compound" lang="Databricks&amp;nbsp;SQL">
<p class="compound-first">You can use any Delta table with a <a class="reference internal" href="../../../sql/language-manual/sql-ref-syntax-ddl-alter-table-add-constraint.html"><span class="doc">Primary Key Constraint</span></a> as a feature table. The following code shows how to create a table with a primary key:</p>
<div class="compound-middle highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">ml</span><span class="p">.</span><span class="n">recommender_system</span><span class="p">.</span><span class="n">customer_features</span><span class="w"> </span><span class="p">(</span>
<span class="w">  </span><span class="n">customer_id</span><span class="w"> </span><span class="nb">int</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<span class="w">  </span><span class="n">feat1</span><span class="w"> </span><span class="n">long</span><span class="p">,</span>
<span class="w">  </span><span class="n">feat2</span><span class="w"> </span><span class="nb">varchar</span><span class="p">(</span><span class="mi">100</span><span class="p">),</span>
<span class="w">  </span><span class="k">CONSTRAINT</span><span class="w"> </span><span class="n">customer_features_pk</span><span class="w"> </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="w"> </span><span class="p">(</span><span class="n">customer_id</span><span class="p">)</span>
<span class="p">);</span>
</pre></div>
</div>
<p class="compound-middle">To create a <a class="reference internal" href="../time-series.html"><span class="doc">time series feature table</span></a>, add a time column as a primary key column and specify the <a class="reference internal" href="../../../sql/language-manual/sql-ref-syntax-ddl-create-table-constraint.html"><span class="doc">TIMESERIES</span></a> keyword. The TIMESERIES keyword requires Databricks Runtime 13.3 LTS or above.</p>
<div class="compound-middle highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">ml</span><span class="p">.</span><span class="n">recommender_system</span><span class="p">.</span><span class="n">customer_features</span><span class="w"> </span><span class="p">(</span>
<span class="w">  </span><span class="n">customer_id</span><span class="w"> </span><span class="nb">int</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<span class="w">  </span><span class="n">ts</span><span class="w"> </span><span class="k">timestamp</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<span class="w">  </span><span class="n">feat1</span><span class="w"> </span><span class="n">long</span><span class="p">,</span>
<span class="w">  </span><span class="n">feat2</span><span class="w"> </span><span class="nb">varchar</span><span class="p">(</span><span class="mi">100</span><span class="p">),</span>
<span class="w">  </span><span class="k">CONSTRAINT</span><span class="w"> </span><span class="n">customer_features_pk</span><span class="w"> </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="w"> </span><span class="p">(</span><span class="n">customer_id</span><span class="p">,</span><span class="w"> </span><span class="n">ts</span><span class="w"> </span><span class="n">TIMESERIES</span><span class="p">)</span>
<span class="p">);</span>
</pre></div>
</div>
<p class="compound-last">After the table is created, you can write data to it in the same way you write other Delta tables, and it can be used as a feature table.</p>
</div>
<div class="compound-last compound" lang="Python">
<p class="compound-first">For details about the commands and parameters used in the following examples, see the <a class="reference external" href="https://api-docs.databricks.com/python/feature-store/latest/index.html">Feature Store Python API reference</a>.</p>
<ol class="compound-middle arabic simple">
<li><p>Write the Python functions to compute the features. The output of each function should be an Apache Spark DataFrame with a unique primary key. The primary key can consist of one or more columns.</p></li>
<li><p>Create a feature table by instantiating a <code class="docutils literal notranslate"><span class="pre">FeatureEngineeringClient</span></code> and using <code class="docutils literal notranslate"><span class="pre">create_table</span></code>.</p></li>
<li><p>Populate the feature table using <code class="docutils literal notranslate"><span class="pre">write_table</span></code>.</p></li>
</ol>
<div class="compound-last highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">databricks.feature_engineering</span> <span class="kn">import</span> <span class="n">FeatureEngineeringClient</span>

<span class="n">fe</span> <span class="o">=</span> <span class="n">FeatureEngineeringClient</span><span class="p">()</span>

<span class="c1"># Prepare feature DataFrame</span>
<span class="k">def</span> <span class="nf">compute_customer_features</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
<span class="w">  </span><span class="sd">&#39;&#39;&#39; Feature computation code returns a DataFrame with &#39;customer_id&#39; as primary key&#39;&#39;&#39;</span>
  <span class="k">pass</span>

<span class="n">customer_features_df</span> <span class="o">=</span> <span class="n">compute_customer_features</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>

<span class="c1"># Create feature table with `customer_id` as the primary key.</span>
<span class="c1"># Take schema from DataFrame output by compute_customer_features</span>
<span class="n">customer_feature_table</span> <span class="o">=</span> <span class="n">fe</span><span class="o">.</span><span class="n">create_table</span><span class="p">(</span>
  <span class="n">name</span><span class="o">=</span><span class="s1">&#39;ml.recommender_system.customer_features&#39;</span><span class="p">,</span>
  <span class="n">primary_keys</span><span class="o">=</span><span class="s1">&#39;customer_id&#39;</span><span class="p">,</span>
  <span class="n">schema</span><span class="o">=</span><span class="n">customer_features_df</span><span class="o">.</span><span class="n">schema</span><span class="p">,</span>
  <span class="n">description</span><span class="o">=</span><span class="s1">&#39;Customer features&#39;</span>
<span class="p">)</span>

<span class="c1"># An alternative is to use `create_table` and specify the `df` argument.</span>
<span class="c1"># This code automatically saves the features to the underlying Delta table.</span>

<span class="c1"># customer_feature_table = fe.create_table(</span>
<span class="c1">#  ...</span>
<span class="c1">#  df=customer_features_df,</span>
<span class="c1">#  ...</span>
<span class="c1"># )</span>

<span class="c1"># To use a composite primary key, pass all primary key columns in the create_table call</span>

<span class="c1"># customer_feature_table = fe.create_table(</span>
<span class="c1">#   ...</span>
<span class="c1">#   primary_keys=[&#39;customer_id&#39;, &#39;date&#39;],</span>
<span class="c1">#   ...</span>
<span class="c1"># )</span>

<span class="c1"># To create a time series table, set the timeseries_columns argument</span>

<span class="c1"># customer_feature_table = fe.create_table(</span>
<span class="c1">#   ...</span>
<span class="c1">#   primary_keys=[&#39;customer_id&#39;, &#39;date&#39;],</span>
<span class="c1">#   timeseries_columns=&#39;date&#39;,</span>
<span class="c1">#   ...</span>
<span class="c1"># )</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="use-an-existing-delta-table-in-unity-catalog-as-a-feature-table">
<span id="use-an-existing-delta-table-in-uc-as-a-feature-table"></span><span id="use-existing-uc-table"></span><h2>Use an existing Delta table in Unity Catalog as a feature table<a class="headerlink" href="#use-an-existing-delta-table-in-unity-catalog-as-a-feature-table" title="Permalink to this headline"> </a></h2>
<p>Any Delta table in Unity Catalog with a primary key can be a feature table in Unity Catalog, and you can use the Feature Store UI and API with the table.</p>
<p>If an existing Delta table in Unity Catalog does not have a <a class="reference internal" href="../../../sql/language-manual/sql-ref-syntax-ddl-alter-table-add-constraint.html"><span class="doc">Primary Key Constraint</span></a>, you can create one as follows:</p>
<ol class="arabic">
<li><p>Set primary key columns to <code class="docutils literal notranslate"><span class="pre">NOT</span> <span class="pre">NULL</span></code>. For each primary key column, run:</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">ALTER</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="o">&lt;</span><span class="n">full_table_name</span><span class="o">&gt;</span><span class="w"> </span><span class="k">ALTER</span><span class="w"> </span><span class="k">COLUMN</span><span class="w"> </span><span class="o">&lt;</span><span class="n">pk_col_name</span><span class="o">&gt;</span><span class="w"> </span><span class="k">SET</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span>
</pre></div>
</div>
</li>
<li><p>Alter the table to add the Primary Key Constraint:</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">ALTER</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="o">&lt;</span><span class="n">full_table_name</span><span class="o">&gt;</span><span class="w"> </span><span class="k">ADD</span><span class="w"> </span><span class="k">CONSTRAINT</span><span class="w"> </span><span class="o">&lt;</span><span class="n">pk_name</span><span class="o">&gt;</span><span class="w"> </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="p">(</span><span class="n">pk_col1</span><span class="p">,</span><span class="w"> </span><span class="n">pk_col2</span><span class="p">,</span><span class="w"> </span><span class="p">...)</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">pk_name</span></code> is the name of the Primary Key Constraint. By convention, you can use the table name (without schema and catalog) with a <code class="docutils literal notranslate"><span class="pre">_pk</span></code> suffix. For example, a table with the name <code class="docutils literal notranslate"><span class="pre">&quot;ml.recommender_system.customer_features&quot;</span></code> would have <code class="docutils literal notranslate"><span class="pre">customer_features_pk</span></code> as the name of its Primary Key Constraint.</p>
<p>To make the table a <a class="reference internal" href="../time-series.html"><span class="doc">time series feature table</span></a>, specify the <a class="reference internal" href="../../../sql/language-manual/sql-ref-syntax-ddl-create-table-constraint.html"><span class="doc">TIMESERIES</span></a> keyword on one of the primary key columns, as follows:</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">ALTER</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="o">&lt;</span><span class="n">full_table_name</span><span class="o">&gt;</span><span class="w"> </span><span class="k">ADD</span><span class="w"> </span><span class="k">CONSTRAINT</span><span class="w"> </span><span class="o">&lt;</span><span class="n">pk_name</span><span class="o">&gt;</span><span class="w"> </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="p">(</span><span class="n">pk_col1</span><span class="w"> </span><span class="n">TIMESERIES</span><span class="p">,</span><span class="w"> </span><span class="n">pk_col2</span><span class="p">,</span><span class="w"> </span><span class="p">...)</span>
</pre></div>
</div>
<p>After you add the Primary Key Constraint on the table, the table appears in the Feature Store UI and you can use it as a feature table.</p>
</li>
</ol>
<div class="admonition note">
<p class="admonition-title">Note</p>
<ul class="simple">
<li><p>Only the table owner can declare Primary Key Constraints. The owner’s name is displayed on the table detail page of Catalog Explorer.</p></li>
<li><p>You need to verify the data type in the Delta table is supported by Feature Store. See <a class="reference internal" href="#supported-data-types"><span class="std std-ref">Supported data types</span></a>.</p></li>
<li><p>The <a class="reference internal" href="../../../sql/language-manual/sql-ref-syntax-ddl-create-table-constraint.html"><span class="doc">TIMESERIES</span></a> keyword requires Databricks Runtime 13.3 LTS or above.</p></li>
</ul>
</div>
</div>
<div class="section" id="control-access-to-feature-tables-in-unity-catalog">
<span id="control-access-to-feature-tables-in-uc"></span><h2>Control access to feature tables in Unity Catalog<a class="headerlink" href="#control-access-to-feature-tables-in-unity-catalog" title="Permalink to this headline"> </a></h2>
<p>Access control for feature tables in Unity Catalog is managed by Unity Catalog. See <a class="reference internal" href="../../../data-governance/unity-catalog/manage-privileges/index.html"><span class="doc">Unity Catalog privileges</span></a>.</p>
</div>
<div class="section" id="update-a-feature-table-in-unity-catalog">
<span id="update-a-feature-table-in-uc"></span><h2>Update a feature table in Unity Catalog<a class="headerlink" href="#update-a-feature-table-in-unity-catalog" title="Permalink to this headline"> </a></h2>
<p>You can update a feature table in Unity Catalog by adding new features or by modifying specific rows based on the primary key.</p>
<p>The following feature table metadata should not be updated:</p>
<ul class="simple">
<li><p>Primary key.</p></li>
<li><p>Partition key.</p></li>
<li><p>Name or data type of an existing feature.</p></li>
</ul>
<p>Altering them will cause downstream pipelines that use features for training and serving models to break.</p>
<div class="section" id="add-new-features-to-an-existing-feature-table-in-unity-catalog">
<span id="add-new-features-to-an-existing-feature-table-in-uc"></span><h3>Add new features to an existing feature table in Unity Catalog<a class="headerlink" href="#add-new-features-to-an-existing-feature-table-in-unity-catalog" title="Permalink to this headline"> </a></h3>
<p>You can add new features to an existing feature table in one of two ways:</p>
<ul class="simple">
<li><p>Update the existing feature computation function and run <code class="docutils literal notranslate"><span class="pre">write_table</span></code> with the returned DataFrame. This updates the feature table schema and merges new feature values based on the primary key.</p></li>
<li><p>Create a new feature computation function to calculate the new feature values. The DataFrame returned by this new computation function must contain the feature tables’s primary keys and partition keys (if defined). Run <code class="docutils literal notranslate"><span class="pre">write_table</span></code> with the DataFrame to write the new features to the existing feature table, using the same primary key.</p></li>
</ul>
</div>
<div class="section" id="update-only-specific-rows-in-a-feature-table">
<h3>Update only specific rows in a feature table<a class="headerlink" href="#update-only-specific-rows-in-a-feature-table" title="Permalink to this headline"> </a></h3>
<p>Use <code class="docutils literal notranslate"><span class="pre">mode</span> <span class="pre">=</span> <span class="pre">&quot;merge&quot;</span></code> in <code class="docutils literal notranslate"><span class="pre">write_table</span></code>. Rows whose primary key does not exist in the DataFrame sent in the <code class="docutils literal notranslate"><span class="pre">write_table</span></code> call remain unchanged.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">databricks.feature_engineering</span> <span class="kn">import</span> <span class="n">FeatureEngineeringClient</span>
<span class="n">fe</span> <span class="o">=</span> <span class="n">FeatureEngineeringClient</span><span class="p">()</span>
<span class="n">fe</span><span class="o">.</span><span class="n">write_table</span><span class="p">(</span>
  <span class="n">name</span><span class="o">=</span><span class="s1">&#39;ml.recommender_system.customer_features&#39;</span><span class="p">,</span>
  <span class="n">df</span> <span class="o">=</span> <span class="n">customer_features_df</span><span class="p">,</span>
  <span class="n">mode</span> <span class="o">=</span> <span class="s1">&#39;merge&#39;</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="schedule-a-job-to-update-a-feature-table">
<h3>Schedule a job to update a feature table<a class="headerlink" href="#schedule-a-job-to-update-a-feature-table" title="Permalink to this headline"> </a></h3>
<p>To ensure that features in feature tables always have the most recent values, Databricks recommends that you <a class="reference internal" href="../../../workflows/jobs/create-run-jobs.html"><span class="doc">create a job</span></a> that runs a notebook to update your feature table on a regular basis, such as every day. If you already have a non-scheduled job created, you can convert it to a <a class="reference internal" href="../../../workflows/jobs/schedule-jobs.html#job-schedule"><span class="std std-ref">scheduled job</span></a> to make sure the feature values are always up-to-date.</p>
<p>Code to update a feature table uses <code class="docutils literal notranslate"><span class="pre">mode='merge'</span></code>, as shown in the following example.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">databricks.feature_engineering</span> <span class="kn">import</span> <span class="n">FeatureEngineeringClient</span>
<span class="n">fe</span> <span class="o">=</span> <span class="n">FeatureEngineeringClient</span><span class="p">()</span>

<span class="n">customer_features_df</span> <span class="o">=</span> <span class="n">compute_customer_features</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

<span class="n">fe</span><span class="o">.</span><span class="n">write_table</span><span class="p">(</span>
  <span class="n">df</span><span class="o">=</span><span class="n">customer_features_df</span><span class="p">,</span>
  <span class="n">name</span><span class="o">=</span><span class="s1">&#39;ml.recommender_system.customer_features&#39;</span><span class="p">,</span>
  <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;merge&#39;</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="store-past-values-of-daily-features">
<h3>Store past values of daily features<a class="headerlink" href="#store-past-values-of-daily-features" title="Permalink to this headline"> </a></h3>
<p>Define a feature table with a composite primary key. Include the date in the primary key. For example, for a feature table <code class="docutils literal notranslate"><span class="pre">customer_features</span></code>, you might use a composite primary key (<code class="docutils literal notranslate"><span class="pre">date</span></code>, <code class="docutils literal notranslate"><span class="pre">customer_id</span></code>) and partition key <code class="docutils literal notranslate"><span class="pre">date</span></code> for efficient reads.</p>
<div class="js-code-language-tabs compound">
<div class="compound-first compound" lang="Databricks&amp;nbsp;SQL">
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">ml</span><span class="p">.</span><span class="n">recommender_system</span><span class="p">.</span><span class="n">customer_features</span><span class="w"> </span><span class="p">(</span>
<span class="w">  </span><span class="n">customer_id</span><span class="w"> </span><span class="nb">int</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<span class="w">  </span><span class="o">`</span><span class="nb">date</span><span class="o">`</span><span class="w"> </span><span class="nb">date</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<span class="w">  </span><span class="n">feat1</span><span class="w"> </span><span class="n">long</span><span class="p">,</span>
<span class="w">  </span><span class="n">feat2</span><span class="w"> </span><span class="nb">varchar</span><span class="p">(</span><span class="mi">100</span><span class="p">),</span>
<span class="w">  </span><span class="k">CONSTRAINT</span><span class="w"> </span><span class="n">customer_features_pk</span><span class="w"> </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="w"> </span><span class="p">(</span><span class="o">`</span><span class="nb">date</span><span class="o">`</span><span class="p">,</span><span class="w"> </span><span class="n">customer_id</span><span class="p">)</span>
<span class="p">)</span>
<span class="n">PARTITIONED</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="p">(</span><span class="o">`</span><span class="nb">date</span><span class="o">`</span><span class="p">)</span>
<span class="k">COMMENT</span><span class="w"> </span><span class="ss">&quot;Customer features&quot;</span><span class="p">;</span>
</pre></div>
</div>
</div>
<div class="compound-last compound" lang="Python">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">databricks.feature_engineering</span> <span class="kn">import</span> <span class="n">FeatureEngineeringClient</span>
<span class="n">fe</span> <span class="o">=</span> <span class="n">FeatureEngineeringClient</span><span class="p">()</span>
<span class="n">fe</span><span class="o">.</span><span class="n">create_table</span><span class="p">(</span>
  <span class="n">name</span><span class="o">=</span><span class="s1">&#39;ml.recommender_system.customer_features&#39;</span><span class="p">,</span>
  <span class="n">primary_keys</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">,</span> <span class="s1">&#39;customer_id&#39;</span><span class="p">],</span>
  <span class="n">partition_columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">],</span>
  <span class="n">schema</span><span class="o">=</span><span class="n">customer_features_df</span><span class="o">.</span><span class="n">schema</span><span class="p">,</span>
  <span class="n">description</span><span class="o">=</span><span class="s1">&#39;Customer features&#39;</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>You can then create code to read from the feature table filtering <code class="docutils literal notranslate"><span class="pre">date</span></code> to the time period of interest.</p>
<p>You can also create a <a class="reference internal" href="../time-series.html"><span class="doc">time series feature table</span></a> which enables point-in-time lookups when you use <code class="docutils literal notranslate"><span class="pre">create_training_set</span></code> or <code class="docutils literal notranslate"><span class="pre">score_batch</span></code>. See <a class="reference internal" href="#create-feature-table"><span class="std std-ref">Create a feature table in Unity Catalog</span></a>.</p>
<p>To keep the feature table up to date, set up a regularly scheduled job to write features, or stream new feature values into the feature table.</p>
</div>
<div class="section" id="create-a-streaming-feature-computation-pipeline-to-update-features">
<h3>Create a streaming feature computation pipeline to update features<a class="headerlink" href="#create-a-streaming-feature-computation-pipeline-to-update-features" title="Permalink to this headline"> </a></h3>
<p>To create a streaming feature computation pipeline, pass a streaming <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code> as an argument to <code class="docutils literal notranslate"><span class="pre">write_table</span></code>. This method returns a <code class="docutils literal notranslate"><span class="pre">StreamingQuery</span></code> object.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">compute_additional_customer_features</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
<span class="w">  </span><span class="sd">&#39;&#39;&#39; Returns Streaming DataFrame</span>
<span class="sd">  &#39;&#39;&#39;</span>
  <span class="k">pass</span>

<span class="kn">from</span> <span class="nn">databricks.feature_engineering</span> <span class="kn">import</span> <span class="n">FeatureEngineeringClient</span>
<span class="n">fe</span> <span class="o">=</span> <span class="n">FeatureEngineeringClient</span><span class="p">()</span>

<span class="n">customer_transactions</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">readStream</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s2">&quot;dbfs:/events/customer_transactions&quot;</span><span class="p">)</span>
<span class="n">stream_df</span> <span class="o">=</span> <span class="n">compute_additional_customer_features</span><span class="p">(</span><span class="n">customer_transactions</span><span class="p">)</span>

<span class="n">fe</span><span class="o">.</span><span class="n">write_table</span><span class="p">(</span>
  <span class="n">df</span><span class="o">=</span><span class="n">stream_df</span><span class="p">,</span>
  <span class="n">name</span><span class="o">=</span><span class="s1">&#39;ml.recommender_system.customer_features&#39;</span><span class="p">,</span>
  <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;merge&#39;</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="read-from-a-feature-table-in-unity-catalog">
<span id="read-from-a-feature-table-in-uc"></span><h2>Read from a feature table in Unity Catalog<a class="headerlink" href="#read-from-a-feature-table-in-unity-catalog" title="Permalink to this headline"> </a></h2>
<p>Use <code class="docutils literal notranslate"><span class="pre">read_table</span></code> to read feature values.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">databricks.feature_engineering</span> <span class="kn">import</span> <span class="n">FeatureEngineeringClient</span>
<span class="n">fe</span> <span class="o">=</span> <span class="n">FeatureEngineeringClient</span><span class="p">()</span>
<span class="n">customer_features_df</span> <span class="o">=</span> <span class="n">fe</span><span class="o">.</span><span class="n">read_table</span><span class="p">(</span>
  <span class="n">name</span><span class="o">=</span><span class="s1">&#39;ml.recommender_system.customer_features&#39;</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="search-and-browse-feature-tables-in-unity-catalog">
<span id="search-and-browse-feature-tables-in-uc"></span><span id="search-feature-table"></span><h2>Search and browse feature tables in Unity Catalog<a class="headerlink" href="#search-and-browse-feature-tables-in-unity-catalog" title="Permalink to this headline"> </a></h2>
<p>Use the Features UI to search for or browse feature tables in Unity Catalog.</p>
<ol class="arabic">
<li><p>Click <img alt="Feature Store Icon" src="../../../_images/feature-store-icon.png" /> <strong>Features</strong> in the sidebar to display the Features UI.</p></li>
<li><p>Select catalog with the catalog selector to view all of the available feature tables in that catalog. In the search box, enter all or part of the name of a feature table, a feature, or a comment. You can also enter all or part of the <a class="reference internal" href="#feature-table-tags"><span class="std std-ref">key or value of a tag</span></a>. Search text is case-insensitive.</p>
<div class="figure align-default">
<img alt="Feature search example" src="../../../_images/feature-search-example-uc.png" />
</div>
</li>
</ol>
</div>
<div class="section" id="get-metadata-of-feature-tables-in-unity-catalog">
<span id="get-metadata-of-feature-tables-in-uc"></span><h2>Get metadata of feature tables in Unity Catalog<a class="headerlink" href="#get-metadata-of-feature-tables-in-unity-catalog" title="Permalink to this headline"> </a></h2>
<p>Use <code class="docutils literal notranslate"><span class="pre">get_table</span></code> to get feature table metadata.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">databricks.feature_engineering</span> <span class="kn">import</span> <span class="n">FeatureEngineeringClient</span>
<span class="n">fe</span> <span class="o">=</span> <span class="n">FeatureEngineeringClient</span><span class="p">()</span>
<span class="n">ft</span> <span class="o">=</span> <span class="n">fe</span><span class="o">.</span><span class="n">get_table</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;ml.recommender_system.user_feature_table&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">ft</span><span class="o">.</span><span class="n">features</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="tags-of-feature-tables-in-unity-catalog">
<span id="tags-of-feature-tables-in-uc"></span><span id="feature-table-tags"></span><h2>Tags of feature tables in Unity Catalog<a class="headerlink" href="#tags-of-feature-tables-in-unity-catalog" title="Permalink to this headline"> </a></h2>
<p>Tags are key-value pairs that you can create and use to <a class="reference internal" href="#search-feature-table"><span class="std std-ref">search for feature tables</span></a>. You can create, edit, and delete tags using the <a class="reference internal" href="../../../catalog-explorer/index.html"><span class="doc">Catalog Explorer UI</span></a> or the <a class="reference internal" href="../python-api.html"><span class="doc">Feature Store Python API</span></a>.</p>
<div class="section" id="create-feature-table-with-tag-using-the-feature-store-python-api">
<h3>Create feature table with tag using the Feature Store Python API<a class="headerlink" href="#create-feature-table-with-tag-using-the-feature-store-python-api" title="Permalink to this headline"> </a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">databricks.feature_engineering</span> <span class="kn">import</span> <span class="n">FeatureEngineeringClient</span>
<span class="n">fe</span> <span class="o">=</span> <span class="n">FeatureEngineeringClient</span><span class="p">()</span>

<span class="n">customer_feature_table</span> <span class="o">=</span> <span class="n">fe</span><span class="o">.</span><span class="n">create_table</span><span class="p">(</span>
  <span class="c1"># ...</span>
  <span class="n">tags</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;tag_key_1&quot;</span><span class="p">:</span> <span class="s2">&quot;tag_value_1&quot;</span><span class="p">,</span> <span class="s2">&quot;tag_key_2&quot;</span><span class="p">:</span> <span class="s2">&quot;tag_value_2&quot;</span><span class="p">,</span> <span class="o">...</span><span class="p">},</span>
  <span class="c1"># ...</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="add-update-and-delete-tags-using-the-feature-store-python-api">
<h3>Add, update, and delete tags using the Feature Store Python API<a class="headerlink" href="#add-update-and-delete-tags-using-the-feature-store-python-api" title="Permalink to this headline"> </a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">databricks.feature_engineering</span> <span class="kn">import</span> <span class="n">FeatureEngineeringClient</span>
<span class="n">fe</span> <span class="o">=</span> <span class="n">FeatureEngineeringClient</span><span class="p">()</span>

<span class="c1"># Upsert a tag</span>
<span class="n">fe</span><span class="o">.</span><span class="n">set_feature_table_tag</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;my_table&quot;</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="s2">&quot;quality&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="s2">&quot;gold&quot;</span><span class="p">)</span>

<span class="c1"># Delete a tag</span>
<span class="n">fe</span><span class="o">.</span><span class="n">delete_feature_table_tag</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;my_table&quot;</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="s2">&quot;quality&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="delete-a-feature-table-in-unity-catalog">
<span id="delete-a-feature-table-in-uc"></span><span id="delete-feature-table"></span><h2>Delete a feature table in Unity Catalog<a class="headerlink" href="#delete-a-feature-table-in-unity-catalog" title="Permalink to this headline"> </a></h2>
<p>You can delete a feature table in Unity Catalog by directly deleting the Delta table in Unity Catalog using the Catalog Explorer or using the <a class="reference internal" href="../python-api.html"><span class="doc">Feature Store Python API</span></a>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<ul class="simple">
<li><p>Deleting a feature table can lead to unexpected failures in upstream producers and downstream consumers (models, endpoints, and scheduled jobs). You must delete published online stores with your cloud provider.</p></li>
<li><p>When you delete a feature table in Unity Catalog, the underlying Delta table is also dropped.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">drop_table</span></code> is not supported in Databricks Runtime 13.1 ML or below. Use SQL command to delete the table.</p></li>
</ul>
</div>
<p>You can use Databricks SQL or <code class="docutils literal notranslate"><span class="pre">FeatureEngineeringClient.drop_table</span></code> to delete a feature table in Unity Catalog:</p>
<div class="js-code-language-tabs compound">
<div class="compound-first compound" lang="Databricks&amp;nbsp;SQL">
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">DROP</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">ml</span><span class="p">.</span><span class="n">recommender_system</span><span class="p">.</span><span class="n">customer_features</span><span class="p">;</span>
</pre></div>
</div>
</div>
<div class="compound-last compound" lang="Python">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">databricks.feature_engineering</span> <span class="kn">import</span> <span class="n">FeatureEngineeringClient</span>
<span class="n">fe</span> <span class="o">=</span> <span class="n">FeatureEngineeringClient</span><span class="p">()</span>
<span class="n">fe</span><span class="o">.</span><span class="n">drop_table</span><span class="p">(</span>
  <span class="n">name</span><span class="o">=</span><span class="s1">&#39;ml.recommender_system.customer_features&#39;</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="upgrade-a-workspace-feature-table-to-unity-catalog">
<span id="upgrade-a-workspace-feature-table-to-uc"></span><span id="upgrade-feature-table"></span><h2>Upgrade a workspace feature table to Unity Catalog<a class="headerlink" href="#upgrade-a-workspace-feature-table-to-unity-catalog" title="Permalink to this headline"> </a></h2>
<p>First, upgrade the underlying workspace Delta table by following <a class="reference internal" href="../../../data-governance/unity-catalog/migrate.html"><span class="doc">Upgrade tables and views to Unity Catalog</span></a>.</p>
<p>After the underlying table and data are available in Unity Catalog, you can upgrade the workspace feature table metadata to Unity Catalog by using <code class="docutils literal notranslate"><span class="pre">upgrade_workspace_table</span></code>. Databricks recommends always using the latest version of <code class="docutils literal notranslate"><span class="pre">databricks-feature-engineering</span></code> for this operation, regardless of the Databricks Runtime version you are using.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="n">pip</span> <span class="n">install</span> <span class="n">databricks</span><span class="o">-</span><span class="n">feature</span><span class="o">-</span><span class="n">engineering</span> <span class="o">--</span><span class="n">upgrade</span>

<span class="n">dbutils</span><span class="o">.</span><span class="n">library</span><span class="o">.</span><span class="n">restartPython</span><span class="p">()</span>

<span class="kn">from</span> <span class="nn">databricks.feature_engineering</span> <span class="kn">import</span> <span class="n">UpgradeClient</span>
<span class="n">upgrade_client</span> <span class="o">=</span> <span class="n">UpgradeClient</span><span class="p">()</span>
<span class="n">upgrade_client</span><span class="o">.</span><span class="n">upgrade_workspace_table</span><span class="p">(</span>
  <span class="n">source_workspace_table</span><span class="o">=</span><span class="s1">&#39;recommender_system.customer_features&#39;</span><span class="p">,</span>
  <span class="n">target_uc_table</span><span class="o">=</span><span class="s1">&#39;ml.recommender_system.customer_features&#39;</span>
<span class="p">)</span>
</pre></div>
</div>
<p>The following metadata is upgraded to Unity Catalog:</p>
<ul class="simple">
<li><p>Primary keys</p></li>
<li><p>Timeseries columns</p></li>
<li><p>Table and column comments (descriptions)</p></li>
<li><p>Table and column tags</p></li>
<li><p>Notebook and job lineage</p></li>
</ul>
<p>If the target table has existing table or column comments that are different from the source table, the upgrade method skips upgrading comments and logs a warning. If you are using version 0.1.2 or below of <code class="docutils literal notranslate"><span class="pre">databricks-feature-engineering</span></code>, an error is thrown and the upgrade does not run. For all other metadata, a mismatch between the target table and source table causes an error and prevents the upgrade. To bypass the error and overwrite any existing metadata on the target Unity Catalog table, pass <code class="docutils literal notranslate"><span class="pre">overwrite</span> <span class="pre">=</span> <span class="pre">True</span></code> to the API:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">upgrade_client</span><span class="o">.</span><span class="n">upgrade_workspace_table</span><span class="p">(</span>
  <span class="n">source_workspace_table</span><span class="o">=</span><span class="s1">&#39;recommender_system.customer_features&#39;</span><span class="p">,</span>
  <span class="n">target_uc_table</span><span class="o">=</span><span class="s1">&#39;ml.recommender_system.customer_features&#39;</span><span class="p">,</span>
  <span class="n">overwrite</span><span class="o">=</span><span class="kc">True</span>
<span class="p">)</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<ul class="simple">
<li><p>Before calling this API, you must first upgrade the underlying workspace Delta table to Unity Catalog.</p></li>
<li><p>Upgrading tags and time series columns is not supported in Databricks Runtime 13.2 ML and below.</p></li>
<li><p>Remember to notify producers and consumers of the upgraded feature table to start using the new table name in Unity Catalog. If the target table in Unity Catalog was upgraded using <code class="docutils literal notranslate"><span class="pre">CREATE</span> <span class="pre">TABLE</span> <span class="pre">AS</span> <span class="pre">SELECT</span></code> or a similar way that cloned the source table, updates to the source table are not automatically synchronized in the target table.</p></li>
</ul>
</div>
</div>
<div class="section" id="supported-data-types">
<h2>Supported data types<a class="headerlink" href="#supported-data-types" title="Permalink to this headline"> </a></h2>
<p>Feature Store with Unity Catalog supports the following <a class="reference external" href="https://spark.apache.org/docs/latest/sql-ref-datatypes.html">PySpark data types</a>:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">IntegerType</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">FloatType</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">BooleanType</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">StringType</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">DoubleType</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">LongType</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">TimestampType</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">DateType</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ShortType</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ArrayType</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">BinaryType</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">DecimalType</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">MapType</span></code></p></li>
</ul>
<p>The data types listed above support feature types that are common in machine learning applications. For example:</p>
<ul class="simple">
<li><p>You can store dense vectors, tensors, and embeddings as <code class="docutils literal notranslate"><span class="pre">ArrayType</span></code>.</p></li>
<li><p>You can store sparse vectors, tensors, and embeddings as <code class="docutils literal notranslate"><span class="pre">MapType</span></code>.</p></li>
<li><p>You can store text as <code class="docutils literal notranslate"><span class="pre">StringType</span></code>.</p></li>
</ul>
<p>When published to online stores, <code class="docutils literal notranslate"><span class="pre">ArrayType</span></code> and <code class="docutils literal notranslate"><span class="pre">MapType</span></code> features are stored in JSON format.</p>
<div class="toctree-wrapper compound">
</div>
</div>
</div>


    
          </div>
        </div>
        <div  class="suapp-rating">
  <div id="suPageRateApp">
     <su-app></su-app>
   </div> 
 </div>
<hr> 
<footer>
  <div role="contentinfo">
      <p class="copyright">
          &copy; Databricks 2023. All rights reserved. Apache, Apache Spark, Spark, and the Spark logo are trademarks of the <a href="http://www.apache.org/">Apache Software Foundation</a>.
      </p>
      <p> 
        
          <a id='feedbacklink' href="mailto:doc-feedback@databricks.com?subject=Documentation Feedback">Send us feedback</a>
        
     | <a href="https://databricks.com/privacy-policy">Privacy Policy</a> | <a href="https://databricks.com/terms-of-use">Terms of Use</a></p>

  </div> 

</footer>
      </div>
    </div>
  </section>
</main>

  </page>
  
  <script type="text/javascript">
    var DOCUMENTATION_OPTIONS = {
      URL_ROOT: '../../../',
      VERSION: '1.0',
      COLLAPSE_INDEX: false,
      FILE_SUFFIX: '.html',
      HAS_SOURCE: 'false'
    };
  </script>
  <script type="text/javascript" src="../../../_static/jquery.js"></script>
  <script type="text/javascript" src="../../../_static/underscore.js"></script>
  <script type="text/javascript" src="../../../_static/doctools.js"></script>
  <script type="text/javascript" src="../../../_static/language_data.js"></script>
  

  <script type="text/javascript" src="../../../_static/js/clipboard.min.js"></script>
  <script type="text/javascript" src="../../../_static/js/jquery.waypoints.min.js"></script>

  <!-- Select2 (https://select2.org/) -->
  <link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />
  <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
  <!-- End Select2 -->

  
  
  <script type="text/javascript" src="../../../_static/js/localized.js"></script>
  <script type="text/javascript" src="../../../_static/js/custom.js"></script>
  

  
  
  <script type="text/javascript">
    jQuery(function () {
      SphinxRtdTheme.StickyNav.enable();
    });

  </script>
  
 



  <script>
  window.__searchunifyLoaderConfig = JSON.parse('{"clients": {"en": "02c2e804-27e9-11ee-aefb-0242ac120011", "ja": "6a42c3f2-2820-11ee-aefb-0242ac120011", "pt": "6a86badd-2821-11ee-aefb-0242ac120011"}}')
</script>
<script type="text/javascript" src="../../../_static/js/search-loader.js"></script>
</body>
<script type='text/javascript'>
  window.onload = function () {
    var description = document.querySelector('meta[name="description"]').getAttribute("content");
    let titleText = document.querySelector('h1').textContent;
    document.querySelector('meta[property="og:title"]').setAttribute("content", titleText);
    document.querySelector('meta[property="og:description"]').setAttribute("content", description);
    document.querySelector('meta[property="twitter:description"]').setAttribute("content", description);
  };
</script>

</html>