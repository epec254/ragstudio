

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en-US" > <![endif]-->
<!--[if gt IE 8]><!-->
<html class="no-js" lang="en-US"> <!--<![endif]-->

<head>
  <!-- cookie consent -->
  
    <!-- Combined Onetrust and Rudderstack Implementation Scripts -->
    <!-- Onetrust Initialization -->
    <script type="text/javascript" src="https://cdn.cookielaw.org/consent/92466579-1717-44d3-809d-a05fb02843ed-test/OtAutoBlock.js"></script>
    <script src="https://cdn.cookielaw.org/scripttemplates/otSDKStub.js" data-document-language="true" type="text/javascript" charset="UTF-8" data-domain-script="92466579-1717-44d3-809d-a05fb02843ed-test"></script>
    <link rel="stylesheet" id="db-onetrust-style" href="https://www.databricks.com/wp-content/uploads/db_onetrust.css" media="all" />
    <!-- Setting Rudderstack Write Key -->
    <script>window.rudderstackKey = "2SOR9fvSr5Fi6tN2ihPbVHnX1SZ" </script>
    <!-- Rudderstack Initialization + Onetrust Integration + Rudderstack Custom Events -->
    <script type="text/javascript" src="https://www.databricks.com/sites/default/files/rudderstack/v1/db-rudderstack-events.js"></script>

  <!-- cookie consent -->

  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta http-equiv="X-UA-Compatible" content="IE=9" />
  <meta content="This article provides guidance for how to query Databricks Foundation Model APIs. It includes instructions from initial package installation to how to format queries to the endpoint and expected response formats." name="description" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0">
  <meta property="og:image" content="https://www.databricks.com/wp-content/uploads/2020/04/og-databricks.png">
  <meta property="og:image:type" content="image/png">
  <meta property="og:title" content="How to query Foundation Model APIs with the Python SDK">
  <meta property="og:image:width" content="1200">
  <meta property="og:image:height" content="630">
  <meta property="og:type" content="website">
  <meta property="og:url" content="https://docs.databricks.com">
  <meta property="og:description" content="" id="og-description">
  <meta name="twitter:image" content="https://www.databricks.com/wp-content/uploads/2020/04/og-databricks.png">
  <meta name="twitter:site" content="@databricks">
  <meta name="twitter:creator" content="@databricks">
  <meta property="twitter:description" content="">
  
  <title>How to query Foundation Model APIs with the Python SDK &#124; Databricks on AWS</title>
  
  
  <link rel="canonical" href="https://docs.databricks.com/en/machine-learning/foundation-models/query-foundation-model-apis.html">
  <!-- Start hreflang tag -->
  <link rel="alternate" hreflang="en" href="https://docs.databricks.com/en/machine-learning/foundation-models/query-foundation-model-apis.html" />
<link rel="alternate" hreflang="x-default" href="https://docs.databricks.com/en/machine-learning/foundation-models/query-foundation-model-apis.html" />
  <!-- End hreflang tag -->
  
  
  <link rel="shortcut icon" href="../../_static/favicon.ico" />
  

  

  

  <!-- Google Tag Manager -->
  <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'https://www.googletagmanager.com/gtm.js?id='+i+dl;
j.setAttributeNode(d.createAttribute('data-ot-ignore'));
f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-T85FQ33');</script>
  <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'https://www.googletagmanager.com/gtm.js?id='+i+dl;
j.setAttributeNode(d.createAttribute('data-ot-ignore'));
f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-TWTKQQ');</script>
    
  <!-- End Google Tag Manager -->


  <!-- MaxMind / GEO IP -->
  <script src="//js.maxmind.com/js/apis/geoip2/v2.1/geoip2.js" type="text/javascript"></script>
  <!-- End MaxMind / GEO IP -->

  
  
  <link href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,600&display=swap" rel="stylesheet">
  <link rel="preload" href="../../_static/fonts/DMSans-Bold.ttf" as="font">
  <link rel="preload" href="../../_static/fonts/DMSans-Regular.ttf" as="font">
  <link rel="preload" href="../../_static/fonts/DMMono-Regular.ttf" as="font">
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/css/custom.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/css/cloud-provider-selector.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/css/translation-selector.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/css/searchunify/main.css" type="text/css" />

  
  <link rel="index" title="Index" href="../../genindex.html" />
  <link rel="search" title="Search" href="../../search.html" />
  <link rel="top" title="Databricks on AWS" href="../../index.html" /> 
</head>

<body class="wy-body-for-nav" role="document">

  <!-- Google Tag Manager (noscript) -->
  <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-T85FQ33"
height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
  <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-TWTKQQ"
    height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
  <!-- End Google Tag Manager (noscript) -->

  
  <nav class="wy-nav-top header su_header" role="navigation" aria-label="top navigation">
    
<nav class="wy-nav-top header su_header" role="navigation" aria-label="top navigation">
  <div class="container-logo">
    <ul class="mobile-menu-toggle">
        <li class="menu-toggle">
            <i data-toggle="wy-nav-top" class="wy-nav-top-menu-button db-icon db-icon-menu pull-left"></i>
            
            <a href="https://www.databricks.com/" class="wy-nav-top-logo"><img src="../../_static/small-scale-lockup-full-color-rgb.svg" width="137" height="21"
              alt="Databricks" /></a>   
               
              </li>
    </ul>
    <ul class="su_nav-menu">
      <li class="menu-toggle">
        <i data-toggle="wy-nav-top" class="wy-nav-top-menu-button db-icon db-icon-menu pull-left"></i>
        
          
        
        <a href="https://www.databricks.com/" class="wy-nav-top-logo"><img src="../../_static/small-scale-lockup-full-color-rgb.svg" width="137" height="21"
            alt="Databricks" /></a></li>
        <!-- 
<li><a href="https://help.databricks.com/s/">Help Center</a></li>
<li class="active"><a href="https://docs.databricks.com/en/">Documentation</a></li>
<li><a href="https://kb.databricks.com/">Knowledge Base</a></li>
 -->
    </ul>
  </div>
  <div class="su_nav-right">
    <ul class="su_link-mobile">
  <!-- Mobile header code can go here -->
</ul>
<ul class="right-try-list">
   
</ul>
  </div>
</nav>
  </nav>

  <div class="su_sub-header">
    <div class="container">
      <div class="su_sub-header-inner">
        <!-- <div class="su_subnav-menu-right">
  <div id="auto" style="width: 100%;">
    <div ng-controller="SearchautoController">
      <div bind-html-compile="autocompleteHtml">
        <form class="su__search-box-1" disabled="disabled">
          <input class="su__search-input" type="search" name="Search box" id="su__search-b" placeholder="Search Documentation" disabled="disabled"/>
          <button class="su__search-button" type="submit" class="button button-success" disabled="disabled">
            <svg width="24" height="24" viewBox="0 0 24 24">
              <path
                d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"
                fill="#333"></path>
            </svg>
          </button>
        </form>
      </div>
    </div>
  </div>
</div> -->
        <div class="search-lng-gap"></div>
        <div style="margin-left: 16px; margin-right: 16px;">
          <!-- <select name="lng selector" id="lng-selector">
    <option value="../../../en/machine-learning/foundation-models/query-foundation-model-apis.html" class="notranslate">English</option>
    <option value="../../../ja/machine-learning/foundation-models/query-foundation-model-apis.html" class="notranslate">日本語</option>
    <option value="../../../pt/machine-learning/foundation-models/query-foundation-model-apis.html" class="notranslate">Português (Brasil)</option>
</select> -->
        </div>
        <div class="cloud-selector-container">
          <!-- <select name="cloud provider selector" id="cloud-provider-selector">
    <option value="aws" selected class="notranslate">
        Amazon Web Services
    </option>
    <option value="azure"  class="notranslate">
        Microsoft Azure
    </option>
    <option value="gcp"  class="notranslate">
        Google Cloud Platform
    </option>
</select> -->
        </div>
      </div>
    </div>
  </div>
  <page class="js-page-container">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side su_nav-side">
<div class="wy-side-scroll">
  <div class="wy-side-nav-search">
    

    

    

    
  </div>

  <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
    
      <a href="../../index.html" class="main-navigation-home">Databricks on AWS</a>
    

    
      

      
        <p class="caption"><span class="caption-text">Load &amp; manage data</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../rag-temp/index.html">RAG Studio</a></li>
</ul>

      
    
  </div>

  <div role="contentinfo">
    
  <p class="build_info notranslate"data-last-edit="December 23, 2023">
    Updated Jan 11, 2024
  </p>
<script>
  window.addEventListener('DOMContentLoaded',function(){
    var h1=document.querySelector('h1');
    var bi=document.querySelector('[data-last-edit]');
    if(h1 && bi){
      var ver = document.createElement('p');
      ver.className = 'version_info';
      ver.textContent = bi.getAttribute('data-last-edit');
      h1.parentElement.insertBefore(ver, h1.nextElementSibling);
    }
  });
</script>

    <p>
      
        <a id='feedbacklink' href="mailto:doc-feedback@databricks.com?subject=Documentation Feedback">Send us feedback</a>
      
    </p>
  </div>
</div>
</nav>
    
    
<main class="wy-grid-for-nav su_nav-grid">
  <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
    <div class="wy-nav-content su__nav_content">
      <div class="rst-content">
        





<div role="navigation" aria-label="breadcrumbs navigation" class="wy-breadcrumbs-wrapper">
  <ul class="wy-breadcrumbs">
    <li><a href="../../index.html">Documentation</a> <span class="db-icon db-icon-chevron-right"></span></li>
    
    
      <li>How to query Foundation Model APIs with the Python SDK</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>
</div>
        
        <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
          <div itemprop="articleBody">
            
    
  <div class="section" id="how-to-query-foundation-model-apis-with-the-python-sdk">
<h1>How to query Foundation Model APIs with the Python SDK<a class="headerlink" href="#how-to-query-foundation-model-apis-with-the-python-sdk" title="Permalink to this headline"> </a></h1>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>The Foundation Model APIs Python SDK is an <a class="reference internal" href="../../release-notes/release-types.html"><span class="doc">Experimental feature</span></a> and the API definition may change.</p>
</div>
<p>This article provides guidance on how to query Databricks Foundation Model APIs with the Python SDK. It includes installation instructions and query and response formats.</p>
<p>The Python SDK is a layer on top of the <a class="reference internal" href="api-reference.html"><span class="doc">REST API</span></a>. It handles low-level details, such as authentication and mapping model IDs to endpoint URLs, making it easier to interact with the models. The SDK is designed to be used from inside Databricks notebooks.</p>
<div class="section" id="requirements">
<h2>Requirements<a class="headerlink" href="#requirements" title="Permalink to this headline"> </a></h2>
<p>See the <a class="reference internal" href="index.html#required"><span class="std std-ref">Requirements</span></a> section.</p>
</div>
<div class="section" id="install-the-foundation-model-apis-python-sdk">
<h2>Install the Foundation Model APIs Python SDK<a class="headerlink" href="#install-the-foundation-model-apis-python-sdk" title="Permalink to this headline"> </a></h2>
<p>You can install the SDK on a cluster attached to a Databricks Notebook or to your local environment. After the SDK is installed, you can use it to query models. See the examples below:</p>
<ul class="simple">
<li><p><a class="reference internal" href="#chat"><span class="std std-ref">Query a chat completion model</span></a></p></li>
<li><p><a class="reference internal" href="#embedding"><span class="std std-ref">Query an embedding model</span></a></p></li>
<li><p><a class="reference internal" href="#completion"><span class="std std-ref">Query a text completion model</span></a></p></li>
</ul>
<div class="section" id="install-the-sdk-on-a-databricks-notebook">
<h3>Install the SDK on a Databricks Notebook<a class="headerlink" href="#install-the-sdk-on-a-databricks-notebook" title="Permalink to this headline"> </a></h3>
<p>You can install the SDK on your cluster attached to your Databricks Notebook. The following command can be run in your notebook:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>!pip install databricks-genai-inference

dbutils.library.restartPython()
</pre></div>
</div>
</div>
<div class="section" id="install-the-sdk-on-your-local-environment">
<h3>Install the SDK on your local environment<a class="headerlink" href="#install-the-sdk-on-your-local-environment" title="Permalink to this headline"> </a></h3>
<p>If you are working outside of a Databricks Notebook, you can install the SDK in your local environment. The following command can be run in your terminal:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>pip<span class="w"> </span>install<span class="w"> </span>databricks-genai-inference
</pre></div>
</div>
<p>Databricks native authentication is required to use this SDK.</p>
<p>To do this, you need to first <a class="reference internal" href="../../dev-tools/auth/pat.html"><span class="doc">generate a personal access token</span></a> for your application, then set the two environment variables <code class="docutils literal notranslate"><span class="pre">DATABRICKS_HOST</span></code> and <code class="docutils literal notranslate"><span class="pre">DATABRICKS_TOKEN</span></code>.</p>
<p>In the following command, <code class="docutils literal notranslate"><span class="pre">DATABRICKS_HOST</span></code> represents the Databricks host URL for your workspace. This URL typically starts with <code class="docutils literal notranslate"><span class="pre">&quot;https://&quot;</span></code> and includes the <a class="reference internal" href="../../workspace/workspace-details.html#workspace-url"><span class="std std-ref">workspace instance name</span></a>. <code class="docutils literal notranslate"><span class="pre">DATABRICKS_TOKEN</span></code> represents your Databricks personal access token value that you generated.</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span><span class="nb">export</span><span class="w"> </span><span class="nv">DATABRICKS_HOST</span><span class="o">=</span>&lt;YOUR<span class="w"> </span>HOST<span class="w"> </span>NAME&gt;
<span class="nb">export</span><span class="w"> </span><span class="nv">DATABRICKS_TOKEN</span><span class="o">=</span>&lt;YOUR<span class="w"> </span>TOKEN&gt;
</pre></div>
</div>
</div>
</div>
<div class="section" id="query-a-chat-completion-model">
<span id="chat"></span><h2>Query a chat completion model<a class="headerlink" href="#query-a-chat-completion-model" title="Permalink to this headline"> </a></h2>
<p>To query the <code class="docutils literal notranslate"><span class="pre">llama-2-70b-chat</span></code> chat model, use <code class="docutils literal notranslate"><span class="pre">ChatCompletion.create()</span></code> to execute a model query. The <code class="docutils literal notranslate"><span class="pre">ChatCompletion.create()</span></code> function accepts the same arguments as the <a class="reference internal" href="api-reference.html#chat"><span class="std std-ref">Chat task request API</span></a>. For other available chat models, see <a class="reference internal" href="api-reference.html#endpoints"><span class="std std-ref">supported models and their endpoints</span></a>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">databricks_genai_inference</span> <span class="kn">import</span> <span class="n">ChatCompletion</span>

<span class="n">response</span> <span class="o">=</span> <span class="n">ChatCompletion</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">model</span><span class="o">=</span><span class="s2">&quot;llama-2-70b-chat&quot;</span><span class="p">,</span>
                                 <span class="n">messages</span><span class="o">=</span><span class="p">[{</span><span class="s2">&quot;role&quot;</span><span class="p">:</span> <span class="s2">&quot;system&quot;</span><span class="p">,</span> <span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="s2">&quot;You are a helpful assistant.&quot;</span><span class="p">},</span>
                                           <span class="p">{</span><span class="s2">&quot;role&quot;</span><span class="p">:</span> <span class="s2">&quot;user&quot;</span><span class="p">,</span><span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="s2">&quot;Knock knock.&quot;</span><span class="p">}],</span>
                                 <span class="n">max_tokens</span><span class="o">=</span><span class="mi">128</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;response.message:</span><span class="si">{</span><span class="n">response</span><span class="o">.</span><span class="n">message</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>By default, <code class="docutils literal notranslate"><span class="pre">create()</span></code> returns a single response object (<code class="docutils literal notranslate"><span class="pre">ChatCompletionObject</span></code>) after the complete response has been generated. This can easily take &gt;5 seconds for a large model like <code class="docutils literal notranslate"><span class="pre">llama-2-70b-chat</span></code>.</p>
<p>For a more responsive experience, you can choose to stream text fragments as they are generated. Pass in <code class="docutils literal notranslate"><span class="pre">stream=True</span></code> to enable streaming. As a result , <code class="docutils literal notranslate"><span class="pre">create()</span></code> returns a generator which provides a sequence of response fragments (<code class="docutils literal notranslate"><span class="pre">ChatCompletionChunkObject</span></code>).</p>
<p>Both kinds of response objects have the same top-level properties:</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 7%" />
<col style="width: 6%" />
<col style="width: 87%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Property</p></th>
<th class="head"><p>Type</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p> <code class="docutils literal notranslate"><span class="pre">json</span></code></p></td>
<td><p> <code class="docutils literal notranslate"><span class="pre">dict</span></code></p></td>
<td><p> Raw json response (see <a class="reference internal" href="api-reference.html#chat"><span class="std std-ref">Chat task API</span></a> for details)</p></td>
</tr>
<tr class="row-odd"><td><p> <code class="docutils literal notranslate"><span class="pre">id</span></code></p></td>
<td><p> <code class="docutils literal notranslate"><span class="pre">string</span></code></p></td>
<td><p> Unique request ID</p></td>
</tr>
<tr class="row-even"><td><p> <code class="docutils literal notranslate"><span class="pre">model</span></code></p></td>
<td><p> <code class="docutils literal notranslate"><span class="pre">string</span></code></p></td>
<td><p> Model name</p></td>
</tr>
<tr class="row-odd"><td><p> <code class="docutils literal notranslate"><span class="pre">message</span></code></p></td>
<td><p> <code class="docutils literal notranslate"><span class="pre">string</span></code></p></td>
<td><p> Chat completion</p></td>
</tr>
<tr class="row-even"><td><p> <code class="docutils literal notranslate"><span class="pre">usage</span></code></p></td>
<td><p> <code class="docutils literal notranslate"><span class="pre">dict</span></code></p></td>
<td><p> Token usage metadata (cumulative for streaming)</p></td>
</tr>
</tbody>
</table>
<div class="section" id="chat-session">
<h3>Chat session<a class="headerlink" href="#chat-session" title="Permalink to this headline"> </a></h3>
<p><code class="docutils literal notranslate"><span class="pre">ChatSession</span></code> is a high level class to manage multi-round chat conversations. It provides the following functions:</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 23%" />
<col style="width: 17%" />
<col style="width: 60%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Function</p></th>
<th class="head"><p>Return</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p> <code class="docutils literal notranslate"><span class="pre">reply</span> <span class="pre">(string)</span></code></p></td>
<td></td>
<td><p> Takes a new user message</p></td>
</tr>
<tr class="row-odd"><td><p> <code class="docutils literal notranslate"><span class="pre">last</span></code></p></td>
<td><p> string</p></td>
<td><p> Last message from assistant</p></td>
</tr>
<tr class="row-even"><td><p> <code class="docutils literal notranslate"><span class="pre">history</span></code></p></td>
<td><p> list of dict</p></td>
<td><p> Messages in chat history, including roles.</p></td>
</tr>
<tr class="row-odd"><td><p> <code class="docutils literal notranslate"><span class="pre">count</span></code></p></td>
<td><p> int</p></td>
<td><p> Number of chat rounds conducted so far.</p></td>
</tr>
</tbody>
</table>
<p>To initialize <code class="docutils literal notranslate"><span class="pre">ChatSession</span></code>, you use the same set of arguments as <code class="docutils literal notranslate"><span class="pre">ChatCompletion</span></code>, and those arguments are used throughout the chat session.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>
<span class="kn">from</span> <span class="nn">databricks_genai_inference</span> <span class="kn">import</span> <span class="n">ChatSession</span>

<span class="n">chat</span> <span class="o">=</span> <span class="n">ChatSession</span><span class="p">(</span><span class="n">model</span><span class="o">=</span><span class="s2">&quot;llama-2-70b-chat&quot;</span><span class="p">,</span> <span class="n">system_message</span><span class="o">=</span><span class="s2">&quot;You are a helpful assistant.&quot;</span><span class="p">,</span> <span class="n">max_tokens</span><span class="o">=</span><span class="mi">128</span><span class="p">)</span>
<span class="n">chat</span><span class="o">.</span><span class="n">reply</span><span class="p">(</span><span class="s2">&quot;Knock, knock!&quot;</span><span class="p">)</span>
<span class="n">chat</span><span class="o">.</span><span class="n">last</span> <span class="c1"># return &quot;Hello! Who&#39;s there?&quot;</span>
<span class="n">chat</span><span class="o">.</span><span class="n">reply</span><span class="p">(</span><span class="s2">&quot;Guess who!&quot;</span><span class="p">)</span>
<span class="n">chat</span><span class="o">.</span><span class="n">last</span> <span class="c1"># return &quot;Okay, I&#39;ll play along! Is it a person, a place, or a thing?&quot;</span>

<span class="n">chat</span><span class="o">.</span><span class="n">history</span>
<span class="c1"># return: [</span>
<span class="c1">#     {&#39;role&#39;: &#39;system&#39;, &#39;content&#39;: &#39;You are a helpful assistant.&#39;},</span>
<span class="c1">#     {&#39;role&#39;: &#39;user&#39;, &#39;content&#39;: &#39;Knock, knock.&#39;},</span>
<span class="c1">#     {&#39;role&#39;: &#39;assistant&#39;, &#39;content&#39;: &quot;Hello! Who&#39;s there?&quot;},</span>
<span class="c1">#     {&#39;role&#39;: &#39;user&#39;, &#39;content&#39;: &#39;Guess who!&#39;},</span>
<span class="c1">#     {&#39;role&#39;: &#39;assistant&#39;, &#39;content&#39;: &quot;Okay, I&#39;ll play along! Is it a person, a place, or a thing?&quot;}</span>
<span class="c1"># ]</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="query-an-embedding-model">
<span id="embedding"></span><h2>Query an embedding model<a class="headerlink" href="#query-an-embedding-model" title="Permalink to this headline"> </a></h2>
<p>To query the <code class="docutils literal notranslate"><span class="pre">bge-large-en</span></code> embedding model, use <code class="docutils literal notranslate"><span class="pre">Embedding.create()</span></code> to execute a model query. The <code class="docutils literal notranslate"><span class="pre">Embedding.create()</span></code> function accepts the same arguments as the <a class="reference internal" href="api-reference.html#embedding"><span class="std std-ref">Embedding task request API</span></a>.</p>
<p>The following example generates embeddings optimized for indexing.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">databricks_genai_inference</span> <span class="kn">import</span> <span class="n">Embedding</span>

<span class="n">response</span> <span class="o">=</span> <span class="n">Embedding</span><span class="o">.</span><span class="n">create</span><span class="p">(</span>
    <span class="n">model</span><span class="o">=</span><span class="s2">&quot;bge-large-en&quot;</span><span class="p">,</span>
    <span class="nb">input</span><span class="o">=</span><span class="s2">&quot;3D ActionSLAM: wearable person tracking in multi-floor environments&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;embeddings: </span><span class="si">{</span><span class="n">response</span><span class="o">.</span><span class="n">embeddings</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>You can pass multiple inputs into <code class="docutils literal notranslate"><span class="pre">create</span></code> by setting <code class="docutils literal notranslate"><span class="pre">input</span></code> to a list of strings.</p>
<p>To optimize an embedding for query retrieval in a RAG application, add the parameter <code class="docutils literal notranslate"><span class="pre">instruction</span> <span class="pre">=</span> <span class="pre">&quot;Represent</span> <span class="pre">this</span> <span class="pre">sentence</span> <span class="pre">for</span> <span class="pre">searching</span> <span class="pre">relevant</span> <span class="pre">passages:&quot;</span></code>.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">Embedding.create()</span></code> function returns an <code class="docutils literal notranslate"><span class="pre">EmbeddingObject</span></code> with the following properties:</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 8%" />
<col style="width: 9%" />
<col style="width: 83%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Property</p></th>
<th class="head"><p>Type</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p> <code class="docutils literal notranslate"><span class="pre">json</span></code></p></td>
<td><p> dict</p></td>
<td><p> Raw json response (see <a class="reference internal" href="api-reference.html#embedding"><span class="std std-ref">Embedding task API</span></a> for details)</p></td>
</tr>
<tr class="row-odd"><td><p> <code class="docutils literal notranslate"><span class="pre">id</span></code></p></td>
<td><p> string</p></td>
<td><p> Unique request ID</p></td>
</tr>
<tr class="row-even"><td><p> <code class="docutils literal notranslate"><span class="pre">model</span></code></p></td>
<td><p> string</p></td>
<td><p> Model name</p></td>
</tr>
<tr class="row-odd"><td><p> <code class="docutils literal notranslate"><span class="pre">embeddings</span></code></p></td>
<td><p> list of array</p></td>
<td><p> List of embeddings</p></td>
</tr>
<tr class="row-even"><td><p> <code class="docutils literal notranslate"><span class="pre">usage</span></code></p></td>
<td><p> dict</p></td>
<td><p> Token usage metadata</p></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="query-a-text-completion-model">
<span id="completion"></span><h2>Query a text completion model<a class="headerlink" href="#query-a-text-completion-model" title="Permalink to this headline"> </a></h2>
<p>To query the <code class="docutils literal notranslate"><span class="pre">mpt-7b-instruct</span></code> text completions model, use <code class="docutils literal notranslate"><span class="pre">Completion.create()</span></code> to execute a query. The <code class="docutils literal notranslate"><span class="pre">Completion.create()</span></code> function accepts the same arguments as the <a class="reference internal" href="api-reference.html#completion"><span class="std std-ref">Completion task request API</span></a>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">databricks_genai_inference</span> <span class="kn">import</span> <span class="n">Completion</span>

<span class="n">response</span> <span class="o">=</span> <span class="n">Completion</span><span class="o">.</span><span class="n">create</span><span class="p">(</span>
    <span class="n">model</span><span class="o">=</span><span class="s2">&quot;mpt-7b-instruct&quot;</span><span class="p">,</span>
    <span class="n">prompt</span><span class="o">=</span><span class="s2">&quot;Write 3 reasons why you should train an AI model on domain specific data sets.&quot;</span><span class="p">,</span>
    <span class="n">max_tokens</span><span class="o">=</span><span class="mi">128</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;response.text:</span><span class="si">{</span><span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="si">:}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">Completion</span></code> is similar to <code class="docutils literal notranslate"><span class="pre">ChatCompletion</span></code>: by default it waits and returns the complete response, but you can use <code class="docutils literal notranslate"><span class="pre">stream=True</span></code> to retrieve response fragments as they are generated. In both cases the response objects have the following top-level properties:</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 6%" />
<col style="width: 10%" />
<col style="width: 85%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Property</p></th>
<th class="head"><p>Type</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p> <code class="docutils literal notranslate"><span class="pre">json</span></code></p></td>
<td><p> dict</p></td>
<td><p> Raw json response (see <a class="reference internal" href="api-reference.html#completion"><span class="std std-ref">Completion task API</span></a> for details)</p></td>
</tr>
<tr class="row-odd"><td><p> <code class="docutils literal notranslate"><span class="pre">id</span></code></p></td>
<td><p> string</p></td>
<td><p> Unique request ID</p></td>
</tr>
<tr class="row-even"><td><p> <code class="docutils literal notranslate"><span class="pre">model</span></code></p></td>
<td><p> string</p></td>
<td><p> Model name</p></td>
</tr>
<tr class="row-odd"><td><p> <code class="docutils literal notranslate"><span class="pre">text</span></code></p></td>
<td><p> list of string</p></td>
<td><p> List of text completions</p></td>
</tr>
<tr class="row-even"><td><p> <code class="docutils literal notranslate"><span class="pre">usage</span></code></p></td>
<td><p> dict</p></td>
<td><p> Token usage metadata (cumulative for streaming)</p></td>
</tr>
</tbody>
</table>
<p></p>
</div>
<div class="section" id="additional-resources">
<h2>Additional resources<a class="headerlink" href="#additional-resources" title="Permalink to this headline"> </a></h2>
<ul class="simple">
<li><p><a class="reference internal" href="index.html"><span class="doc">Databricks Foundation Model APIs</span></a></p></li>
<li><p><a class="reference internal" href="supported-models.html"><span class="doc">Databricks Foundation Model APIs supported models</span></a></p></li>
<li><p><a class="reference internal" href="api-reference.html"><span class="doc">Foundation Model APIs reference</span></a></p></li>
</ul>
</div>
</div>


    
          </div>
        </div>
        <div  class="suapp-rating">
  <div id="suPageRateApp">
     <su-app></su-app>
   </div> 
 </div>
<hr> 
<footer>
  <div role="contentinfo">
      <p class="copyright">
          &copy; Databricks 2023. All rights reserved. Apache, Apache Spark, Spark, and the Spark logo are trademarks of the <a href="http://www.apache.org/">Apache Software Foundation</a>.
      </p>
      <p> 
        
          <a id='feedbacklink' href="mailto:doc-feedback@databricks.com?subject=Documentation Feedback">Send us feedback</a>
        
     | <a href="https://databricks.com/privacy-policy">Privacy Policy</a> | <a href="https://databricks.com/terms-of-use">Terms of Use</a></p>

  </div> 

</footer>
      </div>
    </div>
  </section>
</main>

  </page>
  
  <script type="text/javascript">
    var DOCUMENTATION_OPTIONS = {
      URL_ROOT: '../../',
      VERSION: '1.0',
      COLLAPSE_INDEX: false,
      FILE_SUFFIX: '.html',
      HAS_SOURCE: 'false'
    };
  </script>
  <script type="text/javascript" src="../../_static/jquery.js"></script>
  <script type="text/javascript" src="../../_static/underscore.js"></script>
  <script type="text/javascript" src="../../_static/doctools.js"></script>
  <script type="text/javascript" src="../../_static/language_data.js"></script>
  

  <script type="text/javascript" src="../../_static/js/clipboard.min.js"></script>
  <script type="text/javascript" src="../../_static/js/jquery.waypoints.min.js"></script>

  <!-- Select2 (https://select2.org/) -->
  <link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />
  <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
  <!-- End Select2 -->

  
  
  <script type="text/javascript" src="../../_static/js/localized.js"></script>
  <script type="text/javascript" src="../../_static/js/custom.js"></script>
  

  
  
  <script type="text/javascript">
    jQuery(function () {
      SphinxRtdTheme.StickyNav.enable();
    });

  </script>
  
 



  <script>
  window.__searchunifyLoaderConfig = JSON.parse('{"clients": {"en": "02c2e804-27e9-11ee-aefb-0242ac120011", "ja": "6a42c3f2-2820-11ee-aefb-0242ac120011", "pt": "6a86badd-2821-11ee-aefb-0242ac120011"}}')
</script>
<script type="text/javascript" src="../../_static/js/search-loader.js"></script>
</body>
<script type='text/javascript'>
  window.onload = function () {
    var description = document.querySelector('meta[name="description"]').getAttribute("content");
    let titleText = document.querySelector('h1').textContent;
    document.querySelector('meta[property="og:title"]').setAttribute("content", titleText);
    document.querySelector('meta[property="og:description"]').setAttribute("content", description);
    document.querySelector('meta[property="twitter:description"]').setAttribute("content", description);
  };
</script>

</html>