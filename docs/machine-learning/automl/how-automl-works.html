

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en-US" > <![endif]-->
<!--[if gt IE 8]><!-->
<html class="no-js" lang="en-US"> <!--<![endif]-->

<head>
  <!-- cookie consent -->
  
    <!-- Combined Onetrust and Rudderstack Implementation Scripts -->
    <!-- Onetrust Initialization -->
    <script type="text/javascript" src="https://cdn.cookielaw.org/consent/92466579-1717-44d3-809d-a05fb02843ed-test/OtAutoBlock.js"></script>
    <script src="https://cdn.cookielaw.org/scripttemplates/otSDKStub.js" data-document-language="true" type="text/javascript" charset="UTF-8" data-domain-script="92466579-1717-44d3-809d-a05fb02843ed-test"></script>
    <link rel="stylesheet" id="db-onetrust-style" href="https://www.databricks.com/wp-content/uploads/db_onetrust.css" media="all" />
    <!-- Setting Rudderstack Write Key -->
    <script>window.rudderstackKey = "2SOR9fvSr5Fi6tN2ihPbVHnX1SZ" </script>
    <!-- Rudderstack Initialization + Onetrust Integration + Rudderstack Custom Events -->
    <script type="text/javascript" src="https://www.databricks.com/sites/default/files/rudderstack/v1/db-rudderstack-events.js"></script>

  <!-- cookie consent -->

  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta http-equiv="X-UA-Compatible" content="IE=9" />
  <meta content="This article details how Databricks AutoML works and its implementation of concepts like missing value imputation and large data sampling." name="description" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0">
  <meta property="og:image" content="https://www.databricks.com/wp-content/uploads/2020/04/og-databricks.png">
  <meta property="og:image:type" content="image/png">
  <meta property="og:title" content="How Databricks AutoML works">
  <meta property="og:image:width" content="1200">
  <meta property="og:image:height" content="630">
  <meta property="og:type" content="website">
  <meta property="og:url" content="https://docs.databricks.com">
  <meta property="og:description" content="" id="og-description">
  <meta name="twitter:image" content="https://www.databricks.com/wp-content/uploads/2020/04/og-databricks.png">
  <meta name="twitter:site" content="@databricks">
  <meta name="twitter:creator" content="@databricks">
  <meta property="twitter:description" content="">
  
  <title>How Databricks AutoML works &#124; Databricks on AWS</title>
  
  
  <link rel="canonical" href="https://docs.databricks.com/en/machine-learning/automl/how-automl-works.html">
  <!-- Start hreflang tag -->
  <link rel="alternate" hreflang="en" href="https://docs.databricks.com/en/machine-learning/automl/how-automl-works.html" />
<link rel="alternate" hreflang="x-default" href="https://docs.databricks.com/en/machine-learning/automl/how-automl-works.html" />
  <!-- End hreflang tag -->
  
  
  <link rel="shortcut icon" href="../../_static/favicon.ico" />
  

  

  

  <!-- Google Tag Manager -->
  <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'https://www.googletagmanager.com/gtm.js?id='+i+dl;
j.setAttributeNode(d.createAttribute('data-ot-ignore'));
f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-T85FQ33');</script>
  <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'https://www.googletagmanager.com/gtm.js?id='+i+dl;
j.setAttributeNode(d.createAttribute('data-ot-ignore'));
f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-TWTKQQ');</script>
    
  <!-- End Google Tag Manager -->


  <!-- MaxMind / GEO IP -->
  <script src="//js.maxmind.com/js/apis/geoip2/v2.1/geoip2.js" type="text/javascript"></script>
  <!-- End MaxMind / GEO IP -->

  
  
  <link href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,600&display=swap" rel="stylesheet">
  <link rel="preload" href="../../_static/fonts/DMSans-Bold.ttf" as="font">
  <link rel="preload" href="../../_static/fonts/DMSans-Regular.ttf" as="font">
  <link rel="preload" href="../../_static/fonts/DMMono-Regular.ttf" as="font">
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/css/custom.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/css/cloud-provider-selector.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/css/translation-selector.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/css/searchunify/main.css" type="text/css" />

  
  <link rel="index" title="Index" href="../../genindex.html" />
  <link rel="search" title="Search" href="../../search.html" />
  <link rel="top" title="Databricks on AWS" href="../../index.html" /> 
</head>

<body class="wy-body-for-nav" role="document">

  <!-- Google Tag Manager (noscript) -->
  <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-T85FQ33"
height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
  <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-TWTKQQ"
    height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
  <!-- End Google Tag Manager (noscript) -->

  
  <nav class="wy-nav-top header su_header" role="navigation" aria-label="top navigation">
    
<nav class="wy-nav-top header su_header" role="navigation" aria-label="top navigation">
  <div class="container-logo">
    <ul class="mobile-menu-toggle">
        <li class="menu-toggle">
            <i data-toggle="wy-nav-top" class="wy-nav-top-menu-button db-icon db-icon-menu pull-left"></i>
            
            <a href="https://www.databricks.com/" class="wy-nav-top-logo"><img src="../../_static/small-scale-lockup-full-color-rgb.svg" width="137" height="21"
              alt="Databricks" /></a>   
               
              </li>
    </ul>
    <ul class="su_nav-menu">
      <li class="menu-toggle">
        <i data-toggle="wy-nav-top" class="wy-nav-top-menu-button db-icon db-icon-menu pull-left"></i>
        
          
        
        <a href="https://www.databricks.com/" class="wy-nav-top-logo"><img src="../../_static/small-scale-lockup-full-color-rgb.svg" width="137" height="21"
            alt="Databricks" /></a></li>
        <!-- 
<li><a href="https://help.databricks.com/s/">Help Center</a></li>
<li class="active"><a href="https://docs.databricks.com/en/">Documentation</a></li>
<li><a href="https://kb.databricks.com/">Knowledge Base</a></li>
 -->
    </ul>
  </div>
  <div class="su_nav-right">
    <ul class="su_link-mobile">
  <!-- Mobile header code can go here -->
</ul>
<ul class="right-try-list">
   
</ul>
  </div>
</nav>
  </nav>

  <div class="su_sub-header">
    <div class="container">
      <div class="su_sub-header-inner">
        <!-- <div class="su_subnav-menu-right">
  <div id="auto" style="width: 100%;">
    <div ng-controller="SearchautoController">
      <div bind-html-compile="autocompleteHtml">
        <form class="su__search-box-1" disabled="disabled">
          <input class="su__search-input" type="search" name="Search box" id="su__search-b" placeholder="Search Documentation" disabled="disabled"/>
          <button class="su__search-button" type="submit" class="button button-success" disabled="disabled">
            <svg width="24" height="24" viewBox="0 0 24 24">
              <path
                d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"
                fill="#333"></path>
            </svg>
          </button>
        </form>
      </div>
    </div>
  </div>
</div> -->
        <div class="search-lng-gap"></div>
        <div style="margin-left: 16px; margin-right: 16px;">
          <!-- <select name="lng selector" id="lng-selector">
    <option value="../../../en/machine-learning/automl/how-automl-works.html" class="notranslate">English</option>
    <option value="../../../ja/machine-learning/automl/how-automl-works.html" class="notranslate">日本語</option>
    <option value="../../../pt/machine-learning/automl/how-automl-works.html" class="notranslate">Português (Brasil)</option>
</select> -->
        </div>
        <div class="cloud-selector-container">
          <!-- <select name="cloud provider selector" id="cloud-provider-selector">
    <option value="aws" selected class="notranslate">
        Amazon Web Services
    </option>
    <option value="azure"  class="notranslate">
        Microsoft Azure
    </option>
    <option value="gcp"  class="notranslate">
        Google Cloud Platform
    </option>
</select> -->
        </div>
      </div>
    </div>
  </div>
  <page class="js-page-container">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side su_nav-side">
<div class="wy-side-scroll">
  <div class="wy-side-nav-search">
    

    

    

    
  </div>

  <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
    
      <a href="../../index.html" class="main-navigation-home">Databricks on AWS</a>
    

    
      

      
        <p class="caption"><span class="caption-text">Load &amp; manage data</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../rag-temp/index.html">RAG Studio</a></li>
</ul>

      
    
  </div>

  <div role="contentinfo">
    
  <p class="build_info notranslate"data-last-edit="December 23, 2023">
    Updated Jan 11, 2024
  </p>
<script>
  window.addEventListener('DOMContentLoaded',function(){
    var h1=document.querySelector('h1');
    var bi=document.querySelector('[data-last-edit]');
    if(h1 && bi){
      var ver = document.createElement('p');
      ver.className = 'version_info';
      ver.textContent = bi.getAttribute('data-last-edit');
      h1.parentElement.insertBefore(ver, h1.nextElementSibling);
    }
  });
</script>

    <p>
      
        <a id='feedbacklink' href="mailto:doc-feedback@databricks.com?subject=Documentation Feedback">Send us feedback</a>
      
    </p>
  </div>
</div>
</nav>
    
    
<main class="wy-grid-for-nav su_nav-grid">
  <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
    <div class="wy-nav-content su__nav_content">
      <div class="rst-content">
        





<div role="navigation" aria-label="breadcrumbs navigation" class="wy-breadcrumbs-wrapper">
  <ul class="wy-breadcrumbs">
    <li><a href="../../index.html">Documentation</a> <span class="db-icon db-icon-chevron-right"></span></li>
    
    
      <li>How Databricks AutoML works</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>
</div>
        
        <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
          <div itemprop="articleBody">
            
    
  <div class="section" id="how-databricks-automl-works">
<h1>How Databricks AutoML works<a class="headerlink" href="#how-databricks-automl-works" title="Permalink to this headline"> </a></h1>
<p>This article details how Databricks AutoML works and its implementation of concepts like missing value imputation and <a class="reference internal" href="#automl-sampling"><span class="std std-ref">large data sampling</span></a>.</p>
<p>Databricks AutoML performs the following:</p>
<ol class="arabic simple">
<li><p>Prepares the dataset for model training. For example, AutoML carries out <a class="reference internal" href="#automl-imbalanced-dataset-support"><span class="std std-ref">imbalanced data detection</span></a> for classification problems prior to model training.</p></li>
<li><p>Iterates to train and <a class="reference internal" href="../automl-hyperparam-tuning/index.html"><span class="doc">tune</span></a> multiple models, where each model is constructed from open source components and can easily be edited and integrated into your machine learning pipelines.</p>
<ul class="simple">
<li><p>AutoML automatically distributes hyperparameter tuning trials across the worker nodes of a cluster.</p></li>
<li><p>With Databricks Runtime 9.1 LTS ML or above, AutoML automatically samples your dataset if it is too large to fit into the memory of a single worker node. See <a class="reference internal" href="#automl-sampling"><span class="std std-ref">Sampling large datasets</span></a>.</p></li>
</ul>
</li>
<li><p>Evaluates models based on algorithms from the <a class="reference external" href="https://scikit-learn.org/stable/">scikit-learn</a>, <a class="reference external" href="https://xgboost.readthedocs.io/en/latest/">xgboost</a>, <a class="reference external" href="https://lightgbm.readthedocs.io/en/latest/index.html">LightGBM</a>, <a class="reference external" href="https://facebook.github.io/prophet/docs/">Prophet</a>, and <a class="reference external" href="https://pypi.org/project/pmdarima/">ARIMA</a> packages.</p></li>
<li><p>Displays the results and provides a Python notebook with the source code for each trial run so you can review, reproduce, and modify the code. AutoML also calculates summary statistics on your dataset and saves this information in a notebook that you can review later.</p></li>
</ol>
<div class="section" id="automl-algorithms">
<span id="automl-algorithm"></span><h2>AutoML algorithms<a class="headerlink" href="#automl-algorithms" title="Permalink to this headline"> </a></h2>
<p>Databricks AutoML trains and evaluates models based on the algorithms in the following table.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>For classification and regression models, the decision tree, random forests, logistic regression and linear regression with stochastic gradient descent algorithms are based on scikit-learn.</p>
</div>
<table class="docutils align-default">
<colgroup>
<col style="width: 39%" />
<col style="width: 38%" />
<col style="width: 23%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Classification models</p></th>
<th class="head"><p>Regression models</p></th>
<th class="head"><p>Forecasting models</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p> <a class="reference external" href="https://scikit-learn.org/stable/modules/tree.html#classification">Decision trees</a></p></td>
<td><p> <a class="reference external" href="https://scikit-learn.org/stable/modules/tree.html#regression">Decision trees</a></p></td>
<td><p><a class="reference external" href="https://facebook.github.io/prophet/docs/quick_start.html#python-api">Prophet</a></p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference external" href="https://scikit-learn.org/stable/modules/generated/sklearn.ensemble.RandomForestClassifier.html#sklearn.ensemble.RandomForestClassifier">Random forests</a></p></td>
<td><p> <a class="reference external" href="https://scikit-learn.org/stable/modules/generated/sklearn.ensemble.RandomForestRegressor.html#sklearn.ensemble.RandomForestRegressor">Random forests</a></p></td>
<td><p> <a class="reference external" href="https://pypi.org/project/pmdarima/">Auto-ARIMA</a> (Available in Databricks Runtime 10.3 ML and above.)</p></td>
</tr>
<tr class="row-even"><td><p> <a class="reference external" href="https://scikit-learn.org/stable/modules/linear_model.html#logistic-regression">Logistic regression</a></p></td>
<td><p> <a class="reference external" href="https://scikit-learn.org/stable/modules/sgd.html#regression">Linear regression with stochastic gradient descent</a></p></td>
<td></td>
</tr>
<tr class="row-odd"><td><p> <a class="reference external" href="https://xgboost.readthedocs.io/en/latest/python/python_api.html#xgboost.XGBClassifier">XGBoost</a></p></td>
<td><p> <a class="reference external" href="https://xgboost.readthedocs.io/en/latest/python/python_api.html#xgboost.XGBRegressor">XGBoost</a></p></td>
<td></td>
</tr>
<tr class="row-even"><td><p> <a class="reference external" href="https://lightgbm.readthedocs.io/en/latest/pythonapi/lightgbm.LGBMClassifier.html">LightGBM</a></p></td>
<td><p> <a class="reference external" href="https://lightgbm.readthedocs.io/en/latest/pythonapi/lightgbm.LGBMRegressor.html">LightGBM</a></p></td>
<td></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="supported-data-feature-types">
<h2>Supported data feature types<a class="headerlink" href="#supported-data-feature-types" title="Permalink to this headline"> </a></h2>
<p>Feature types not listed below are not supported. For example, images are not supported.</p>
<p>The following feature types are supported:</p>
<ul class="simple">
<li><p>Numeric (<code class="docutils literal notranslate"><span class="pre">ByteType</span></code>, <code class="docutils literal notranslate"><span class="pre">ShortType</span></code>, <code class="docutils literal notranslate"><span class="pre">IntegerType</span></code>, <code class="docutils literal notranslate"><span class="pre">LongType</span></code>, <code class="docutils literal notranslate"><span class="pre">FloatType</span></code>, and <code class="docutils literal notranslate"><span class="pre">DoubleType</span></code>)</p></li>
<li><p>Boolean</p></li>
<li><p>String (categorical or English text)</p></li>
<li><p>Timestamps (<code class="docutils literal notranslate"><span class="pre">TimestampType</span></code>, <code class="docutils literal notranslate"><span class="pre">DateType</span></code>)</p></li>
<li><p>ArrayType[Numeric] (Databricks Runtime 10.4 LTS ML and above)</p></li>
<li><p>DecimalType (Databricks Runtime 11.3 LTS ML and above)</p></li>
</ul>
</div>
<div class="section" id="split-data-into-trainvalidationtest-sets">
<span id="control-automl-split"></span><h2>Split data into train/validation/test sets<a class="headerlink" href="#split-data-into-trainvalidationtest-sets" title="Permalink to this headline"> </a></h2>
<p>With Databricks Runtime 10.1 ML and above, you can specify a time column to use for the training/validation/testing data split for classification and regression problems. If you specify this column, the dataset is split into training, validation, and test sets by time. The earliest points are used for training, the next earliest for validation, and the latest points are used as a test set.</p>
<p>In Databricks Runtime 10.1 ML, the time column must be a timestamp or integer column. In Databricks Runtime 10.2 ML and above, you can also select a string column.</p>
</div>
<div class="section" id="sampling-large-datasets">
<span id="automl-sampling"></span><h2>Sampling large datasets<a class="headerlink" href="#sampling-large-datasets" title="Permalink to this headline"> </a></h2>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Sampling is not applied to forecasting problems.</p>
</div>
<p>Although AutoML distributes hyperparameter tuning trials across the worker nodes of a cluster, each model is trained on a single worker node.</p>
<p>AutoML automatically estimates the memory required to load and train your dataset and samples the dataset if necessary.</p>
<p>In Databricks Runtime 9.1 LTS ML through Databricks Runtime 10.5 ML, the sampling fraction does not depend on the cluster’s node type or the amount of memory on each node.</p>
<p>In Databricks Runtime 11.x ML:</p>
<ul class="simple">
<li><p>The sampling fraction increases for worker nodes that have more memory per core. You can increase the sample size by choosing a <strong>memory optimized</strong> instance type.</p></li>
<li><p>You can further increase the sample size by choosing a larger value for <code class="docutils literal notranslate"><span class="pre">spark.task.cpus</span></code> in the Spark configuration for the cluster. The default setting is 1; the maximum value is the number of CPUs on the worker node. When you increase this value, the sample size is larger, but fewer trials run in parallel. For example, in a machine with 4 cores and 64GB total RAM, the default <code class="docutils literal notranslate"><span class="pre">spark.task.cpus=1</span></code> runs 4 trials per worker with each trial limited to 16GB RAM. If you set <code class="docutils literal notranslate"><span class="pre">spark.task.cpus=4</span></code>, each worker runs only one trial but that trial can use 64GB RAM.</p></li>
</ul>
<p>In Databricks Runtime 12.0 ML and above, AutoML can train on larger datasets by allocating more CPU cores per training task. You can increase the sample size by choosing an instance size with larger total memory.</p>
<p>In Databricks Runtime 11.0 ML and above, if AutoML sampled the dataset, the sampling fraction is shown in the <strong>Overview</strong> tab in the UI.</p>
<p>For classification problems, AutoML uses the PySpark <code class="docutils literal notranslate"><span class="pre">sampleBy</span></code> <a class="reference external" href="https://api-docs.databricks.com/python/pyspark/latest/pyspark.sql/api/pyspark.sql.DataFrameStatFunctions.sampleBy.html">method</a> for stratified sampling to preserve the target label distribution.</p>
<p>For regression problems, AutoML uses the PySpark <code class="docutils literal notranslate"><span class="pre">sample</span></code> <a class="reference external" href="https://api-docs.databricks.com/python/pyspark/latest/pyspark.sql/api/pyspark.sql.DataFrame.sample.html">method</a>.</p>
</div>
<div class="section" id="imbalanced-dataset-support-for-classification-problems">
<span id="automl-imbalanced-dataset-support"></span><h2>Imbalanced dataset support for classification problems<a class="headerlink" href="#imbalanced-dataset-support-for-classification-problems" title="Permalink to this headline"> </a></h2>
<p>In Databricks Runtime 11.2 ML and above, if AutoML detects that a dataset is imbalanced, it tries to reduce the imbalance of the training dataset by downsampling the major class(es) and adding class weights. AutoML only balances the training dataset and does not balance the test and validation datasets. Doing so ensures that the model performance is always evaluated on the non-enriched dataset with the true input class distribution.</p>
<p>To balance an imbalanced training dataset, AutoML uses class weights that are inversely related to the degree by which a given class is downsampled. For example, if a training dataset with 100 samples has 95 samples belonging to class A and 5 samples belonging to class B, AutoML reduces this imbalance by downsampling class A to 70 samples, that is downsampling class A by a ratio of 70/95 or 0.736, while keeping the number of samples in class B at 5. To ensure that the final model is correctly calibrated and the probability distribution of the model output is the same as that of the input, AutoML scales up the class weight for class A by the ratio 1/0.736, or 1.358, while keeping the weight of class B as 1. AutoML then uses these class weights in model training as a parameter to ensure that the samples from each class are weighted appropriately when training the model.</p>
</div>
<div class="section" id="semantic-type-detection">
<span id="semantic-detection"></span><h2>Semantic type detection<a class="headerlink" href="#semantic-type-detection" title="Permalink to this headline"> </a></h2>
<div class="admonition note">
<p class="admonition-title">Note</p>
<ul class="simple">
<li><p>Semantic type detection is not applied to forecasting problems.</p></li>
<li><p>AutoML does not perform semantic type detection for columns that have <a class="reference internal" href="train-ml-model-automl-ui.html#impute-missing-values"><span class="std std-ref">custom imputation methods</span></a> specified.</p></li>
</ul>
</div>
<p>With Databricks Runtime 9.1 LTS ML and above, AutoML tries to detect whether columns have a semantic type that is different from the Spark or pandas data type in the table schema. AutoML treats these columns as the detected semantic type. These detections are best effort and might miss the existence of semantic types in some cases. You can also manually set the semantic type of a column or tell AutoML not to apply semantic type detection to a column <a class="reference internal" href="#semantic-type-annotations"><span class="std std-ref">using annotations</span></a>.</p>
<p>Specifically, AutoML makes these adjustments:</p>
<ul class="simple">
<li><p>String and integer columns that represent date or timestamp data are treated as a timestamp type.</p></li>
<li><p>String columns that represent numeric data are treated as a numeric type.</p></li>
</ul>
<p>With Databricks Runtime 10.1 ML and above, AutoML also makes these adjustments:</p>
<ul class="simple">
<li><p>Numeric columns that contain categorical IDs are treated as a categorical feature.</p></li>
<li><p>String columns that contain English text are treated as a text feature.</p></li>
</ul>
<div class="section" id="semantic-type-annotations">
<h3>Semantic type annotations<a class="headerlink" href="#semantic-type-annotations" title="Permalink to this headline"> </a></h3>
<p>With Databricks Runtime 10.1 ML and above, you can manually control the assigned semantic type by placing a semantic type annotation on a column. To manually annotate the semantic type of column <code class="docutils literal notranslate"><span class="pre">&lt;column-name&gt;</span></code> as <code class="docutils literal notranslate"><span class="pre">&lt;semantic-type&gt;</span></code>, use the following syntax:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">metadata_dict</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">schema</span><span class="p">[</span><span class="s2">&quot;&lt;column-name&gt;&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">metadata</span>
<span class="n">metadata_dict</span><span class="p">[</span><span class="s2">&quot;spark.contentAnnotation.semanticType&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;&lt;semantic-type&gt;&quot;</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">withMetadata</span><span class="p">(</span><span class="s2">&quot;&lt;column-name&gt;&quot;</span><span class="p">,</span> <span class="n">metadata_dict</span><span class="p">)</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">&lt;semantic-type&gt;</span></code> can be one of the following:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">categorical</span></code>: The column contains categorical values (for example, numerical values that should be treated as IDs).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">numeric</span></code>:  The column contains numeric values (for example, string values that can be parsed into numbers).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">datetime</span></code>: The column contains timestamp values (string, numerical, or date values that can be converted into timestamps).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">text</span></code>: The string column contains English text.</p></li>
</ul>
<p>To disable semantic type detection on a column, use the special keyword annotation <code class="docutils literal notranslate"><span class="pre">native</span></code>.</p>
</div>
</div>
<div class="section" id="shapley-values-shap-for-model-explainability">
<h2>Shapley values (SHAP) for model explainability<a class="headerlink" href="#shapley-values-shap-for-model-explainability" title="Permalink to this headline"> </a></h2>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>For MLR 11.1 and below, SHAP plots are not generated, if the dataset contains a <code class="docutils literal notranslate"><span class="pre">datetime</span></code> column.</p>
</div>
<p>The notebooks produced by AutoML regression and classification runs include code to calculate <a class="reference external" href="https://shap.readthedocs.io/en/latest/example_notebooks/overviews/An%20introduction%20to%20explainable%20AI%20with%20Shapley%20values.html#">Shapley values</a>. Shapley values are based in game theory and estimate the importance of each feature to a model’s predictions.</p>
<p>AutoML notebooks use the <a class="reference external" href="https://shap.readthedocs.io/en/latest/overviews.html">SHAP package</a> to calculate Shapley values. Because these calculations are very memory-intensive, the calculations are not performed by default.</p>
<p>To calculate and display Shapley values:</p>
<ol class="arabic simple">
<li><p>Go to the <strong>Feature importance</strong> section in an AutoML generated trial notebook.</p></li>
<li><p>Set <code class="docutils literal notranslate"><span class="pre">shap_enabled</span> <span class="pre">=</span> <span class="pre">True</span></code>.</p></li>
<li><p>Re-run the notebook.</p></li>
</ol>
</div>
<div class="section" id="time-series-aggregation">
<h2>Time series aggregation<a class="headerlink" href="#time-series-aggregation" title="Permalink to this headline"> </a></h2>
<p>For forecasting problems, when there are multiple values for a timestamp in a time series, AutoML uses the average of the values.</p>
<p>To use the sum instead, edit the source code notebook. In the <strong>Aggregate data by …</strong> cell, change <code class="docutils literal notranslate"><span class="pre">.agg(y=(target_col,</span> <span class="pre">&quot;avg&quot;))</span></code> to <code class="docutils literal notranslate"><span class="pre">.agg(y=(target_col,</span> <span class="pre">&quot;sum&quot;))</span></code>, as shown:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">group_cols</span> <span class="o">=</span> <span class="p">[</span><span class="n">time_col</span><span class="p">]</span> <span class="o">+</span> <span class="n">id_cols</span>
<span class="n">df_aggregation</span> <span class="o">=</span> <span class="n">df_loaded</span> \
  <span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">group_cols</span><span class="p">)</span> \
  <span class="o">.</span><span class="n">agg</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="p">(</span><span class="n">target_col</span><span class="p">,</span> <span class="s2">&quot;sum&quot;</span><span class="p">))</span> \
  <span class="o">.</span><span class="n">reset_index</span><span class="p">()</span> \
  <span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span> <span class="n">time_col</span> <span class="p">:</span> <span class="s2">&quot;ds&quot;</span> <span class="p">})</span>
</pre></div>
</div>
</div>
<div class="section" id="feature-store-integration">
<span id="feature-store"></span><h2>Feature Store integration<a class="headerlink" href="#feature-store-integration" title="Permalink to this headline"> </a></h2>
<p>With Databricks Runtime 11.3 LTS ML and above, you can use existing feature tables in <a class="reference internal" href="../feature-store/index.html"><span class="doc">Feature Store</span></a> to augment the original input dataset for your classification and regression problems.</p>
<p>With Databricks Runtime 12.2 LTS ML and above, you can use existing feature tables in <a class="reference internal" href="../feature-store/index.html"><span class="doc">Feature Store</span></a> to augment the original input dataset for all of your AutoML problems: classification, regression, and forecasting.</p>
<p>To create a feature table, see <a class="reference internal" href="../feature-store/index.html"><span class="doc">What is a feature store?</span></a>.</p>
<p>This capability requires that your account and workspace must be on the E2 version of the platform.</p>
<p>To use existing feature tables, you can <a class="reference internal" href="train-ml-model-automl-ui.html#feature-store"><span class="std std-ref">select feature tables with the AutoML UI</span></a> or set the <code class="docutils literal notranslate"><span class="pre">feature_store_lookups</span></code> parameter in your <a class="reference internal" href="train-ml-model-automl-api.html"><span class="doc">AutoML run specification</span></a>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">feature_store_lookups</span> <span class="o">=</span> <span class="p">[</span>
  <span class="p">{</span>
     <span class="s2">&quot;table_name&quot;</span><span class="p">:</span> <span class="s2">&quot;example.trip_pickup_features&quot;</span><span class="p">,</span>
     <span class="s2">&quot;lookup_key&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;pickup_zip&quot;</span><span class="p">,</span> <span class="s2">&quot;rounded_pickup_datetime&quot;</span><span class="p">],</span>
  <span class="p">},</span>
  <span class="p">{</span>
      <span class="s2">&quot;table_name&quot;</span><span class="p">:</span> <span class="s2">&quot;example.trip_dropoff_features&quot;</span><span class="p">,</span>
     <span class="s2">&quot;lookup_key&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;dropoff_zip&quot;</span><span class="p">,</span> <span class="s2">&quot;rounded_dropoff_datetime&quot;</span><span class="p">],</span>
  <span class="p">}</span>
<span class="p">]</span>
</pre></div>
</div>
</div>
<div class="section" id="trial-notebook-generation">
<span id="notebook-generation"></span><h2>Trial notebook generation<a class="headerlink" href="#trial-notebook-generation" title="Permalink to this headline"> </a></h2>
<p>For forecasting experiments, AutoML generated notebooks are automatically imported to your workspace for all trials of your experiment.</p>
<p>For classification and regression experiments, AutoML generated notebooks for data exploration and the best trial in your experiment are automatically imported to your workspace. Generated notebooks for other experiment trials are saved as MLflow artifacts on DBFS, instead of auto-imported into your workspace. For all trials besides the best trial, the <code class="docutils literal notranslate"><span class="pre">notebook_path</span></code> and <code class="docutils literal notranslate"><span class="pre">notebook_url</span></code> in the <code class="docutils literal notranslate"><span class="pre">TrialInfo</span></code> Python API are not set. If you need to use these notebooks, you can manually import them into your workspace with the AutoML experiment UI or the <code class="docutils literal notranslate"><span class="pre">databricks.automl.import_notebook</span></code> <a class="reference internal" href="train-ml-model-automl-api.html#import-notebook"><span class="std std-ref">Python API</span></a>.</p>
<p>If you only use the data exploration notebook or best trial notebook generated by AutoML, the <strong>Source</strong> column in the AutoML experiment UI contains the link to the generated notebook for the best trial.</p>
<p>If you use other generated notebooks in the AutoML experiment UI, these are not automatically imported into the workspace. You can find the notebooks by clicking into each MLflow run. The IPython notebook is saved in the <strong>Artifacts</strong> section of the run page. You can download this notebook and import it into the workspace, if downloading artifacts is enabled by your workspace administrators.</p>
</div>
<div class="section" id="notebook-example-automl-experiment-with-feature-store">
<h2>Notebook example: AutoML experiment with Feature Store<a class="headerlink" href="#notebook-example-automl-experiment-with-feature-store" title="Permalink to this headline"> </a></h2>
<p>The following notebook shows how to train an ML model with AutoML and Feature Store feature tables.</p>
<div class="embedded-notebook-section section" id="automl-experiment-with-feature-store-example-notebook">
<span id="automl-feature-store-example"></span><h3>AutoML experiment with Feature Store example notebook<a class="headerlink" href="#automl-experiment-with-feature-store-example-notebook" title="Permalink to this headline"> </a></h3>
<div class="embedded-notebook">
    <p class="notebook-import-help">
        <a href="/_extras/notebooks/source/machine-learning/automl-feature-store-example.html"            target="_blank">Open notebook in new tab</a>
        <button class="embedded-notebook-copy-to-clipboard"                copy-path-to-clipboard-on-click="/_extras/notebooks/source/machine-learning/automl-feature-store-example.html">            <img src="/_static/clippy.svg"                alt="Copy to clipboard">            Copy link for import        </button>    <div class="embedded-notebook-container">        <div class="loading-spinner"></div>        <iframe data-src="/_extras/notebooks/source/machine-learning/automl-feature-store-example.html"            id="d81782ebbd627b43aa9af20a4800539049952c793315c9ed775487e3585ce4fc" height="1000px" width="100%"            style="overflow-y:hidden;" scrolling="no"></iframe>    </div></div></div>
</div>
</div>


    
          </div>
        </div>
        <div  class="suapp-rating">
  <div id="suPageRateApp">
     <su-app></su-app>
   </div> 
 </div>
<hr> 
<footer>
  <div role="contentinfo">
      <p class="copyright">
          &copy; Databricks 2023. All rights reserved. Apache, Apache Spark, Spark, and the Spark logo are trademarks of the <a href="http://www.apache.org/">Apache Software Foundation</a>.
      </p>
      <p> 
        
          <a id='feedbacklink' href="mailto:doc-feedback@databricks.com?subject=Documentation Feedback">Send us feedback</a>
        
     | <a href="https://databricks.com/privacy-policy">Privacy Policy</a> | <a href="https://databricks.com/terms-of-use">Terms of Use</a></p>

  </div> 

</footer>
      </div>
    </div>
  </section>
</main>

  </page>
  
  <script type="text/javascript">
    var DOCUMENTATION_OPTIONS = {
      URL_ROOT: '../../',
      VERSION: '1.0',
      COLLAPSE_INDEX: false,
      FILE_SUFFIX: '.html',
      HAS_SOURCE: 'false'
    };
  </script>
  <script type="text/javascript" src="../../_static/jquery.js"></script>
  <script type="text/javascript" src="../../_static/underscore.js"></script>
  <script type="text/javascript" src="../../_static/doctools.js"></script>
  <script type="text/javascript" src="../../_static/language_data.js"></script>
  

  <script type="text/javascript" src="../../_static/js/clipboard.min.js"></script>
  <script type="text/javascript" src="../../_static/js/jquery.waypoints.min.js"></script>

  <!-- Select2 (https://select2.org/) -->
  <link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />
  <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
  <!-- End Select2 -->

  
  
  <script type="text/javascript" src="../../_static/js/localized.js"></script>
  <script type="text/javascript" src="../../_static/js/custom.js"></script>
  

  
  
  <script type="text/javascript">
    jQuery(function () {
      SphinxRtdTheme.StickyNav.enable();
    });

  </script>
  
 



  <script>
  window.__searchunifyLoaderConfig = JSON.parse('{"clients": {"en": "02c2e804-27e9-11ee-aefb-0242ac120011", "ja": "6a42c3f2-2820-11ee-aefb-0242ac120011", "pt": "6a86badd-2821-11ee-aefb-0242ac120011"}}')
</script>
<script type="text/javascript" src="../../_static/js/search-loader.js"></script>
</body>
<script type='text/javascript'>
  window.onload = function () {
    var description = document.querySelector('meta[name="description"]').getAttribute("content");
    let titleText = document.querySelector('h1').textContent;
    document.querySelector('meta[property="og:title"]').setAttribute("content", titleText);
    document.querySelector('meta[property="og:description"]').setAttribute("content", description);
    document.querySelector('meta[property="twitter:description"]').setAttribute("content", description);
  };
</script>

</html>