

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en-US" > <![endif]-->
<!--[if gt IE 8]><!-->
<html class="no-js" lang="en-US"> <!--<![endif]-->

<head>
  <!-- cookie consent -->
  
    <!-- Combined Onetrust and Rudderstack Implementation Scripts -->
    <!-- Onetrust Initialization -->
    <script type="text/javascript" src="https://cdn.cookielaw.org/consent/92466579-1717-44d3-809d-a05fb02843ed-test/OtAutoBlock.js"></script>
    <script src="https://cdn.cookielaw.org/scripttemplates/otSDKStub.js" data-document-language="true" type="text/javascript" charset="UTF-8" data-domain-script="92466579-1717-44d3-809d-a05fb02843ed-test"></script>
    <link rel="stylesheet" id="db-onetrust-style" href="https://www.databricks.com/wp-content/uploads/db_onetrust.css" media="all" />
    <!-- Setting Rudderstack Write Key -->
    <script>window.rudderstackKey = "2SOR9fvSr5Fi6tN2ihPbVHnX1SZ" </script>
    <!-- Rudderstack Initialization + Onetrust Integration + Rudderstack Custom Events -->
    <script type="text/javascript" src="https://www.databricks.com/sites/default/files/rudderstack/v1/db-rudderstack-events.js"></script>

  <!-- cookie consent -->

  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta http-equiv="X-UA-Compatible" content="IE=9" />
  <meta content="Learn about the most common Databricks E2 configuration errors during workspace creation and how to fix them." name="description" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0">
  <meta property="og:image" content="https://www.databricks.com/wp-content/uploads/2020/04/og-databricks.png">
  <meta property="og:image:type" content="image/png">
  <meta property="og:title" content="Troubleshooting creating workspaces">
  <meta property="og:image:width" content="1200">
  <meta property="og:image:height" content="630">
  <meta property="og:type" content="website">
  <meta property="og:url" content="https://docs.databricks.com">
  <meta property="og:description" content="" id="og-description">
  <meta name="twitter:image" content="https://www.databricks.com/wp-content/uploads/2020/04/og-databricks.png">
  <meta name="twitter:site" content="@databricks">
  <meta name="twitter:creator" content="@databricks">
  <meta property="twitter:description" content="">
  
  <title>Troubleshooting creating workspaces &#124; Databricks on AWS</title>
  
  
  <link rel="canonical" href="https://docs.databricks.com/en/administration-guide/workspace/troubleshooting.html">
  <!-- Start hreflang tag -->
  <link rel="alternate" hreflang="en" href="https://docs.databricks.com/en/administration-guide/workspace/troubleshooting.html" />
<link rel="alternate" hreflang="x-default" href="https://docs.databricks.com/en/administration-guide/workspace/troubleshooting.html" />
  <!-- End hreflang tag -->
  
  
  <link rel="shortcut icon" href="../../_static/favicon.ico" />
  

  

  

  <!-- Google Tag Manager -->
  <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'https://www.googletagmanager.com/gtm.js?id='+i+dl;
j.setAttributeNode(d.createAttribute('data-ot-ignore'));
f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-T85FQ33');</script>
  <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'https://www.googletagmanager.com/gtm.js?id='+i+dl;
j.setAttributeNode(d.createAttribute('data-ot-ignore'));
f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-TWTKQQ');</script>
    
  <!-- End Google Tag Manager -->


  <!-- MaxMind / GEO IP -->
  <script src="//js.maxmind.com/js/apis/geoip2/v2.1/geoip2.js" type="text/javascript"></script>
  <!-- End MaxMind / GEO IP -->

  
  
  <link href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,600&display=swap" rel="stylesheet">
  <link rel="preload" href="../../_static/fonts/DMSans-Bold.ttf" as="font">
  <link rel="preload" href="../../_static/fonts/DMSans-Regular.ttf" as="font">
  <link rel="preload" href="../../_static/fonts/DMMono-Regular.ttf" as="font">
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/css/custom.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/css/cloud-provider-selector.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/css/translation-selector.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/css/searchunify/main.css" type="text/css" />

  
  <link rel="index" title="Index" href="../../genindex.html" />
  <link rel="search" title="Search" href="../../search.html" />
  <link rel="top" title="Databricks on AWS" href="../../index.html" /> 
</head>

<body class="wy-body-for-nav" role="document">

  <!-- Google Tag Manager (noscript) -->
  <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-T85FQ33"
height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
  <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-TWTKQQ"
    height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
  <!-- End Google Tag Manager (noscript) -->

  
  <nav class="wy-nav-top header su_header" role="navigation" aria-label="top navigation">
    
<nav class="wy-nav-top header su_header" role="navigation" aria-label="top navigation">
  <div class="container-logo">
    <ul class="mobile-menu-toggle">
        <li class="menu-toggle">
            <i data-toggle="wy-nav-top" class="wy-nav-top-menu-button db-icon db-icon-menu pull-left"></i>
            
            <a href="https://www.databricks.com/" class="wy-nav-top-logo"><img src="../../_static/small-scale-lockup-full-color-rgb.svg" width="137" height="21"
              alt="Databricks" /></a>   
               
              </li>
    </ul>
    <ul class="su_nav-menu">
      <li class="menu-toggle">
        <i data-toggle="wy-nav-top" class="wy-nav-top-menu-button db-icon db-icon-menu pull-left"></i>
        
          
        
        <a href="https://www.databricks.com/" class="wy-nav-top-logo"><img src="../../_static/small-scale-lockup-full-color-rgb.svg" width="137" height="21"
            alt="Databricks" /></a></li>
        <!-- 
<li><a href="https://help.databricks.com/s/">Help Center</a></li>
<li class="active"><a href="https://docs.databricks.com/en/">Documentation</a></li>
<li><a href="https://kb.databricks.com/">Knowledge Base</a></li>
 -->
    </ul>
  </div>
  <div class="su_nav-right">
    <ul class="su_link-mobile">
  <!-- Mobile header code can go here -->
</ul>
<ul class="right-try-list">
   
</ul>
  </div>
</nav>
  </nav>

  <div class="su_sub-header">
    <div class="container">
      <div class="su_sub-header-inner">
        <!-- <div class="su_subnav-menu-right">
  <div id="auto" style="width: 100%;">
    <div ng-controller="SearchautoController">
      <div bind-html-compile="autocompleteHtml">
        <form class="su__search-box-1" disabled="disabled">
          <input class="su__search-input" type="search" name="Search box" id="su__search-b" placeholder="Search Documentation" disabled="disabled"/>
          <button class="su__search-button" type="submit" class="button button-success" disabled="disabled">
            <svg width="24" height="24" viewBox="0 0 24 24">
              <path
                d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"
                fill="#333"></path>
            </svg>
          </button>
        </form>
      </div>
    </div>
  </div>
</div> -->
        <div class="search-lng-gap"></div>
        <div style="margin-left: 16px; margin-right: 16px;">
          <!-- <select name="lng selector" id="lng-selector">
    <option value="../../../en/administration-guide/workspace/troubleshooting.html" class="notranslate">English</option>
    <option value="../../../ja/administration-guide/workspace/troubleshooting.html" class="notranslate">日本語</option>
    <option value="../../../pt/administration-guide/workspace/troubleshooting.html" class="notranslate">Português (Brasil)</option>
</select> -->
        </div>
        <div class="cloud-selector-container">
          <!-- <select name="cloud provider selector" id="cloud-provider-selector">
    <option value="aws" selected class="notranslate">
        Amazon Web Services
    </option>
    <option value="azure"  class="notranslate">
        Microsoft Azure
    </option>
    <option value="gcp"  class="notranslate">
        Google Cloud Platform
    </option>
</select> -->
        </div>
      </div>
    </div>
  </div>
  <page class="js-page-container">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side su_nav-side">
<div class="wy-side-scroll">
  <div class="wy-side-nav-search">
    

    

    

    
  </div>

  <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
    
      <a href="../../index.html" class="main-navigation-home">Databricks on AWS</a>
    

    
      

      
        <p class="caption"><span class="caption-text">Load &amp; manage data</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../rag-temp/index.html">RAG Studio</a></li>
</ul>

      
    
  </div>

  <div role="contentinfo">
    
  <p class="build_info notranslate"data-last-edit="December 23, 2023">
    Updated Jan 11, 2024
  </p>
<script>
  window.addEventListener('DOMContentLoaded',function(){
    var h1=document.querySelector('h1');
    var bi=document.querySelector('[data-last-edit]');
    if(h1 && bi){
      var ver = document.createElement('p');
      ver.className = 'version_info';
      ver.textContent = bi.getAttribute('data-last-edit');
      h1.parentElement.insertBefore(ver, h1.nextElementSibling);
    }
  });
</script>

    <p>
      
        <a id='feedbacklink' href="mailto:doc-feedback@databricks.com?subject=Documentation Feedback">Send us feedback</a>
      
    </p>
  </div>
</div>
</nav>
    
    
<main class="wy-grid-for-nav su_nav-grid">
  <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
    <div class="wy-nav-content su__nav_content">
      <div class="rst-content">
        





<div role="navigation" aria-label="breadcrumbs navigation" class="wy-breadcrumbs-wrapper">
  <ul class="wy-breadcrumbs">
    <li><a href="../../index.html">Documentation</a> <span class="db-icon db-icon-chevron-right"></span></li>
    
    
      <li>Troubleshooting creating workspaces</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>
</div>
        
        <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
          <div itemprop="articleBody">
            
    
  <div class="section" id="troubleshooting-creating-workspaces">
<h1>Troubleshooting creating workspaces<a class="headerlink" href="#troubleshooting-creating-workspaces" title="Permalink to this headline"> </a></h1>
<div class="section" id="overview">
<h2>Overview<a class="headerlink" href="#overview" title="Permalink to this headline"> </a></h2>
<p>The following sections describe configuration errors during workspace creation and how to fix the errors. Most issues apply to workspace creation using both the <a class="reference internal" href="create-workspace.html"><span class="doc">account console</span></a> or <a class="reference internal" href="create-workspace-api.html"><span class="doc">Account API</span></a>, with exceptions as indicated.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This article describes the process for <a class="reference internal" href="../../getting-started/overview.html#e2-architecture"><span class="std std-ref">accounts on the E2 version of the Databricks platform</span></a>. All new Databricks accounts and most existing accounts are now E2.</p>
</div>
<div class="admonition important">
<p class="admonition-title">Important</p>
<ul class="simple">
<li><p>This article mentions the term <em>compute plane</em>, which is the compute layer of the Databricks platform. In the context of this article, compute plane refers to the classic compute plane in your AWS account. By contrast, the serverless compute plane that supports <a class="reference internal" href="../../compute/sql-warehouse/serverless.html"><span class="doc">serverless SQL warehouses</span></a> runs in your Databricks account. To learn more, see <a class="reference internal" href="../../serverless-compute/index.html"><span class="doc">Serverless compute</span></a>.</p></li>
<li><p>Previously, Databricks referred to the compute plane as the data plane.</p></li>
</ul>
</div>
</div>
<div class="section" id="general-errors">
<h2>General errors<a class="headerlink" href="#general-errors" title="Permalink to this headline"> </a></h2>
<div class="section" id="maximum-number-of-vpcs">
<h3>Maximum number of VPCs<a class="headerlink" href="#maximum-number-of-vpcs" title="Permalink to this headline"> </a></h3>
<p>If you get an error message that mentions the maximum number of VPCs, submit a <a class="reference external" href="https://docs.aws.amazon.com/general/latest/gr/aws_service_limits.html">service limit increase request</a> for the number of VPCs allowed in the region.  This error typically happens only if you are using a Databricks-managed VPC, not a customer-managed VPC.</p>
</div>
<div class="section" id="maximum-number-of-vpc-endpoints">
<h3>Maximum number of VPC endpoints<a class="headerlink" href="#maximum-number-of-vpc-endpoints" title="Permalink to this headline"> </a></h3>
<p>If you get an error message that mentions a maximum number of VPC endpoints, submit a <a class="reference external" href="https://docs.aws.amazon.com/general/latest/gr/aws_service_limits.html">service limit increase request</a> for the number of Gateway VPC Endpoints allowed in the region. This error typically happens only if you are using a Databricks-managed VPC, not a customer-managed VPC.</p>
</div>
<div class="section" id="maximum-number-of-addresses">
<h3>Maximum number of addresses<a class="headerlink" href="#maximum-number-of-addresses" title="Permalink to this headline"> </a></h3>
<p>If you get an error message that mentions a maximum number of addresses, submit a <a class="reference external" href="https://docs.aws.amazon.com/general/latest/gr/aws_service_limits.html">service limit increase request</a> for VPC Elastic IP Addresses allowed in the region. This error typically happens only if you are using a Databricks-managed VPC, not a customer-managed VPC.</p>
</div>
<div class="section" id="not-authorized-to-perform-this-operation">
<h3>Not authorized to perform this operation<a class="headerlink" href="#not-authorized-to-perform-this-operation" title="Permalink to this headline"> </a></h3>
<p>If you get an error that you are not authorized to perform this operation, check that your IAM role has all of the necessary policies, as defined in the <a class="reference internal" href="../account-settings-e2/credentials.html"><span class="doc">IAM role article</span></a>.</p>
</div>
</div>
<div class="section" id="storage-configuration-error-messages">
<h2>Storage configuration error messages<a class="headerlink" href="#storage-configuration-error-messages" title="Permalink to this headline"> </a></h2>
<div class="section" id="malformed-request-failed-storage-configuration-validation-checks">
<h3>Malformed request: Failed storage configuration validation checks<a class="headerlink" href="#malformed-request-failed-storage-configuration-validation-checks" title="Permalink to this headline"> </a></h3>
<p>If you get an error message that mentions failed storage configuration validation checks, your S3 bucket permissions are not properly set up. Follow the steps in the article <a class="reference internal" href="../account-settings-e2/storage.html"><span class="doc">Create an S3 bucket for workspace deployment</span></a> to ensure that the S3 bucket permissions are correct.</p>
</div>
</div>
<div class="section" id="credentials-configuration-error-messages">
<h2>Credentials configuration error messages<a class="headerlink" href="#credentials-configuration-error-messages" title="Permalink to this headline"> </a></h2>
<div class="section" id="malformed-request-failed-credential-configuration-validation-checks">
<h3>Malformed request: Failed credential configuration validation checks<a class="headerlink" href="#malformed-request-failed-credential-configuration-validation-checks" title="Permalink to this headline"> </a></h3>
<p>The list of permissions checks in the error message indicate the likely cause of your problems.</p>
<ul class="simple">
<li><p>If the credential configuration validation fails fewer than ten permission checks, it’s likely that your IAM policy is missing those specific permissions. Copy the correct policy from the article <a class="reference internal" href="../account-settings-e2/credentials.html"><span class="doc">Create an IAM role for workspace deployment</span></a>.</p></li>
<li><p>If the credential configuration validation fails ten or more checks, it’s more likely that the trust relationship of the IAM role is incorrectly set up. Verify that the trust relationship of your customer role is set up properly according to instructions in the article <a class="reference internal" href="../account-settings-e2/credentials.html"><span class="doc">Create an IAM role for workspace deployment</span></a>.</p></li>
</ul>
<p>If both your policy and trust relationship appear to be correct, also check the following:</p>
<ul class="simple">
<li><p>Confirm that you include the correct role ARN in the credentials object.</p></li>
<li><p>Confirm whether you have organization-level <a class="reference external" href="https://docs.aws.amazon.com/organizations/latest/userguide/orgs_manage_policies_scps.html">service control policies</a> (SCPs) that deny the <code class="docutils literal notranslate"><span class="pre">AssumeRole</span></code> action or deny EC2/VPC access. If you are unsure, ask your AWS administrator about SCPs.</p></li>
</ul>
</div>
</div>
<div class="section" id="network-configuration">
<h2>Network configuration<a class="headerlink" href="#network-configuration" title="Permalink to this headline"> </a></h2>
<div class="section" id="subnet-is-already-in-use-by-another-network">
<h3>Subnet is already in use by another network<a class="headerlink" href="#subnet-is-already-in-use-by-another-network" title="Permalink to this headline"> </a></h3>
<p>A subnet in use error generally looks like the following:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>MALFORMED_REQUEST: Malformed parameters: subnet_id subnet-xxxxxxxx1 is already used by another Network, subnet_id subnet-xxxxxxxx2 is already used by another Network.
</pre></div>
</div>
<p>This means that you have a Databricks network configuration that uses these same subnets. To resolve, do one of the following:</p>
<ul class="simple">
<li><p>Delete the previous configuration. If you are using the Account API, use the <a class="reference external" href="https://docs.databricks.com/api/account/introduction">Delete network configuration API</a>. You can also use the <a class="reference internal" href="../account-settings/index.html#account-console"><span class="std std-ref">account console</span></a> to delete the configuration.</p></li>
<li><p>If that previous configuration is not in use, you can use that previous configuration for your new workspace.</p></li>
<li><p>If that network configuration is already in use by a running workspace, create new subnets and a new network configuration for your new workspace.</p></li>
</ul>
<p>Note that if a previous attempt at workspace creation failed, the related configuration components are not automatically deleted.</p>
</div>
<div class="section" id="no-network-configuration-errors-during-setup-but-errors-appear-during-workspace-creation">
<h3>No network configuration errors during setup, but errors appear during workspace creation<a class="headerlink" href="#no-network-configuration-errors-during-setup-but-errors-appear-during-workspace-creation" title="Permalink to this headline"> </a></h3>
<p>A network configuration might show errors after attempting to deploy a workspace but it showed no error when you set it up. This is because Databricks performs only basic validations while creating the network object. For example, it checks for unique subnets, unique security groups, and missing fields.</p>
<p>Most meaningful network configuration validation happens only after you attempt to create a new workspace with your new network configuration. If there were errors during workspace deployment, look closely at the network validation error message for details.</p>
</div>
<div class="section" id="a-new-cluster-does-not-respond-or-&quot;compute-plane-network-is-misconfigured&quot;-event-log-error">
<h3>A new cluster does not respond or “compute plane network is misconfigured” event log error<a class="headerlink" href="#a-new-cluster-does-not-respond-or-"compute-plane-network-is-misconfigured"-event-log-error" title="Permalink to this headline"> </a></h3>
<p>After what seems like a successful workspace deployment, you might notice that your first test cluster does not respond. After approximately 20-30 minutes, check your <a class="reference internal" href="../../compute/clusters-manage.html#event-log"><span class="std std-ref">cluster event log</span></a>. You might see a error message similar to:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>The compute plane network is misconfigured. Please verify that the network for your compute plane is configured correctly. Error message: Node daemon ping timeout in 600000 ms ...
</pre></div>
</div>
<p>This message indicates that routing or the firewall is incorrect. Databricks requested EC2 instances for a new cluster, but encountered a long time delay waiting for the EC2 instance to bootstrap and connect to the control plane. The cluster manager terminates the instances and reports this error.</p>
<p>Your network configuration must allow cluster node instances to successfully connect to the Databricks <a class="reference internal" href="../../getting-started/overview.html"><span class="doc">control plane</span></a>. For a faster troubleshooting technique than using a cluster, you can deploy an EC2 instance into one of the workspace subnets and do typical network troubleshooting steps like <code class="docutils literal notranslate"><span class="pre">nc</span></code>, <code class="docutils literal notranslate"><span class="pre">ping</span></code>, <code class="docutils literal notranslate"><span class="pre">telnet</span></code>, <code class="docutils literal notranslate"><span class="pre">traceroute</span></code>, etc. The Relay CNAME for each region is mentioned <a class="reference internal" href="../../security/network/classic/customer-managed-vpc.html#firewall"><span class="std std-ref">in the customer-managed VPC article</span></a>. For the Artifact Storage, ensure that there’s a successful networking path to S3.</p>
<p>For access domains and IPs by region, see <a class="reference internal" href="../../resources/supported-regions.html#ip-domain-aws"><span class="std std-ref">IP addresses and domains</span></a>. For regional endpoints, see <a class="reference internal" href="../../security/network/classic/customer-managed-vpc.html#regional-endpoints"><span class="std std-ref">(Recommended) Configure regional endpoints</span></a>. The following example uses the AWS region <code class="docutils literal notranslate"><span class="pre">eu-west-1</span></code>:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Verify access to the web application</span>
nc<span class="w"> </span>-zv<span class="w"> </span>ireland.cloud.databricks.com<span class="w"> </span><span class="m">443</span>

<span class="c1"># Verify access to the secure cluster connectivity relay</span>
nc<span class="w"> </span>-zv<span class="w"> </span>tunnel.eu-west-1.cloud.databricks.com<span class="w"> </span><span class="m">443</span>

<span class="c1"># Verify S3 global and regional access</span>
nc<span class="w"> </span>-zv<span class="w"> </span>s3.amazonaws.com<span class="w"> </span><span class="m">443</span>
nc<span class="w"> </span>-zv<span class="w"> </span>s3.eu-west-1.amazonaws.com<span class="w"> </span><span class="m">443</span>

<span class="c1"># Verify STS global and regional access</span>
nc<span class="w"> </span>-zv<span class="w"> </span>sts.amazonaws.com<span class="w"> </span><span class="m">443</span>
nc<span class="w"> </span>-zv<span class="w"> </span>sts.eu-west-1.amazonaws.com<span class="w"> </span><span class="m">443</span>

<span class="c1"># Verify regional Kinesis access</span>
nc<span class="w"> </span>-zv<span class="w"> </span>kinesis.eu-west-1.amazonaws.com<span class="w"> </span><span class="m">443</span>
</pre></div>
</div>
<p>If these all return correctly, the networking could be configured correctly but there could be another issue if you are using a firewall. The firewall may have deep packet inspection, SSL inspection, or something else that causes Databricks commands to fail. Using an EC2 instance in the Databricks subnet, try the following:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>curl<span class="w">  </span>-X<span class="w"> </span>GET<span class="w"> </span>-H<span class="w"> </span><span class="s1">&#39;Authorization: Bearer &lt;token&gt;&#39;</span><span class="w"> </span><span class="se">\</span>
https://&lt;workspace-name&gt;.cloud.databricks.com/api/2.0/clusters/spark-versions
</pre></div>
</div>
<p>Replace <code class="docutils literal notranslate"><span class="pre">&lt;token&gt;</span></code> with your own personal access token and use the correct URL for your workspace. See the <a class="reference external" href="https://docs.databricks.com/api/workspace/tokenmanagement">Token management API</a>.</p>
<p>If this request fails, try the <code class="docutils literal notranslate"><span class="pre">-k</span></code> option with your request to remove SSL verification. If this works with the <code class="docutils literal notranslate"><span class="pre">-k</span></code> option, then the firewall is causing an issue with SSL certificates.</p>
<p>Look at the SSL certificates using the following and replace the domain name with the <a class="reference internal" href="../../resources/supported-regions.html#ip-domain-aws"><span class="std std-ref">control plane web application domain</span></a> for your region:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>openssl<span class="w"> </span>s_client<span class="w"> </span>-showcerts<span class="w"> </span>-connect<span class="w"> </span>oregon.cloud.databricks.com:443
</pre></div>
</div>
<p>This command shows the return code and the Databricks certificates. If it returns an error, it’s a sign that your firewall is misconfigured and must be fixed.</p>
<p>Note that <a class="reference external" href="https://security.stackexchange.com/questions/19681/where-does-ssl-encryption-take-place">SSL issues are not a networking layer issue</a>. Viewing traffic at the firewall will not show these SSL issues. Looking at source and destination requests will work as expected.</p>
</div>
<div class="section" id="a-workspace-seems-to-work-but-its-network-configuration-has-status-warned">
<h3>A workspace seems to work but its network configuration has status <code class="docutils literal notranslate"><span class="pre">WARNED</span></code><a class="headerlink" href="#a-workspace-seems-to-work-but-its-network-configuration-has-status-warned" title="Permalink to this headline"> </a></h3>
<p>Make sure that you can start a cluster, run a data job, and that you don’t have <code class="docutils literal notranslate"><span class="pre">DBFS_DOWN</span></code> or <code class="docutils literal notranslate"><span class="pre">METASTORE_DOWN</span></code> showing in your <a class="reference internal" href="../../compute/clusters-manage.html#cluster-event-logs"><span class="std std-ref">Cluster event logs</span></a>. If there are no such errors in the cluster event log, the <code class="docutils literal notranslate"><span class="pre">WARNED</span></code> status is not necessarily a problem.</p>
<p>For a new workspace, there are a number of things that Databricks attempts to check. If you do not do a simple routing like Workspace subnets → NAT Gateway → Internet Gateway, then Databricks cannot verify that your network is correct. In such cases, Databricks displays a warning on the network configuration.</p>
<div class="section" id="check-for-subnet-route-table-errors">
<h4>Check for subnet route table errors<a class="headerlink" href="#check-for-subnet-route-table-errors" title="Permalink to this headline"> </a></h4>
<p>In your cluster events log, you may see errors like:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>subnet: Route Table with ID rtb-xxxxxxxx used for subnet with ID subnet-yyyyyyyyy is missing default route to direct all traffic to the NAT gateway nat-zzzzzzzzzzz.
</pre></div>
</div>
<p>This error could actually indicate a problem if you are trying to deploy a simple Databricks workspace configuration.</p>
<p>If you do your own egress setup, like routing through a firewall (optionally via a Transit Gateway in a hub-spoke fashion), this error will not necessarily be meaningful.</p>
<p>Another potential reason for this error is you register a NAT subnet as a Databricks subnet for clusters. Remove the NAT subnet from the list of Databricks workspace subnets and re-create the workspace.</p>
</div>
<div class="section" id="do-not-add-your-nat-subnet-to-the-list-of-subnets-in-a-network-configuration">
<h4>Do not add your NAT subnet to the list of subnets in a network configuration<a class="headerlink" href="#do-not-add-your-nat-subnet-to-the-list-of-subnets-in-a-network-configuration" title="Permalink to this headline"> </a></h4>
<p>Do not add your NAT subnet to the list of Databricks workspace subnets. The NAT subnet is for the NAT gateway and is not intended as a subnet for deployment of Databricks cluster nodes. When creating a network configuration, only list the two subnets to use for Databricks nodes.</p>
</div>
</div>
<div class="section" id="problems-using-your-metastore-or-cluster-event-log-includes-metastore_down-events">
<h3>Problems using your metastore or cluster event log includes <code class="docutils literal notranslate"><span class="pre">METASTORE_DOWN</span></code> events<a class="headerlink" href="#problems-using-your-metastore-or-cluster-event-log-includes-metastore_down-events" title="Permalink to this headline"> </a></h3>
<p>If your workspace seems to be up and you can set up clusters, but you have <code class="docutils literal notranslate"><span class="pre">METASTORE_DOWN</span></code> events in your <a class="reference internal" href="../../compute/clusters-manage.html#view-cluster-logs"><span class="std std-ref">cluster event logs</span></a>, or if your <a class="reference internal" href="../../archive/external-metastores/index.html"><span class="doc">metastore</span></a> does not seem to work, confirm if you use a Web Application Firewall (WAF) like Squid proxy. Cluster members must connect to several services that don’t work over a WAF.</p>
</div>
<div class="section" id="cluster-start-error-failed-to-launch-spark-container-on-instance">
<h3>Cluster start error: failed to launch Spark container on instance<a class="headerlink" href="#cluster-start-error-failed-to-launch-spark-container-on-instance" title="Permalink to this headline"> </a></h3>
<p>You might see a cluster log error such as:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>Cluster start error: failed to launch spark container on instance ...
Exception: Could not add container for ... with address ....
Timed out with exception after 1 attempts
</pre></div>
</div>
<p>This <a class="reference internal" href="../../compute/clusters-manage.html#view-cluster-logs"><span class="std std-ref">cluster log error</span></a> is likely due to the instance not being able to use STS to get into the root S3 bucket. This usually happens when you are implementing exfiltration protection, using VPC endpoints to lock down communication, or adding a firewall.</p>
<p>To fix, do one of the following:</p>
<ul class="simple">
<li><p>Change the firewall to allow the global STS endpoint to pass (<code class="docutils literal notranslate"><span class="pre">sts.amazonaws.com</span></code>) as documented in the <a class="reference internal" href="../../security/network/classic/customer-managed-vpc.html"><span class="doc">VPC requirements docs</span></a>.</p></li>
<li><p>Use a VPC endpoint to set up the <a class="reference internal" href="../../security/network/classic/customer-managed-vpc.html#regional-endpoints"><span class="std std-ref">regional endpoint</span></a>.</p></li>
</ul>
<p>To get more information about the error, call the <code class="docutils literal notranslate"><span class="pre">decode-authorization-message</span></code> AWS CLI command. For details, see the <a class="reference external" href="https://docs.aws.amazon.com/cli/latest/reference/sts/decode-authorization-message.html">AWS article for decode-authorization-message</a>. The command looks like:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>aws<span class="w"> </span>sts<span class="w"> </span>decode-authorization-message<span class="w"> </span>--encoded-message
</pre></div>
</div>
<p>You may see this error if you set up a VPC endpoint (VPCE) with a different security group for the STS VPCE than the workspaces. You can either update the security groups to allow resources in each security group to talk to each other or put the STS VPCE in the same security group as the workspace subnets.</p>
<p>Cluster nodes need to use STS to access the root S3 bucket using the customer S3 policy. A network path has to be available to the AWS STS service from Databricks cluster nodes.</p>
</div>
<div class="section" id="security-group-could-not-be-updated-with-the-latest-rules">
<h3>Security Group could not be updated with the latest rules<a class="headerlink" href="#security-group-could-not-be-updated-with-the-latest-rules" title="Permalink to this headline"> </a></h3>
<p>You may see a cluster log error such as:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>Security Group with ID sg-xxxx could not be updated with latest Security Group Rules
</pre></div>
</div>
<p>Update the IAM role to conform to what we have in the <a class="reference internal" href="../account-settings-e2/credentials.html"><span class="doc">IAM role article</span></a>. In some cases, the resource for <code class="docutils literal notranslate"><span class="pre">AuthorizeSecurityGroupEgress</span></code> and similar actions can have comma-separated values. Update these to separate resources instead of one resource:</p>
<p><strong>Correct</strong></p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="nt">&quot;Action&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">    </span><span class="s2">&quot;ec2:AuthorizeSecurityGroupEgress&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="s2">&quot;ec2:AuthorizeSecurityGroupIngress&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="s2">&quot;ec2:RevokeSecurityGroupEgress&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="s2">&quot;ec2:RevokeSecurityGroupIngress&quot;</span>
<span class="p">],</span>
<span class="nt">&quot;Resource&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">    </span><span class="s2">&quot;arn:aws:ec2:us-east-1:444:security-group/sg-xxxx&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="s2">&quot;arn:aws:ec2:us-east-1:444:security-group/sg-yyyy&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="s2">&quot;arn:aws:ec2:us-east-1:444:security-group/sg-zzzz&quot;</span>
<span class="p">],</span>
</pre></div>
</div>
<p><strong>Incorrect</strong></p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="nt">&quot;Resource&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;arn:aws:ec2:us-east-1:444:security-group/sg-xxxx,sg-yyyy,sg-zzzz&quot;</span><span class="p">],</span>
</pre></div>
</div>
</div>
<div class="section" id="if-you-have-network-setup-issues-consider-using-a-databricks-managed-vpc">
<h3>If you have network setup issues, consider using a Databricks-managed VPC<a class="headerlink" href="#if-you-have-network-setup-issues-consider-using-a-databricks-managed-vpc" title="Permalink to this headline"> </a></h3>
<p>If you are having network setup issues, you could choose to create the workspace with a Databricks-managed VPC rather than a customer-managed VPC.</p>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>You must choose whether to provide a customer-managed VPC when creating your workspace. You cannot change this setting after you successfully create the workspace.</p>
</div>
<p>To switch a failed workspace to use a Databricks-managed VPC, you must also use a different cross-account IAM role:</p>
<ol class="arabic">
<li><p>Go to the <a class="reference internal" href="../account-settings-e2/credentials.html"><span class="doc">cross-account IAM role</span></a> article.</p></li>
<li><p>Select and copy the policy labelled <strong>Databricks VPC</strong>.</p></li>
<li><p>Use that policy for <a class="reference internal" href="create-workspace.html"><span class="doc">workspace creation using the account console</span></a> or <a class="reference internal" href="create-workspace-api.html"><span class="doc">workspace creation using the Account API</span></a></p>
<ul>
<li><p>In the <a class="reference internal" href="../account-settings/index.html#account-console"><span class="std std-ref">account console</span></a>, in the network configuration picker, select <strong>Databricks-managed</strong>.</p></li>
<li><p>For the Account API, be careful not to include the <code class="docutils literal notranslate"><span class="pre">network_id</span></code> element, for example:</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;workspace_name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;&lt;workspace-name&gt;&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;deployment_name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;&lt;deployment-name&gt;&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;aws_region&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;&lt;aws-region&gt;&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;credentials_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;&lt;credentials-id&gt;&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;storage_configuration_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;&lt;storage-configuration-id&gt;&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
</li>
</ul>
</li>
</ol>
</div>
</div>
<div class="section" id="diagnose-vpc-network-issues-with-aws-reachability-analyzer">
<h2>Diagnose VPC network issues with AWS Reachability Analyzer<a class="headerlink" href="#diagnose-vpc-network-issues-with-aws-reachability-analyzer" title="Permalink to this headline"> </a></h2>
<p>AWS’s Reachability Analyzer is a configuration analysis tool you can use to test a source resource and a destination resource in your VPC. You can find it in your AWS Console as <strong>VPC Reachability Analyzer</strong>.</p>
<p>With Reachability Analyzer, you can spin up a test machine in the Databricks private subnet without logging in. You need to add the source as your EC2 instance and the destination as the Databricks control plane IP address and port. You can then test the connectivity to find the blocking component. For more information, see <a class="reference external" href="https://docs.aws.amazon.com/vpc/latest/reachability/what-is-reachability-analyzer.html">What is Reachability Analyzer</a>.</p>
</div>
<div class="section" id="account-api-specific-error-messages">
<h2>Account API specific error messages<a class="headerlink" href="#account-api-specific-error-messages" title="Permalink to this headline"> </a></h2>
<p>The following errors are potentially returned from an Account API request to create the workspace.</p>
<div class="section" id="malformed-request-invalid-config-in-the-http-request-body">
<h3>Malformed request: Invalid <code class="docutils literal notranslate"><span class="pre">&lt;config&gt;</span></code> in the HTTP request body<a class="headerlink" href="#malformed-request-invalid-config-in-the-http-request-body" title="Permalink to this headline"> </a></h3>
<p>The JSON of your request body is incorrectly formatted. In this error message, <code class="docutils literal notranslate"><span class="pre">&lt;config&gt;</span></code> refers to either credentials, storage configurations, or networks. Confirm that all special characters are escaped properly in the URL or use a REST API client application such as Postman.</p>
</div>
<div class="section" id="malformed-request-invalid-config-in-body">
<h3>Malformed request: Invalid <code class="docutils literal notranslate"><span class="pre">&lt;config&gt;</span></code> in body<a class="headerlink" href="#malformed-request-invalid-config-in-body" title="Permalink to this headline"> </a></h3>
<p>The JSON of your request body is incorrectly formatted. In this error message, <code class="docutils literal notranslate"><span class="pre">&lt;config&gt;</span></code> refers to either credentials, storage configurations, or networks. Confirm that all special characters are escaped properly in the URL or use a REST API client application such as Postman.</p>
</div>
</div>
</div>


    
          </div>
        </div>
        <div  class="suapp-rating">
  <div id="suPageRateApp">
     <su-app></su-app>
   </div> 
 </div>
<hr> 
<footer>
  <div role="contentinfo">
      <p class="copyright">
          &copy; Databricks 2023. All rights reserved. Apache, Apache Spark, Spark, and the Spark logo are trademarks of the <a href="http://www.apache.org/">Apache Software Foundation</a>.
      </p>
      <p> 
        
          <a id='feedbacklink' href="mailto:doc-feedback@databricks.com?subject=Documentation Feedback">Send us feedback</a>
        
     | <a href="https://databricks.com/privacy-policy">Privacy Policy</a> | <a href="https://databricks.com/terms-of-use">Terms of Use</a></p>

  </div> 

</footer>
      </div>
    </div>
  </section>
</main>

  </page>
  
  <script type="text/javascript">
    var DOCUMENTATION_OPTIONS = {
      URL_ROOT: '../../',
      VERSION: '1.0',
      COLLAPSE_INDEX: false,
      FILE_SUFFIX: '.html',
      HAS_SOURCE: 'false'
    };
  </script>
  <script type="text/javascript" src="../../_static/jquery.js"></script>
  <script type="text/javascript" src="../../_static/underscore.js"></script>
  <script type="text/javascript" src="../../_static/doctools.js"></script>
  <script type="text/javascript" src="../../_static/language_data.js"></script>
  

  <script type="text/javascript" src="../../_static/js/clipboard.min.js"></script>
  <script type="text/javascript" src="../../_static/js/jquery.waypoints.min.js"></script>

  <!-- Select2 (https://select2.org/) -->
  <link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />
  <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
  <!-- End Select2 -->

  
  
  <script type="text/javascript" src="../../_static/js/localized.js"></script>
  <script type="text/javascript" src="../../_static/js/custom.js"></script>
  

  
  
  <script type="text/javascript">
    jQuery(function () {
      SphinxRtdTheme.StickyNav.enable();
    });

  </script>
  
 



  <script>
  window.__searchunifyLoaderConfig = JSON.parse('{"clients": {"en": "02c2e804-27e9-11ee-aefb-0242ac120011", "ja": "6a42c3f2-2820-11ee-aefb-0242ac120011", "pt": "6a86badd-2821-11ee-aefb-0242ac120011"}}')
</script>
<script type="text/javascript" src="../../_static/js/search-loader.js"></script>
</body>
<script type='text/javascript'>
  window.onload = function () {
    var description = document.querySelector('meta[name="description"]').getAttribute("content");
    let titleText = document.querySelector('h1').textContent;
    document.querySelector('meta[property="og:title"]').setAttribute("content", titleText);
    document.querySelector('meta[property="og:description"]').setAttribute("content", description);
    document.querySelector('meta[property="twitter:description"]').setAttribute("content", description);
  };
</script>

</html>