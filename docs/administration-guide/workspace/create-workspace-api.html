

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en-US" > <![endif]-->
<!--[if gt IE 8]><!-->
<html class="no-js" lang="en-US"> <!--<![endif]-->

<head>
  <!-- cookie consent -->
  
    <!-- Combined Onetrust and Rudderstack Implementation Scripts -->
    <!-- Onetrust Initialization -->
    <script type="text/javascript" src="https://cdn.cookielaw.org/consent/92466579-1717-44d3-809d-a05fb02843ed-test/OtAutoBlock.js"></script>
    <script src="https://cdn.cookielaw.org/scripttemplates/otSDKStub.js" data-document-language="true" type="text/javascript" charset="UTF-8" data-domain-script="92466579-1717-44d3-809d-a05fb02843ed-test"></script>
    <link rel="stylesheet" id="db-onetrust-style" href="https://www.databricks.com/wp-content/uploads/db_onetrust.css" media="all" />
    <!-- Setting Rudderstack Write Key -->
    <script>window.rudderstackKey = "2SOR9fvSr5Fi6tN2ihPbVHnX1SZ" </script>
    <!-- Rudderstack Initialization + Onetrust Integration + Rudderstack Custom Events -->
    <script type="text/javascript" src="https://www.databricks.com/sites/default/files/rudderstack/v1/db-rudderstack-events.js"></script>

  <!-- cookie consent -->

  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta http-equiv="X-UA-Compatible" content="IE=9" />
  <meta content="Learn how to create Databricks workspaces using the Account API. If you use customer-managed keys, you must use the Account API to set up a workspace." name="description" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0">
  <meta property="og:image" content="https://www.databricks.com/wp-content/uploads/2020/04/og-databricks.png">
  <meta property="og:image:type" content="image/png">
  <meta property="og:title" content="Create a workspace using the Account API">
  <meta property="og:image:width" content="1200">
  <meta property="og:image:height" content="630">
  <meta property="og:type" content="website">
  <meta property="og:url" content="https://docs.databricks.com">
  <meta property="og:description" content="" id="og-description">
  <meta name="twitter:image" content="https://www.databricks.com/wp-content/uploads/2020/04/og-databricks.png">
  <meta name="twitter:site" content="@databricks">
  <meta name="twitter:creator" content="@databricks">
  <meta property="twitter:description" content="">
  
  <title>Create a workspace using the Account API &#124; Databricks on AWS</title>
  
  
  <link rel="canonical" href="https://docs.databricks.com/en/administration-guide/workspace/create-workspace-api.html">
  <!-- Start hreflang tag -->
  <link rel="alternate" hreflang="en" href="https://docs.databricks.com/en/administration-guide/workspace/create-workspace-api.html" />
<link rel="alternate" hreflang="x-default" href="https://docs.databricks.com/en/administration-guide/workspace/create-workspace-api.html" />
  <!-- End hreflang tag -->
  
  
  <link rel="shortcut icon" href="../../_static/favicon.ico" />
  

  

  

  <!-- Google Tag Manager -->
  <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'https://www.googletagmanager.com/gtm.js?id='+i+dl;
j.setAttributeNode(d.createAttribute('data-ot-ignore'));
f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-T85FQ33');</script>
  <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'https://www.googletagmanager.com/gtm.js?id='+i+dl;
j.setAttributeNode(d.createAttribute('data-ot-ignore'));
f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-TWTKQQ');</script>
    
  <!-- End Google Tag Manager -->


  <!-- MaxMind / GEO IP -->
  <script src="//js.maxmind.com/js/apis/geoip2/v2.1/geoip2.js" type="text/javascript"></script>
  <!-- End MaxMind / GEO IP -->

  
  
  <link href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,600&display=swap" rel="stylesheet">
  <link rel="preload" href="../../_static/fonts/DMSans-Bold.ttf" as="font">
  <link rel="preload" href="../../_static/fonts/DMSans-Regular.ttf" as="font">
  <link rel="preload" href="../../_static/fonts/DMMono-Regular.ttf" as="font">
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/css/custom.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/css/cloud-provider-selector.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/css/translation-selector.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/css/searchunify/main.css" type="text/css" />

  
  <link rel="index" title="Index" href="../../genindex.html" />
  <link rel="search" title="Search" href="../../search.html" />
  <link rel="top" title="Databricks on AWS" href="../../index.html" /> 
</head>

<body class="wy-body-for-nav" role="document">

  <!-- Google Tag Manager (noscript) -->
  <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-T85FQ33"
height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
  <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-TWTKQQ"
    height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
  <!-- End Google Tag Manager (noscript) -->

  
  <nav class="wy-nav-top header su_header" role="navigation" aria-label="top navigation">
    
<nav class="wy-nav-top header su_header" role="navigation" aria-label="top navigation">
  <div class="container-logo">
    <ul class="mobile-menu-toggle">
        <li class="menu-toggle">
            <i data-toggle="wy-nav-top" class="wy-nav-top-menu-button db-icon db-icon-menu pull-left"></i>
            
            <a href="https://www.databricks.com/" class="wy-nav-top-logo"><img src="../../_static/small-scale-lockup-full-color-rgb.svg" width="137" height="21"
              alt="Databricks" /></a>   
               
              </li>
    </ul>
    <ul class="su_nav-menu">
      <li class="menu-toggle">
        <i data-toggle="wy-nav-top" class="wy-nav-top-menu-button db-icon db-icon-menu pull-left"></i>
        
          
        
        <a href="https://www.databricks.com/" class="wy-nav-top-logo"><img src="../../_static/small-scale-lockup-full-color-rgb.svg" width="137" height="21"
            alt="Databricks" /></a></li>
        <!-- 
<li><a href="https://help.databricks.com/s/">Help Center</a></li>
<li class="active"><a href="https://docs.databricks.com/en/">Documentation</a></li>
<li><a href="https://kb.databricks.com/">Knowledge Base</a></li>
 -->
    </ul>
  </div>
  <div class="su_nav-right">
    <ul class="su_link-mobile">
  <!-- Mobile header code can go here -->
</ul>
<ul class="right-try-list">
   
</ul>
  </div>
</nav>
  </nav>

  <div class="su_sub-header">
    <div class="container">
      <div class="su_sub-header-inner">
        <!-- <div class="su_subnav-menu-right">
  <div id="auto" style="width: 100%;">
    <div ng-controller="SearchautoController">
      <div bind-html-compile="autocompleteHtml">
        <form class="su__search-box-1" disabled="disabled">
          <input class="su__search-input" type="search" name="Search box" id="su__search-b" placeholder="Search Documentation" disabled="disabled"/>
          <button class="su__search-button" type="submit" class="button button-success" disabled="disabled">
            <svg width="24" height="24" viewBox="0 0 24 24">
              <path
                d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"
                fill="#333"></path>
            </svg>
          </button>
        </form>
      </div>
    </div>
  </div>
</div> -->
        <div class="search-lng-gap"></div>
        <div style="margin-left: 16px; margin-right: 16px;">
          <!-- <select name="lng selector" id="lng-selector">
    <option value="../../../en/administration-guide/workspace/create-workspace-api.html" class="notranslate">English</option>
    <option value="../../../ja/administration-guide/workspace/create-workspace-api.html" class="notranslate">日本語</option>
    <option value="../../../pt/administration-guide/workspace/create-workspace-api.html" class="notranslate">Português (Brasil)</option>
</select> -->
        </div>
        <div class="cloud-selector-container">
          <!-- <select name="cloud provider selector" id="cloud-provider-selector">
    <option value="aws" selected class="notranslate">
        Amazon Web Services
    </option>
    <option value="azure"  class="notranslate">
        Microsoft Azure
    </option>
    <option value="gcp"  class="notranslate">
        Google Cloud Platform
    </option>
</select> -->
        </div>
      </div>
    </div>
  </div>
  <page class="js-page-container">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side su_nav-side">
<div class="wy-side-scroll">
  <div class="wy-side-nav-search">
    

    

    

    
  </div>

  <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
    
      <a href="../../index.html" class="main-navigation-home">Databricks on AWS</a>
    

    
      

      
        <p class="caption"><span class="caption-text">Load &amp; manage data</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../rag-temp/index.html">RAG Studio</a></li>
</ul>

      
    
  </div>

  <div role="contentinfo">
    
  <p class="build_info notranslate"data-last-edit="December 23, 2023">
    Updated Jan 11, 2024
  </p>
<script>
  window.addEventListener('DOMContentLoaded',function(){
    var h1=document.querySelector('h1');
    var bi=document.querySelector('[data-last-edit]');
    if(h1 && bi){
      var ver = document.createElement('p');
      ver.className = 'version_info';
      ver.textContent = bi.getAttribute('data-last-edit');
      h1.parentElement.insertBefore(ver, h1.nextElementSibling);
    }
  });
</script>

    <p>
      
        <a id='feedbacklink' href="mailto:doc-feedback@databricks.com?subject=Documentation Feedback">Send us feedback</a>
      
    </p>
  </div>
</div>
</nav>
    
    
<main class="wy-grid-for-nav su_nav-grid">
  <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
    <div class="wy-nav-content su__nav_content">
      <div class="rst-content">
        





<div role="navigation" aria-label="breadcrumbs navigation" class="wy-breadcrumbs-wrapper">
  <ul class="wy-breadcrumbs">
    <li><a href="../../index.html">Documentation</a> <span class="db-icon db-icon-chevron-right"></span></li>
    
    
      <li>Create a workspace using the Account API</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>
</div>
        
        <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
          <div itemprop="articleBody">
            
    
  <div class="section" id="create-a-workspace-using-the-account-api">
<h1>Create a workspace using the Account API<a class="headerlink" href="#create-a-workspace-using-the-account-api" title="Permalink to this headline"> </a></h1>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>These instructions apply to accounts created before November 8, 2023. If your Databricks account was created after November 8, 2023, see <a class="reference external" href="https://docs.databricks.com/api/account/workspaces/create">Create workspace API</a>.</p>
</div>
<p>This article teaches you how to create a workspace using the Account API. You can also create workspaces using the <a class="reference internal" href="quick-start.html"><span class="doc">AWS Quick Start template</span></a>, <a class="reference internal" href="#"><span class="doc">the account console</span></a>, or <a class="reference internal" href="../../dev-tools/terraform/e2-workspace.html"><span class="doc">Terraform</span></a>.</p>
<p>You must use the Account API to create workspaces if you want to use <a class="reference internal" href="../../security/keys/customer-managed-keys-managed-services-aws.html"><span class="doc">customer-managed keys for managed services</span></a> or <a class="reference internal" href="../../security/network/classic/privatelink.html"><span class="doc">AWS PrivateLink</span></a>.</p>
<div class="admonition important">
<p class="admonition-title">Important</p>
<ul class="simple">
<li><p>This article mentions the term <em>compute plane</em>, which is the compute layer of the Databricks platform. In the context of this article, compute plane refers to the classic compute plane in your AWS account. By contrast, the serverless compute plane that supports <a class="reference internal" href="../../compute/sql-warehouse/serverless.html"><span class="doc">serverless SQL warehouses</span></a> runs in your Databricks account. To learn more, see <a class="reference internal" href="../../serverless-compute/index.html"><span class="doc">Serverless compute</span></a>.</p></li>
<li><p>Previously, Databricks referred to the compute plane as the data plane.</p></li>
</ul>
</div>
<div class="section" id="before-you-begin">
<h2>Before you begin<a class="headerlink" href="#before-you-begin" title="Permalink to this headline"> </a></h2>
<ul>
<li><p>Ensure you have access to your <a class="reference internal" href="../account-settings/index.html#account-id"><span class="std std-ref">account ID</span></a>.</p></li>
<li><p>Determine if your workspace will enable the following features:</p>
<ul class="simple">
<li><p><strong><a class="reference internal" href="../../security/network/classic/customer-managed-vpc.html"><span class="doc">Customer-managed VPC</span></a></strong>: Provide your own Amazon Virtual Public Cloud (VPC) if you want to use <a class="reference internal" href="../../security/network/classic/privatelink.html"><span class="doc">AWS PrivateLink</span></a> for any type of connection.</p></li>
<li><p><strong><a class="reference internal" href="../../security/network/classic/secure-cluster-connectivity.html"><span class="doc">Secure cluster connectivity</span></a></strong>: Network architecture with no VPC open ports and no Databricks runtime worker public IP addresses. In some APIs, this is referred to as No Public IP or NPIP. Note: Secure cluster connectivity is enabled by default for all workspaces created by Account API after September 1, 2020.</p></li>
<li><p><strong>Customer-managed keys for encryption</strong>:</p>
<ul>
<li><p><strong><a class="reference internal" href="../../security/keys/customer-managed-keys-managed-services-aws.html"><span class="doc">Customer-managed keys for managed services in the control plane</span></a></strong>: Provide KMS keys to encrypt notebook and secret data in the Databricks-managed control plane.</p></li>
<li><p><strong><a class="reference internal" href="../../security/keys/customer-managed-keys-storage-aws.html"><span class="doc">Customer-managed keys for workspace storage</span></a></strong>: Provide KMS keys to encrypt your workspace’s S3 bucket (the workspace’s root DBFS, job results, and more) and optionally cluster node EBS volumes.</p></li>
</ul>
</li>
<li><p><strong><a class="reference internal" href="../../security/network/classic/privatelink.html"><span class="doc">AWS PrivateLink</span></a></strong>: AWS PrivateLink provides private connectivity from AWS VPCs and on-premises networks to AWS services without exposing the traffic to the public network.</p></li>
</ul>
</li>
<li><p>Determine the regions to use for your workspace’s <a class="reference internal" href="../../getting-started/overview.html#architecture"><span class="std std-ref">compute plane</span></a> (VPC). The <a class="reference internal" href="../../getting-started/overview.html#architecture"><span class="std std-ref">control plane</span></a> region is determined by the compute plane region.</p>
<p>Workspace compute plane VPCs can be in AWS regions <code class="docutils literal notranslate"><span class="pre">ap-northeast-1</span></code>, <code class="docutils literal notranslate"><span class="pre">ap-northeast-2</span></code>, <code class="docutils literal notranslate"><span class="pre">ap-south-1</span></code>, <code class="docutils literal notranslate"><span class="pre">ap-southeast-1</span></code>, <code class="docutils literal notranslate"><span class="pre">ap-southeast-2</span></code>, <code class="docutils literal notranslate"><span class="pre">ca-central-1</span></code>, <code class="docutils literal notranslate"><span class="pre">eu-west-1</span></code>, <code class="docutils literal notranslate"><span class="pre">eu-west-2</span></code>, <code class="docutils literal notranslate"><span class="pre">eu-central-1</span></code>, <code class="docutils literal notranslate"><span class="pre">us-east-1</span></code>, <code class="docutils literal notranslate"><span class="pre">us-east-2</span></code>, <code class="docutils literal notranslate"><span class="pre">us-west-1</span></code>, and <code class="docutils literal notranslate"><span class="pre">us-west-2</span></code>. However, you cannot use a VPC in <code class="docutils literal notranslate"><span class="pre">us-west-1</span></code> if you want to use <a class="reference internal" href="../../security/keys/customer-managed-keys.html"><span class="doc">customer-managed keys</span></a> for encryption.</p>
</li>
</ul>
</div>
<div class="section" id="how-to-use-the-account-api">
<span id="how-to-use-the-account-api"></span><h2>How to use the Account API<a class="headerlink" href="#how-to-use-the-account-api" title="Permalink to this headline"> </a></h2>
<p>To authenticate to the Account API, you can use Databricks OAuth for service principals, Databricks OAuth for users, or a Databricks account admin’s username and password. Databricks strongly recommends that you use Databricks OAuth for users or service principals. A service principal is an identity that you create in Databricks for use with automated tools, jobs, and applications. To create an OAuth token, see <a class="reference internal" href="../../dev-tools/authentication-oauth.html"><span class="doc">Authentication using OAuth for service principals</span></a>.</p>
<p>Use the following examples to authenticate to a Databricks account. You can use OAuth for service principals, OAuth for users, or a user’s username and password (legacy). For background, see:</p>
<ul class="simple">
<li><p>For OAuth for service principals, see <a class="reference internal" href="../../dev-tools/auth/oauth-m2m.html"><span class="doc">OAuth machine-to-machine (M2M) authentication</span></a>.</p></li>
<li><p>For OAuth for users, see <a class="reference internal" href="../../dev-tools/auth/oauth-u2m.html"><span class="doc">OAuth user-to-machine (U2M) authentication</span></a>.</p></li>
<li><p>For a user’s username and password (legacy), see <a class="reference internal" href="../../dev-tools/auth/basic.html"><span class="doc">Basic authentication (legacy)</span></a>.</p></li>
</ul>
<p>For authentication examples, choose from the following:</p>
<div class="js-code-language-tabs compound">
<div class="compound-first compound" lang="OAuth&amp;nbsp;for&amp;nbsp;service&amp;nbsp;principals">
<ol class="arabic">
<li><p>Install Databricks CLI version 0.205 or above. See <a class="reference internal" href="../../dev-tools/cli/install.html"><span class="doc">Install or update the Databricks CLI</span></a>.</p></li>
<li><p>Complete the steps to configure OAuth M2M authentication for service principals in the account. See <a class="reference internal" href="../../dev-tools/auth/oauth-m2m.html"><span class="doc">OAuth machine-to-machine (M2M) authentication</span></a>.</p></li>
<li><p>Identify or manually create a Databricks configuration profile in your <code class="docutils literal notranslate"><span class="pre">.databrickscfg</span></code> file, with the profile’s fields set correctly for the related <code class="docutils literal notranslate"><span class="pre">host</span></code>, <code class="docutils literal notranslate"><span class="pre">account_id</span></code>, and <code class="docutils literal notranslate"><span class="pre">client_id</span></code> and <code class="docutils literal notranslate"><span class="pre">client_secret</span></code> mapping to the service principal. See <a class="reference internal" href="../../dev-tools/cli/authentication.html#m2m-auth"><span class="std std-ref">OAuth machine-to-machine (M2M) authentication</span></a>.</p></li>
<li><p>Run your target Databricks CLI command, where <code class="docutils literal notranslate"><span class="pre">&lt;profile-name&gt;</span></code> represents the name of the configuration profile in your <code class="docutils literal notranslate"><span class="pre">.databrickscfg</span></code> file:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>databricks<span class="w"> </span>account<span class="w"> </span>&lt;command-name&gt;<span class="w"> </span>&lt;subcommand-name&gt;<span class="w"> </span>-p<span class="w"> </span>&lt;profile-name&gt;
</pre></div>
</div>
<p>For example, to list all users in the account:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>databricks<span class="w"> </span>account<span class="w"> </span>users<span class="w"> </span>list<span class="w"> </span>-p<span class="w"> </span>MY-AWS-ACCOUNT
</pre></div>
</div>
<ul class="simple">
<li><p>For a list of available account commands, run the command <code class="docutils literal notranslate"><span class="pre">databricks</span> <span class="pre">account</span> <span class="pre">-h</span></code>.</p></li>
<li><p>For a list of available subcommands for an account command, run the command <code class="docutils literal notranslate"><span class="pre">databricks</span> <span class="pre">account</span> <span class="pre">&lt;command-name&gt;</span> <span class="pre">-h</span></code>.</p></li>
</ul>
</li>
</ol>
</div>
<div class="compound-middle compound" lang="OAuth&amp;nbsp;for&amp;nbsp;users">
<ol class="arabic">
<li><p>Install Databricks CLI version 0.205 or above. See <a class="reference internal" href="../../dev-tools/cli/install.html"><span class="doc">Install or update the Databricks CLI</span></a>.</p></li>
<li><p>Complete the steps to configure OAuth U2M authentication for users in the account. See <a class="reference internal" href="../../dev-tools/auth/oauth-u2m.html"><span class="doc">OAuth user-to-machine (U2M) authentication</span></a>.</p></li>
<li><p>Start the user authentication process by running the following Databricks CLI command:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>databricks<span class="w"> </span>auth<span class="w"> </span>login<span class="w"> </span>--host<span class="w"> </span>&lt;account-console-url&gt;<span class="w"> </span>--account-id<span class="w"> </span>&lt;account-id&gt;
</pre></div>
</div>
<p>For example:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>databricks<span class="w"> </span>auth<span class="w"> </span>login<span class="w"> </span>--host<span class="w"> </span>https://accounts.cloud.databricks.com<span class="w"> </span>--account-id<span class="w"> </span><span class="m">00000000</span>-0000-0000-0000-000000000000
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If you have an existing Databricks <a class="reference internal" href="../../dev-tools/auth/index.html#config-profiles"><span class="std std-ref">configuration profile</span></a> with the <code class="docutils literal notranslate"><span class="pre">host</span></code> and <code class="docutils literal notranslate"><span class="pre">account_id</span></code> fields already set, you can substitute <code class="docutils literal notranslate"><span class="pre">--host</span> <span class="pre">&lt;account-console-url&gt;</span> <span class="pre">--account-id</span> <span class="pre">&lt;account-id&gt;</span></code> with <code class="docutils literal notranslate"><span class="pre">--profile</span> <span class="pre">&lt;profile-name&gt;</span></code>.</p>
</div>
</li>
<li><p>Follow the on-screen instructions to have the Databricks CLI automatically create the related Databricks configuration profile in your <code class="docutils literal notranslate"><span class="pre">.databrickscfg</span></code> file.</p></li>
<li><p>Continue following the on-screen instructions to sign in to your Databricks account through your web browser.</p></li>
<li><p>Run your target Databricks CLI command, where <code class="docutils literal notranslate"><span class="pre">&lt;profile-name&gt;</span></code> represents the name of the configuration profile in your <code class="docutils literal notranslate"><span class="pre">.databrickscfg</span></code> file:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>databricks<span class="w"> </span>account<span class="w"> </span>&lt;command-name&gt;<span class="w"> </span>&lt;subcommand-name&gt;<span class="w"> </span>-p<span class="w"> </span>&lt;profile-name&gt;
</pre></div>
</div>
<p>For example, to list all users in the account:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>databricks<span class="w"> </span>account<span class="w"> </span>users<span class="w"> </span>list<span class="w"> </span>-p<span class="w"> </span>ACCOUNT-00000000-0000-0000-0000-000000000000
</pre></div>
</div>
<ul class="simple">
<li><p>For a list of available account commands, run the command <code class="docutils literal notranslate"><span class="pre">databricks</span> <span class="pre">account</span> <span class="pre">-h</span></code>.</p></li>
<li><p>For a list of available subcommands for an account command, run the command <code class="docutils literal notranslate"><span class="pre">databricks</span> <span class="pre">account</span> <span class="pre">&lt;command-name&gt;</span> <span class="pre">-h</span></code>.</p></li>
</ul>
</li>
</ol>
</div>
<div class="compound-last compound" lang="Username&amp;nbsp;and&amp;nbsp;password&amp;nbsp;(legacy)">
<ol class="arabic">
<li><p>Install Databricks CLI version 0.205 or above. See <a class="reference internal" href="../../dev-tools/cli/install.html"><span class="doc">Install or update the Databricks CLI</span></a>.</p></li>
<li><p>Identify or manually create a Databricks configuration profile in your <code class="docutils literal notranslate"><span class="pre">.databrickscfg</span></code> file, with the profile’s fields set correctly for the related <code class="docutils literal notranslate"><span class="pre">host</span></code>, <code class="docutils literal notranslate"><span class="pre">account_id</span></code>, and <code class="docutils literal notranslate"><span class="pre">username</span></code> and <code class="docutils literal notranslate"><span class="pre">password</span></code> mapping to your Databricks user account. See <a class="reference internal" href="../../dev-tools/cli/authentication.html#basic-auth"><span class="std std-ref">Basic authentication (legacy)</span></a>.</p></li>
<li><p>Run your target Databricks CLI command, where <code class="docutils literal notranslate"><span class="pre">&lt;profile-name&gt;</span></code> represents the name of the configuration profile in your <code class="docutils literal notranslate"><span class="pre">.databrickscfg</span></code> file:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>databricks<span class="w"> </span>account<span class="w"> </span>&lt;command-name&gt;<span class="w"> </span>&lt;subcommand-name&gt;<span class="w"> </span>-p<span class="w"> </span>&lt;profile-name&gt;
</pre></div>
</div>
<p>For example, to list all users in the account:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>databricks<span class="w"> </span>account<span class="w"> </span>users<span class="w"> </span>list<span class="w"> </span>-p<span class="w"> </span>MY-AWS-ACCOUNT
</pre></div>
</div>
<ul class="simple">
<li><p>For a list of available account commands, run the command <code class="docutils literal notranslate"><span class="pre">databricks</span> <span class="pre">account</span> <span class="pre">-h</span></code>.</p></li>
<li><p>For a list of available subcommands for an account command, run the command <code class="docutils literal notranslate"><span class="pre">databricks</span> <span class="pre">account</span> <span class="pre">&lt;command-name&gt;</span> <span class="pre">-h</span></code>.</p></li>
</ul>
</li>
</ol>
</div>
</div>
</div>
<div class="section" id="step-1-configure-cross-account-authentication">
<h2>Step 1: Configure cross-account authentication<a class="headerlink" href="#step-1-configure-cross-account-authentication" title="Permalink to this headline"> </a></h2>
<p>Databricks needs access to a cross-account service IAM role in your AWS account so that Databricks can deploy clusters in the appropriate VPC for the new workspace.</p>
<ol class="arabic">
<li><p>If such a role does not yet exist, see <a class="reference internal" href="../account-settings-e2/credentials.html"><span class="doc">Create an IAM role for workspace deployment</span></a> to create an appropriate role and policy for your deployment type. You provide the ARN for your new role (the <code class="docutils literal notranslate"><span class="pre">role_arn</span></code>) later in this procedure.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>You can share a cross-account IAM role with multiple workspaces. You are not required to create a new cross-account IAM role for each workspace. If you already have a cross-account IAM role, you can skip this step.</p>
</div>
</li>
<li><p>Create a Databricks credential configuration ID for your AWS role. Call the <a class="reference external" href="https://docs.databricks.com/api/account/credentials/create">Create credential configuration API</a> (<code class="docutils literal notranslate"><span class="pre">POST</span> <span class="pre">/accounts/&lt;databricks-account-id&gt;/credentials</span></code>). This request establishes cross-account trust and returns a reference ID to use when you create a new workspace.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>You can share a credentials configuration ID with multiple workspaces. It is not required to create a new one for each workspace. If you already have one, you can skip this step.</p>
</div>
<p>Replace <code class="docutils literal notranslate"><span class="pre">&lt;databricks-account-id&gt;</span></code> with your Databricks account ID.  For authentication, see <a class="reference internal" href="#how-to-use-the-account-api"><span class="std std-ref">How to use the Account API</span></a>. In the request body:</p>
<ul class="simple">
<li><p>Set <code class="docutils literal notranslate"><span class="pre">credentials_name</span></code> to a name for these credentials. The name must be unique within your account.</p></li>
<li><p>Set <code class="docutils literal notranslate"><span class="pre">aws_credentials</span></code> to an object that contains an <code class="docutils literal notranslate"><span class="pre">sts_role</span></code> property. That object must contain a <code class="docutils literal notranslate"><span class="pre">role_arn</span></code> property that specifies the AWS role ARN for the role you’ve created.</p></li>
</ul>
<p></p>
<p>The response body will include a <code class="docutils literal notranslate"><span class="pre">credentials_id</span></code> field, which is the Databricks credentials configuration ID that you need to create the new workspace. Copy and save this value, which you will use in a later step to create the workspace.</p>
<p> For example:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="w"> </span>curl<span class="w"> </span>-X<span class="w"> </span>POST
<span class="w">   </span><span class="s1">&#39;https://accounts.cloud.databricks.com/api/2.0/accounts/&lt;databricks-account-id&gt;/credentials&#39;</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--header<span class="w"> </span><span class="s1">&#39;Authorization: Bearer $OAUTH_TOKEN&#39;</span><span class="w">  </span><span class="se">\</span>
<span class="w">   </span>-d<span class="w"> </span><span class="s1">&#39;{</span>
<span class="s1">   &quot;credentials_name&quot;: &quot;databricks-workspace-credentials-v1&quot;,</span>
<span class="s1">   &quot;aws_credentials&quot;: {</span>
<span class="s1">     &quot;sts_role&quot;: {</span>
<span class="s1">       &quot;role_arn&quot;: &quot;arn:aws:iam::&lt;aws-account-id&gt;:role/my-company-example-role&quot;</span>
<span class="s1">     }</span>
<span class="s1">   }</span>
<span class="s1"> }&#39;</span>
</pre></div>
</div>
<p> Example response:</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="w"> </span><span class="p">{</span>
<span class="w">   </span><span class="nt">&quot;credentials_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;&lt;databricks-credentials-id&gt;&quot;</span><span class="p">,</span>
<span class="w">   </span><span class="nt">&quot;account_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;&lt;databricks-account-id&gt;&quot;</span><span class="p">,</span>
<span class="w">   </span><span class="nt">&quot;aws_credentials&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">     </span><span class="nt">&quot;sts_role&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">       </span><span class="nt">&quot;role_arn&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;arn:aws:iam::&lt;aws-account-id&gt;:role/my-company-example-role&quot;</span><span class="p">,</span>
<span class="w">       </span><span class="nt">&quot;external_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;&lt;databricks-account-id&gt;&quot;</span>
<span class="w">     </span><span class="p">}</span>
<span class="w">   </span><span class="p">},</span>
<span class="w">   </span><span class="nt">&quot;credentials_name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;databricks-workspace-credentials-v1&quot;</span><span class="p">,</span>
<span class="w">   </span><span class="nt">&quot;creation_time&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1579753556257</span>
<span class="w"> </span><span class="p">}</span>
</pre></div>
</div>
<p> Copy the <code class="docutils literal notranslate"><span class="pre">credentials_id</span></code> field from the response for later use.</p>
</li>
</ol>
</div>
<div class="section" id="step-2-configure-root-storage">
<span id="storage"></span><h2>Step 2: Configure root storage<a class="headerlink" href="#step-2-configure-root-storage" title="Permalink to this headline"> </a></h2>
<p>The root storage S3 bucket in your account stores objects like cluster logs, notebook revisions, and job results. You can also use the root storage S3 bucket to store non-production data, like data you need for testing.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>You can share a root S3 bucket with multiple workspaces in a single account. You do not have to create new buckets for each workspace. If you share a root S3 bucket for multiple workspaces in an account, data on the root S3 bucket is partitioned into separate directories by workspace. If you already have a bucket and an associated storage configuration ID generated by the Account API, you can skip this step. However, do not reuse a bucket from legacy workspaces. For example, if you are migrating to E2, create a new AWS bucket for your E2 setup.</p>
</div>
<ol class="arabic">
<li><p>Create the root S3 bucket using the instructions in <a class="reference internal" href="../account-settings-e2/storage.html"><span class="doc">Create an S3 bucket for workspace deployment</span></a>.</p></li>
<li><p>Create a storage configuration record that represents the root S3 bucket. Specify your root S3 bucket by name by calling the <a class="reference external" href="https://docs.databricks.com/api/account/introduction">create storage configuration API</a> (<code class="docutils literal notranslate"><span class="pre">POST</span> <span class="pre">/accounts/&lt;account-id&gt;/storage-configurations</span></code>).</p>
<p>The request returns a storage configuration ID that represents your S3 bucket.</p>
<p>Pass the following:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">storage_configuration_name</span></code>: New unique storage configuration name.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">root_bucket_info</span></code>: A JSON object that contains a <code class="docutils literal notranslate"><span class="pre">bucket_name</span></code> field that contains your S3 bucket name.</p></li>
</ul>
<p>The response body includes a <code class="docutils literal notranslate"><span class="pre">storage_configuration_id</span></code> property, which is that bucket’s storage configuration ID. Copy that value for later use.</p>
<p>For example:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>curl<span class="w"> </span>-X<span class="w"> </span>POST
<span class="w">    </span><span class="s1">&#39;https://accounts.cloud.databricks.com/api/2.0/accounts/&lt;databricks-account-id&gt;/storage-configurations&#39;</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--header<span class="w"> </span><span class="s1">&#39;Authorization: Bearer $OAUTH_TOKEN&#39;</span><span class="w">  </span><span class="se">\</span>
<span class="w">  </span>-d<span class="w"> </span><span class="s1">&#39;{</span>
<span class="s1">    &quot;storage_configuration_name&quot;: &quot;databricks-workspace-storageconf-v1&quot;,</span>
<span class="s1">    &quot;root_bucket_info&quot;: {</span>
<span class="s1">      &quot;bucket_name&quot;: &quot;my-company-example-bucket&quot;</span>
<span class="s1">    }</span>
<span class="s1">  }&#39;</span>
</pre></div>
</div>
<p>Response:</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;storage_configuration_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;&lt;databricks-storage-config-id&gt;&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;account_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;&lt;databricks-account-id&gt;&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;root_bucket_info&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;bucket_name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;my-company-example-bucket&quot;</span>
<span class="w">  </span><span class="p">},</span>
<span class="w">  </span><span class="nt">&quot;storage_configuration_name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;databricks-workspace-storageconf-v1&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;creation_time&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1579754875555</span>
<span class="p">}</span>
</pre></div>
</div>
</li>
</ol>
</div>
<div class="section" id="step-3-configure-privatelink-optional">
<span id="privatelink"></span><h2>Step 3: Configure PrivateLink (optional)<a class="headerlink" href="#step-3-configure-privatelink-optional" title="Permalink to this headline"> </a></h2>
<p>This step is necessary only if you want to use <a class="reference internal" href="../../security/network/classic/privatelink.html"><span class="doc">AWS PrivateLink</span></a>.</p>
<p>AWS PrivateLink provides private connectivity from your AWS VPC and on-premises networks to AWS services without exposing the traffic to the public network.</p>
<p>Databricks workspaces on the E2 version of the platform support adding PrivateLink connections for two connection types:</p>
<ul class="simple">
<li><p>User to workspace (front-end)</p></li>
<li><p>Compute plane to control plane (back-end)</p></li>
</ul>
<p>For PrivateLink connections for a new workspace:</p>
<ol class="arabic simple">
<li><p>Carefully read the article <a class="reference internal" href="../../security/network/classic/privatelink.html"><span class="doc">AWS PrivateLink</span></a> and confirm the prerequisites before proceeding.</p>
<ol class="arabic simple">
<li><p>Create your AWS VPC endpoints in AWS console or with automation tools. See <a class="reference internal" href="../../security/network/classic/privatelink.html#create-vpce"><span class="std std-ref">Step 2: Create VPC endpoints</span></a>.</p></li>
<li><p>Review the steps for using Account API to create VPC endpoint registrations, network configurations, and private access settings objects. See <a class="reference internal" href="../../security/network/classic/privatelink.html#account-api"><span class="std std-ref">Use the Account API</span></a>.</p></li>
</ol>
</li>
<li><p>Continue to the next step in this article. If you want to implement any type of PrivateLink connection (including front-end only), you must use a customer-managed VPC.</p></li>
</ol>
</div>
<div class="section" id="step-4-configure-customer-managed-vpc-optional-but-required-if-you-use-privatelink">
<span id="vpc"></span><h2>Step 4: Configure customer-managed VPC (optional, but required if you use PrivateLink)<a class="headerlink" href="#step-4-configure-customer-managed-vpc-optional-but-required-if-you-use-privatelink" title="Permalink to this headline"> </a></h2>
<p>By default, Databricks creates a VPC in your AWS account for each workspace. Databricks uses it for running clusters in the workspace. Optionally, you can use your own VPC for the workspace, using the feature <a class="reference internal" href="../../security/network/classic/customer-managed-vpc.html"><span class="doc">customer-managed VPC</span></a>. Databricks recommends that you provide your own VPC so that you can configure it according to your organization’s enterprise cloud standards while still conforming to Databricks requirements. You cannot migrate an existing workspace to your own VPC.</p>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>To configure your workspace to use <a class="reference internal" href="../../security/network/classic/privatelink.html"><span class="doc">Enable AWS PrivateLink</span></a> for any type of connection (including front-end only), your workspace must use a customer-managed VPC.</p>
</div>
<ol class="arabic">
<li><p>Set up your VPC, subnets, and security groups, using the instructions in <a class="reference internal" href="../../security/network/classic/customer-managed-vpc.html"><span class="doc">Configure a customer-managed VPC</span></a>. Copy the IDs for each of those objects for the next step, in which you register them with Databricks and get a network ID to represent your new network.</p>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>You can share one customer-managed VPC with multiple workspaces in a single account. You do not have to create a new VPC for each workspace. However, you <em>cannot</em> reuse subnets or security groups with any other resources, including other workspaces or non-Databricks resources. If you plan to share one VPC with multiple workspaces, be sure to size your VPC and subnets accordingly. Because a Databricks network ID encapsulates this information, you cannot reuse a network ID across workspaces.</p>
</div>
</li>
<li><p>To register your network configuration with Databricks, call the <a class="reference external" href="https://docs.databricks.com/api/account/introduction">create network configuration API</a> (<code class="docutils literal notranslate"><span class="pre">POST</span> <span class="pre">/accounts/&lt;account-id&gt;/networks</span></code>).</p>
<p>Pass the following:</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">network_name</span></code>: New unique network name.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">vpc_id</span></code>: VPC ID.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">subnet_ids</span></code>: Subnet IDs, as an array.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">security_group_ids</span></code>: Security Group IDs, as an array.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">vpc_endpoints</span></code>: Used only for <a class="reference internal" href="../../security/network/classic/privatelink.html"><span class="doc">AWS PrivateLink</span></a>. Required if you are deploying a back-end (compute plane to control plane) PrivateLink connection, in which case this object must have two properties that reference registered VPC endpoint registrations. Set <code class="docutils literal notranslate"><span class="pre">rest_api</span></code> to an array containing only the Databricks ID for your workspace VPC endpoint registration. Set <code class="docutils literal notranslate"><span class="pre">dataplane_relay</span></code> to an array containing only the Databricks ID for your secure cluster connectivity VPC endpoint registration. For more details on these objects, see <a class="reference internal" href="../../security/network/classic/privatelink.html"><span class="doc">Enable AWS PrivateLink</span></a>. These IDs were returned during VPC endpoint registration, as described in <a class="reference internal" href="../../security/network/classic/privatelink.html#register-vpce-ids"><span class="std std-ref">Step 3a: Register VPC endpoints (front-end, back-end, or both)</span></a>.</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">rest_api</span></code>: Set this to a JSON array that contains exactly one element: the Databricks-specific ID for the back-end REST API VPC endpoint that you registered. This is the Databricks VPC endpoint registration ID, not the AWS VPC endpoint ID.</p>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>In this release, after you register a VPC endpoint to the workspace VPC endpoint service for either a front-end connection or back-end REST API connection for any workspace, Databricks enables front-end (web application and REST API) access from that VPC endpoint to all PrivateLink-enabled workspaces in your Databricks account in that AWS region.</p>
</div>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">dataplane_relay</span></code>: Set this to a JSON array that contains exactly one element: the Databricks-specific ID for the back-end SCC VPC endpoint that you registered. This is the Databricks VPC endpoint registration ID, not the AWS VPC endpoint ID.</p></li>
</ul>
<p>For additional information on network configurations for PrivateLink back-end connections, see <a class="reference internal" href="../../security/network/classic/privatelink.html#create-network-config"><span class="std std-ref">Create new network configuration using Account API</span></a> in the PrivateLink article.</p>
</li>
</ul>
<p>For example:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>curl<span class="w"> </span>-X<span class="w"> </span>POST
<span class="w">  </span><span class="s1">&#39;https://accounts.cloud.databricks.com/api/2.0/accounts/&lt;databricks-account-id&gt;/networks&#39;</span><span class="w"> </span><span class="se">\</span>
<span class="w"> </span>--header<span class="w"> </span><span class="s1">&#39;Authorization: Bearer $OAUTH_TOKEN&#39;</span><span class="w">  </span><span class="se">\</span>
<span class="w">  </span>-d<span class="w"> </span><span class="s1">&#39;{</span>
<span class="s1">  &quot;network_name&quot;: &quot;mycompany-vpc-example&quot;,</span>
<span class="s1">  &quot;vpc_id&quot;: &quot;&lt;aws-vpc-id&gt;&quot;,</span>
<span class="s1">  &quot;subnet_ids&quot;: [</span>
<span class="s1">    &quot;&lt;aws-subnet-id-1&gt;&quot;,</span>
<span class="s1">    &quot;&lt;aws-subnet-id-2&gt;&quot;</span>
<span class="s1">  ],</span>
<span class="s1">  &quot;security_group_ids&quot;: [</span>
<span class="s1">    &quot;&lt;aws-security-group-id&gt;&quot;</span>
<span class="s1">  ],</span>
<span class="s1">  &quot;vpc_endpoints&quot;: {</span>
<span class="s1">     &quot;dataplane_relay&quot;: [</span>
<span class="s1">         &quot;&lt;databricks-vpce-id-for-scc&gt;&quot;</span>
<span class="s1">     ],</span>
<span class="s1">     &quot;rest_api&quot;: [</span>
<span class="s1">         &quot;&lt;databricks-vpce-id-for-rest-apis&gt;&quot;</span>
<span class="s1">     ]</span>
<span class="s1"> }</span>
<span class="s1">}&#39;</span>
</pre></div>
</div>
</li>
<li><p>Copy the <code class="docutils literal notranslate"><span class="pre">network_id</span></code> from the response body for later use. This is the network ID that represents the network for your new workspace.</p>
<p>Example response:</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;network_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;&lt;databricks-network-id&gt;&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;account_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;&lt;databricks-account-id&gt;&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;vpc_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;&lt;aws-vpc-id&gt;&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;subnet_ids&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">    </span><span class="s2">&quot;&lt;aws-subnet-id-1&gt;&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="s2">&quot;&lt;aws-subnet-id-2&gt;&quot;</span>
<span class="w">  </span><span class="p">],</span>
<span class="w">  </span><span class="nt">&quot;security_group_ids&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">    </span><span class="s2">&quot;&lt;aws-security-group-id&gt;&quot;</span>
<span class="w">  </span><span class="p">],</span>
<span class="w">  </span><span class="nt">&quot;vpc_status&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;UNATTACHED&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;network_name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;mycompany-vpc-example&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;creation_time&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1579767389544</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;vpc_endpoints&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">     </span><span class="nt">&quot;dataplane_relay&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">         </span><span class="s2">&quot;&lt;databricks-vpce-id-for-scc&gt;&quot;</span>
<span class="w">     </span><span class="p">],</span>
<span class="w">     </span><span class="nt">&quot;rest_api&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">         </span><span class="s2">&quot;&lt;databricks-vpce-id-for-rest-apis&gt;&quot;</span>
<span class="w">     </span><span class="p">]</span>
<span class="w"> </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</li>
</ol>
</div>
<div class="section" id="step-5-configure-customer-managed-keys-optional">
<span id="cmk"></span><h2>Step 5: Configure customer-managed keys (optional)<a class="headerlink" href="#step-5-configure-customer-managed-keys-optional" title="Permalink to this headline"> </a></h2>
<div class="admonition important">
<p class="admonition-title">Important</p>
<ul class="simple">
<li><p>This feature requires that your account is on the Enterprise pricing tier.</p></li>
<li><p>Workspace compute plane VPCs can be in AWS regions <code class="docutils literal notranslate"><span class="pre">ap-northeast-1</span></code>, <code class="docutils literal notranslate"><span class="pre">ap-northeast-2</span></code>, <code class="docutils literal notranslate"><span class="pre">ap-south-1</span></code>, <code class="docutils literal notranslate"><span class="pre">ap-southeast-1</span></code>, <code class="docutils literal notranslate"><span class="pre">ap-southeast-2</span></code>, <code class="docutils literal notranslate"><span class="pre">ca-central-1</span></code>, <code class="docutils literal notranslate"><span class="pre">eu-west-1</span></code>, <code class="docutils literal notranslate"><span class="pre">eu-west-2</span></code>, <code class="docutils literal notranslate"><span class="pre">eu-central-1</span></code>, <code class="docutils literal notranslate"><span class="pre">us-east-1</span></code>, <code class="docutils literal notranslate"><span class="pre">us-east-2</span></code>, <code class="docutils literal notranslate"><span class="pre">us-west-1</span></code>, and <code class="docutils literal notranslate"><span class="pre">us-west-2</span></code>. However, you cannot use a VPC in <code class="docutils literal notranslate"><span class="pre">us-west-1</span></code> if you want to use <a class="reference internal" href="../../security/keys/customer-managed-keys.html"><span class="doc">customer-managed keys</span></a> for encryption.</p></li>
</ul>
</div>
<p>There are two use cases for customer-managed encryption keys:</p>
<ul class="simple">
<li><p><a class="reference internal" href="../../security/keys/customer-managed-keys-managed-services-aws.html"><span class="doc">Encrypt managed services</span></a>, which includes notebook and secret data in the control plane.</p></li>
<li><p><a class="reference internal" href="../../security/keys/customer-managed-keys-storage-aws.html"><span class="doc">Encrypt workspace storage</span></a>, which includes the workspace’s root S3 bucket and optionally cluster EBS volumes.</p></li>
</ul>
<p>You can choose to configure neither, one, or both of these. If you choose to implement encryption for both uses cases, you can optionally share a key and optionally even the same configuration object for these uses cases.</p>
<p>There are important differences between these two use cases in when you can add the keys:</p>
<ul class="simple">
<li><p>For a customer-managed key for managed services, you can configure it during workspace creation, <a class="reference internal" href="../../security/keys/customer-managed-keys-managed-services-aws.html#patch-workspace"><span class="std std-ref">add the key</span></a> to a running workspace, or <a class="reference internal" href="../../security/keys/customer-managed-keys-managed-services-aws.html#patch-workspace"><span class="std std-ref">rotate (update) the key</span></a> later.</p></li>
<li><p>For a customer-managed key for storage, you can configure it during workspace creation or <a class="reference internal" href="../../security/keys/customer-managed-keys-storage-aws.html#workspace-update"><span class="std std-ref">add the key to a running workspace</span></a>, but you <em>cannot</em> rotate (update) the key later.</p></li>
</ul>
<p>You can share a customer-managed key or its key configuration object across workspaces. When creating a new workspace, a key configuration can represent both encryption use cases by setting its <code class="docutils literal notranslate"><span class="pre">use_cases</span></code> field to include both enumeration values.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>To add a workspace storage key to an existing workspace that already uses notebook encryption you must create a new key configuration object for workspace storage. See <a class="reference internal" href="../../security/keys/customer-managed-keys-storage-aws.html"><span class="doc">Customer-managed keys for workspace storage</span></a>.</p>
</div>
<p>To implement one encryption use case or both encryption use cases with the same key, perform the following procedure exactly once. To add encryption for both encryption use cases with different keys, perform the procedure two times, once for each use case.</p>
<ol class="arabic">
<li><p>Create the AWS KMS key. Follow the instructions in either of the following sections, which differ only in the human-readable description field (<code class="docutils literal notranslate"><span class="pre">sid</span></code>) in the policy to identify the use case. Create the key for <a class="reference internal" href="../../security/keys/customer-managed-keys-managed-services-aws.html#key"><span class="std std-ref">managed services</span></a> or <a class="reference internal" href="../../security/keys/customer-managed-keys-storage-aws.html#key"><span class="std std-ref">workspace storage</span></a>. To share the key and configuration for both use cases, update the <code class="docutils literal notranslate"><span class="pre">sid</span></code> field accordingly.</p></li>
<li><p>To register your KMS key with Databricks, call the <a class="reference external" href="https://docs.databricks.com/api/account/introduction">create customer-managed key configuration API</a> (<code class="docutils literal notranslate"><span class="pre">POST</span> <span class="pre">/accounts/&lt;account-id&gt;/customer-managed-keys</span></code>).</p>
<p>Pass the following parameters:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">use_cases</span></code> — An array that specifies the uses cases for which to use the key, specify one or both of the following:</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">MANAGED_SERVICES</span></code>: This key encrypts <a class="reference internal" href="../../security/keys/customer-managed-keys-managed-services-aws.html"><span class="doc">managed services in the control plane</span></a>, which includes notebook and secret data in the control plane.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">STORAGE</span></code>: This key encrypts <a class="reference internal" href="../../security/keys/customer-managed-keys-storage-aws.html"><span class="doc">workspace storage</span></a>, which includes the workspace’s DBFS root and cluster EBS volumes.</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">aws_key_info</span></code>: A JSON object with the following properties:</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">key_arn</span></code>: AWS KMS key ARN. Note that Databricks infers the AWS region from the key ARN.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">key_alias</span></code>: (<strong>Optional</strong>) AWS KMS key alias.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">reuse_key_for_cluster_volumes</span></code>: (<strong>Optional</strong>) Used only if the <code class="docutils literal notranslate"><span class="pre">use_cases</span></code> array contains <code class="docutils literal notranslate"><span class="pre">STORAGE</span></code>, this specifies whether to also use the key to encrypt cluster EBS volumes. The default value is <code class="docutils literal notranslate"><span class="pre">true</span></code>,  which means Databricks also uses the key for cluster volumes. If you set this to <code class="docutils literal notranslate"><span class="pre">false</span></code>, Databricks does not encrypt the EBS volumes with your specified key. In that case, your Databricks EBS volumes are encrypted either with default AWS SSE encryption or if you enabled <a class="reference external" href="https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/EBSEncryption.html#encryption-by-default">AWS account-level EBS encryption by default</a>, AWS enforces account-level EBS encryption using a separate key that you provided to them. Note that if <code class="docutils literal notranslate"><span class="pre">reuse_key_for_cluster_volumes</span></code> is <code class="docutils literal notranslate"><span class="pre">true</span></code> and you revoke the permission for the key, it does not affect running clusters but affects new and restarted clusters.</p></li>
</ul>
</li>
</ul>
<p>Example request:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>curl<span class="w"> </span>-X<span class="w"> </span>POST
<span class="w">  </span><span class="s1">&#39;https://accounts.cloud.databricks.com/api/2.0/accounts/&lt;databricks-account-id&gt;/customer-managed-keys&#39;</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--header<span class="w"> </span><span class="s1">&#39;Authorization: Bearer $OAUTH_TOKEN&#39;</span><span class="w">  </span><span class="se">\</span>
<span class="w">  </span>-d<span class="w"> </span><span class="s1">&#39;{</span>
<span class="s1">  &quot;use_cases&quot;: [&quot;MANAGED_SERVICES&quot;, &quot;STORAGE&quot;],</span>
<span class="s1">  &quot;aws_key_info&quot;: {</span>
<span class="s1">    &quot;key_arn&quot;: &quot;arn:aws:kms:us-west-2:&lt;aws-account-id&gt;:key/&lt;key-id&gt;&quot;,</span>
<span class="s1">    &quot;key_alias&quot;: &quot;my-example-key&quot;,</span>
<span class="s1">    &quot;reuse_key_for_cluster_volumes&quot;: true</span>
<span class="s1">  }</span>
<span class="s1">}&#39;</span>
</pre></div>
</div>
<p>Example response:</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;use_cases&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;MANAGED_SERVICES&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;STORAGE&quot;</span><span class="p">],</span>
<span class="w">  </span><span class="nt">&quot;customer_managed_key_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;&lt;aws-kms-key-id&gt;&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;creation_time&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1586447506984</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;account_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;&lt;databricks-account-id&gt;&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;aws_key_info&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;key_arn&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;arn:aws:kms:us-west-2:&lt;aws-account-id&gt;:key/&lt;key-id&gt;&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;key_alias&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;my-example-key&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;reuse_key_for_cluster_volumes&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;key_region&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;us-west-2&quot;</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</li>
<li><p>From the response JSON, copy the <code class="docutils literal notranslate"><span class="pre">customer_managed_key_id</span></code>. You use that ID in the next step to set your workspace configuration object’s property <code class="docutils literal notranslate"><span class="pre">managed_services_customer_managed_key_id</span></code>, <code class="docutils literal notranslate"><span class="pre">storage_customer_managed_key_id</span></code>, or both, depending on which encryption use cases this object represents.</p></li>
</ol>
</div>
<div class="section" id="step-6-create-the-workspace">
<span id="workspace"></span><h2>Step 6: Create the workspace<a class="headerlink" href="#step-6-create-the-workspace" title="Permalink to this headline"> </a></h2>
<p>To create the new workspace, call the <a class="reference external" href="https://docs.databricks.com/api/account/introduction">create workspace API</a> (<code class="docutils literal notranslate"><span class="pre">POST</span> <span class="pre">/accounts/&lt;account-id&gt;/workspaces</span></code>).</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><a class="reference internal" href="../../security/network/classic/secure-cluster-connectivity.html"><span class="doc">Secure cluster connectivity</span></a> is enabled by default for all workspaces created using the Account API after September 1, 2020. The pricing tier defaults to the plan associated with your account. See <a class="reference external" href="https://databricks.com/product/aws-pricing">AWS Pricing</a>.</p>
</div>
<p>Pass the following parameters, which are values that you copied in previous steps:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">aws_region</span></code>: The AWS region of the workspace’s compute plane.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">workspace_name</span></code>: Human-readable name for your workspace. This is the workspace name users see in the Databricks UI.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">deployment_name</span></code>: (Recommended but optional) Unique deployment name for your workspace. For details, see the <a class="reference internal" href="#deployment-name"><span class="std std-ref">notes about deployment name</span></a>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">credentials_id</span></code>: Your credential ID, which represents your cross-account role credentials. This is the ID from the credentials configuration object.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">storage_configuration_id</span></code>: Your storage configuration ID, which represents your root S3 bucket. This is the ID from the storage configuration object.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">network_id</span></code>: (<strong>Optional</strong>) only used for customer-managed VPC. This is the ID from the network configuration object.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">managed_services_customer_managed_key_id</span></code>: (<strong>Optional</strong>) Used only to <a class="reference internal" href="../../security/keys/customer-managed-keys-managed-services-aws.html"><span class="doc">encrypt managed services such as notebook and secret data in the control plane</span></a>. This is your key configuration ID for workspace storage, which is the <code class="docutils literal notranslate"><span class="pre">customer_managed_key_id</span></code> field from a key configuration object. If you want to support this encryption use case, you must configure it at workspace creation time.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">storage_customer_managed_key_id</span></code>: (<strong>Optional</strong>) Used only to <a class="reference internal" href="../../security/keys/customer-managed-keys-storage-aws.html"><span class="doc">encrypt workspace storage</span></a>. This is your key configuration ID for workspace storage, which is the <code class="docutils literal notranslate"><span class="pre">customer_managed_key_id</span></code> field from the key configuration object. If you want to support this encryption use case, you can configure it at workspace creation time, but you can also <a class="reference internal" href="../../security/keys/customer-managed-keys-storage-aws.html"><span class="doc">add it later</span></a> to a running workspace.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">private_access_settings_id</span></code>: (<strong>Optional</strong>) Used only for <a class="reference internal" href="../../security/network/classic/privatelink.html"><span class="doc">AWS PrivateLink</span></a>. This is the ID of the private access settings object that you created for this workspace. See <a class="reference internal" href="../../security/network/classic/privatelink.html#add-pas-config"><span class="std std-ref">Create a private access settings configuration using Account API</span></a> in the PrivateLink article. This is a required field for PrivateLink access for all connection types (front-end, back-end, or both).</p></li>
</ul>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">custom_tags</span></code>: (<strong>Optional</strong>) Key-value pairs that act as metadata for organizing resources. Tags can help to manage, identify, organize, search, and filter resources, as well as monitor cost and attribute usage.</p></li>
</ul>
<p id="deployment-name">Notes about deployment name:</p>
<ul class="simple">
<li><p>Choose your <code class="docutils literal notranslate"><span class="pre">deployment_name</span></code> value carefully. The deployment name defines part of the subdomain for the workspace. The workspace URL for web application and REST APIs is <code class="docutils literal notranslate"><span class="pre">&lt;deployment-name&gt;.cloud.databricks.com</span></code>. For example, if the deployment name is <code class="docutils literal notranslate"><span class="pre">ABCSales</span></code>, your workspace URL will be <code class="docutils literal notranslate"><span class="pre">https://abcsales.cloud.databricks.com</span></code>. This property supports characters a-z and 0-9. Hyphens are also allowed but not as the first or last character.</p></li>
<li><p>Accounts can have a deployment name prefix. Contact your Databricks account team to add an account deployment name prefix to your account. If your account has a non-empty deployment name prefix at workspace creation time, the workspace deployment name is updated so that it begins with the account prefix and a hyphen. For example, if your account’s deployment prefix is <code class="docutils literal notranslate"><span class="pre">acme</span></code> and the workspace deployment name is <code class="docutils literal notranslate"><span class="pre">workspace-1</span></code>, the <code class="docutils literal notranslate"><span class="pre">deployment_name</span></code> field becomes <code class="docutils literal notranslate"><span class="pre">acme-workspace-1</span></code>. In this example, the workspace URL is <code class="docutils literal notranslate"><span class="pre">acme-workspace-1.cloud.databricks.com</span></code>.</p></li>
<li><p>After this modification with the account prefix, the new value is what is returned in JSON responses for this workspace’s <code class="docutils literal notranslate"><span class="pre">deployment_name</span></code> field.</p></li>
<li><p>If your account has a non-empty deployment name prefix and you set <code class="docutils literal notranslate"><span class="pre">deployment_name</span></code> to the reserved keyword <code class="docutils literal notranslate"><span class="pre">EMPTY</span></code>, <code class="docutils literal notranslate"><span class="pre">deployment_name</span></code> is the account prefix only. For example, if your account’s deployment prefix is <code class="docutils literal notranslate"><span class="pre">acme</span></code> and the workspace deployment name is <code class="docutils literal notranslate"><span class="pre">EMPTY</span></code>, <code class="docutils literal notranslate"><span class="pre">deployment_name</span></code> becomes <code class="docutils literal notranslate"><span class="pre">acme</span></code> only, and the workspace URL is <code class="docutils literal notranslate"><span class="pre">acme.cloud.databricks.com</span></code>. If your account does not yet have a deployment name prefix, the special deployment name value <code class="docutils literal notranslate"><span class="pre">EMPTY</span></code> is invalid.</p></li>
</ul>
<p>The JSON response includes the property <code class="docutils literal notranslate"><span class="pre">workspace_id</span></code>. Copy this value for later use.</p>
<p>For example:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>curl<span class="w"> </span>-X<span class="w"> </span>POST
<span class="w">  </span><span class="s1">&#39;https://accounts.cloud.databricks.com/api/2.0/accounts/&lt;databricks-account-id&gt;/workspaces&#39;</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--header<span class="w"> </span><span class="s1">&#39;Authorization: Bearer $OAUTH_TOKEN&#39;</span><span class="w">  </span><span class="se">\</span>
<span class="w">  </span>-d<span class="w"> </span><span class="s1">&#39;{</span>
<span class="s1">  &quot;workspace_name&quot;: &quot;my-company-example&quot;,</span>
<span class="s1">  &quot;deployment_name&quot;: &quot;my-company-example&quot;,</span>
<span class="s1">  &quot;aws_region&quot;: &quot;us-west-2&quot;,</span>
<span class="s1">  &quot;credentials_id&quot;: &quot;&lt;aws-credentials-id&gt;&quot;,</span>
<span class="s1">  &quot;storage_configuration_id&quot;: &quot;&lt;databricks-storage-config-id&gt;&quot;,</span>
<span class="s1">  &quot;network_id&quot;: &quot;&lt;databricks-network-id&gt;&quot;,</span>
<span class="s1">  &quot;managed_services_customer_managed_key_id&quot;: &quot;&lt;aws-kms-managed-services-key-id&gt;&quot;,</span>
<span class="s1">  &quot;storage_customer_managed_key_id&quot;: &quot;&lt;aws-kms-notebook-workspace-storage-id&gt;&quot;,</span>
<span class="s1">  &quot;private_access_settings_id&quot;: &quot;&lt;private-access-settings-id&gt;&quot;,</span>
<span class="s1">  &quot;custom_tags&quot;: {</span>
<span class="s1">    &quot;Organization&quot;: &quot;Marketing&quot;,</span>
<span class="s1">    &quot;Env&quot;: &quot;Prod&quot;</span>
<span class="s1">  }</span>
<span class="s1">}&#39;</span>
</pre></div>
</div>
<p>Example response:</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;workspace_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">123456789</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;workspace_name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;my-company-example&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;aws_region&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;us-west-2&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;creation_time&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1579768294842</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;deployment_name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;my-company-example&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;workspace_status&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;PROVISIONING&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;account_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;&lt;databricks-account-id&gt;&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;credentials_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;&lt;aws-credentials-id&gt;&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;storage_configuration_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;&lt;databricks-storage-config-id&gt;&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;workspace_status_message&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Workspace resources are being set up.&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;network_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;&lt;databricks-network-id&gt;&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;managed_services_customer_managed_key_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;&lt;aws-kms-managed-services-key-id&gt;&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;storage_customer_managed_key_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;&lt;aws-kms-notebook-workspace-storage-id&gt;&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;private_access_settings_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;&lt;private-access-settings-id&gt;&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;pricing_tier&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;ENTERPRISE&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;custom_tags&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;Organization&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Marketing&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;Env&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Prod&quot;</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;workspace_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">123456789</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;workspace_name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;my-company-example&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;aws_region&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;us-west-2&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;creation_time&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1579768294842</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;deployment_name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;my-company-example&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;workspace_status&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;PROVISIONING&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;account_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;&lt;databricks-account-id&gt;&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;credentials_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;&lt;aws-credentials-id&gt;&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;storage_configuration_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;&lt;databricks-storage-config-id&gt;&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;workspace_status_message&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Workspace resources are being set up.&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;network_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;&lt;databricks-network-id&gt;&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;managed_services_customer_managed_key_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;&lt;aws-kms-managed-services-key-id&gt;&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;storage_customer_managed_key_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;&lt;aws-kms-notebook-workspace-storage-id&gt;&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;private_access_settings_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;&lt;private-access-settings-id&gt;&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;pricing_tier&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;ENTERPRISE&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>If you specified a customer-managed VPC and the workspace creation step returns a network-related error, you can call the <a class="reference external" href="https://docs.databricks.com/api/account/introduction">get network configuration API</a> (endpoint <code class="docutils literal notranslate"><span class="pre">/networks/&lt;network-id&gt;</span></code>) to validate the network settings. See <a class="reference internal" href="#troubleshooting"><span class="std std-ref">Troubleshoot workspace creation errors</span></a>.</p>
</div>
<div class="section" id="step-7 confirm-the-new-workspace">
<span id="step-7-confirm-the-new-workspace"></span><h2>Step 7: Confirm the new workspace<a class="headerlink" href="#step-7 confirm-the-new-workspace" title="Permalink to this headline"> </a></h2>
<p>To check workspace status, call the <a class="reference external" href="https://docs.databricks.com/api/account/introduction">get workspace API</a> (<code class="docutils literal notranslate"><span class="pre">GET</span> <span class="pre">/accounts/&lt;account-id&gt;/workspaces/&lt;workspace-id&gt;</span></code>).</p>
<p>Use the <code class="docutils literal notranslate"><span class="pre">workspace_id</span></code> value from the JSON response returned when you created the workspace.</p>
<p>In the response, possible <code class="docutils literal notranslate"><span class="pre">workspace_status</span></code> values are:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">NOT_PROVISIONED</span></code>:  Not yet provisioned.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">PROVISIONING</span></code>: Still provisioning. <strong>Wait a few minutes and repeat this API request.</strong></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">RUNNING</span></code>: Successful deployment and now running.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">FAILED</span></code>: Failed deployment.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">BANNED</span></code>: Banned.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">CANCELLING</span></code>: In process of cancellation.</p></li>
</ul>
<p>See <a class="reference internal" href="#troubleshooting"><span class="std std-ref">Troubleshoot workspace creation errors</span></a> for how to handle unsuccessful status values.</p>
<p>For example:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>curl<span class="w"> </span>-X<span class="w"> </span>GET
<span class="s1">&#39;https://accounts.cloud.databricks.com/api/2.0/accounts/&lt;databricks-account-id&gt;/workspaces/&lt;databricks-workspace-id&gt;&#39;</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--header<span class="w"> </span><span class="s1">&#39;Authorization: Bearer $OAUTH_TOKEN&#39;</span>
</pre></div>
</div>
<p>Response:</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;workspace_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">123456789</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;workspace_name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;my-company-example&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;aws_region&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;us-west-2&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;creation_time&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1579768294842</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;deployment_name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;my-company-example&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;workspace_status&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;RUNNING&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;account_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;&lt;databricks-account-id&gt;&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;credentials_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;&lt;aws-credentials-id&gt;&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;storage_configuration_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;&lt;databricks-storage-config-id&gt;&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;workspace_status_message&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Workspace is running.&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;network_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;339f16b9-b8a3-4d50-9d1b-7e29e49448c3&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;managed_services_customer_managed_key_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;&lt;aws-kms-managed-services-key-id&gt;&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;storage_customer_managed_key_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;&lt;aws-kms-notebook-workspace-storage-id&gt;&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;pricing_tier&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;ENTERPRISE&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>In this example, the workspace status (<code class="docutils literal notranslate"><span class="pre">workspace_status</span></code>) is set to <code class="docutils literal notranslate"><span class="pre">RUNNING</span></code>, so it was successful. If it is <code class="docutils literal notranslate"><span class="pre">PROVISIONING</span></code>, repeat this API request until it succeeds.</p>
<p>The pricing tier defaults to the plan associated with your account. See <a class="reference external" href="https://databricks.com/product/pricing/platform-addons">AWS platform tiers</a>.</p>
<p>Test your new workspace after its status is <code class="docutils literal notranslate"><span class="pre">RUNNING</span></code>:</p>
<ul>
<li><p><strong>User interface login on the new workspace</strong> — Confirm you can log in to the web application at URL <code class="docutils literal notranslate"><span class="pre">https://&lt;deployment-name&gt;.cloud.databricks.com</span></code>. For example, if the deployment name you specified during workspace creation is <code class="docutils literal notranslate"><span class="pre">ABCSales</span></code>, your workspace URL is <code class="docutils literal notranslate"><span class="pre">https://abcsales.cloud.databricks.com</span></code>. Use your account username and password.</p></li>
<li><p><strong>REST API login on the new workspace</strong> — Confirm that you can access the REST API. The following example calls the Workspace Users API to get a list of users.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>curl<span class="w">  </span>-u<span class="w"> </span>&lt;user-name&gt;<span class="w"> </span>-X<span class="w"> </span>GET<span class="w"> </span><span class="s1">&#39;https://&lt;deployment-name&gt;.cloud.databricks.com/api/2.0/scim/v2/Users&#39;</span><span class="w"> </span><span class="se">\</span>
--header<span class="w"> </span><span class="s1">&#39;Authorization: Bearer $OAUTH_TOKEN&#39;</span>
</pre></div>
</div>
<p>For more information about using Databricks REST APIs, including other authentication options, see the <a class="reference external" href="https://docs.databricks.com/api/workspace/introduction">Workspace API</a>.</p>
</li>
</ul>
</div>
<div class="section" id="step-8-post-deployment-privatelink-configuration-optional">
<h2>Step 8: Post-deployment PrivateLink configuration (optional)<a class="headerlink" href="#step-8-post-deployment-privatelink-configuration-optional" title="Permalink to this headline"> </a></h2>
<p>This step is necessary only if you are configuring <a class="reference internal" href="../../security/network/classic/privatelink.html"><span class="doc">AWS PrivateLink</span></a>.</p>
<p>After workspace creation:</p>
<ol class="arabic simple">
<li><p>If you are implementing a <strong>front-end</strong> PrivateLink connection, implement relevant DNS configuration changes as described in <a class="reference internal" href="../../security/network/classic/privatelink.html#create-dns-name"><span class="std std-ref">Step 4: Configure internal DNS to redirect user requests to the web application (for front-end)</span></a>.</p></li>
<li><p>Optionally create other VPC endpoints, as described in <a class="reference internal" href="../../security/network/classic/privatelink.html#optional-vpce"><span class="std std-ref">Step 5: Add VPC endpoints for other AWS services</span></a>.</p></li>
</ol>
</div>
<div class="section" id="step-9-other-optional-post-deployment-configuration">
<h2>Step 9: Other optional post-deployment configuration<a class="headerlink" href="#step-9-other-optional-post-deployment-configuration" title="Permalink to this headline"> </a></h2>
<p>You might want to consider these optional configuration steps for your new workspace.</p>
<div class="section" id="enable-ip-access-lists">
<h3>Enable IP Access Lists<a class="headerlink" href="#enable-ip-access-lists" title="Permalink to this headline"> </a></h3>
<p>Configure which IP addresses can connect to the web application, REST APIs, JDBC/ODBC endpoints, and DBConnect. You can specify allow lists and block lists as IP addresses or ranges. See <a class="reference internal" href="../../security/network/front-end/ip-access-list-workspace.html"><span class="doc">Configure IP access lists for workspaces</span></a>.</p>
</div>
<div class="section" id="enable-audit-log-system-table">
<h3>Enable audit log system table<a class="headerlink" href="#enable-audit-log-system-table" title="Permalink to this headline"> </a></h3>
<p>Databricks strongly recommends that you enable the audit log system table to monitor the activities performed and usage incurred by your Databricks users. Your workspace must have Unity Catalog enabled. See <a class="reference internal" href="../system-tables/index.html"><span class="doc">Monitor usage with system tables</span></a> for instructions.</p>
</div>
</div>
<div class="section" id="troubleshoot-workspace-creation-errors">
<span id="troubleshooting"></span><h2>Troubleshoot workspace creation errors<a class="headerlink" href="#troubleshoot-workspace-creation-errors" title="Permalink to this headline"> </a></h2>
<p>The following sections provide solutions for common workspace creation errors.</p>
<div class="section" id="the-maximum-number-of-addresses-has-been-reached">
<h3>The maximum number of addresses has been reached<a class="headerlink" href="#the-maximum-number-of-addresses-has-been-reached" title="Permalink to this headline"> </a></h3>
<p>When Databricks creates a VPC on your behalf, you must have at least one unused Elastic IP. Otherwise, the VPC isn’t created and the following error occurs:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">The maximum number of addresses has been reached.</span>
</pre></div>
</div>
<p>Increase the number of Elastic IPs and try again.</p>
</div>
<div class="section" id="general-troubleshooting-steps">
<h3>General troubleshooting steps<a class="headerlink" href="#general-troubleshooting-steps" title="Permalink to this headline"> </a></h3>
<p>For all workspace creation errors, try the following troubleshooting steps in the order provided.</p>
</div>
<div class="section" id="validate-network">
<span id="validate_network"></span><h3>Validate network<a class="headerlink" href="#validate-network" title="Permalink to this headline"> </a></h3>
<p>If the workspace creation or status check steps indicate a network-related error, call the <a class="reference external" href="https://docs.databricks.com/api/account/introduction">get network configuration API</a> to ensure that the network settings are correct. This API endpoint has the form:</p>
<p><code class="docutils literal notranslate"><span class="pre">/accounts/&lt;databricks-account-id&gt;/networks/&lt;databricks-network-id&gt;</span></code></p>
<p>For example:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="w">  </span>curl<span class="w"> </span>-X<span class="w"> </span>GET
<span class="w">  </span><span class="s1">&#39;https://accounts.cloud.databricks.com/api/2.0/accounts/&lt;databricks-account-id&gt;/networks/&lt;databricks-network-id&gt;&#39;</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--header<span class="w"> </span><span class="s1">&#39;Authorization: Bearer $OAUTH_TOKEN&#39;</span>
</pre></div>
</div>
<p>In the response, view the <code class="docutils literal notranslate"><span class="pre">warning_messages</span></code> <code class="docutils literal notranslate"><span class="pre">error_messages</span></code> fields. If both arrays are empty, there are no warnings or errors.</p>
<p>Otherwise, review the warnings and error JSON objects carefully:</p>
<ul class="simple">
<li><p>For warnings, the <code class="docutils literal notranslate"><span class="pre">warning_type</span></code> enumeration indicates that the problem was with either a subnet or security group. The <code class="docutils literal notranslate"><span class="pre">warning_message</span></code> provides additional details. Be aware that if you have a firewall or NAT instance (instead of a NAT gateway), the network validation always issues a warning.</p></li>
<li><p>For errors, the <code class="docutils literal notranslate"><span class="pre">error_type</span></code> enumeration indicates that the problem was with either credentials, VPC, subnet, security group, or network ACL. The <code class="docutils literal notranslate"><span class="pre">error_message</span></code> provides additional details.</p></li>
</ul>
</div>
<div class="section" id="fix-infrastructure-issues">
<h3>Fix infrastructure issues<a class="headerlink" href="#fix-infrastructure-issues" title="Permalink to this headline"> </a></h3>
<p>Depending on the errors in the response to the <a class="reference external" href="https://docs.databricks.com/api/account/introduction">get network configuration API</a> API request, confirm that:</p>
<ul class="simple">
<li><p>Your security group complies with the <a class="reference internal" href="../../security/network/classic/customer-managed-vpc.html"><span class="doc">customer-managed VPC requirements</span></a>.</p></li>
<li><p>Your cross-account IAM policy includes the required permissions. See <a class="reference internal" href="../account-settings-e2/credentials.html"><span class="doc">Create an IAM role for workspace deployment</span></a> for the policy to use for your deployment type.</p></li>
<li><p>Your Databricks account was enabled by Databricks for multiple workspaces and for any additional features you are using (customer-managed VPC, customer-managed notebooks, secure cluster connectivity). Contact your Databricks account team to confirm.</p></li>
</ul>
</div>
<div class="section" id="update-the-failed-workspace">
<h3>Update the failed workspace<a class="headerlink" href="#update-the-failed-workspace" title="Permalink to this headline"> </a></h3>
<p>To update the failed workspace, call the <a class="reference external" href="https://docs.databricks.com/api/account/introduction">update workspace and redeploy API</a> (<code class="docutils literal notranslate"><span class="pre">PATCH</span> <span class="pre">/accounts/&lt;account-id&gt;/workspaces/&lt;workspace-id&gt;</span></code>).</p>
<p>The update workspace API supports updates of workspace configurations that failed during workspace creation only to change the configurations for credentials, storage, network (for customer-managed VPC), and keys (for encrypting notebooks).</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>You can use the same API to update a running (successfully deployed) workspace but you only can change the credential and network configurations.</p>
</div>
<p>You can pass these workspace configuration fields to change them: <code class="docutils literal notranslate"><span class="pre">credentials_id</span></code>, <code class="docutils literal notranslate"><span class="pre">storage_configuration_id</span></code>, <code class="docutils literal notranslate"><span class="pre">network_id</span></code>,  <code class="docutils literal notranslate"><span class="pre">managed_services_customer_managed_key_id</span></code>, and <code class="docutils literal notranslate"><span class="pre">storage_customer_managed_key_id</span></code>.</p>
<p>If the <code class="docutils literal notranslate"><span class="pre">workspace_status</span></code> value returns <code class="docutils literal notranslate"><span class="pre">PROVISIONING</span></code>, keep checking for <code class="docutils literal notranslate"><span class="pre">RUNNING</span></code> state using the <a class="reference internal" href="#validate_network"><span class="std std-ref">get workspace API</span></a>.</p>
<p>For example:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="w">  </span>curl<span class="w"> </span>-X<span class="w"> </span>PATCH<span class="w"> </span><span class="s1">&#39;https://accounts.cloud.databricks.com/api/2.0/accounts/&lt;databricks-account-id&gt;/workspaces/&lt;databricks-workspace-id&gt;&#39;</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--header<span class="w"> </span><span class="s1">&#39;Authorization: Bearer $OAUTH_TOKEN&#39;</span><span class="w">  </span><span class="se">\</span>
<span class="w">  </span>-d<span class="w"> </span><span class="s1">&#39;{</span>
<span class="s1">  &quot;aws_region&quot;: &quot;us-west-2&quot;,</span>
<span class="s1">  &quot;credentials_id&quot;: &quot;&lt;aws-credentials-id&gt;&quot;,</span>
<span class="s1">  &quot;storage_configuration_id&quot;: &quot;&lt;databricks-storage-config-id&gt;&quot;,</span>
<span class="s1">  &quot;network_id&quot;: &quot;&lt;databricks-network-id&gt;&quot;,</span>
<span class="s1">  &quot;managed_services_customer_managed_key_id&quot;: &quot;&lt;aws-kms-managed-services-key-id&gt;&quot;,</span>
<span class="s1">  &quot;storage_customer_managed_key_id&quot;: &quot;&lt;aws-kms-notebook-workspace-storage-id&gt;&quot;</span>
<span class="s1">}&#39;</span>
</pre></div>
</div>
<p>Response:</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;workspace_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">123456789</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;workspace_name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;my-company-example&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;aws_region&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;us-west-2&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;creation_time&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1579768294842</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;deployment_name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;my-company-example&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;workspace_status&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;PROVISIONING&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;account_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;&lt;databricks-account-id&gt;&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;credentials_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;&lt;aws-credentials-id&gt;&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;storage_configuration_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;&lt;databricks-storage-config-id&gt;&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;workspace_status_message&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Workspace resources are being set up.&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;network_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;&lt;databricks-network-id&gt;&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;managed_services_customer_managed_key_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;&lt;aws-kms-managed-services-key-id&gt;&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;storage_customer_managed_key_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;&lt;aws-kms-notebook-workspace-storage-id&gt;&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;pricing_tier&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;ENTERPRISE&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="if-the-workspace-update-fails-recreate-the-network-and-workspace">
<h3>If the workspace update fails, recreate the network and workspace<a class="headerlink" href="#if-the-workspace-update-fails-recreate-the-network-and-workspace" title="Permalink to this headline"> </a></h3>
<p>If the update workspace API doesn’t work, you must delete and recreate the network (if you provided your own VPC) and the failed workspace in the following order.</p>
<ol class="arabic">
<li><p>Delete the workspace using the <a class="reference external" href="https://docs.databricks.com/api/account/introduction">delete workspace API</a> (<code class="docutils literal notranslate"><span class="pre">DELETE</span> <span class="pre">/accounts/&lt;account-id&gt;/workspaces/&lt;workspace-id&gt;</span></code>).</p>
<p>For example:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>curl<span class="w"> </span>-X<span class="w"> </span>DELETE
<span class="s1">&#39;https://accounts.cloud.databricks.com/api/2.0/accounts/&lt;databricks-account-id&gt;/workspaces/&lt;databricks-workspace-id&gt;&#39;</span><span class="w"> </span><span class="se">\</span>
<span class="w"> </span>--header<span class="w"> </span><span class="s1">&#39;Authorization: Bearer $OAUTH_TOKEN&#39;</span>
</pre></div>
</div>
</li>
<li><p>If you provided your own VPC, delete the Databricks network configuration using the <a class="reference external" href="https://docs.databricks.com/api/account/introduction">delete network configuration API</a> (<code class="docutils literal notranslate"><span class="pre">DELETE</span> <span class="pre">/accounts/&lt;account-id&gt;/networks/&lt;network-id&gt;</span></code>).</p>
<p>For example:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>curl<span class="w"> </span>-X<span class="w"> </span>DELETE
<span class="s1">&#39;https://accounts.cloud.databricks.com/api/2.0/accounts/&lt;databricks-account-id&gt;/networks/&lt;databricks-network-id&gt;&#39;</span>
<span class="w"> </span>--header<span class="w"> </span><span class="s1">&#39;Authorization: Bearer $OAUTH_TOKEN&#39;</span>
</pre></div>
</div>
</li>
<li><p><a class="reference internal" href="#vpc"><span class="std std-ref">Recreate the network</span></a> using the correct values for <code class="docutils literal notranslate"><span class="pre">vpc_id</span></code>, <code class="docutils literal notranslate"><span class="pre">subnet_ids</span></code> and <code class="docutils literal notranslate"><span class="pre">security_group_ids</span></code>.</p></li>
<li><p><a class="reference internal" href="#workspace"><span class="std std-ref">Recreate the workspace</span></a> using the correct values for <code class="docutils literal notranslate"><span class="pre">credentials_id</span></code>, <code class="docutils literal notranslate"><span class="pre">storage_configuration_id</span></code>, <code class="docutils literal notranslate"><span class="pre">network_id</span></code>,  <code class="docutils literal notranslate"><span class="pre">managed_services_customer_managed_key_id</span></code>, and <code class="docutils literal notranslate"><span class="pre">storage_customer_managed_key_id</span></code>.</p>
<p>If you get the <code class="docutils literal notranslate"><span class="pre">workspace_status</span></code> value <code class="docutils literal notranslate"><span class="pre">PROVISIONING</span></code>, keep checking for <code class="docutils literal notranslate"><span class="pre">RUNNING</span></code> state using the <a class="reference internal" href="#validate_network"><span class="std std-ref">get workspace API</span></a>.</p>
</li>
</ol>
</div>
</div>
</div>


    
          </div>
        </div>
        <div  class="suapp-rating">
  <div id="suPageRateApp">
     <su-app></su-app>
   </div> 
 </div>
<hr> 
<footer>
  <div role="contentinfo">
      <p class="copyright">
          &copy; Databricks 2023. All rights reserved. Apache, Apache Spark, Spark, and the Spark logo are trademarks of the <a href="http://www.apache.org/">Apache Software Foundation</a>.
      </p>
      <p> 
        
          <a id='feedbacklink' href="mailto:doc-feedback@databricks.com?subject=Documentation Feedback">Send us feedback</a>
        
     | <a href="https://databricks.com/privacy-policy">Privacy Policy</a> | <a href="https://databricks.com/terms-of-use">Terms of Use</a></p>

  </div> 

</footer>
      </div>
    </div>
  </section>
</main>

  </page>
  
  <script type="text/javascript">
    var DOCUMENTATION_OPTIONS = {
      URL_ROOT: '../../',
      VERSION: '1.0',
      COLLAPSE_INDEX: false,
      FILE_SUFFIX: '.html',
      HAS_SOURCE: 'false'
    };
  </script>
  <script type="text/javascript" src="../../_static/jquery.js"></script>
  <script type="text/javascript" src="../../_static/underscore.js"></script>
  <script type="text/javascript" src="../../_static/doctools.js"></script>
  <script type="text/javascript" src="../../_static/language_data.js"></script>
  

  <script type="text/javascript" src="../../_static/js/clipboard.min.js"></script>
  <script type="text/javascript" src="../../_static/js/jquery.waypoints.min.js"></script>

  <!-- Select2 (https://select2.org/) -->
  <link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />
  <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
  <!-- End Select2 -->

  
  
  <script type="text/javascript" src="../../_static/js/localized.js"></script>
  <script type="text/javascript" src="../../_static/js/custom.js"></script>
  

  
  
  <script type="text/javascript">
    jQuery(function () {
      SphinxRtdTheme.StickyNav.enable();
    });

  </script>
  
 



  <script>
  window.__searchunifyLoaderConfig = JSON.parse('{"clients": {"en": "02c2e804-27e9-11ee-aefb-0242ac120011", "ja": "6a42c3f2-2820-11ee-aefb-0242ac120011", "pt": "6a86badd-2821-11ee-aefb-0242ac120011"}}')
</script>
<script type="text/javascript" src="../../_static/js/search-loader.js"></script>
</body>
<script type='text/javascript'>
  window.onload = function () {
    var description = document.querySelector('meta[name="description"]').getAttribute("content");
    let titleText = document.querySelector('h1').textContent;
    document.querySelector('meta[property="og:title"]').setAttribute("content", titleText);
    document.querySelector('meta[property="og:description"]').setAttribute("content", description);
    document.querySelector('meta[property="twitter:description"]').setAttribute("content", description);
  };
</script>

</html>