

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en-US" > <![endif]-->
<!--[if gt IE 8]><!-->
<html class="no-js" lang="en-US"> <!--<![endif]-->

<head>
  <!-- cookie consent -->
  
    <!-- Combined Onetrust and Rudderstack Implementation Scripts -->
    <!-- Onetrust Initialization -->
    <script type="text/javascript" src="https://cdn.cookielaw.org/consent/92466579-1717-44d3-809d-a05fb02843ed-test/OtAutoBlock.js"></script>
    <script src="https://cdn.cookielaw.org/scripttemplates/otSDKStub.js" data-document-language="true" type="text/javascript" charset="UTF-8" data-domain-script="92466579-1717-44d3-809d-a05fb02843ed-test"></script>
    <link rel="stylesheet" id="db-onetrust-style" href="https://www.databricks.com/wp-content/uploads/db_onetrust.css" media="all" />
    <!-- Setting Rudderstack Write Key -->
    <script>window.rudderstackKey = "2SOR9fvSr5Fi6tN2ihPbVHnX1SZ" </script>
    <!-- Rudderstack Initialization + Onetrust Integration + Rudderstack Custom Events -->
    <script type="text/javascript" src="https://www.databricks.com/sites/default/files/rudderstack/v1/db-rudderstack-events.js"></script>

  <!-- cookie consent -->

  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta http-equiv="X-UA-Compatible" content="IE=9" />
  <meta content="Learn to utilize the audit log system table to gain insights and observability in your Databricks account." name="description" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0">
  <meta property="og:image" content="https://www.databricks.com/wp-content/uploads/2020/04/og-databricks.png">
  <meta property="og:image:type" content="image/png">
  <meta property="og:title" content="Audit log system table reference">
  <meta property="og:image:width" content="1200">
  <meta property="og:image:height" content="630">
  <meta property="og:type" content="website">
  <meta property="og:url" content="https://docs.databricks.com">
  <meta property="og:description" content="" id="og-description">
  <meta name="twitter:image" content="https://www.databricks.com/wp-content/uploads/2020/04/og-databricks.png">
  <meta name="twitter:site" content="@databricks">
  <meta name="twitter:creator" content="@databricks">
  <meta property="twitter:description" content="">
  
  <title>Audit log system table reference &#124; Databricks on AWS</title>
  
  
  <link rel="canonical" href="https://docs.databricks.com/en/administration-guide/system-tables/audit-logs.html">
  <!-- Start hreflang tag -->
  <link rel="alternate" hreflang="en" href="https://docs.databricks.com/en/administration-guide/system-tables/audit-logs.html" />
<link rel="alternate" hreflang="x-default" href="https://docs.databricks.com/en/administration-guide/system-tables/audit-logs.html" />
  <!-- End hreflang tag -->
  
  
  <link rel="shortcut icon" href="../../_static/favicon.ico" />
  

  

  

  <!-- Google Tag Manager -->
  <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'https://www.googletagmanager.com/gtm.js?id='+i+dl;
j.setAttributeNode(d.createAttribute('data-ot-ignore'));
f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-T85FQ33');</script>
  <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'https://www.googletagmanager.com/gtm.js?id='+i+dl;
j.setAttributeNode(d.createAttribute('data-ot-ignore'));
f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-TWTKQQ');</script>
    
  <!-- End Google Tag Manager -->


  <!-- MaxMind / GEO IP -->
  <script src="//js.maxmind.com/js/apis/geoip2/v2.1/geoip2.js" type="text/javascript"></script>
  <!-- End MaxMind / GEO IP -->

  
  
  <link href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,600&display=swap" rel="stylesheet">
  <link rel="preload" href="../../_static/fonts/DMSans-Bold.ttf" as="font">
  <link rel="preload" href="../../_static/fonts/DMSans-Regular.ttf" as="font">
  <link rel="preload" href="../../_static/fonts/DMMono-Regular.ttf" as="font">
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/css/custom.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/css/cloud-provider-selector.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/css/translation-selector.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/css/searchunify/main.css" type="text/css" />

  
  <link rel="index" title="Index" href="../../genindex.html" />
  <link rel="search" title="Search" href="../../search.html" />
  <link rel="top" title="Databricks on AWS" href="../../index.html" /> 
</head>

<body class="wy-body-for-nav" role="document">

  <!-- Google Tag Manager (noscript) -->
  <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-T85FQ33"
height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
  <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-TWTKQQ"
    height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
  <!-- End Google Tag Manager (noscript) -->

  
  <nav class="wy-nav-top header su_header" role="navigation" aria-label="top navigation">
    
<nav class="wy-nav-top header su_header" role="navigation" aria-label="top navigation">
  <div class="container-logo">
    <ul class="mobile-menu-toggle">
        <li class="menu-toggle">
            <i data-toggle="wy-nav-top" class="wy-nav-top-menu-button db-icon db-icon-menu pull-left"></i>
            
            <a href="https://www.databricks.com/" class="wy-nav-top-logo"><img src="../../_static/small-scale-lockup-full-color-rgb.svg" width="137" height="21"
              alt="Databricks" /></a>   
               
              </li>
    </ul>
    <ul class="su_nav-menu">
      <li class="menu-toggle">
        <i data-toggle="wy-nav-top" class="wy-nav-top-menu-button db-icon db-icon-menu pull-left"></i>
        
          
        
        <a href="https://www.databricks.com/" class="wy-nav-top-logo"><img src="../../_static/small-scale-lockup-full-color-rgb.svg" width="137" height="21"
            alt="Databricks" /></a></li>
        <!-- 
<li><a href="https://help.databricks.com/s/">Help Center</a></li>
<li class="active"><a href="https://docs.databricks.com/en/">Documentation</a></li>
<li><a href="https://kb.databricks.com/">Knowledge Base</a></li>
 -->
    </ul>
  </div>
  <div class="su_nav-right">
    <ul class="su_link-mobile">
  <!-- Mobile header code can go here -->
</ul>
<ul class="right-try-list">
   
</ul>
  </div>
</nav>
  </nav>

  <div class="su_sub-header">
    <div class="container">
      <div class="su_sub-header-inner">
        <!-- <div class="su_subnav-menu-right">
  <div id="auto" style="width: 100%;">
    <div ng-controller="SearchautoController">
      <div bind-html-compile="autocompleteHtml">
        <form class="su__search-box-1" disabled="disabled">
          <input class="su__search-input" type="search" name="Search box" id="su__search-b" placeholder="Search Documentation" disabled="disabled"/>
          <button class="su__search-button" type="submit" class="button button-success" disabled="disabled">
            <svg width="24" height="24" viewBox="0 0 24 24">
              <path
                d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"
                fill="#333"></path>
            </svg>
          </button>
        </form>
      </div>
    </div>
  </div>
</div> -->
        <div class="search-lng-gap"></div>
        <div style="margin-left: 16px; margin-right: 16px;">
          <!-- <select name="lng selector" id="lng-selector">
    <option value="../../../en/administration-guide/system-tables/audit-logs.html" class="notranslate">English</option>
    <option value="../../../ja/administration-guide/system-tables/audit-logs.html" class="notranslate">日本語</option>
    <option value="../../../pt/administration-guide/system-tables/audit-logs.html" class="notranslate">Português (Brasil)</option>
</select> -->
        </div>
        <div class="cloud-selector-container">
          <!-- <select name="cloud provider selector" id="cloud-provider-selector">
    <option value="aws" selected class="notranslate">
        Amazon Web Services
    </option>
    <option value="azure"  class="notranslate">
        Microsoft Azure
    </option>
    <option value="gcp"  class="notranslate">
        Google Cloud Platform
    </option>
</select> -->
        </div>
      </div>
    </div>
  </div>
  <page class="js-page-container">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side su_nav-side">
<div class="wy-side-scroll">
  <div class="wy-side-nav-search">
    

    

    

    
  </div>

  <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
    
      <a href="../../index.html" class="main-navigation-home">Databricks on AWS</a>
    

    
      

      
        <p class="caption"><span class="caption-text">Load &amp; manage data</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../rag-temp/index.html">RAG Studio</a></li>
</ul>

      
    
  </div>

  <div role="contentinfo">
    
  <p class="build_info notranslate"data-last-edit="December 23, 2023">
    Updated Jan 11, 2024
  </p>
<script>
  window.addEventListener('DOMContentLoaded',function(){
    var h1=document.querySelector('h1');
    var bi=document.querySelector('[data-last-edit]');
    if(h1 && bi){
      var ver = document.createElement('p');
      ver.className = 'version_info';
      ver.textContent = bi.getAttribute('data-last-edit');
      h1.parentElement.insertBefore(ver, h1.nextElementSibling);
    }
  });
</script>

    <p>
      
        <a id='feedbacklink' href="mailto:doc-feedback@databricks.com?subject=Documentation Feedback">Send us feedback</a>
      
    </p>
  </div>
</div>
</nav>
    
    
<main class="wy-grid-for-nav su_nav-grid">
  <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
    <div class="wy-nav-content su__nav_content">
      <div class="rst-content">
        





<div role="navigation" aria-label="breadcrumbs navigation" class="wy-breadcrumbs-wrapper">
  <ul class="wy-breadcrumbs">
    <li><a href="../../index.html">Documentation</a> <span class="db-icon db-icon-chevron-right"></span></li>
    
    
      <li>Audit log system table reference</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>
</div>
        
        <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
          <div itemprop="articleBody">
            
    
  <div class="section" id="audit-log-system-table-reference">
<h1>Audit log system table reference<a class="headerlink" href="#audit-log-system-table-reference" title="Permalink to this headline"> </a></h1>
<div class="preview admonition">
<p class="admonition-title">Preview</p>
<p>This feature is in <a class="reference internal" href="../../release-notes/release-types.html"><span class="doc">Public Preview</span></a>.</p>
</div>
<p>This article outlines the audit log table schema and provides you with sample queries you can use with the audit log system table to answer common account usage questions. For information on audit log events, see <a class="reference internal" href="../account-settings/audit-logs.html"><span class="doc">Audit log reference</span></a>.</p>
<p>The audit log system table is located at <code class="docutils literal notranslate"><span class="pre">system.access.audit</span></code>.</p>
<div class="section" id="audit-log-considerations">
<h2>Audit log considerations<a class="headerlink" href="#audit-log-considerations" title="Permalink to this headline"> </a></h2>
<ul class="simple">
<li><p>Most audit logs are only available in the region of the workspace.</p></li>
<li><p>Only Unity Catalog account-level logs are available in all regions.</p></li>
<li><p>Account-level audit logs record <code class="docutils literal notranslate"><span class="pre">workspace_id</span></code> as <code class="docutils literal notranslate"><span class="pre">0</span></code>.</p></li>
</ul>
</div>
<div class="section" id="audit-log-system-table-schema">
<h2>Audit log system table schema<a class="headerlink" href="#audit-log-system-table-schema" title="Permalink to this headline"> </a></h2>
<p>The audit log system table uses the following schema:</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 11%" />
<col style="width: 5%" />
<col style="width: 48%" />
<col style="width: 35%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Column name</p></th>
<th class="head"><p>Data type</p></th>
<th class="head"><p>Description</p></th>
<th class="head"><p>Example</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p> <code class="docutils literal notranslate"><span class="pre">version</span></code></p></td>
<td><p> string</p></td>
<td><p> Audit log schema version</p></td>
<td><p> <code class="docutils literal notranslate"><span class="pre">2.0</span></code></p></td>
</tr>
<tr class="row-odd"><td><p> <code class="docutils literal notranslate"><span class="pre">event_time</span></code></p></td>
<td><p> timestamp</p></td>
<td><p> Timestamp</p></td>
<td><p> <code class="docutils literal notranslate"><span class="pre">2023-01-01T01:01:01.123</span></code></p></td>
</tr>
<tr class="row-even"><td><p> <code class="docutils literal notranslate"><span class="pre">event_date</span></code></p></td>
<td><p> date</p></td>
<td><p> Calendar date the action took place</p></td>
<td><p> <code class="docutils literal notranslate"><span class="pre">2023-01-01</span></code></p></td>
</tr>
<tr class="row-odd"><td><p> <code class="docutils literal notranslate"><span class="pre">workspace_id</span></code></p></td>
<td><p> long</p></td>
<td><p> ID of the workspace</p></td>
<td><p> <code class="docutils literal notranslate"><span class="pre">1234567890123456</span></code></p></td>
</tr>
<tr class="row-even"><td><p> <code class="docutils literal notranslate"><span class="pre">source_ip_address</span></code></p></td>
<td><p> string</p></td>
<td><p> IP address where the request originated</p></td>
<td><p> <code class="docutils literal notranslate"><span class="pre">10.30.0.242</span></code></p></td>
</tr>
<tr class="row-odd"><td><p> <code class="docutils literal notranslate"><span class="pre">user_agent</span></code></p></td>
<td><p> string</p></td>
<td><p> Origination of request</p></td>
<td><p> <code class="docutils literal notranslate"><span class="pre">Apache-HttpClient/4.5.13</span> <span class="pre">(Java/1.8.0_345)</span></code></p></td>
</tr>
<tr class="row-even"><td><p> <code class="docutils literal notranslate"><span class="pre">session_id</span></code></p></td>
<td><p> string</p></td>
<td><p> ID of the session where the request came from</p></td>
<td><p> <code class="docutils literal notranslate"><span class="pre">123456789</span></code></p></td>
</tr>
<tr class="row-odd"><td><p> <code class="docutils literal notranslate"><span class="pre">user_identity</span></code></p></td>
<td><p> string</p></td>
<td><p> Identity of user initiating request</p></td>
<td><p> <code class="docutils literal notranslate"><span class="pre">{&quot;email&quot;:</span> <span class="pre">&quot;user&#64;domain.com&quot;,</span> <span class="pre">&quot;subjectName&quot;:</span> <span class="pre">null}</span></code></p></td>
</tr>
<tr class="row-even"><td><p> <code class="docutils literal notranslate"><span class="pre">service_name</span></code></p></td>
<td><p> string</p></td>
<td><p> Service name initiating request</p></td>
<td><p> <code class="docutils literal notranslate"><span class="pre">unityCatalog</span></code></p></td>
</tr>
<tr class="row-odd"><td><p> <code class="docutils literal notranslate"><span class="pre">action_name</span></code></p></td>
<td><p> string</p></td>
<td><p> Category of the event captured in audit log</p></td>
<td><p> <code class="docutils literal notranslate"><span class="pre">getTable</span></code></p></td>
</tr>
<tr class="row-even"><td><p> <code class="docutils literal notranslate"><span class="pre">request_id</span></code></p></td>
<td><p> string</p></td>
<td><p> ID of request</p></td>
<td><p> <code class="docutils literal notranslate"><span class="pre">ServiceMain-4529754264</span></code></p></td>
</tr>
<tr class="row-odd"><td><p> <code class="docutils literal notranslate"><span class="pre">request_params</span></code></p></td>
<td><p> map</p></td>
<td><p> Map of key values containing all the request parameters. Depends on request type</p></td>
<td><p> <code class="docutils literal notranslate"><span class="pre">[[&quot;full_name_arg&quot;,</span> <span class="pre">&quot;user.chat.messages&quot;],</span></code>
<code class="docutils literal notranslate"><span class="pre">[&quot;workspace_id&quot;,</span> <span class="pre">&quot;123456789&quot;],</span></code>
<code class="docutils literal notranslate"><span class="pre">[&quot;metastore_id&quot;,</span> <span class="pre">&quot;123456789&quot;]]</span></code></p></td>
</tr>
<tr class="row-even"><td><p> <code class="docutils literal notranslate"><span class="pre">response</span></code></p></td>
<td><p> struct</p></td>
<td><p> Struct of response return values</p></td>
<td><p> <code class="docutils literal notranslate"><span class="pre">{&quot;statusCode&quot;:</span> <span class="pre">200,</span> <span class="pre">&quot;errorMessage&quot;:</span> <span class="pre">null,</span> <span class="pre">&quot;result&quot;:</span> <span class="pre">null}</span></code></p></td>
</tr>
<tr class="row-odd"><td><p> <code class="docutils literal notranslate"><span class="pre">audit_level</span></code></p></td>
<td><p> string</p></td>
<td><p> Workspace or account level event</p></td>
<td><p> <code class="docutils literal notranslate"><span class="pre">ACCOUNT_LEVEL</span></code></p></td>
</tr>
<tr class="row-even"><td><p> <code class="docutils literal notranslate"><span class="pre">account_id</span></code></p></td>
<td><p> string</p></td>
<td><p> ID of the account</p></td>
<td><p> <code class="docutils literal notranslate"><span class="pre">23e22ba4-87b9-4cc2-9770-d10b894bxx</span></code></p></td>
</tr>
<tr class="row-odd"><td><p> <code class="docutils literal notranslate"><span class="pre">event_id</span></code></p></td>
<td><p> string</p></td>
<td><p> ID of the event</p></td>
<td><p> <code class="docutils literal notranslate"><span class="pre">34ac703c772f3549dcc8671f654950f0</span></code></p></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="example-queries">
<h2>Example queries<a class="headerlink" href="#example-queries" title="Permalink to this headline"> </a></h2>
<p>The following sections include sample queries you can use to gain insights with your audit logs system table. For these queries to work, replace the values within curly brackets <code class="docutils literal notranslate"><span class="pre">{{}}</span></code> with your own parameters.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Some of these examples include verbose audit log events, which are not enabled by default. To enable verbose audit logs in a workspace, see <a class="reference internal" href="../account-settings/audit-log-delivery.html#verbose-audit-logs"><span class="std std-ref">Enable verbose audit logs</span></a>.</p>
</div>
<p>This article includes the following example queries:</p>
<ul class="simple">
<li><p><a class="reference internal" href="#table-access"><span class="std std-ref">Who accessed this table?</span></a></p></li>
<li><p><a class="reference internal" href="#which-users"><span class="std std-ref">Which users accessed a table within the last day?</span></a></p></li>
<li><p><a class="reference internal" href="#which-tables"><span class="std std-ref">Which tables did a user access?</span></a></p></li>
<li><p><a class="reference internal" href="#permissions"><span class="std std-ref">View all permissions changes</span></a></p></li>
<li><p><a class="reference internal" href="#commands"><span class="std std-ref">View the most recently run notebook commands</span></a></p></li>
</ul>
<div class="section" id="who-accessed-this-table">
<span id="table-access"></span><h3>Who accessed this table?<a class="headerlink" href="#who-accessed-this-table" title="Permalink to this headline"> </a></h3>
<p>This query uses the <code class="docutils literal notranslate"><span class="pre">information_schema</span></code>.</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">SELECT</span><span class="w"> </span><span class="k">DISTINCT</span><span class="p">(</span><span class="n">grantee</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="o">`</span><span class="n">ACCESSIBLE</span><span class="w"> </span><span class="k">BY</span><span class="o">`</span>
<span class="k">FROM</span><span class="w"> </span><span class="k">system</span><span class="p">.</span><span class="n">information_schema</span><span class="p">.</span><span class="n">table_privileges</span>
<span class="k">WHERE</span><span class="w"> </span><span class="n">table_schema</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;{{schema_name}}&#39;</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="k">table_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;{{table_name}}&#39;</span>
<span class="w">  </span><span class="k">UNION</span>
<span class="w">    </span><span class="k">SELECT</span><span class="w"> </span><span class="n">table_owner</span>
<span class="w">    </span><span class="k">FROM</span><span class="w"> </span><span class="k">system</span><span class="p">.</span><span class="n">information_schema</span><span class="p">.</span><span class="n">tables</span>
<span class="w">    </span><span class="k">WHERE</span><span class="w"> </span><span class="n">table_schema</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;{{schema_name}}&#39;</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="k">table_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;{{table}}&#39;</span>
<span class="w">  </span><span class="k">UNION</span>
<span class="w">    </span><span class="k">SELECT</span><span class="w"> </span><span class="k">DISTINCT</span><span class="p">(</span><span class="n">grantee</span><span class="p">)</span>
<span class="w">    </span><span class="k">FROM</span><span class="w"> </span><span class="k">system</span><span class="p">.</span><span class="n">information_schema</span><span class="p">.</span><span class="n">schema_privileges</span>
<span class="w">    </span><span class="k">WHERE</span><span class="w"> </span><span class="k">schema_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;{{schema_name}}&#39;</span>
</pre></div>
</div>
</div>
<div class="section" id="which-users-accessed-a-table-within-the-last-day">
<span id="which-users"></span><h3>Which users accessed a table within the last day?<a class="headerlink" href="#which-users-accessed-a-table-within-the-last-day" title="Permalink to this headline"> </a></h3>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Full names are not captured in the log for DML operations. Include the schema and simple name to capture all.</p>
</div>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">SELECT</span>
<span class="w">  </span><span class="n">user_identity</span><span class="p">.</span><span class="n">email</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="o">`</span><span class="k">User</span><span class="o">`</span><span class="p">,</span>
<span class="w">  </span><span class="n">IFNULL</span><span class="p">(</span><span class="n">request_params</span><span class="p">.</span><span class="n">full_name_arg</span><span class="p">,</span>
<span class="w">    </span><span class="n">request_params</span><span class="p">.</span><span class="n">name</span><span class="p">)</span>
<span class="w">    </span><span class="k">AS</span><span class="w"> </span><span class="o">`</span><span class="k">Table</span><span class="o">`</span><span class="p">,</span>
<span class="w">    </span><span class="n">action_name</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="o">`</span><span class="k">Type</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="k">Access</span><span class="o">`</span><span class="p">,</span>
<span class="w">    </span><span class="n">event_time</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="o">`</span><span class="k">Time</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="k">Access</span><span class="o">`</span>
<span class="k">FROM</span><span class="w"> </span><span class="k">system</span><span class="p">.</span><span class="k">access</span><span class="p">.</span><span class="n">audit</span>
<span class="k">WHERE</span><span class="w"> </span><span class="p">(</span><span class="n">request_params</span><span class="p">.</span><span class="n">full_name_arg</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;{{catalog.schema.table}}&#39;</span>
<span class="w">  </span><span class="k">OR</span><span class="w"> </span><span class="p">(</span><span class="n">request_params</span><span class="p">.</span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;{{table_name}}&#39;</span>
<span class="w">  </span><span class="k">AND</span><span class="w"> </span><span class="n">request_params</span><span class="p">.</span><span class="k">schema_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;{{schema_name}}&#39;</span><span class="p">))</span>
<span class="w">  </span><span class="k">AND</span><span class="w"> </span><span class="n">action_name</span>
<span class="w">    </span><span class="k">IN</span><span class="w"> </span><span class="p">(</span><span class="s1">&#39;createTable&#39;</span><span class="p">,</span><span class="s1">&#39;getTable&#39;</span><span class="p">,</span><span class="s1">&#39;deleteTable&#39;</span><span class="p">)</span>
<span class="w">  </span><span class="k">AND</span><span class="w"> </span><span class="n">event_date</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">now</span><span class="p">()</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nb">interval</span><span class="w"> </span><span class="s1">&#39;1 day&#39;</span>
<span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">event_date</span><span class="w"> </span><span class="k">DESC</span>
</pre></div>
</div>
</div>
<div class="section" id="which-tables-did-a-user-access">
<span id="which-tables"></span><h3>Which tables did a user access?<a class="headerlink" href="#which-tables-did-a-user-access" title="Permalink to this headline"> </a></h3>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>To filter by date range, uncomment out the date clause at the bottom of the query.</p>
</div>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">SELECT</span>
<span class="w">        </span><span class="n">action_name</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="o">`</span><span class="n">EVENT</span><span class="o">`</span><span class="p">,</span>
<span class="w">        </span><span class="n">event_time</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="o">`</span><span class="k">WHEN</span><span class="o">`</span><span class="p">,</span>
<span class="w">        </span><span class="n">IFNULL</span><span class="p">(</span><span class="n">request_params</span><span class="p">.</span><span class="n">full_name_arg</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;Non-specific&#39;</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="o">`</span><span class="k">TABLE</span><span class="w"> </span><span class="n">ACCESSED</span><span class="o">`</span><span class="p">,</span>
<span class="w">        </span><span class="n">IFNULL</span><span class="p">(</span><span class="n">request_params</span><span class="p">.</span><span class="n">commandText</span><span class="p">,</span><span class="s1">&#39;GET table&#39;</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="o">`</span><span class="n">QUERY</span><span class="w"> </span><span class="nb">TEXT</span><span class="o">`</span>
<span class="k">FROM</span><span class="w"> </span><span class="k">system</span><span class="p">.</span><span class="k">access</span><span class="p">.</span><span class="n">audit</span>
<span class="k">WHERE</span><span class="w"> </span><span class="n">user_identity</span><span class="p">.</span><span class="n">email</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;{{User}}&#39;</span>
<span class="w">        </span><span class="k">AND</span><span class="w"> </span><span class="n">action_name</span><span class="w"> </span><span class="k">IN</span><span class="w"> </span><span class="p">(</span><span class="s1">&#39;createTable&#39;</span><span class="p">,</span>
<span class="s1">&#39;commandSubmit&#39;</span><span class="p">,</span><span class="s1">&#39;getTable&#39;</span><span class="p">,</span><span class="s1">&#39;deleteTable&#39;</span><span class="p">)</span>
<span class="w">        </span><span class="c1">-- AND datediff(now(), event_date) &lt; 1</span>
<span class="w">        </span><span class="c1">-- ORDER BY event_date DESC</span>
</pre></div>
</div>
<div class="section" id="example-result">
<h4>Example result<a class="headerlink" href="#example-result" title="Permalink to this headline"> </a></h4>
<table class="docutils align-default">
<colgroup>
<col style="width: 17%" />
<col style="width: 14%" />
<col style="width: 33%" />
<col style="width: 36%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p><code class="docutils literal notranslate"><span class="pre">EVENT</span></code></p></th>
<th class="head"><p><code class="docutils literal notranslate"><span class="pre">WHEN</span></code></p></th>
<th class="head"><p><code class="docutils literal notranslate"><span class="pre">TABLE</span> <span class="pre">ACCESSED</span></code></p></th>
<th class="head"><p><code class="docutils literal notranslate"><span class="pre">QUERY</span> <span class="pre">TEXT</span></code></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>  <code class="docutils literal notranslate"><span class="pre">getTable</span></code></p></td>
<td><p>  <code class="docutils literal notranslate"><span class="pre">2023-05-31</span></code></p></td>
<td><p>  <code class="docutils literal notranslate"><span class="pre">system.access.audit</span></code></p></td>
<td><p>  <code class="docutils literal notranslate"><span class="pre">GET</span> <span class="pre">table</span></code></p></td>
</tr>
<tr class="row-odd"><td><p>  <code class="docutils literal notranslate"><span class="pre">getTable</span></code></p></td>
<td><p>  <code class="docutils literal notranslate"><span class="pre">2023-05-31</span></code></p></td>
<td><p>  <code class="docutils literal notranslate"><span class="pre">system.access.table_lineage</span></code></p></td>
<td><p>  <code class="docutils literal notranslate"><span class="pre">GET</span> <span class="pre">table</span></code></p></td>
</tr>
<tr class="row-even"><td><p>  <code class="docutils literal notranslate"><span class="pre">commandSubmit</span></code></p></td>
<td><p>  <code class="docutils literal notranslate"><span class="pre">2023-05-31</span></code></p></td>
<td><p>  <code class="docutils literal notranslate"><span class="pre">Non-specific</span></code></p></td>
<td><p>  <code class="docutils literal notranslate"><span class="pre">show</span> <span class="pre">functions;</span></code></p></td>
</tr>
<tr class="row-odd"><td><p>  <code class="docutils literal notranslate"><span class="pre">commandSubmit</span></code></p></td>
<td><p>  <code class="docutils literal notranslate"><span class="pre">2023-05-31</span></code></p></td>
<td><p>  <code class="docutils literal notranslate"><span class="pre">Non-specific</span></code></p></td>
<td><p>  <code class="docutils literal notranslate"><span class="pre">SELECT</span></code></p>
<p>  <code class="docutils literal notranslate"><span class="pre">request_params</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">FROM</span></code></p>
<p>  <code class="docutils literal notranslate"><span class="pre">system.access.audit</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">WHERE</span></code></p>
<p>  <code class="docutils literal notranslate"><span class="pre">service_name</span> <span class="pre">=</span> <span class="pre">&quot;notebook&quot;</span></code></p>
<p>  <code class="docutils literal notranslate"><span class="pre">AND</span> <span class="pre">action_name</span> <span class="pre">=</span> <span class="pre">&quot;moveFolder&quot;</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">LIMIT</span></code></p>
<p>  <code class="docutils literal notranslate"><span class="pre">5</span></code></p>
</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="view-permissions-changes-for-all-securable-objects">
<span id="permissions"></span><h3>View permissions changes for all securable objects<a class="headerlink" href="#view-permissions-changes-for-all-securable-objects" title="Permalink to this headline"> </a></h3>
<p>This query will return an event for every permission change that has occured in your account. The query will return the user who made the change, the securable object type and name, and the specific changes that were made.</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">SELECT</span><span class="w"> </span><span class="n">event_time</span><span class="p">,</span><span class="w"> </span><span class="n">user_identity</span><span class="p">.</span><span class="n">email</span><span class="p">,</span><span class="w"> </span><span class="n">request_params</span><span class="p">.</span><span class="n">securable_type</span><span class="p">,</span><span class="w"> </span><span class="n">request_params</span><span class="p">.</span><span class="n">securable_full_name</span><span class="p">,</span><span class="w"> </span><span class="n">request_params</span><span class="p">.</span><span class="n">changes</span>
<span class="k">FROM</span><span class="w"> </span><span class="k">system</span><span class="p">.</span><span class="k">access</span><span class="p">.</span><span class="n">audit</span>
<span class="k">WHERE</span><span class="w"> </span><span class="n">service_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;unityCatalog&#39;</span>
<span class="w">  </span><span class="k">AND</span><span class="w"> </span><span class="n">action_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;updatePermissions&#39;</span>
<span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="k">DESC</span>
</pre></div>
</div>
</div>
<div class="section" id="view-the-most-recently-run-notebook-commands">
<span id="commands"></span><h3>View the most recently run notebook commands<a class="headerlink" href="#view-the-most-recently-run-notebook-commands" title="Permalink to this headline"> </a></h3>
<p>This query returns the most recently run notebook commands along with the user who ran the command.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The <code class="docutils literal notranslate"><span class="pre">runCommand</span></code> action is only emitted when verbose audit logs are enabled. To enable verbose audit logs, see <a class="reference internal" href="../account-settings/audit-log-delivery.html#verbose-audit-logs"><span class="std std-ref">Enable verbose audit logs</span></a>.</p>
</div>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">SELECT</span><span class="w"> </span><span class="n">event_time</span><span class="p">,</span><span class="w"> </span><span class="n">user_identity</span><span class="p">.</span><span class="n">email</span><span class="p">,</span><span class="w"> </span><span class="n">request_params</span><span class="p">.</span><span class="n">commandText</span>
<span class="k">FROM</span><span class="w"> </span><span class="k">system</span><span class="p">.</span><span class="k">access</span><span class="p">.</span><span class="n">audit</span>
<span class="k">WHERE</span><span class="w"> </span><span class="n">action_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">`</span><span class="n">runCommand</span><span class="o">`</span>
<span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">event_time</span><span class="w"> </span><span class="k">DESC</span>
<span class="k">LIMIT</span><span class="w"> </span><span class="mi">100</span>
</pre></div>
</div>
</div>
</div>
</div>


    
          </div>
        </div>
        <div  class="suapp-rating">
  <div id="suPageRateApp">
     <su-app></su-app>
   </div> 
 </div>
<hr> 
<footer>
  <div role="contentinfo">
      <p class="copyright">
          &copy; Databricks 2023. All rights reserved. Apache, Apache Spark, Spark, and the Spark logo are trademarks of the <a href="http://www.apache.org/">Apache Software Foundation</a>.
      </p>
      <p> 
        
          <a id='feedbacklink' href="mailto:doc-feedback@databricks.com?subject=Documentation Feedback">Send us feedback</a>
        
     | <a href="https://databricks.com/privacy-policy">Privacy Policy</a> | <a href="https://databricks.com/terms-of-use">Terms of Use</a></p>

  </div> 

</footer>
      </div>
    </div>
  </section>
</main>

  </page>
  
  <script type="text/javascript">
    var DOCUMENTATION_OPTIONS = {
      URL_ROOT: '../../',
      VERSION: '1.0',
      COLLAPSE_INDEX: false,
      FILE_SUFFIX: '.html',
      HAS_SOURCE: 'false'
    };
  </script>
  <script type="text/javascript" src="../../_static/jquery.js"></script>
  <script type="text/javascript" src="../../_static/underscore.js"></script>
  <script type="text/javascript" src="../../_static/doctools.js"></script>
  <script type="text/javascript" src="../../_static/language_data.js"></script>
  

  <script type="text/javascript" src="../../_static/js/clipboard.min.js"></script>
  <script type="text/javascript" src="../../_static/js/jquery.waypoints.min.js"></script>

  <!-- Select2 (https://select2.org/) -->
  <link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />
  <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
  <!-- End Select2 -->

  
  
  <script type="text/javascript" src="../../_static/js/localized.js"></script>
  <script type="text/javascript" src="../../_static/js/custom.js"></script>
  

  
  
  <script type="text/javascript">
    jQuery(function () {
      SphinxRtdTheme.StickyNav.enable();
    });

  </script>
  
 



  <script>
  window.__searchunifyLoaderConfig = JSON.parse('{"clients": {"en": "02c2e804-27e9-11ee-aefb-0242ac120011", "ja": "6a42c3f2-2820-11ee-aefb-0242ac120011", "pt": "6a86badd-2821-11ee-aefb-0242ac120011"}}')
</script>
<script type="text/javascript" src="../../_static/js/search-loader.js"></script>
</body>
<script type='text/javascript'>
  window.onload = function () {
    var description = document.querySelector('meta[name="description"]').getAttribute("content");
    let titleText = document.querySelector('h1').textContent;
    document.querySelector('meta[property="og:title"]').setAttribute("content", titleText);
    document.querySelector('meta[property="og:description"]').setAttribute("content", description);
    document.querySelector('meta[property="twitter:description"]').setAttribute("content", description);
  };
</script>

</html>